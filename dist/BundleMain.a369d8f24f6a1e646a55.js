"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["BundleMain"],{

/***/ "./src/bundles/main.ts":
/*!*****************************!*\
  !*** ./src/bundles/main.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LockScreen: () => (/* reexport safe */ _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_4__["default"]),
/* harmony export */   Main: () => (/* reexport safe */ _components_main_Main__WEBPACK_IMPORTED_MODULE_3__["default"])
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _components_main_Main__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../components/main/Main */ "./src/components/main/Main.tsx");
/* harmony import */ var _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../components/main/LockScreen */ "./src/components/main/LockScreen.tsx");





if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
  // eslint-disable-next-line no-console
  console.log('>>> FINISH LOAD MAIN BUNDLE');
}
const {
  passcode: {
    isScreenLocked
  },
  connectionState
} = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
if (!connectionState && !isScreenLocked && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_MULTITAB_SUPPORTED) {
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)().initApi();
}

/***/ }),

/***/ "./src/components/calls/ActiveCallHeader.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/calls/ActiveCallHeader.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ActiveCallHeaderAsync = props => {
  const {
    isActive
  } = props;
  const ActiveCallHeader = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'ActiveCallHeader', !isActive);
  return ActiveCallHeader ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ActiveCallHeader, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ActiveCallHeaderAsync);

/***/ }),

/***/ "./src/components/calls/group/GroupCall.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/calls/group/GroupCall.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GroupCallAsync = props => {
  const {
    groupCallId
  } = props;
  const GroupCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'GroupCall', !groupCallId);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return GroupCall ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GroupCall, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GroupCallAsync);

/***/ }),

/***/ "./src/components/calls/phone/PhoneCall.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/calls/phone/PhoneCall.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PhoneCallAsync = props => {
  const {
    isActive
  } = props;
  const PhoneCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'PhoneCall', !isActive);
  return PhoneCall ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PhoneCall, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PhoneCallAsync);

/***/ }),

/***/ "./src/components/calls/phone/RatePhoneCallModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/calls/phone/RatePhoneCallModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const RatePhoneCallModalAsync = props => {
  const {
    isOpen
  } = props;
  const RatePhoneCallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'RatePhoneCallModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return RatePhoneCallModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(RatePhoneCallModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RatePhoneCallModalAsync);

/***/ }),

/***/ "./src/components/common/AboutAdsModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/common/AboutAdsModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AboutAdsModalAsync = props => {
  const {
    isOpen
  } = props;
  const AboutAdsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AboutAdsModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return AboutAdsModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AboutAdsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutAdsModalAsync);

/***/ }),

/***/ "./src/components/common/CustomEmojiSetsModal.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/common/CustomEmojiSetsModal.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CustomEmojiSetsModalAsync = props => {
  const {
    customEmojiSetIds
  } = props;
  const CustomEmojiSetsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CustomEmojiSetsModal', !customEmojiSetIds);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return CustomEmojiSetsModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CustomEmojiSetsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomEmojiSetsModalAsync);

/***/ }),

/***/ "./src/components/common/PeerColorWrapper.tsx":
/*!****************************************************!*\
  !*** ./src/components/common/PeerColorWrapper.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_peerColor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _embedded_EmojiIconBackground__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./embedded/EmojiIconBackground */ "./src/components/common/embedded/EmojiIconBackground.tsx");
/* harmony import */ var _PeerColorWrapper_module_scss__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./PeerColorWrapper.module.scss */ "./src/components/common/PeerColorWrapper.module.scss");
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }





function PeerColorWrapper(_ref) {
  let {
    peer,
    peerColor,
    noUserColors,
    shoudReset,
    className,
    emojiIconClassName,
    children,
    ...otherProps
  } = _ref;
  const color = peerColor || peer?.color;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", _extends({
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_PeerColorWrapper_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].root, peer && (0,_helpers_peerColor__WEBPACK_IMPORTED_MODULE_2__.getPeerColorClass)(peer, noUserColors, shoudReset), peerColor && (0,_helpers_peerColor__WEBPACK_IMPORTED_MODULE_2__.getApiPeerColorClass)(peerColor), className)
    // eslint-disable-next-line react/jsx-props-no-spreading
  }, otherProps), color?.backgroundEmojiId && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_embedded_EmojiIconBackground__WEBPACK_IMPORTED_MODULE_3__["default"], {
    className: emojiIconClassName,
    emojiDocumentId: color.backgroundEmojiId
  }), children);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PeerColorWrapper));

/***/ }),

/***/ "./src/components/common/PrivacySettingsNoticeModal.async.tsx":
/*!********************************************************************!*\
  !*** ./src/components/common/PrivacySettingsNoticeModal.async.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PrivacySettingsNoticeModalAsync = props => {
  const {
    isOpen
  } = props;
  const PrivacySettingsNoticeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PrivacySettingsNoticeModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PrivacySettingsNoticeModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PrivacySettingsNoticeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PrivacySettingsNoticeModalAsync);

/***/ }),

/***/ "./src/components/common/SeenByModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/common/SeenByModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SeenByModalAsync = props => {
  const {
    isOpen
  } = props;
  const SeenByModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SeenByModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return SeenByModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SeenByModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SeenByModalAsync);

/***/ }),

/***/ "./src/components/common/StickerSetModal.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/common/StickerSetModal.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StickerSetModalAsync = props => {
  const {
    isOpen
  } = props;
  const StickerSetModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StickerSetModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StickerSetModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StickerSetModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSetModalAsync);

/***/ }),

/***/ "./src/components/common/TopicChip.tsx":
/*!*********************************************!*\
  !*** ./src/components/common/TopicChip.tsx ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_forumColors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/forumColors */ "./src/util/forumColors.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _TopicIcon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _TopicChip_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./TopicChip.module.scss */ "./src/components/common/TopicChip.module.scss");
/* harmony import */ var _assets_blank_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../assets/blank.png */ "./src/assets/blank.png");









const TOPIC_ICON_SIZE = 1.125 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const TopicChip = _ref => {
  let {
    topic,
    className,
    onClick
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_TopicChip_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, className),
    style: `--topic-button-accent-color: var(${(0,_util_forumColors__WEBPACK_IMPORTED_MODULE_2__.getTopicColorCssVariable)(topic?.iconColor)})`,
    onClick: onClick
  }, topic ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    topic: topic,
    size: TOPIC_ICON_SIZE
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _assets_blank_png__WEBPACK_IMPORTED_MODULE_8__,
    alt: "",
    draggable: false
  }), topic?.title ? (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(topic.title) : lang('Loading'), topic?.isClosed && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-lock"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-next"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(TopicChip));

/***/ }),

/***/ "./src/components/common/UnpinAllMessagesModal.async.tsx":
/*!***************************************************************!*\
  !*** ./src/components/common/UnpinAllMessagesModal.async.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const UnpinAllMessagesModalAsync = props => {
  const {
    isOpen
  } = props;
  const UnpinAllMessagesModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'UnpinAllMessagesModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return UnpinAllMessagesModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(UnpinAllMessagesModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UnpinAllMessagesModalAsync);

/***/ }),

/***/ "./src/components/common/UnreadCounter.tsx":
/*!*************************************************!*\
  !*** ./src/components/common/UnreadCounter.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_appBadge__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/appBadge */ "./src/util/appBadge.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");





const UnreadCounter = _ref => {
  let {
    isForAppBadge
  } = _ref;
  (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__.useFolderManagerForUnreadCounters)();
  const unreadNotificationsCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_2__.getAllNotificationsCount)();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isForAppBadge) {
      (0,_util_appBadge__WEBPACK_IMPORTED_MODULE_1__.updateAppBadge)(unreadNotificationsCount);
    }
  }, [isForAppBadge, unreadNotificationsCount]);
  if (isForAppBadge || !unreadNotificationsCount) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "unread-count active"
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(unreadNotificationsCount));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UnreadCounter));

/***/ }),

/***/ "./src/components/common/embedded/EmbeddedStory.tsx":
/*!**********************************************************!*\
  !*** ./src/components/common/embedded/EmbeddedStory.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_peerColor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _EmbeddedMessage_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./EmbeddedMessage.scss */ "./src/components/common/embedded/EmbeddedMessage.scss");














const NBSP = '\u00A0';
const EmbeddedStory = _ref => {
  let {
    story,
    sender,
    noUserColors,
    isProtected,
    observeIntersectionForLoading,
    onClick
  } = _ref;
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__.useIsIntersecting)(ref, observeIntersectionForLoading);
  const isFullStory = story && 'content' in story;
  const isExpiredStory = story && 'isDeleted' in story;
  const isVideoStory = isFullStory && Boolean(story.content.video);
  const title = isFullStory ? 'Story' : isExpiredStory ? 'ExpiredStory' : 'Loading';
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(isFullStory && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story, 'pictogram'), !isIntersecting);
  const mediaThumbnail = isVideoStory ? story.content.video.thumbnail?.dataUri : undefined;
  const pictogramUrl = mediaBlobUrl || mediaThumbnail;
  const senderTitle = sender ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getSenderTitle)(lang, sender) : undefined;
  const handleFastClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (story && !isExpiredStory) {
      onClick();
    } else {
      showNotification({
        message: lang('StoryNotFound')
      });
    }
  });
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__.useFastClick)(handleFastClick);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('EmbeddedMessage', (0,_helpers_peerColor__WEBPACK_IMPORTED_MODULE_5__.getPeerColorClass)(sender, noUserColors, true), pictogramUrl && 'with-thumb'),
    onClick: handleClick,
    onMouseDown: handleMouseDown
  }, pictogramUrl && renderPictogram(pictogramUrl, isProtected), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-text with-message-color"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "embedded-text-wrapper"
  }, isExpiredStory && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "story-expired",
    className: "embedded-origin-icon"
  }), isFullStory && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "story-reply",
    className: "embedded-origin-icon"
  }), lang(title)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-title"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(senderTitle || NBSP))));
};
function renderPictogram(srcUrl, isProtected) {
  const {
    width,
    height
  } = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.getPictogramDimensions)();
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "embedded-thumb"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: srcUrl,
    width: width,
    height: height,
    alt: "",
    className: "pictogram",
    draggable: false
  }), isProtected && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmbeddedStory);

/***/ }),

/***/ "./src/components/common/hooks/useAnimatedEmoji.ts":
/*!*********************************************************!*\
  !*** ./src/components/common/hooks/useAnimatedEmoji.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useAnimatedEmoji)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_safePlay__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/safePlay */ "./src/util/safePlay.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");








const SIZE = 7 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM;
const INTERACTION_BUNCH_TIME = 1000;
const MS_DIVIDER = 1000;
const TIME_DEFAULT = 0;
function useAnimatedEmoji(chatId, messageId, soundId, activeEmojiInteractions, isOwn, emoji, preferredSize) {
  const {
    interactWithAnimatedEmoji,
    sendEmojiInteraction,
    sendWatchingEmojiInteraction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);

  // eslint-disable-next-line no-null/no-null
  const audioRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const soundMediaData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(soundId ? `document${soundId}` : undefined, !soundId);
  const size = preferredSize || SIZE;
  const style = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_2__["default"])(`width: ${size}px`, `height: ${size}px`, emoji && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_ELECTRON && 'cursor: pointer');
  const interactions = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const startedInteractions = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const sendInteractionBunch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const container = ref.current;
    if (!container) return;
    sendEmojiInteraction({
      chatId: chatId,
      messageId: messageId,
      emoji: emoji,
      interactions: interactions.current
    });
    startedInteractions.current = undefined;
    interactions.current = undefined;
  });
  const play = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const audio = audioRef.current;
    if (soundMediaData) {
      if (audio) {
        audio.pause();
        audio.remove();
      }
      audioRef.current = new Audio();
      audioRef.current.src = soundMediaData;
      (0,_util_safePlay__WEBPACK_IMPORTED_MODULE_3__["default"])(audioRef.current);
      audioRef.current.addEventListener('ended', () => {
        audioRef.current = undefined;
      }, {
        once: true
      });
    }
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    play();
    const container = ref.current;
    if (!emoji || !container || !messageId || !chatId) {
      return;
    }
    const {
      x,
      y
    } = container.getBoundingClientRect();
    interactWithAnimatedEmoji({
      emoji: emoji,
      x,
      y,
      startSize: size,
      isReversed: !isOwn
    });
    if (!interactions.current) {
      interactions.current = [];
      startedInteractions.current = performance.now();
      setTimeout(sendInteractionBunch, INTERACTION_BUNCH_TIME);
    }
    interactions.current.push(startedInteractions.current ? (performance.now() - startedInteractions.current) / MS_DIVIDER : TIME_DEFAULT);
  });

  // Set an end anchor for remote activated interaction
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const container = ref.current;
    if (!container || !activeEmojiInteractions) return;
    activeEmojiInteractions.forEach(_ref => {
      let {
        id,
        startSize,
        messageId: interactionMessageId
      } = _ref;
      if (startSize || messageId !== interactionMessageId) {
        return;
      }
      const {
        x,
        y
      } = container.getBoundingClientRect();
      sendWatchingEmojiInteraction({
        id,
        chatId: chatId,
        emoticon: emoji,
        startSize: size,
        x,
        y,
        isReversed: !isOwn
      });
      play();
    });
  }, [activeEmojiInteractions, chatId, emoji, isOwn, messageId, play, sendWatchingEmojiInteraction, size]);
  return {
    ref,
    size,
    style,
    handleClick
  };
}

/***/ }),

/***/ "./src/components/left/ArchivedChats.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/left/ArchivedChats.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const ArchivedChatsAsync = props => {
  const ArchivedChats = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ArchivedChats');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ArchivedChats ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ArchivedChats, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ArchivedChatsAsync);

/***/ }),

/***/ "./src/components/left/ConnectionStatusOverlay.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ConnectionStatusOverlay_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ConnectionStatusOverlay.scss */ "./src/components/left/ConnectionStatusOverlay.scss");






const ConnectionStatusOverlay = _ref => {
  let {
    connectionStatus,
    connectionStatusText,
    onClick
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_1__["default"])();
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "ConnectionStatusOverlay",
    dir: lang.isRtl ? 'rtl' : undefined,
    onClick: onClick
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_3__["default"], {
    color: "black"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "state-text"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_4__["default"], {
    activeKey: connectionStatus,
    name: "slideFade"
  }, connectionStatusText)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_2__["default"], {
    round: true,
    size: "tiny",
    color: "translucent-black"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "icon icon-close"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ConnectionStatusOverlay));

/***/ }),

/***/ "./src/components/left/LeftColumn.tsx":
/*!********************************************!*\
  !*** ./src/components/left/LeftColumn.tsx ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_swipeController__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/swipeController */ "./src/util/swipeController.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/reducers/useFoldersReducer */ "./src/hooks/reducers/useFoldersReducer.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePrevious2__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/usePrevious2 */ "./src/hooks/usePrevious2.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ArchivedChats_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ArchivedChats.async */ "./src/components/left/ArchivedChats.async.tsx");
/* harmony import */ var _main_LeftMain__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./main/LeftMain */ "./src/components/left/main/LeftMain.tsx");
/* harmony import */ var _newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./newChat/NewChat.async */ "./src/components/left/newChat/NewChat.async.tsx");
/* harmony import */ var _settings_Settings_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./settings/Settings.async */ "./src/components/left/settings/Settings.async.tsx");
/* harmony import */ var _LeftColumn_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./LeftColumn.scss */ "./src/components/left/LeftColumn.scss");



















var ContentType = /*#__PURE__*/function (ContentType) {
  ContentType[ContentType["Main"] = 0] = "Main";
  ContentType[ContentType["Settings"] = 1] = "Settings";
  ContentType[ContentType["Archived"] = 2] = "Archived";
  ContentType[ContentType["NewGroup"] = 3] = "NewGroup";
  ContentType[ContentType["NewChannel"] = 4] = "NewChannel";
  return ContentType;
}(ContentType || {});
const RENDER_COUNT = Object.keys(ContentType).length / 2;
const RESET_TRANSITION_DELAY_MS = 250;
function LeftColumn(_ref) {
  let {
    ref,
    searchQuery,
    searchDate,
    isFirstChatFolderActive,
    shouldSkipHistoryAnimations,
    currentUserId,
    hasPasscode,
    nextSettingsScreen,
    nextFoldersAction,
    isChatOpen,
    isAppUpdateAvailable,
    isElectronUpdateAvailable,
    isForumPanelOpen,
    forumPanelChatId,
    isClosingSearch,
    archiveSettings,
    isArchivedStoryRibbonShown
  } = _ref;
  const {
    setGlobalSearchQuery,
    setGlobalSearchClosing,
    setGlobalSearchChatId,
    resetChatCreation,
    setGlobalSearchDate,
    loadPasswordInfo,
    clearTwoFaError,
    openChat,
    requestNextSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [content, setContent] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList);
  const [settingsScreen, setSettingsScreen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main);
  const [contactsFilter, setContactsFilter] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [foldersState, foldersDispatch] = (0,_hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_7__["default"])();

  // Used to reset child components in background.
  const [lastResetTime, setLastResetTime] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  let contentType = ContentType.Main;
  switch (content) {
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived:
      contentType = ContentType.Archived;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings:
      contentType = ContentType.Settings;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2:
      contentType = ContentType.NewChannel;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2:
      contentType = ContentType.NewGroup;
      break;
  }
  const handleReset = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(forceReturnToChatList => {
    function fullReset() {
      setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList);
      setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main);
      setContactsFilter('');
      setGlobalSearchClosing({
        isClosing: true
      });
      resetChatCreation();
      setTimeout(() => {
        setGlobalSearchQuery({
          query: ''
        });
        setGlobalSearchDate({
          date: undefined
        });
        setGlobalSearchChatId({
          id: undefined
        });
        setGlobalSearchClosing({
          isClosing: false
        });
        setLastResetTime(Date.now());
      }, RESET_TRANSITION_DELAY_MS);
    }
    if (forceReturnToChatList === true) {
      fullReset();
      return;
    }
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2) {
      setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1);
      return;
    }
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2) {
      setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1);
      return;
    }
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1) {
      const pickerSearchInput = document.getElementById('new-group-picker-search');
      if (pickerSearchInput) {
        pickerSearchInput.blur();
      }
    }
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings) {
      switch (settingsScreen) {
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.EditProfile:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Notifications:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DataStorage:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Performance:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveSessions:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Experimental:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackgroundColor:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyAddByPhone:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBlockedUsers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveWebsites:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaCongratulations:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeCongratulations:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode:
          setSettingsScreen(hasPasscode ? _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled : _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeTurnOff:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscodeConfirm:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeConfirm:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsDeniedContacts:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmailCode:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaTurnOff:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordHint:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCode:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersCreateFolder:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersShare:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersIncludedChatsFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersExcludedChatsFromChatList:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderInvites:
          setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList);
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.QuickReaction:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.CustomEmoji:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers);
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DoNotTranslate:
          setSettingsScreen(_types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language);
          return;
        default:
          break;
      }
    }
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList && isFirstChatFolderActive) {
      setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch);
      return;
    }
    fullReset();
  });
  const handleSearchQuery = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(query => {
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts) {
      setContactsFilter(query);
      return;
    }
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch);
    if (query !== searchQuery) {
      setGlobalSearchQuery({
        query
      });
    }
  });
  const handleTopicSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch);
    setGlobalSearchQuery({
      query: ''
    });
    setGlobalSearchChatId({
      id: forumPanelChatId
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const isArchived = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived;
    const isChatList = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
    const noChatOrForumOpen = !isChatOpen && !isForumPanelOpen;
    // We listen for escape key only in these cases:
    // 1. When we are in archived chats and no chat or forum is open.
    // 2. When we are in any other screen except chat list and archived chat list.
    // 3. When we are in chat list and first chat folder is active and no chat or forum is open.
    if (isArchived && noChatOrForumOpen || !isChatList && !isArchived || isFirstChatFolderActive && noChatOrForumOpen) {
      return (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
        handleReset();
      });
    } else {
      return undefined;
    }
  }, [isFirstChatFolderActive, content, handleReset, isChatOpen, isForumPanelOpen]);
  const handleHotkeySearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    if (content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch) {
      return;
    }
    e.preventDefault();
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch);
  });
  const handleHotkeySavedMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    e.preventDefault();
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleArchivedChats = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    e.preventDefault();
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived);
  });
  const handleHotkeySettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    e.preventDefault();
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings);
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_8__.useHotkeys)({
    'Mod+Shift+F': handleHotkeySearch,
    // https://support.mozilla.org/en-US/kb/take-screenshots-firefox
    ...(!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_FIREFOX && {
      'Mod+Shift+S': handleHotkeySavedMessages
    }),
    ...(_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_APP && {
      'Mod+0': handleHotkeySavedMessages,
      'Mod+9': handleArchivedChats
    }),
    ...(_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_MAC_OS && _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_APP && {
      'Mod+,': handleHotkeySettings
    })
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    clearTwoFaError();
    if (settingsScreen === _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy) {
      loadPasswordInfo();
    }
  }, [clearTwoFaError, loadPasswordInfo, settingsScreen]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (nextSettingsScreen !== undefined) {
      setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings);
      setSettingsScreen(nextSettingsScreen);
      requestNextSettingsScreen({
        screen: undefined
      });
    }
    if (nextFoldersAction) {
      foldersDispatch(nextFoldersAction);
    }
  }, [foldersDispatch, nextFoldersAction, nextSettingsScreen, requestNextSettingsScreen]);
  const handleSettingsScreenSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(screen => {
    setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings);
    setSettingsScreen(screen);
  });
  const prevSettingsScreenRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_11__.useStateRef)((0,_hooks_usePrevious2__WEBPACK_IMPORTED_MODULE_10__["default"])(contentType === ContentType.Settings ? settingsScreen : -1));
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_swipeController__WEBPACK_IMPORTED_MODULE_5__.captureControlledSwipe)(ref.current, {
      excludedClosestSelector: '.ProfileInfo, .color-picker, .hue-picker',
      selectorToPreventScroll: '#Settings .custom-scroll',
      onSwipeRightStart: handleReset,
      onCancel: () => {
        setContent(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings);
        handleSettingsScreenSelect(prevSettingsScreenRef.current);
      }
    });
  }, [prevSettingsScreenRef, ref]);
  function renderContent(isActive) {
    switch (contentType) {
      case ContentType.Archived:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ArchivedChats_async__WEBPACK_IMPORTED_MODULE_14__["default"], {
          isActive: isActive,
          onReset: handleReset,
          onTopicSearch: handleTopicSearch,
          foldersDispatch: foldersDispatch,
          onSettingsScreenSelect: handleSettingsScreenSelect,
          onLeftColumnContentChange: setContent,
          isForumPanelOpen: isForumPanelOpen,
          archiveSettings: archiveSettings,
          isStoryRibbonShown: isArchivedStoryRibbonShown
        });
      case ContentType.Settings:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_settings_Settings_async__WEBPACK_IMPORTED_MODULE_17__["default"], {
          isActive: isActive,
          currentScreen: settingsScreen,
          foldersState: foldersState,
          foldersDispatch: foldersDispatch,
          shouldSkipTransition: shouldSkipHistoryAnimations,
          onScreenSelect: handleSettingsScreenSelect,
          onReset: handleReset
        });
      case ContentType.NewChannel:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_16__["default"], {
          key: lastResetTime,
          isActive: isActive,
          isChannel: true,
          content: content,
          onContentChange: setContent,
          onReset: handleReset
        });
      case ContentType.NewGroup:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_16__["default"], {
          key: lastResetTime,
          isActive: isActive,
          content: content,
          onContentChange: setContent,
          onReset: handleReset
        });
      default:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_main_LeftMain__WEBPACK_IMPORTED_MODULE_15__["default"], {
          content: content,
          isClosingSearch: isClosingSearch,
          searchQuery: searchQuery,
          searchDate: searchDate,
          contactsFilter: contactsFilter,
          foldersDispatch: foldersDispatch,
          onContentChange: setContent,
          onSearchQuery: handleSearchQuery,
          onSettingsScreenSelect: handleSettingsScreenSelect,
          onReset: handleReset,
          shouldSkipTransition: shouldSkipHistoryAnimations,
          isAppUpdateAvailable: isAppUpdateAvailable,
          isElectronUpdateAvailable: isElectronUpdateAvailable,
          isForumPanelOpen: isForumPanelOpen,
          onTopicSearch: handleTopicSearch
        });
    }
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_13__["default"], {
    ref: ref,
    name: shouldSkipHistoryAnimations ? 'none' : _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.LAYERS_ANIMATION_NAME,
    renderCount: RENDER_COUNT,
    activeKey: contentType,
    shouldCleanup: true,
    cleanupExceptionKey: ContentType.Main,
    shouldWrap: true,
    wrapExceptionKey: ContentType.Main,
    id: "LeftColumn",
    withSwipeControl: true
  }, renderContent);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    globalSearch: {
      query,
      date
    },
    shouldSkipHistoryAnimations,
    activeChatFolder,
    nextSettingsScreen,
    nextFoldersAction,
    storyViewer: {
      isArchivedRibbonShown
    }
  } = tabState;
  const {
    currentUserId,
    passcode: {
      hasPasscode
    },
    isAppUpdateAvailable,
    isElectronUpdateAvailable,
    archiveSettings
  } = global;
  const currentChat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentChat)(global);
  const isChatOpen = Boolean(currentChat?.id);
  const isForumPanelOpen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsForumPanelOpen)(global);
  const forumPanelChatId = tabState.forumPanelChatId;
  return {
    searchQuery: query,
    searchDate: date,
    isFirstChatFolderActive: activeChatFolder === 0,
    shouldSkipHistoryAnimations,
    currentUserId,
    hasPasscode,
    nextSettingsScreen,
    nextFoldersAction,
    isChatOpen,
    isAppUpdateAvailable,
    isElectronUpdateAvailable,
    isForumPanelOpen,
    forumPanelChatId,
    isClosingSearch: tabState.globalSearch.isClosing,
    archiveSettings,
    isArchivedStoryRibbonShown: isArchivedRibbonShown
  };
})(LeftColumn)));

/***/ }),

/***/ "./src/components/left/NewChatButton.tsx":
/*!***********************************************!*\
  !*** ./src/components/left/NewChatButton.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _NewChatButton_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./NewChatButton.scss */ "./src/components/left/NewChatButton.scss");







const NewChatButton = _ref => {
  let {
    isShown,
    onNewPrivateChat,
    onNewChannel,
    onNewGroup
  } = _ref;
  const [isMenuOpen, setIsMenuOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isShown) {
      setIsMenuOpen(false);
    }
  }, [isShown]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('NewChatButton', isShown && 'revealed', isMenuOpen && 'menu-is-open');
  const toggleIsMenuOpen = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setIsMenuOpen(!isMenuOpen);
  }, [isMenuOpen]);
  const handleClose = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setIsMenuOpen(false);
  }, []);
  const menuItems = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_5__["default"], {
    icon: "channel",
    onClick: onNewChannel
  }, lang('NewChannel')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_5__["default"], {
    icon: "group",
    onClick: onNewGroup
  }, lang('NewGroup')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_5__["default"], {
    icon: "user",
    onClick: onNewPrivateChat
  }, lang('NewMessageTitle'))), [lang, onNewChannel, onNewGroup, onNewPrivateChat]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fabClassName,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_3__["default"], {
    round: true,
    color: "primary",
    className: isMenuOpen ? 'active' : '',
    onClick: toggleIsMenuOpen,
    ariaLabel: lang(isMenuOpen ? 'Close' : 'NewMessageTitle'),
    tabIndex: -1
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-new-chat-filled"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-close"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_4__["default"], {
    isOpen: isMenuOpen,
    positionX: lang.isRtl ? 'left' : 'right',
    positionY: "bottom",
    autoClose: true,
    onClose: handleClose
  }, menuItems));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatButton);

/***/ }),

/***/ "./src/components/left/main/ChatFolders.tsx":
/*!**************************************************!*\
  !*** ./src/components/left/main/ChatFolders.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _story_StoryRibbon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../story/StoryRibbon */ "./src/components/story/StoryRibbon.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatList__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ChatList */ "./src/components/left/main/ChatList.tsx");



















const SAVED_MESSAGES_HOTKEY = '0';
const FIRST_FOLDER_INDEX = 0;
const ChatFolders = _ref => {
  let {
    foldersDispatch,
    onSettingsScreenSelect,
    onLeftColumnContentChange,
    chatFoldersById,
    orderedFolderIds,
    activeChatFolder,
    currentUserId,
    isForumPanelOpen,
    shouldSkipHistoryAnimations,
    maxFolders,
    maxChatLists,
    shouldHideFolderTabs,
    folderInvitesById,
    maxFolderInvites,
    hasArchivedChats,
    hasArchivedStories,
    archiveSettings,
    isStoryRibbonShown,
    sessions
  } = _ref;
  const {
    loadChatFolders,
    setActiveChatFolder,
    openChat,
    openShareChatFolderModal,
    openDeleteChatFolderModal,
    openEditChatFolder,
    openLimitReachedModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadChatFolders();
  }, []);
  const {
    shouldRender: shouldRenderStoryRibbon,
    transitionClassNames: storyRibbonClassNames,
    isClosing: isStoryRibbonClosing
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_14__["default"])(isStoryRibbonShown, undefined, undefined, '');
  const allChatsFolder = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      id: _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID,
      title: orderedFolderIds?.[0] === _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID ? lang('FilterAllChatsShort') : lang('FilterAllChats'),
      includedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY,
      excludedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY
    };
  }, [orderedFolderIds, lang]);
  const displayedFolders = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return orderedFolderIds ? orderedFolderIds.map(id => {
      if (id === _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID) {
        return allChatsFolder;
      }
      return chatFoldersById[id] || {};
    }).filter(Boolean) : undefined;
  }, [chatFoldersById, allChatsFolder, orderedFolderIds]);
  const allChatsFolderIndex = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID);
  const isInAllChatsFolder = allChatsFolderIndex === activeChatFolder;
  const isInFirstFolder = FIRST_FOLDER_INDEX === activeChatFolder;
  const folderCountersById = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_10__.useFolderManagerForUnreadCounters)();
  const folderTabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!displayedFolders || !displayedFolders.length) {
      return undefined;
    }
    return displayedFolders.map((folder, i) => {
      const {
        id,
        title
      } = folder;
      const isBlocked = id !== _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID && i > maxFolders - 1;
      const canShareFolder = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanShareFolder)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), id);
      const contextActions = [];
      if (canShareFolder) {
        contextActions.push({
          title: lang('ChatList.ContextMenuShare'),
          icon: 'link',
          handler: () => {
            const chatListCount = Object.values(chatFoldersById).reduce((acc, el) => acc + (el.isChatList ? 1 : 0), 0);
            if (chatListCount >= maxChatLists && !folder.isChatList) {
              openLimitReachedModal({
                limit: 'chatlistJoined'
              });
              return;
            }

            // Greater amount can be after premium downgrade
            if (folderInvitesById[id]?.length >= maxFolderInvites) {
              openLimitReachedModal({
                limit: 'chatlistInvites'
              });
              return;
            }
            openShareChatFolderModal({
              folderId: id
            });
          }
        });
      }
      if (id !== _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID) {
        contextActions.push({
          title: lang('FilterEdit'),
          icon: 'edit',
          handler: () => {
            openEditChatFolder({
              folderId: id
            });
          }
        });
        contextActions.push({
          title: lang('FilterDeleteItem'),
          icon: 'delete',
          destructive: true,
          handler: () => {
            openDeleteChatFolderModal({
              folderId: id
            });
          }
        });
      }
      return {
        id,
        title,
        badgeCount: folderCountersById[id]?.chatsCount,
        isBadgeActive: Boolean(folderCountersById[id]?.notificationsCount),
        isBlocked,
        contextActions: contextActions?.length ? contextActions : undefined
      };
    });
  }, [displayedFolders, maxFolders, folderCountersById, lang, chatFoldersById, maxChatLists, folderInvitesById, maxFolderInvites]);
  const handleSwitchTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(index => {
    setActiveChatFolder({
      activeChatFolder: index
    }, {
      forceOnHeavyAnimation: true
    });
  });

  // Prevent `activeTab` pointing at non-existing folder after update
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!folderTabs?.length) {
      return;
    }
    if (activeChatFolder >= folderTabs.length) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }, [activeChatFolder, folderTabs, setActiveChatFolder]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_TOUCH_ENV || !folderTabs?.length || isForumPanelOpen) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.chat-list',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.SwipeDirection.Left) {
          setActiveChatFolder({
            activeChatFolder: Math.min(activeChatFolder + 1, folderTabs.length - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.SwipeDirection.Right) {
          setActiveChatFolder({
            activeChatFolder: Math.max(0, activeChatFolder - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        }
        return false;
      }
    });
  }, [activeChatFolder, folderTabs, isForumPanelOpen, setActiveChatFolder]);
  const isNotInFirstFolderRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  isNotInFirstFolderRef.current = !isInFirstFolder;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isNotInFirstFolderRef.current ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (isNotInFirstFolderRef.current) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }) : undefined, [activeChatFolder, setActiveChatFolder]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_11__["default"])({
    isActive: !isInFirstFolder,
    onBack: () => setActiveChatFolder({
      activeChatFolder: FIRST_FOLDER_INDEX
    }, {
      forceOnHeavyAnimation: true
    })
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const handleKeyDown = e => {
      if (e.ctrlKey && e.shiftKey && e.code.startsWith('Digit') && folderTabs) {
        const [, digit] = e.code.match(/Digit(\d)/) || [];
        if (!digit) return;
        if (digit === SAVED_MESSAGES_HOTKEY) {
          openChat({
            id: currentUserId,
            shouldReplaceHistory: true
          });
          return;
        }
        const folder = Number(digit) - 1;
        if (folder > folderTabs.length - 1) return;
        setActiveChatFolder({
          activeChatFolder: folder
        }, {
          forceOnHeavyAnimation: true
        });
        e.preventDefault();
      }
    };
    document.addEventListener('keydown', handleKeyDown, true);
    return () => {
      document.removeEventListener('keydown', handleKeyDown, true);
    };
  }, [currentUserId, folderTabs, openChat, setActiveChatFolder]);
  const {
    shouldRender: shouldRenderPlaceholder,
    transitionClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_14__["default"])(!orderedFolderIds, undefined, true);
  function renderCurrentTab(isActive) {
    const activeFolder = Object.values(chatFoldersById).find(_ref2 => {
      let {
        id
      } = _ref2;
      return id === folderTabs[activeChatFolder].id;
    });
    const isFolder = activeFolder && !isInAllChatsFolder;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatList__WEBPACK_IMPORTED_MODULE_18__["default"], {
      folderType: isFolder ? 'folder' : 'all',
      folderId: isFolder ? activeFolder.id : undefined,
      isActive: isActive,
      isForumPanelOpen: isForumPanelOpen,
      foldersDispatch: foldersDispatch,
      onSettingsScreenSelect: onSettingsScreenSelect,
      onLeftColumnContentChange: onLeftColumnContentChange,
      canDisplayArchive: (hasArchivedChats || hasArchivedStories) && !archiveSettings.isHidden,
      archiveSettings: archiveSettings,
      sessions: sessions
    });
  }
  const shouldRenderFolders = folderTabs && folderTabs.length > 1;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ChatFolders', shouldRenderFolders && shouldHideFolderTabs && 'ChatFolders--tabs-hidden', shouldRenderStoryRibbon && 'with-story-ribbon', storyRibbonClassNames)
  }, shouldRenderStoryRibbon && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_StoryRibbon__WEBPACK_IMPORTED_MODULE_15__["default"], {
    isClosing: isStoryRibbonClosing
  }), shouldRenderFolders ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_16__["default"], {
    contextRootElementSelector: "#LeftColumn",
    tabs: folderTabs,
    activeTab: activeChatFolder,
    onSwitchTab: handleSwitchTab,
    areFolders: true
  }) : shouldRenderPlaceholder ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('tabs-placeholder', transitionClassNames)
  }) : undefined, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
    ref: transitionRef,
    name: shouldSkipHistoryAnimations ? 'none' : lang.isRtl ? 'slideOptimizedRtl' : 'slideOptimized',
    activeKey: activeChatFolder,
    renderCount: shouldRenderFolders ? folderTabs.length : undefined
  }, renderCurrentTab));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatFolders: {
      byId: chatFoldersById,
      orderedIds: orderedFolderIds,
      invites: folderInvitesById
    },
    chats: {
      listIds: {
        archived
      }
    },
    stories: {
      orderedPeerIds: {
        archived: archivedStories
      }
    },
    activeSessions: {
      byHash: sessions
    },
    currentUserId,
    archiveSettings
  } = global;
  const {
    shouldSkipHistoryAnimations,
    activeChatFolder
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    storyViewer: {
      isRibbonShown: isStoryRibbonShown
    }
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  return {
    chatFoldersById,
    folderInvitesById,
    orderedFolderIds,
    activeChatFolder,
    currentUserId,
    shouldSkipHistoryAnimations,
    hasArchivedChats: Boolean(archived?.length),
    hasArchivedStories: Boolean(archivedStories?.length),
    maxFolders: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'dialogFilters'),
    maxFolderInvites: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistInvites'),
    maxChatLists: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistJoined'),
    archiveSettings,
    isStoryRibbonShown,
    sessions
  };
})(ChatFolders)));

/***/ }),

/***/ "./src/components/left/main/ContactList.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/left/main/ContactList.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const ContactListAsync = props => {
  const ContactList = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ContactList');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ContactList ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ContactList, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ContactListAsync);

/***/ }),

/***/ "./src/components/left/main/LeftMain.tsx":
/*!***********************************************!*\
  !*** ./src/components/left/main/LeftMain.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useForumPanelRender */ "./src/hooks/useForumPanelRender.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _NewChatButton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../NewChatButton */ "./src/components/left/NewChatButton.tsx");
/* harmony import */ var _search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../search/LeftSearch.async */ "./src/components/left/search/LeftSearch.async.tsx");
/* harmony import */ var _ChatFolders__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ChatFolders */ "./src/components/left/main/ChatFolders.tsx");
/* harmony import */ var _ContactList_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ContactList.async */ "./src/components/left/main/ContactList.async.tsx");
/* harmony import */ var _ForumPanel__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./ForumPanel */ "./src/components/left/main/ForumPanel.tsx");
/* harmony import */ var _LeftMainHeader__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./LeftMainHeader */ "./src/components/left/main/LeftMainHeader.tsx");
/* harmony import */ var _LeftMain_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./LeftMain.scss */ "./src/components/left/main/LeftMain.scss");



















const TRANSITION_RENDER_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent).length / 2;
const BUTTON_CLOSE_DELAY_MS = 250;
let closeTimeout;
const LeftMain = _ref => {
  let {
    content,
    searchQuery,
    searchDate,
    isClosingSearch,
    contactsFilter,
    shouldSkipTransition,
    foldersDispatch,
    isAppUpdateAvailable,
    isElectronUpdateAvailable,
    isForumPanelOpen,
    onSearchQuery,
    onContentChange,
    onSettingsScreenSelect,
    onReset,
    onTopicSearch
  } = _ref;
  const {
    closeForumPanel
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isNewChatButtonShown, setIsNewChatButtonShown] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV);
  const [isElectronAutoUpdateEnabled, setIsElectronAutoUpdateEnabled] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    window.electron?.getIsAutoUpdateEnabled().then(setIsElectronAutoUpdateEnabled);
  }, []);
  const {
    shouldRenderForumPanel,
    handleForumPanelAnimationEnd,
    handleForumPanelAnimationStart,
    isAnimationStarted
  } = (0,_hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_6__["default"])(isForumPanelOpen);
  const isForumPanelRendered = isForumPanelOpen && content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const isForumPanelVisible = isForumPanelRendered && isAnimationStarted;
  const {
    shouldRender: shouldRenderUpdateButton,
    transitionClassNames: updateButtonClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_9__["default"])(isAppUpdateAvailable || isElectronUpdateAvailable);
  const isMouseInside = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const handleMouseEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      return;
    }
    isMouseInside.current = true;
    setIsNewChatButtonShown(true);
  });
  const handleMouseLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    isMouseInside.current = false;
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = undefined;
    }
    closeTimeout = window.setTimeout(() => {
      if (!isMouseInside.current) {
        setIsNewChatButtonShown(false);
      }
    }, BUTTON_CLOSE_DELAY_MS);
  });
  const handleSelectSettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onContentChange(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings);
  });
  const handleSelectContacts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onContentChange(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts);
  });
  const handleSelectArchived = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onContentChange(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived);
    closeForumPanel();
  });
  const handleUpdateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_ELECTRON && !isElectronAutoUpdateEnabled) {
      window.open(`${_config__WEBPACK_IMPORTED_MODULE_3__.PRODUCTION_URL}/get`, '_blank', 'noopener');
    } else if (isElectronUpdateAvailable) {
      window.electron?.installUpdate();
    } else {
      window.location.reload();
    }
  });
  const handleSelectNewChannel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onContentChange(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1);
  });
  const handleSelectNewGroup = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onContentChange(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let autoCloseTimeout;
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      autoCloseTimeout = window.setTimeout(() => {
        setIsNewChatButtonShown(false);
      }, BUTTON_CLOSE_DELAY_MS);
    } else if (isMouseInside.current || _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) {
      setIsNewChatButtonShown(true);
    }
    return () => {
      if (autoCloseTimeout) {
        clearTimeout(autoCloseTimeout);
        autoCloseTimeout = undefined;
      }
    };
  }, [content]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "LeftColumn-main",
    onMouseEnter: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? handleMouseEnter : undefined,
    onMouseLeave: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? handleMouseLeave : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_LeftMainHeader__WEBPACK_IMPORTED_MODULE_17__["default"], {
    shouldHideSearch: isForumPanelVisible,
    content: content,
    contactsFilter: contactsFilter,
    onSearchQuery: onSearchQuery,
    onSelectSettings: handleSelectSettings,
    onSelectContacts: handleSelectContacts,
    onSelectArchived: handleSelectArchived,
    onReset: onReset,
    shouldSkipTransition: shouldSkipTransition,
    isClosingSearch: isClosingSearch
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: shouldSkipTransition ? 'none' : 'zoomFade',
    renderCount: TRANSITION_RENDER_COUNT,
    activeKey: content,
    shouldCleanup: true,
    cleanupExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList,
    shouldWrap: true,
    wrapExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList
  }, isActive => {
    switch (content) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatFolders__WEBPACK_IMPORTED_MODULE_14__["default"], {
          shouldHideFolderTabs: isForumPanelVisible,
          onSettingsScreenSelect: onSettingsScreenSelect,
          onLeftColumnContentChange: onContentChange,
          foldersDispatch: foldersDispatch,
          isForumPanelOpen: isForumPanelVisible
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_13__["default"], {
          searchQuery: searchQuery,
          searchDate: searchDate,
          isActive: isActive,
          onReset: onReset
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContactList_async__WEBPACK_IMPORTED_MODULE_15__["default"], {
          filter: contactsFilter,
          isActive: isActive,
          onReset: onReset
        });
      default:
        return undefined;
    }
  }), shouldRenderUpdateButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    fluid: true,
    pill: true,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('btn-update', updateButtonClassNames),
    onClick: handleUpdateClick
  }, lang('lng_update_telegram')), shouldRenderForumPanel && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ForumPanel__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: isForumPanelOpen,
    isHidden: !isForumPanelRendered,
    onTopicSearch: onTopicSearch,
    onOpenAnimationStart: handleForumPanelAnimationStart,
    onCloseAnimationEnd: handleForumPanelAnimationEnd
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_NewChatButton__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isShown: isNewChatButtonShown,
    onNewPrivateChat: handleSelectContacts,
    onNewChannel: handleSelectNewChannel,
    onNewGroup: handleSelectNewGroup
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(LeftMain));

/***/ }),

/***/ "./src/components/left/main/LeftMainHeader.tsx":
/*!*****************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/window/useFullscreen */ "./src/hooks/window/useFullscreen.ts");
/* harmony import */ var _hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hooks/useLeftHeaderButtonRtlForumTransition */ "./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts");
/* harmony import */ var _common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/PickerSelectedItem */ "./src/components/common/PickerSelectedItem.tsx");
/* harmony import */ var _story_StoryToggler__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../story/StoryToggler */ "./src/components/story/StoryToggler.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_ShowTransition__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/ShowTransition */ "./src/components/ui/ShowTransition.tsx");
/* harmony import */ var _ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../ConnectionStatusOverlay */ "./src/components/left/ConnectionStatusOverlay.tsx");
/* harmony import */ var _LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./LeftSideMenuItems */ "./src/components/left/main/LeftSideMenuItems.tsx");
/* harmony import */ var _StatusButton__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./StatusButton */ "./src/components/left/main/StatusButton.tsx");
/* harmony import */ var _LeftMainHeader_scss__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./LeftMainHeader.scss */ "./src/components/left/main/LeftMainHeader.scss");





























const CLEAR_DATE_SEARCH_PARAM = {
  date: undefined
};
const CLEAR_CHAT_SEARCH_PARAM = {
  id: undefined
};
const LeftMainHeader = _ref => {
  let {
    shouldHideSearch,
    content,
    contactsFilter,
    isClosingSearch,
    searchQuery,
    isLoading,
    isCurrentUserPremium,
    shouldSkipTransition,
    globalSearchChatId,
    searchDate,
    theme,
    connectionState,
    isSyncing,
    isFetchingDifference,
    isMessageListOpen,
    isConnectionStatusMinimized,
    areChatsLoaded,
    hasPasscode,
    canSetPasscode,
    onSearchQuery,
    onSelectSettings,
    onSelectContacts,
    onSelectArchived,
    onReset
  } = _ref;
  const {
    setGlobalSearchDate,
    setSettingOption,
    setGlobalSearchChatId,
    lockScreen,
    requestNextSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isBotMenuOpen, markBotMenuOpen, unmarkBotMenuOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const hasMenu = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const selectedSearchDate = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return searchDate ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateToString)(new Date(searchDate * 1000)) : undefined;
  }, [searchDate]);
  const {
    connectionStatus,
    connectionStatusText,
    connectionStatusPosition
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_10__["default"])(oldLang, connectionState, isSyncing || isFetchingDifference, isMessageListOpen, isConnectionStatusMinimized, !areChatsLoaded);
  const handleLockScreenHotkey = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(e => {
    e.preventDefault();
    e.stopPropagation();
    if (hasPasscode) {
      lockScreen();
    } else {
      requestNextSettingsScreen({
        screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled
      });
    }
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_13__.useHotkeys)(canSetPasscode ? {
    'Ctrl+Shift+L': handleLockScreenHotkey,
    'Alt+Shift+L': handleLockScreenHotkey,
    'Meta+Shift+L': handleLockScreenHotkey,
    ...(_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_APP && {
      'Mod+L': handleLockScreenHotkey
    })
  } : undefined);
  const MainButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return _ref2 => {
      let {
        onTrigger,
        isOpen
      } = _ref2;
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
        round: true,
        ripple: hasMenu && !isMobile,
        size: "smaller",
        color: "translucent",
        className: isOpen ? 'active' : ''
        // eslint-disable-next-line react/jsx-no-bind
        ,
        onClick: hasMenu ? onTrigger : () => onReset(),
        ariaLabel: hasMenu ? oldLang('AccDescrOpenMenu2') : 'Return to chat list'
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('animated-menu-icon', !hasMenu && 'state-back', shouldSkipTransition && 'no-animation')
      }));
    };
  }, [hasMenu, isMobile, oldLang, onReset, shouldSkipTransition]);
  const handleSearchFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    if (!searchQuery) {
      onSearchQuery('');
    }
  });
  const toggleConnectionStatus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    setSettingOption({
      isConnectionStatusMinimized: !isConnectionStatusMinimized
    });
  });
  const handleLockScreen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    lockScreen();
  });
  const isSearchFocused = Boolean(globalSearchChatId) || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isSearchFocused ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(() => onReset()) : undefined, [isSearchFocused, onReset]);
  const searchInputPlaceholder = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts ? lang('SearchFriends') : lang('Search');
  const versionString = _config__WEBPACK_IMPORTED_MODULE_3__.IS_BETA ? `${"10.9.8"} Beta (${"slavabarkal/eng-4847-update-telegram-web-to-latest-version"})` : _config__WEBPACK_IMPORTED_MODULE_3__.DEBUG ? "slavabarkal/eng-4847-update-telegram-web-to-latest-version" : "10.9.8";
  const isFullscreen = (0,_hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_17__.useFullscreenStatus)();

  // Disable dropdown menu RTL animation for resize
  const {
    shouldDisableDropdownMenuTransitionRef,
    handleDropdownMenuTransitionEnd
  } = (0,_hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_18__["default"])(shouldHideSearch);

  // eslint-disable-next-line no-null/no-null
  const headerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_11__["default"])(headerRef);
  const searchContent = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, selectedSearchDate && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
      icon: "calendar",
      title: selectedSearchDate,
      canClose: true,
      isMinimized: Boolean(globalSearchChatId),
      className: "search-date",
      onClick: setGlobalSearchDate,
      clickArg: CLEAR_DATE_SEARCH_PARAM
    }), globalSearchChatId && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
      peerId: globalSearchChatId,
      onClick: setGlobalSearchChatId,
      canClose: true,
      clickArg: CLEAR_CHAT_SEARCH_PARAM
    }));
  }, [globalSearchChatId, selectedSearchDate]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "LeftMainHeader"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "LeftMainHeader",
    className: "left-header",
    ref: headerRef
  }, oldLang.isRtl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "DropdownMenuFiller"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_22__["default"], {
    trigger: MainButton,
    footer: `${_config__WEBPACK_IMPORTED_MODULE_3__.APP_NAME} ${versionString}`,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('main-menu', oldLang.isRtl && 'rtl', shouldHideSearch && oldLang.isRtl && 'right-aligned', shouldDisableDropdownMenuTransitionRef.current && oldLang.isRtl && 'disable-transition'),
    forceOpen: isBotMenuOpen,
    positionX: shouldHideSearch && oldLang.isRtl ? 'right' : 'left',
    transformOriginX: _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_ELECTRON && _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_MAC_OS && !isFullscreen ? 90 : undefined,
    onTransitionEnd: oldLang.isRtl ? handleDropdownMenuTransitionEnd : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_26__["default"], {
    onSelectArchived: onSelectArchived,
    onSelectContacts: onSelectContacts,
    onSelectSettings: onSelectSettings,
    onBotMenuOpened: markBotMenuOpen,
    onBotMenuClosed: unmarkBotMenuOpen
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_23__["default"], {
    inputId: "telegram-search-input",
    parentContainerClassName: "LeftSearch",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(globalSearchChatId || searchDate ? 'with-picker-item' : undefined, shouldHideSearch && 'SearchInput--hidden'),
    value: isClosingSearch ? undefined : contactsFilter || searchQuery,
    focused: isSearchFocused,
    isLoading: isLoading || connectionStatusPosition === 'minimized',
    spinnerColor: connectionStatusPosition === 'minimized' ? 'yellow' : undefined,
    spinnerBackgroundColor: connectionStatusPosition === 'minimized' && theme === 'light' ? 'light' : undefined,
    placeholder: searchInputPlaceholder,
    autoComplete: "off",
    canClose: Boolean(globalSearchChatId || searchDate),
    onChange: onSearchQuery,
    onReset: onReset,
    onFocus: handleSearchFocus,
    onSpinnerClick: connectionStatusPosition === 'minimized' ? toggleConnectionStatus : undefined
  }, searchContent, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_StoryToggler__WEBPACK_IMPORTED_MODULE_20__["default"], {
    canShow: !isSearchFocused && !selectedSearchDate && !globalSearchChatId
  })), isCurrentUserPremium && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatusButton__WEBPACK_IMPORTED_MODULE_27__["default"], null), hasPasscode && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
    round: true,
    ripple: !isMobile,
    size: "smaller",
    color: "translucent",
    ariaLabel: `${oldLang('ShortcutsController.Others.LockByPasscode')} (Ctrl+Shift+L)`,
    onClick: handleLockScreen,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(!isCurrentUserPremium && 'extra-spacing')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-lock"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ShowTransition__WEBPACK_IMPORTED_MODULE_24__["default"], {
    isOpen: connectionStatusPosition === 'overlay',
    isCustom: true,
    className: "connection-state-wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_25__["default"], {
    connectionStatus: connectionStatus,
    connectionStatusText: connectionStatusText,
    onClick: toggleConnectionStatus
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    query: searchQuery,
    fetchingStatus,
    chatId,
    date
  } = tabState.globalSearch;
  const {
    connectionState,
    isSyncing,
    isFetchingDifference
  } = global;
  const {
    isConnectionStatusMinimized
  } = global.settings.byKey;
  return {
    searchQuery,
    isLoading: fetchingStatus ? Boolean(fetchingStatus.chats || fetchingStatus.messages) : false,
    globalSearchChatId: chatId,
    searchDate: date,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global),
    connectionState,
    isSyncing,
    isFetchingDifference,
    isMessageListOpen: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global)),
    isConnectionStatusMinimized,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsCurrentUserPremium)(global),
    areChatsLoaded: Boolean(global.chats.listIds.active),
    hasPasscode: Boolean(global.passcode.hasPasscode),
    canSetPasscode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanSetPasscode)(global)
  };
})(LeftMainHeader)));

/***/ }),

/***/ "./src/components/left/main/LeftSideMenuItems.tsx":
/*!********************************************************!*\
  !*** ./src/components/left/main/LeftSideMenuItems.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_initialState__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/initialState */ "./src/global/initialState.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_installPrompt__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/installPrompt */ "./src/util/installPrompt.ts");
/* harmony import */ var _util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/permanentWebVersion */ "./src/util/permanentWebVersion.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../middle/composer/AttachBotItem */ "./src/components/middle/composer/AttachBotItem.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _ui_Toggle__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Toggle */ "./src/components/ui/Toggle.tsx");
















const LeftSideMenuItems = _ref => {
  let {
    currentUserId,
    archiveSettings,
    animationLevel,
    theme,
    canInstall,
    attachBots,
    onSelectArchived,
    onSelectContacts,
    onSelectSettings,
    onBotMenuOpened,
    onBotMenuClosed
  } = _ref;
  const {
    openChat,
    setSettingOption,
    updatePerformanceSettings,
    openChatByUsername,
    openUrl,
    openChatWithInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const animationLevelValue = animationLevel !== _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN ? animationLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX ? 'max' : 'mid' : 'min';
  const withOtherVersions = !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_ELECTRON && (window.location.hostname === _config__WEBPACK_IMPORTED_MODULE_2__.PRODUCTION_HOSTNAME || _config__WEBPACK_IMPORTED_MODULE_2__.IS_TEST);
  const archivedUnreadChatsCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__.useFolderManagerForUnreadCounters)()[_config__WEBPACK_IMPORTED_MODULE_2__.ARCHIVED_FOLDER_ID]?.chatsCount || 0;
  const bots = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => Object.values(attachBots).filter(bot => bot.isForSideMenu), [attachBots]);
  const handleSelectSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleDarkModeToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    e.stopPropagation();
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setSettingOption({
      theme: newTheme
    });
    setSettingOption({
      shouldUseSystemTheme: false
    });
  });
  const handleAnimationLevelChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    e.stopPropagation();
    let newLevel = animationLevel + 1;
    if (newLevel > _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX) {
      newLevel = _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN;
    }
    const performanceSettings = newLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN ? _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MIN : newLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX ? _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MAX : _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MID;
    setSettingOption({
      animationLevel: newLevel
    });
    updatePerformanceSettings(performanceSettings);
  });
  const handleChangelogClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    window.open(_config__WEBPACK_IMPORTED_MODULE_2__.BETA_CHANGELOG_URL, '_blank', 'noopener');
  });
  const handleSwitchToWebK = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    (0,_util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_6__.switchPermanentWebVersion)('K');
  });
  const handleOpenTipsChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openChatByUsername({
      username: oldLang('Settings.TipsUsername')
    });
  });
  const handleBugReportClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openUrl({
      url: _config__WEBPACK_IMPORTED_MODULE_2__.FEEDBACK_URL
    });
  });
  const handleOpenMyStories = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openChatWithInfo({
      id: currentUserId,
      shouldReplaceHistory: true,
      profileTab: 'stories'
    });
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "saved-messages",
    onClick: handleSelectSaved
  }, oldLang('SavedMessages')), archiveSettings.isHidden && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "archive",
    onClick: onSelectArchived
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name"
  }, oldLang('ArchivedChats')), archivedUnreadChatsCount > 0 && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "right-badge"
  }, archivedUnreadChatsCount)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "user",
    onClick: onSelectContacts
  }, oldLang('Contacts')), bots.map(bot => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_12__["default"], {
    bot: bot,
    theme: theme,
    isInSideMenu: true,
    canShowNew: true,
    onMenuOpened: onBotMenuOpened,
    onMenuClosed: onBotMenuClosed
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "play-story",
    onClick: handleOpenMyStories
  }, oldLang('Settings.MyStories')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "settings",
    onClick: onSelectSettings
  }, oldLang('Settings')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "darkmode",
    onClick: handleDarkModeToggle
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name"
  }, oldLang('lng_menu_night_mode')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_14__["default"], {
    id: "darkmode",
    label: oldLang(theme === 'dark' ? 'lng_settings_disable_night_theme' : 'lng_settings_enable_night_theme'),
    checked: theme === 'dark',
    noAnimation: true
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "animations",
    onClick: handleAnimationLevelChange
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name capitalize"
  }, oldLang('Appearance.Animations').toLowerCase()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Toggle__WEBPACK_IMPORTED_MODULE_15__["default"], {
    value: animationLevelValue
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "help",
    onClick: handleOpenTipsChat
  }, oldLang('TelegramFeatures')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "bug",
    onClick: handleBugReportClick
  }, lang('MenuReportBug')), _config__WEBPACK_IMPORTED_MODULE_2__.IS_BETA && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "permissions",
    onClick: handleChangelogClick
  }, lang('MenuBetaChangelog')), withOtherVersions && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "K",
    isCharIcon: true,
    href: `${_config__WEBPACK_IMPORTED_MODULE_2__.WEB_VERSION_BASE}k`,
    onClick: handleSwitchToWebK
  }, lang('MenuSwitchToK')), canInstall && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "install",
    onClick: (0,_util_installPrompt__WEBPACK_IMPORTED_MODULE_5__.getPromptInstall)()
  }, lang('MenuInstallApp')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    currentUserId,
    archiveSettings
  } = global;
  const {
    animationLevel
  } = global.settings.byKey;
  const attachBots = global.attachMenu.bots;
  return {
    currentUserId,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global),
    animationLevel,
    canInstall: Boolean(tabState.canInstall),
    archiveSettings,
    attachBots
  };
})(LeftSideMenuItems)));

/***/ }),

/***/ "./src/components/left/main/StatusButton.tsx":
/*!***************************************************!*\
  !*** ./src/components/left/main/StatusButton.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/reactions/CustomEmojiEffect */ "./src/components/common/reactions/CustomEmojiEffect.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./StatusPickerMenu.async */ "./src/components/left/main/StatusPickerMenu.async.tsx");














const EFFECT_DURATION_MS = 1500;
const EMOJI_STATUS_SIZE = 24;
const StatusButton = _ref => {
  let {
    emojiStatus
  } = _ref;
  const {
    setEmojiStatus,
    loadCurrentUser
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const buttonRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const [shouldShowEffect, markShouldShowEffect, unmarkShouldShowEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isEffectShown, showEffect, hideEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isStatusPickerOpen, openStatusPicker, closeStatusPicker] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const delay = emojiStatus?.until ? emojiStatus.until * 1000 - Date.now() + (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTimeOffset)() * 1000 : undefined;
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(loadCurrentUser, delay);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__["default"])(_ref2 => {
    let [prevEmojiStatus] = _ref2;
    if (shouldShowEffect && emojiStatus && prevEmojiStatus && emojiStatus.documentId !== prevEmojiStatus.documentId) {
      showEffect();
      unmarkShouldShowEffect();
    }
  }, [emojiStatus, shouldShowEffect, showEffect, unmarkShouldShowEffect]);
  const handleEmojiStatusSet = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(sticker => {
    markShouldShowEffect();
    setEmojiStatus({
      emojiStatus: sticker
    });
  }, [markShouldShowEffect, setEmojiStatus]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(hideEffect, isEffectShown ? EFFECT_DURATION_MS : undefined);
  const handleEmojiStatusClick = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openStatusPicker();
  }, [openStatusPicker]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "extra-spacing"
  }, Boolean(isEffectShown && emojiStatus) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_11__["default"], {
    reaction: emojiStatus,
    isLottie: true,
    className: "emoji-status-effect"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    round: true,
    ref: buttonRef,
    ripple: !isMobile,
    size: "smaller",
    color: "translucent",
    className: "emoji-status",
    onClick: handleEmojiStatusClick
  }, emojiStatus ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__["default"], {
    key: emojiStatus.documentId,
    documentId: emojiStatus.documentId,
    size: EMOJI_STATUS_SIZE,
    loopLimit: _config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_STATUS_LOOP_LIMIT
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__["default"], null)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_13__["default"], {
    statusButtonRef: buttonRef,
    isOpen: isStatusPickerOpen,
    onEmojiStatusSelect: handleEmojiStatusSet,
    onClose: closeStatusPicker
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId) : undefined;
  return {
    emojiStatus: currentUser?.emojiStatus
  };
})(StatusButton)));

/***/ }),

/***/ "./src/components/left/main/StatusPickerMenu.async.tsx":
/*!*************************************************************!*\
  !*** ./src/components/left/main/StatusPickerMenu.async.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StatusPickerMenuAsync = props => {
  const {
    isOpen
  } = props;
  const StatusPickerMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StatusPickerMenu', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StatusPickerMenu ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StatusPickerMenu, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatusPickerMenuAsync);

/***/ }),

/***/ "./src/components/left/newChat/NewChat.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/left/newChat/NewChat.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const NewChatAsync = props => {
  const NewChat = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'NewChat');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return NewChat ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(NewChat, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatAsync);

/***/ }),

/***/ "./src/components/left/search/LeftSearch.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/search/LeftSearch.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const LeftSearchAsync = props => {
  const LeftSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'LeftSearch');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return LeftSearch ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(LeftSearch, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LeftSearchAsync);

/***/ }),

/***/ "./src/components/left/settings/Settings.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/settings/Settings.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const SettingsAsync = props => {
  const Settings = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Settings');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return Settings ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Settings, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SettingsAsync);

/***/ }),

/***/ "./src/components/main/AttachBotRecipientPicker.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/main/AttachBotRecipientPicker.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AttachBotRecipientPickerAsync = props => {
  const {
    requestedAttachBotInChat
  } = props;
  const AttachBotRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AttachBotRecipientPicker', !requestedAttachBotInChat);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return AttachBotRecipientPicker ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AttachBotRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/BotTrustModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/main/BotTrustModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const BotTrustModalAsync = props => {
  const {
    bot
  } = props;
  const BotTrustModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'BotTrustModal', !bot);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return BotTrustModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(BotTrustModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BotTrustModalAsync);

/***/ }),

/***/ "./src/components/main/ConfettiContainer.tsx":
/*!***************************************************!*\
  !*** ./src/components/main/ConfettiContainer.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ConfettiContainer.module.scss */ "./src/components/main/ConfettiContainer.module.scss");












const CONFETTI_FADEOUT_TIMEOUT = 10000;
const DEFAULT_CONFETTI_SIZE = 10;
const CONFETTI_COLORS = ['#E8BC2C', '#D0049E', '#02CBFE', '#5723FD', '#FE8C27', '#6CB859'];
// eslint-disable-next-line max-len
const STAR_PATH = new Path2D('M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z');
const STAR_SIZE_MULTIPLIER = 1.5;
const ConfettiContainer = _ref => {
  let {
    confetti
  } = _ref;
  // eslint-disable-next-line no-null/no-null
  const canvasRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const confettiRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)([]);
  const isRafStartedRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const windowSize = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const defaultConfettiAmount = isMobile ? 50 : 100;
  const {
    lastConfettiTime,
    top,
    width,
    left,
    height,
    style = 'poppers'
  } = confetti || {};
  const generateConfetti = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(function (w, h) {
    let amount = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultConfettiAmount;
    for (let i = 0; i < amount; i++) {
      const {
        position,
        velocity
      } = generateRandomPositionData(style, w, h, i);
      const size = DEFAULT_CONFETTI_SIZE + randomNumberAroundZero(DEFAULT_CONFETTI_SIZE / 2);
      const randomColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
      confettiRef.current.push({
        pos: position,
        size,
        color: randomColor,
        velocity,
        flicker: size,
        flickerFrequency: Math.random() * 0.2,
        rotation: 0,
        lastDrawnAt: Date.now(),
        frameCount: 0,
        isStar: confetti?.withStars && Math.random() > 0.8
      });
    }
  });
  const updateCanvas = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!canvasRef.current || !isRafStartedRef.current) {
      return;
    }
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      return;
    }
    const {
      width: canvasWidth,
      height: canvasHeight
    } = canvas;
    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
    const confettiToRemove = [];
    confettiRef.current.forEach((c, i) => {
      const {
        pos,
        velocity,
        size,
        color,
        flicker,
        flickerFrequency,
        rotation,
        lastDrawnAt,
        frameCount
      } = c;
      const diff = (Date.now() - lastDrawnAt) / 1000;
      const newPos = {
        x: pos.x + velocity.x * diff,
        y: pos.y + velocity.y * diff
      };
      const newVelocity = {
        x: velocity.x * 0.5 ** (diff / 1),
        // Air Resistance
        y: velocity.y += diff * 1000 // Gravity
      };
      const newFlicker = size * Math.abs(Math.sin(frameCount * flickerFrequency));
      const newRotation = 5 * frameCount * flickerFrequency * (Math.PI / 180);
      const newFrameCount = frameCount + 1;
      const newLastDrawnAt = Date.now();
      const shouldRemove = newPos.y > canvasHeight + c.size;
      if (shouldRemove) {
        confettiToRemove.push(c);
        return;
      }
      const newConfetti = {
        ...c,
        pos: newPos,
        velocity: newVelocity,
        flicker: newFlicker,
        rotation: newRotation,
        lastDrawnAt: newLastDrawnAt,
        frameCount: newFrameCount
      };
      confettiRef.current[i] = newConfetti;
      ctx.fillStyle = color;
      if (c.isStar) {
        ctx.save();
        ctx.translate(pos.x, pos.y);
        ctx.scale(size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER, size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER);
        ctx.rotate(rotation);
        ctx.fill(STAR_PATH);
        ctx.restore();
      } else {
        ctx.beginPath();
        ctx.ellipse(pos.x, pos.y, size, flicker, rotation, 0, 2 * Math.PI);
        ctx.fill();
      }
    });
    confettiRef.current = confettiRef.current.filter(c => !confettiToRemove.includes(c));
    if (confettiRef.current.length) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
    } else {
      isRafStartedRef.current = false;
    }
  });
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__["default"])(_ref2 => {
    let [prevConfettiTime] = _ref2;
    let hideTimeout;
    if (prevConfettiTime !== lastConfettiTime) {
      generateConfetti(width || windowSize.width, height || windowSize.height);
      hideTimeout = setTimeout(forceUpdate, CONFETTI_FADEOUT_TIMEOUT);
      if (!isRafStartedRef.current) {
        isRafStartedRef.current = true;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
      }
    }
    return () => {
      clearTimeout(hideTimeout);
    };
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps -- Old timeout should be cleared only if new confetti is generated
  }, [lastConfettiTime, forceUpdate, updateCanvas]);
  if (!lastConfettiTime || Date.now() - lastConfettiTime > CONFETTI_FADEOUT_TIMEOUT) {
    return undefined;
  }
  const containerStyle = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(Boolean(top) && `top: ${top}px`, Boolean(left) && `left: ${left}px`, Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "Confetti",
    className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    style: containerStyle
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: canvasRef,
    className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].canvas,
    width: windowSize.width,
    height: windowSize.height
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global), ['confetti']))(ConfettiContainer)));
function generateRandomPositionData(style, containerWidth, containerHeight, index) {
  if (style === 'poppers') {
    const leftSide = index % 2;
    const position = {
      x: containerWidth * (leftSide ? -0.1 : 1.1),
      y: containerHeight * 0.66
    };
    const randomX = Math.random() * containerWidth;
    const randomY = -containerHeight - randomNumberAroundZero(containerHeight * 0.75);
    const velocity = {
      x: leftSide ? randomX : randomX * -1,
      y: randomY
    };
    return {
      position,
      velocity
    };
  } else {
    const position = {
      x: Math.random() * containerWidth,
      y: -DEFAULT_CONFETTI_SIZE * 2
    };
    const randomX = randomNumberAroundZero(containerWidth);
    const randomY = -containerHeight * Math.random() * 1.25;
    const velocity = {
      x: randomX,
      y: randomY
    };
    return {
      position,
      velocity
    };
  }
}
function randomNumberAroundZero() {
  let max = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
  return Math.random() * max - max / 2;
}

/***/ }),

/***/ "./src/components/main/DeleteFolderDialog.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/main/DeleteFolderDialog.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DeleteFolderDialogAsync = props => {
  const {
    folder
  } = props;
  const DeleteFolderDialog = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DeleteFolderDialog', !folder);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return DeleteFolderDialog ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DeleteFolderDialog, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteFolderDialogAsync);

/***/ }),

/***/ "./src/components/main/Dialogs.async.tsx":
/*!***********************************************!*\
  !*** ./src/components/main/Dialogs.async.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DialogsAsync = _ref => {
  let {
    isOpen
  } = _ref;
  const Dialogs = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Dialogs', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return Dialogs ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Dialogs, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DialogsAsync);

/***/ }),

/***/ "./src/components/main/DownloadManager.tsx":
/*!*************************************************!*\
  !*** ./src/components/main/DownloadManager.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_download__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/download */ "./src/util/download.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");









const GLOBAL_UPDATE_DEBOUNCE = 1000;
const processedHashes = new Set();
const downloadedHashes = new Set();
const DownloadManager = _ref => {
  let {
    activeDownloads
  } = _ref;
  const {
    cancelMediaHashDownloads,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const runDebounced = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_8__["default"])(GLOBAL_UPDATE_DEBOUNCE, true);
  const handleMediaDownloaded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(hash => {
    downloadedHashes.add(hash);
    runDebounced(() => {
      if (downloadedHashes.size) {
        cancelMediaHashDownloads({
          mediaHashes: Array.from(downloadedHashes)
        });
        downloadedHashes.clear();
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!Object.keys(activeDownloads).length) {
      processedHashes.clear();
      return;
    }
    Object.entries(activeDownloads).forEach(_ref2 => {
      let [mediaHash, metadata] = _ref2;
      if (processedHashes.has(mediaHash)) {
        return;
      }
      processedHashes.add(mediaHash);
      const {
        size,
        filename,
        format: mediaFormat
      } = metadata;
      const mediaData = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.getFromMemory(mediaHash);
      if (mediaData) {
        (0,_util_download__WEBPACK_IMPORTED_MODULE_4__["default"])(mediaData, filename);
        handleMediaDownloaded(mediaHash);
        return;
      }
      if (size > _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.MAX_BUFFER_SIZE && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_OPFS_SUPPORTED && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_SERVICE_WORKER_SUPPORTED) {
        showNotification({
          message: 'Downloading files bigger than 2GB is not supported in your browser.'
        });
        handleMediaDownloaded(mediaHash);
        return;
      }
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(mediaHash, mediaFormat, true).then(result => {
        if (mediaFormat === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.DownloadUrl) {
          const url = new URL(result, window.document.baseURI);
          url.searchParams.set('filename', encodeURIComponent(filename));
          const downloadWindow = window.open(url.toString());
          downloadWindow?.addEventListener('beforeunload', () => {
            showNotification({
              message: 'Download started. Please, do not close the app before it is finished.'
            });
          });
        } else if (result) {
          (0,_util_download__WEBPACK_IMPORTED_MODULE_4__["default"])(result, filename);
        }
        handleMediaDownloaded(mediaHash);
      });
    });
  }, [activeDownloads]);
  return undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global).activeDownloads;
  return {
    activeDownloads
  };
})(DownloadManager)));

/***/ }),

/***/ "./src/components/main/DraftRecipientPicker.async.tsx":
/*!************************************************************!*\
  !*** ./src/components/main/DraftRecipientPicker.async.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DraftRecipientPickerAsync = props => {
  const {
    requestedDraft
  } = props;
  const DraftRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DraftRecipientPicker', !requestedDraft);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return DraftRecipientPicker ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DraftRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DraftRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/ForwardRecipientPicker.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/main/ForwardRecipientPicker.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ForwardRecipientPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ForwardRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ForwardRecipientPicker', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ForwardRecipientPicker ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ForwardRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ForwardRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/GameModal.tsx":
/*!*******************************************!*\
  !*** ./src/components/main/GameModal.tsx ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useSendMessageAction */ "./src/hooks/useSendMessageAction.ts");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GameModal_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GameModal.scss */ "./src/components/main/GameModal.scss");











const PLAY_GAME_ACTION_INTERVAL = 5000;
const GameModal = _ref => {
  let {
    openedGame,
    gameTitle,
    canPost
  } = _ref;
  const {
    closeGame,
    openForwardMenu
  } = (0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    url,
    chatId,
    messageId
  } = openedGame || {};
  const isOpen = Boolean(url);
  const sendMessageAction = (0,_hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_8__["default"])(chatId);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    sendMessageAction({
      type: 'playingGame'
    });
  }, isOpen && canPost ? PLAY_GAME_ACTION_INTERVAL : undefined);
  const handleMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    try {
      const data = JSON.parse(event.data);
      if (data.eventType === 'share_score') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId],
          withMyScore: true
        });
        closeGame();
      }
      if (data.eventType === 'share_game') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId]
        });
        closeGame();
      }
    } catch (e) {
      // Ignore other messages
    }
  }, [chatId, closeGame, messageId, openForwardMenu]);
  const handleLoad = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    event.currentTarget.focus();
  }, []);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    window.addEventListener('message', handleMessage);
    return () => window.removeEventListener('message', handleMessage);
  }, [handleMessage]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_9__["default"], {
    className: "GameModal",
    isOpen: isOpen,
    onClose: closeGame,
    title: gameTitle,
    hasCloseButton: true
  }, isOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("iframe", {
    className: "game-frame",
    onLoad: handleLoad,
    src: url,
    title: lang('AttachGame'),
    sandbox: "allow-scripts allow-same-origin allow-orientation-lock",
    allow: "fullscreen"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, _ref2) => {
  let {
    openedGame
  } = _ref2;
  const {
    chatId
  } = openedGame || {};
  const chat = chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, chatId);
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatFullInfo)(global, chatId) : undefined;
  const canPost = Boolean(chat) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getCanPostInChat)(chat, _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID, undefined, chatFullInfo);
  return {
    canPost
  };
})(GameModal)));

/***/ }),

/***/ "./src/components/main/HistoryCalendar.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/main/HistoryCalendar.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const HistoryCalendarAsync = props => {
  const {
    isOpen
  } = props;
  const HistoryCalendar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'HistoryCalendar', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return HistoryCalendar ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(HistoryCalendar, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HistoryCalendarAsync);

/***/ }),

/***/ "./src/components/main/LockScreen.tsx":
/*!********************************************!*\
  !*** ./src/components/main/LockScreen.tsx ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../common/PasswordForm */ "./src/components/common/PasswordForm.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./LockScreen.module.scss */ "./src/components/main/LockScreen.module.scss");
/* harmony import */ var _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../assets/lock.png */ "./src/assets/lock.png");















const ICON_SIZE = 160;
const LockScreen = _ref => {
  let {
    isLocked,
    passcodeSettings
  } = _ref;
  const {
    unlockScreen,
    signOut,
    logInvalidUnlockAttempt,
    resetInvalidUnlockAttempts
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    invalidAttemptsCount,
    timeoutUntil,
    isLoading
  } = passcodeSettings;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [validationError, setValidationError] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [shouldShowPasscode, setShouldShowPasscode] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isSignOutDialogOpen, openSignOutConfirmation, closeSignOutConfirmation] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])(false);
  const {
    shouldRender
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_7__["default"])(isLocked);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__["default"])(resetInvalidUnlockAttempts, timeoutUntil ? timeoutUntil - Date.now() : undefined);
  const handleClearError = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setValidationError('');
  }, []);
  const handleSubmit = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(passcode => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
      return;
    }
    setValidationError('');
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_2__.decryptSession)(passcode).then(unlockScreen, err => {
      if (err instanceof _util_passcode__WEBPACK_IMPORTED_MODULE_2__.UnrecoverablePasscodeError) {
        signOut({
          forceInitApi: true
        });
      }
      logInvalidUnlockAttempt();
      setValidationError(lang('lng_passcode_wrong'));
    });
  }, [lang, timeoutUntil]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
    } else if (invalidAttemptsCount === 0) {
      setValidationError('');
    }
  }, [timeoutUntil, lang, invalidAttemptsCount]);
  const handleSignOutMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    closeSignOutConfirmation();
    signOut({
      forceInitApi: true
    });
  }, [closeSignOutConfirmation, signOut]);
  if (!shouldRender) {
    return undefined;
  }
  function renderLogoutPrompt() {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].help
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
      onClick: openSignOutConfirmation
    }, "Log out"), ' ', "if you don't remember your passcode."), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
      color: "translucent",
      size: "tiny",
      isText: true,
      onClick: openSignOutConfirmation
    }, lang('AccountSettings.Logout'))));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].container
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].wrapper,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__["default"], {
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__.LOCAL_TGS_URLS.Lock,
    previewUrl: _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__,
    size: ICON_SIZE,
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].icon
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__["default"], {
    key: "password-form",
    shouldShowSubmit: true,
    shouldDisablePasswordManager: true,
    isLoading: isLoading,
    error: validationError,
    placeholder: lang('Passcode.EnterPasscodePlaceholder'),
    submitLabel: lang('Next'),
    clearError: handleClearError,
    isPasswordVisible: shouldShowPasscode,
    noRipple: true,
    onChangePasswordVisibility: setShouldShowPasscode,
    onSubmit: handleSubmit
  }), renderLogoutPrompt()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isOpen: isSignOutDialogOpen,
    onClose: closeSignOutConfirmation,
    text: lang('lng_sure_logout'),
    confirmLabel: lang('AccountSettings.Logout'),
    confirmHandler: handleSignOutMessage,
    confirmIsDestructive: true
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    passcodeSettings: global.passcode
  };
})(LockScreen)));

/***/ }),

/***/ "./src/components/main/Main.tsx":
/*!**************************************!*\
  !*** ./src/components/main/Main.tsx ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _global_actions_all__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../global/actions/all */ "./src/global/actions/all.ts");
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types_electron__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../types/electron */ "./src/types/electron.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/cssAnimationEndListeners */ "./src/util/cssAnimationEndListeners.ts");
/* harmony import */ var _util_deeplink__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/deeplink */ "./src/util/deeplink.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _nreach_helpers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../nreach/helpers */ "./src/nreach/helpers.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useHeavyAnimationCheck */ "./src/hooks/useHeavyAnimationCheck.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/usePreventPinchZoomGesture */ "./src/hooks/usePreventPinchZoomGesture.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/window/useBeforeUnload */ "./src/hooks/window/useBeforeUnload.ts");
/* harmony import */ var _hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/window/useFullscreen */ "./src/hooks/window/useFullscreen.ts");
/* harmony import */ var _calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../calls/ActiveCallHeader.async */ "./src/components/calls/ActiveCallHeader.async.tsx");
/* harmony import */ var _calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../calls/group/GroupCall.async */ "./src/components/calls/group/GroupCall.async.tsx");
/* harmony import */ var _calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../calls/phone/PhoneCall.async */ "./src/components/calls/phone/PhoneCall.async.tsx");
/* harmony import */ var _calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../calls/phone/RatePhoneCallModal.async */ "./src/components/calls/phone/RatePhoneCallModal.async.tsx");
/* harmony import */ var _common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../common/CustomEmojiSetsModal.async */ "./src/components/common/CustomEmojiSetsModal.async.tsx");
/* harmony import */ var _common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../common/StickerSetModal.async */ "./src/components/common/StickerSetModal.async.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _left_LeftColumn__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../left/LeftColumn */ "./src/components/left/LeftColumn.tsx");
/* harmony import */ var _mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../mediaViewer/MediaViewer.async */ "./src/components/mediaViewer/MediaViewer.async.tsx");
/* harmony import */ var _middle_AudioPlayer__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../middle/AudioPlayer */ "./src/components/middle/AudioPlayer.tsx");
/* harmony import */ var _middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../middle/message/reactions/ReactionPicker.async */ "./src/components/middle/message/reactions/ReactionPicker.async.tsx");
/* harmony import */ var _middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../middle/MessageListHistoryHandler */ "./src/components/middle/MessageListHistoryHandler.tsx");
/* harmony import */ var _middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../middle/MiddleColumn */ "./src/components/middle/MiddleColumn.tsx");
/* harmony import */ var _modals_ModalContainer__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../modals/ModalContainer */ "./src/components/modals/ModalContainer.tsx");
/* harmony import */ var _payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../payment/PaymentModal.async */ "./src/components/payment/PaymentModal.async.tsx");
/* harmony import */ var _payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../payment/ReceiptModal.async */ "./src/components/payment/ReceiptModal.async.tsx");
/* harmony import */ var _right_RightColumn__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../right/RightColumn */ "./src/components/right/RightColumn.tsx");
/* harmony import */ var _story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../story/StoryViewer.async */ "./src/components/story/StoryViewer.async.tsx");
/* harmony import */ var _AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./AttachBotRecipientPicker.async */ "./src/components/main/AttachBotRecipientPicker.async.tsx");
/* harmony import */ var _BotTrustModal_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./BotTrustModal.async */ "./src/components/main/BotTrustModal.async.tsx");
/* harmony import */ var _ConfettiContainer__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./ConfettiContainer */ "./src/components/main/ConfettiContainer.tsx");
/* harmony import */ var _DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./DeleteFolderDialog.async */ "./src/components/main/DeleteFolderDialog.async.tsx");
/* harmony import */ var _Dialogs_async__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./Dialogs.async */ "./src/components/main/Dialogs.async.tsx");
/* harmony import */ var _DownloadManager__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./DownloadManager */ "./src/components/main/DownloadManager.tsx");
/* harmony import */ var _DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./DraftRecipientPicker.async */ "./src/components/main/DraftRecipientPicker.async.tsx");
/* harmony import */ var _ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./ForwardRecipientPicker.async */ "./src/components/main/ForwardRecipientPicker.async.tsx");
/* harmony import */ var _GameModal__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./GameModal */ "./src/components/main/GameModal.tsx");
/* harmony import */ var _HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./HistoryCalendar.async */ "./src/components/main/HistoryCalendar.async.tsx");
/* harmony import */ var _NewContactModal_async__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./NewContactModal.async */ "./src/components/main/NewContactModal.async.tsx");
/* harmony import */ var _Notifications_async__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./Notifications.async */ "./src/components/main/Notifications.async.tsx");
/* harmony import */ var _premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./premium/common/PremiumLimitReachedModal.async */ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx");
/* harmony import */ var _premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./premium/GiveawayModal.async */ "./src/components/main/premium/GiveawayModal.async.tsx");
/* harmony import */ var _premium_PremiumGiftingModal_async__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./premium/PremiumGiftingModal.async */ "./src/components/main/premium/PremiumGiftingModal.async.tsx");
/* harmony import */ var _premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./premium/PremiumMainModal.async */ "./src/components/main/premium/PremiumMainModal.async.tsx");
/* harmony import */ var _SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./SafeLinkModal.async */ "./src/components/main/SafeLinkModal.async.tsx");
/* harmony import */ var _Main_scss__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./Main.scss */ "./src/components/main/Main.scss");
































































const APP_OUTDATED_TIMEOUT_MS = 5 * 60 * 1000; // 5 min
const CALL_BUNDLE_LOADING_DELAY_MS = 5000; // 5 sec

// eslint-disable-next-line @typescript-eslint/naming-convention
let DEBUG_isLogged = false;
const Main = _ref => {
  let {
    isMobile,
    isLeftColumnOpen,
    isMiddleColumnOpen,
    isRightColumnOpen,
    isMediaViewerOpen,
    isStoryViewerOpen,
    isForwardModalOpen,
    hasNotifications,
    hasDialogs,
    audioMessage,
    activeGroupCallId,
    safeLinkModalUrl,
    isHistoryCalendarOpen,
    shouldSkipHistoryAnimations,
    limitReached,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    isServiceChatReady,
    withInterfaceAnimations,
    language,
    wasTimeFormatSetManually,
    addedSetIds,
    addedCustomEmojiIds,
    isPhoneCallActive,
    newContactUserId,
    newContactByPhoneNumber,
    openedGame,
    gameTitle,
    isRatePhoneCallModalOpen,
    botTrustRequest,
    botTrustRequestBot,
    requestedAttachBotInChat,
    requestedDraft,
    isPremiumModalOpen,
    isGiveawayModalOpen,
    isPremiumGiftingModalOpen,
    isPaymentModalOpen,
    isReceiptModalOpen,
    isReactionPickerOpen,
    isCurrentUserPremium,
    deleteFolderDialog,
    isMasterTab,
    noRightColumnAnimation,
    isSynced,
    currentUserId
  } = _ref;
  const {
    initMain,
    loadAnimatedEmojis,
    loadBirthdayNumbersStickers,
    loadNotificationSettings,
    loadNotificationExceptions,
    updateIsOnline,
    onTabFocusChange,
    loadTopInlineBots,
    loadEmojiKeywords,
    loadCountryList,
    loadAvailableReactions,
    loadStickerSets,
    loadPremiumGifts,
    loadDefaultTopicIcons,
    loadAddedStickers,
    loadFavoriteStickers,
    loadDefaultStatusIcons,
    ensureTimeFormat,
    closeStickerSetModal,
    closeCustomEmojiSets,
    checkVersionNotification,
    loadConfig,
    loadAppConfig,
    loadAttachBots,
    loadContactList,
    loadCustomEmojis,
    loadGenericEmojiEffects,
    closePaymentModal,
    clearReceipt,
    checkAppVersion,
    openThread,
    toggleLeftColumn,
    loadRecentEmojiStatuses,
    updatePageTitle,
    loadTopReactions,
    loadRecentReactions,
    loadDefaultTagReactions,
    loadFeaturedEmojiStickers,
    setIsElectronUpdateAvailable,
    loadAuthorizations,
    loadPeerColors,
    loadSavedReactionTags,
    loadTimezones,
    loadQuickReplies,
    loadStarStatus,
    loadAvailableEffects
  } = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getActions)();
  if (_config__WEBPACK_IMPORTED_MODULE_5__.DEBUG && !DEBUG_isLogged) {
    DEBUG_isLogged = true;
    // eslint-disable-next-line no-console
    console.log('>>> RENDER MAIN');
  }

  // Preload Calls bundle to initialize sounds for iOS
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    void (0,_util_moduleLoader__WEBPACK_IMPORTED_MODULE_11__.loadBundle)(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_11__.Bundles.Calls);
  }, CALL_BUNDLE_LOADING_DELAY_MS);

  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const leftColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);
  const [crmPageInitialized, setCrmPageInitialized] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useState)(false);

  // Example in a React component or similar central script
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    function receiveMessage(event) {
      // eslint-disable-next-line max-len
      const domains = ['http://localhost:3000', 'https://develop.nreach.io', 'https://app.nreach.io', 'https://develop.d25qb5qv8apj8m.amplifyapp.com', 'https://main.deq09zb7fu5m5.amplifyapp.com'];
      // Check the origin for security reasons
      if (!domains.includes(event.origin)) {
        return;
      }

      // Handle the message
      const data = event.data;
      switch (data.type) {
        case 'username':
          (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_10__.processDeepLink)(`tg://resolve?domain=${data.channel}`);
          break;
        case 'userId':
          openThread({
            chatId: data.channel,
            threadId: -1,
            type: 'thread'
          });
          break;
        case 'phone':
          (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_10__.processDeepLink)(`tg://resolve?phone=${data.channel}`);
          break;
        case 'syncUnreadMessages':
          if (!crmPageInitialized) {
            // eslint-disable-next-line no-console
            console.log('syncUnreadMessages');
            (0,_nreach_helpers__WEBPACK_IMPORTED_MODULE_15__.updateCrmWithTimeout)((0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)(), JSON.parse(data.telegramIds));
            // eslint-disable-next-line no-console
            setCrmPageInitialized(true);
          }
          break;
        default:
          // eslint-disable-next-line no-console
          console.log(`Type for postMessage ${data.type}`);
      }
    }
    window.addEventListener('message', receiveMessage);

    // Cleanup
    return () => {
      window.removeEventListener('message', receiveMessage);
    };
  }, [crmPageInitialized]);
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isLeftColumnOpen && !isMiddleColumnOpen && !isDesktop) {
      // Always display at least one column
      toggleLeftColumn();
    } else if (isLeftColumnOpen && isMiddleColumnOpen && isMobile) {
      // Can't have two active columns at the same time
      toggleLeftColumn();
    }
  }, [isDesktop, isLeftColumnOpen, isMiddleColumnOpen, isMobile, toggleLeftColumn]);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_16__["default"])(checkAppVersion, isMasterTab ? APP_OUTDATED_TIMEOUT_MS : undefined, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_14__.IS_ELECTRON) {
      return undefined;
    }
    const removeUpdateAvailableListener = window.electron.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.UPDATE_AVAILABLE, () => {
      setIsElectronUpdateAvailable(true);
    });
    const removeUpdateErrorListener = window.electron.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.UPDATE_ERROR, () => {
      setIsElectronUpdateAvailable(false);
      removeUpdateAvailableListener?.();
    });
    return () => {
      removeUpdateErrorListener?.();
      removeUpdateAvailableListener?.();
    };
  }, []);

  // Initial API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced) {
      updateIsOnline(true);
      loadConfig();
      loadAppConfig();
      loadPeerColors();
      initMain();
      loadAvailableReactions();
      loadAnimatedEmojis();
      loadNotificationSettings();
      loadNotificationExceptions();
      loadAttachBots();
      loadContactList();
      loadDefaultTopicIcons();
      checkAppVersion();
      loadTopReactions();
      loadRecentReactions();
      loadDefaultTagReactions();
      loadFeaturedEmojiStickers();
      loadTopInlineBots();
      loadEmojiKeywords({
        language: _config__WEBPACK_IMPORTED_MODULE_5__.BASE_EMOJI_KEYWORD_LANG
      });
      loadTimezones();
      loadQuickReplies();
      loadStarStatus();
      loadPremiumGifts();
      loadAvailableEffects();
      loadBirthdayNumbersStickers();
      loadGenericEmojiEffects();
      loadSavedReactionTags();
      loadAuthorizations();
    }
  }, [isMasterTab, isSynced]);

  // Initial Premium API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isCurrentUserPremium) {
      loadDefaultStatusIcons();
      loadRecentEmojiStatuses();
    }
  }, [isCurrentUserPremium, isMasterTab]);

  // Language-based API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      if (language !== _config__WEBPACK_IMPORTED_MODULE_5__.BASE_EMOJI_KEYWORD_LANG) {
        loadEmojiKeywords({
          language: language
        });
      }
      loadCountryList({
        langCode: language
      });
    }
  }, [language, isMasterTab]);

  // Re-fetch cached saved emoji for `localDb`
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      loadCustomEmojis({
        ids: Object.keys((0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)().customEmojis.byId),
        ignoreCache: true
      });
    }
  }, [isMasterTab]);

  // Sticker sets
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced) {
      if (!addedSetIds || !addedCustomEmojiIds) {
        loadStickerSets();
        loadFavoriteStickers();
      }
      if (addedSetIds && addedCustomEmojiIds) {
        loadAddedStickers();
      }
    }
  }, [addedSetIds, addedCustomEmojiIds, isMasterTab, isSynced]);

  // Check version when service chat is ready
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isServiceChatReady && isMasterTab) {
      checkVersionNotification();
    }
  }, [isServiceChatReady, isMasterTab]);

  // Ensure time format
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!wasTimeFormatSetManually) {
      ensureTimeFormat();
    }
  }, [wasTimeFormatSetManually]);

  // Parse deep link
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isSynced) return;
    const parsedInitialLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_12__.parseInitialLocationHash)();
    if (parsedInitialLocationHash?.tgaddr) {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_10__.processDeepLink)(decodeURIComponent(parsedInitialLocationHash.tgaddr));
    }
  }, [isSynced]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    return window.electron?.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.DEEPLINK, link => {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_10__.processDeepLink)(decodeURIComponent(link));
    });
  }, []);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    const parsedLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_12__.parseLocationHash)(currentUserId);
    if (!parsedLocationHash) return;
    openThread({
      chatId: parsedLocationHash.chatId,
      threadId: parsedLocationHash.threadId,
      type: parsedLocationHash.type
    });
  }, [currentUserId]);

  // Restore Transition slide class after async rendering
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useLayoutEffect)(() => {
    const container = containerRef.current;
    if (container.parentNode.childElementCount === 1) {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__.addExtraClass)(container, 'Transition_slide-active');
    }
  }, []);
  const leftColumnTransition = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_23__["default"])(isLeftColumnOpen, undefined, true, undefined, shouldSkipHistoryAnimations, undefined, true);
  const willAnimateLeftColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_19__["default"])();

  // Handle opening middle column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(_ref2 => {
    let [prevIsLeftColumnOpen] = _ref2;
    if (prevIsLeftColumnOpen === undefined || isLeftColumnOpen === prevIsLeftColumnOpen || !withInterfaceAnimations) {
      return;
    }
    willAnimateLeftColumnRef.current = true;
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_14__.IS_ANDROID) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestNextMutation)(() => {
        document.body.classList.toggle('android-left-blackout-open', !isLeftColumnOpen);
      });
    }
    const dispatchHeavyAnimationEnd = (0,_hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_20__.dispatchHeavyAnimationEvent)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_9__.waitForTransitionEnd)(document.getElementById('MiddleColumn'), () => {
      dispatchHeavyAnimationEnd();
      willAnimateLeftColumnRef.current = false;
      forceUpdate();
    });
  }, [isLeftColumnOpen, withInterfaceAnimations, forceUpdate]);
  const rightColumnTransition = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_23__["default"])(isRightColumnOpen, undefined, true, undefined, shouldSkipHistoryAnimations, undefined, true);
  const willAnimateRightColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const [isNarrowMessageList, setIsNarrowMessageList] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useState)(isRightColumnOpen);
  const isFullscreen = (0,_hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_27__.useFullscreenStatus)();

  // Handle opening right column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(_ref3 => {
    let [prevIsMiddleColumnOpen, prevIsRightColumnOpen] = _ref3;
    if (prevIsRightColumnOpen === undefined || isRightColumnOpen === prevIsRightColumnOpen) {
      return;
    }
    if (!prevIsMiddleColumnOpen || noRightColumnAnimation) {
      setIsNarrowMessageList(isRightColumnOpen);
      return;
    }
    willAnimateRightColumnRef.current = true;
    const dispatchHeavyAnimationEnd = (0,_hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_20__.dispatchHeavyAnimationEvent)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_9__.waitForTransitionEnd)(document.getElementById('RightColumn'), () => {
      dispatchHeavyAnimationEnd();
      willAnimateRightColumnRef.current = false;
      forceUpdate();
      setIsNarrowMessageList(isRightColumnOpen);
    });
  }, [isMiddleColumnOpen, isRightColumnOpen, noRightColumnAnimation, forceUpdate]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])(leftColumnTransition.hasShownClass && 'left-column-shown', leftColumnTransition.hasOpenClass && 'left-column-open', willAnimateLeftColumnRef.current && 'left-column-animating', rightColumnTransition.hasShownClass && 'right-column-shown', rightColumnTransition.hasOpenClass && 'right-column-open', willAnimateRightColumnRef.current && 'right-column-animating', isNarrowMessageList && 'narrow-message-list', shouldSkipHistoryAnimations && 'history-animation-disabled', isFullscreen && 'is-fullscreen');
  const handleBlur = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    onTabFocusChange({
      isBlurred: true
    });
  });
  const handleFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    onTabFocusChange({
      isBlurred: false
    });
    if (!document.title.includes(_config__WEBPACK_IMPORTED_MODULE_5__.INACTIVE_MARKER)) {
      updatePageTitle();
    }
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_13__["default"])(false);
  });
  const handleStickerSetModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    closeStickerSetModal();
  });
  const handleCustomEmojiSetsModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    closeCustomEmojiSets();
  });

  // Online status and browser tab indicators
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_25__["default"])(handleBlur, handleFocus, !!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_14__.IS_ELECTRON);
  (0,_hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_26__["default"])(handleBlur);
  (0,_hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_22__["default"])(isMediaViewerOpen || isStoryViewerOpen);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    ref: containerRef,
    id: "Main",
    className: className
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_left_LeftColumn__WEBPACK_IMPORTED_MODULE_35__["default"], {
    ref: leftColumnRef
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_40__["default"], {
    leftColumnRef: leftColumnRef,
    isMobile: isMobile
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_right_RightColumn__WEBPACK_IMPORTED_MODULE_44__["default"], {
    isMobile: isMobile
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_36__["default"], {
    isOpen: isMediaViewerOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_45__["default"], {
    isOpen: isStoryViewerOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_53__["default"], {
    isOpen: isForwardModalOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_52__["default"], {
    requestedDraft: requestedDraft
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_Notifications_async__WEBPACK_IMPORTED_MODULE_57__["default"], {
    isOpen: hasNotifications
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_Dialogs_async__WEBPACK_IMPORTED_MODULE_50__["default"], {
    isOpen: hasDialogs
  }), audioMessage && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_AudioPlayer__WEBPACK_IMPORTED_MODULE_37__["default"], {
    key: audioMessage.id,
    message: audioMessage,
    noUi: true
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_modals_ModalContainer__WEBPACK_IMPORTED_MODULE_41__["default"], null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_62__["default"], {
    url: safeLinkModalUrl
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_55__["default"], {
    isOpen: isHistoryCalendarOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_33__["default"], {
    isOpen: Boolean(openedStickerSetShortName),
    onClose: handleStickerSetModalClose,
    stickerSetShortName: openedStickerSetShortName
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_32__["default"], {
    customEmojiSetIds: openedCustomEmojiSetIds,
    onClose: handleCustomEmojiSetsModalClose
  }), activeGroupCallId && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_29__["default"], {
    groupCallId: activeGroupCallId
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_28__["default"], {
    isActive: Boolean(activeGroupCallId || isPhoneCallActive)
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_NewContactModal_async__WEBPACK_IMPORTED_MODULE_56__["default"], {
    isOpen: Boolean(newContactUserId || newContactByPhoneNumber),
    userId: newContactUserId,
    isByPhoneNumber: newContactByPhoneNumber
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_GameModal__WEBPACK_IMPORTED_MODULE_54__["default"], {
    openedGame: openedGame,
    gameTitle: gameTitle
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DownloadManager__WEBPACK_IMPORTED_MODULE_51__["default"], null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_ConfettiContainer__WEBPACK_IMPORTED_MODULE_48__["default"], null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_30__["default"], {
    isActive: isPhoneCallActive
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_34__["default"], {
    isForAppBadge: true
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
    isOpen: isRatePhoneCallModalOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_BotTrustModal_async__WEBPACK_IMPORTED_MODULE_47__["default"], {
    bot: botTrustRequestBot,
    type: botTrustRequest?.type,
    shouldRequestWriteAccess: botTrustRequest?.shouldRequestWriteAccess
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_46__["default"], {
    requestedAttachBotInChat: requestedAttachBotInChat
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_39__["default"], null), isPremiumModalOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_61__["default"], {
    isOpen: isPremiumModalOpen
  }), isGiveawayModalOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_59__["default"], {
    isOpen: isGiveawayModalOpen
  }), isPremiumGiftingModalOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_PremiumGiftingModal_async__WEBPACK_IMPORTED_MODULE_60__["default"], {
    isOpen: isPremiumGiftingModalOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_58__["default"], {
    limit: limitReached
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_42__["default"], {
    isOpen: isPaymentModalOpen,
    onClose: closePaymentModal
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_43__["default"], {
    isOpen: isReceiptModalOpen,
    onClose: clearReceipt
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_49__["default"], {
    folder: deleteFolderDialog
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_38__["default"], {
    isOpen: isReactionPickerOpen
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_3__.withGlobal)((global, _ref4) => {
  let {
    isMobile
  } = _ref4;
  const {
    settings: {
      byKey: {
        language,
        wasTimeFormatSetManually
      }
    },
    currentUserId
  } = global;
  const {
    botTrustRequest,
    requestedAttachBotInChat,
    requestedDraft,
    safeLinkModalUrl,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    shouldSkipHistoryAnimations,
    openedGame,
    audioPlayer,
    isLeftColumnShown,
    historyCalendarSelectedAt,
    notifications,
    dialogs,
    newContact,
    ratingPhoneCall,
    premiumModal,
    giveawayModal,
    giftingModal,
    isMasterTab,
    payment,
    limitReachedModal,
    deleteFolderDialogModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  const gameMessage = openedGame && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, openedGame.chatId, openedGame.messageId);
  const gameTitle = gameMessage?.content.game?.title;
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global) || {};
  const noRightColumnAnimation = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPerformanceSettingsValue)(global, 'rightColumnAnimations') || !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAnimateInterface)(global);
  const deleteFolderDialog = deleteFolderDialogModal ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatFolder)(global, deleteFolderDialogModal) : undefined;
  return {
    currentUserId,
    isLeftColumnOpen: isLeftColumnShown,
    isMiddleColumnOpen: Boolean(chatId),
    isRightColumnOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsRightColumnShown)(global, isMobile),
    isMediaViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMediaViewerOpen)(global),
    isStoryViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsStoryViewerOpen)(global),
    isForwardModalOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsForwardModalOpen)(global),
    isReactionPickerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsReactionPickerOpen)(global),
    hasNotifications: Boolean(notifications.length),
    hasDialogs: Boolean(dialogs.length),
    audioMessage,
    safeLinkModalUrl,
    isHistoryCalendarOpen: Boolean(historyCalendarSelectedAt),
    shouldSkipHistoryAnimations,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    isServiceChatReady: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsServiceChatReady)(global),
    activeGroupCallId: isMasterTab ? global.groupCalls.activeGroupCallId : undefined,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAnimateInterface)(global),
    language,
    wasTimeFormatSetManually,
    isPhoneCallActive: isMasterTab ? Boolean(global.phoneCall) : undefined,
    addedSetIds: global.stickers.added.setIds,
    addedCustomEmojiIds: global.customEmojis.added.setIds,
    newContactUserId: newContact?.userId,
    newContactByPhoneNumber: newContact?.isByPhoneNumber,
    openedGame,
    gameTitle,
    isRatePhoneCallModalOpen: Boolean(ratingPhoneCall),
    botTrustRequest,
    botTrustRequestBot: botTrustRequest && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, botTrustRequest.botId),
    requestedAttachBotInChat,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserPremium)(global),
    isPremiumModalOpen: premiumModal?.isOpen,
    isGiveawayModalOpen: giveawayModal?.isOpen,
    isPremiumGiftingModalOpen: giftingModal?.isOpen,
    limitReached: limitReachedModal?.limit,
    isPaymentModalOpen: payment.isPaymentModalOpen,
    isReceiptModalOpen: Boolean(payment.receipt),
    deleteFolderDialog,
    isMasterTab,
    requestedDraft,
    noRightColumnAnimation,
    isSynced: global.isSynced
  };
})(Main)));

/***/ }),

/***/ "./src/components/main/NewContactModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/main/NewContactModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const NewContactModalAsync = props => {
  const {
    isOpen
  } = props;
  const NewContactModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'NewContactModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return NewContactModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(NewContactModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewContactModalAsync);

/***/ }),

/***/ "./src/components/main/Notifications.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/main/Notifications.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const NotificationsAsync = _ref => {
  let {
    isOpen
  } = _ref;
  const Notifications = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Notifications', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return Notifications ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Notifications, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NotificationsAsync);

/***/ }),

/***/ "./src/components/main/SafeLinkModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/main/SafeLinkModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SafeLinkModalAsync = props => {
  const {
    url
  } = props;
  const SafeLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SafeLinkModal', !url);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return SafeLinkModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SafeLinkModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SafeLinkModalAsync);

/***/ }),

/***/ "./src/components/main/premium/GiftPremiumModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/main/premium/GiftPremiumModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftPremiumModalAsync = props => {
  const {
    isOpen
  } = props;
  const GiftPremiumModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GiftPremiumModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return GiftPremiumModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftPremiumModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftPremiumModalAsync);

/***/ }),

/***/ "./src/components/main/premium/GiveawayModal.async.tsx":
/*!*************************************************************!*\
  !*** ./src/components/main/premium/GiveawayModal.async.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiveawayModalAsync = props => {
  const {
    isOpen
  } = props;
  const GiveawayModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GiveawayModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return GiveawayModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiveawayModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiveawayModalAsync);

/***/ }),

/***/ "./src/components/main/premium/PremiumGiftingModal.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/main/premium/PremiumGiftingModal.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PremiumGiftingModalAsync = props => {
  const {
    isOpen
  } = props;
  const PremiumGiftingModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PremiumGiftingModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PremiumGiftingModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PremiumGiftingModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumGiftingModalAsync);

/***/ }),

/***/ "./src/components/main/premium/PremiumMainModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/main/premium/PremiumMainModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PremiumMainModalAsync = props => {
  const {
    isOpen
  } = props;
  const PremiumMainModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PremiumMainModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PremiumMainModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PremiumMainModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumMainModalAsync);

/***/ }),

/***/ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx":
/*!*******************************************************************************!*\
  !*** ./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PremiumLimitReachedModalAsync = props => {
  const {
    limit
  } = props;
  const PremiumLimitReachedModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PremiumLimitReachedModal', !limit);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PremiumLimitReachedModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PremiumLimitReachedModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumLimitReachedModalAsync);

/***/ }),

/***/ "./src/components/mediaViewer/MediaViewer.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/mediaViewer/MediaViewer.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MediaViewerAsync = _ref => {
  let {
    isOpen
  } = _ref;
  const MediaViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MediaViewer', !isOpen);
  return MediaViewer ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MediaViewer, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MediaViewerAsync);

/***/ }),

/***/ "./src/components/middle/AudioPlayer.tsx":
/*!***********************************************!*\
  !*** ./src/components/middle/AudioPlayer.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useAudioPlayer */ "./src/hooks/useAudioPlayer.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useMessageMediaMetadata */ "./src/hooks/useMessageMediaMetadata.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_RangeSlider__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/RangeSlider */ "./src/components/ui/RangeSlider.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _AudioPlayer_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./AudioPlayer.scss */ "./src/components/middle/AudioPlayer.scss");























const PLAYBACK_RATES = {
  0.5: 0.66,
  0.75: 0.8,
  1: 1,
  1.5: 1.4,
  2: 1.8
};
const PLAYBACK_RATE_VALUES = Object.keys(PLAYBACK_RATES).sort().map(Number);
const REGULAR_PLAYBACK_RATE = 1;
const DEFAULT_FAST_PLAYBACK_RATE = 2;
const AudioPlayer = _ref => {
  let {
    message,
    className,
    noUi,
    sender,
    chat,
    volume,
    playbackRate,
    isPlaybackRateActive,
    isMuted
  } = _ref;
  const {
    setAudioPlayerVolume,
    setAudioPlayerPlaybackRate,
    setAudioPlayerMuted,
    focusMessage,
    closeAudioPlayer
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const {
    audio,
    voice,
    video
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(message);
  const isVoice = Boolean(voice || video);
  const shouldRenderPlaybackButton = isVoice || (audio?.duration || 0) > _config__WEBPACK_IMPORTED_MODULE_2__.PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION;
  const senderName = sender ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getSenderTitle)(lang, sender) : undefined;
  const mediaData = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.getFromMemory((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageMediaHash)(message, 'inline'));
  const mediaMetadata = (0,_hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_15__["default"])(message, sender, chat);
  const {
    playPause,
    stop,
    isPlaying,
    requestNextTrack,
    requestPreviousTrack,
    isFirst,
    isLast,
    setVolume,
    toggleMuted,
    setPlaybackRate
  } = (0,_hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_12__["default"])((0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_5__.makeTrackId)(message), (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaDuration)(message), isVoice ? 'voice' : 'audio', mediaData, undefined, mediaMetadata, undefined, true, undefined, undefined, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isMessageLocal)(message), true);
  const {
    isContextMenuOpen,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_13__["default"])(ref);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    focusMessage({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!stop) {
      return;
    }
    if (isPlaying) {
      playPause();
    }
    closeAudioPlayer();
    (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_8__.clearMediaSession)();
    stop();
  });
  const handleVolumeChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(value => {
    if (!setVolume) {
      return;
    }
    setAudioPlayerVolume({
      volume: value / 100
    });
    setVolume(value / 100);
  });
  const handleVolumeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_TOUCH_ENV && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_IOS) return;
    if (!toggleMuted) {
      return;
    }
    toggleMuted();
    setAudioPlayerMuted({
      isMuted: !isMuted
    });
  });
  const updatePlaybackRate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(function (newRate) {
    let isActive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
    if (!setPlaybackRate) {
      return;
    }
    const rate = PLAYBACK_RATES[newRate];
    const shouldBeActive = newRate !== REGULAR_PLAYBACK_RATE && isActive;
    setAudioPlayerPlaybackRate({
      playbackRate: rate,
      isPlaybackRateActive: shouldBeActive
    });
    setPlaybackRate(shouldBeActive ? rate : REGULAR_PLAYBACK_RATE);
  });
  const handlePlaybackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    handleContextMenuClose();
    const oldRate = Number(Object.entries(PLAYBACK_RATES).find(_ref2 => {
      let [, rate] = _ref2;
      return rate === playbackRate;
    })?.[0]) || REGULAR_PLAYBACK_RATE;
    const newIsActive = !isPlaybackRateActive;
    updatePlaybackRate(newIsActive && oldRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : oldRate, newIsActive);
  });
  const PlaybackRateButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    const displayRate = Object.entries(PLAYBACK_RATES).find(_ref3 => {
      let [, rate] = _ref3;
      return rate === playbackRate;
    })?.[0] || REGULAR_PLAYBACK_RATE;
    const text = `${playbackRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : displayRate}Х`;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "playback-wrapper"
    }, isContextMenuOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "playback-backdrop",
      onClick: handleContextMenuClose
    }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
      round: true,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('playback-button', isPlaybackRateActive && 'applied', isContextMenuOpen && 'on-top'),
      color: "translucent",
      size: "smaller",
      ariaLabel: "Playback Rate",
      ripple: !isMobile,
      onMouseEnter: handleContextMenu,
      onClick: handlePlaybackClick,
      onMouseDown: handleBeforeContextMenu,
      onContextMenu: handleContextMenu
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('playback-button-inner', text.length === 4 && 'small', text.length === 5 && 'tiny')
    }, text)));
  });
  const volumeIcon = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (volume === 0 || isMuted) return 'icon-muted';
    if (volume < 0.3) return 'icon-volume-1';
    if (volume < 0.6) return 'icon-volume-2';
    return 'icon-volume-3';
  }, [volume, isMuted]);
  if (noUi) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('AudioPlayer', className),
    dir: lang.isRtl ? 'rtl' : undefined,
    ref: ref
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AudioPlayer-content",
    onClick: handleClick
  }, audio ? renderAudio(audio) : renderVoice(lang('AttachAudio'), senderName), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_21__["default"], null)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: "player-button",
    disabled: isFirst?.(),
    onClick: requestPreviousTrack,
    ariaLabel: "Previous track"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-skip-previous"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('toggle-play', 'player-button', isPlaying ? 'pause' : 'play'),
    onClick: playPause,
    ariaLabel: isPlaying ? 'Pause audio' : 'Play audio'
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-play"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-pause"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: "player-button",
    disabled: isLast?.(),
    onClick: requestNextTrack,
    ariaLabel: "Next track"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-skip-next"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-button-wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    round: true,
    className: "player-button volume-button",
    color: "translucent",
    size: "smaller",
    ariaLabel: "Volume",
    onClick: handleVolumeClick,
    ripple: !isMobile
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('icon', volumeIcon)
  })), !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_IOS && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider-wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider-spacer"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RangeSlider__WEBPACK_IMPORTED_MODULE_20__["default"], {
    bold: true,
    value: isMuted ? 0 : volume * 100,
    onChange: handleVolumeChange
  })))), shouldRenderPlaybackButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_18__["default"], {
    forceOpen: isContextMenuOpen,
    positionX: "right",
    positionY: "top",
    className: "playback-rate-menu",
    trigger: PlaybackRateButton,
    onClose: handleContextMenuClose,
    onHide: handleContextMenuHide,
    onMouseEnterBackdrop: handleContextMenuClose
  }, PLAYBACK_RATE_VALUES.map(rate => {
    return renderPlaybackRateMenuItem(rate, playbackRate, updatePlaybackRate, isPlaybackRateActive);
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    round: true,
    className: "player-close",
    color: "translucent",
    size: "smaller",
    onClick: handleClose,
    ariaLabel: "Close player"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-close"
  })));
};
function renderAudio(audio) {
  const {
    title,
    performer,
    fileName
  } = audio;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title",
    dir: "auto"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(title || fileName)), performer && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle",
    dir: "auto"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(performer)));
}
function renderVoice(subtitle, senderName) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title",
    dir: "auto"
  }, senderName && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(senderName)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle",
    dir: "auto"
  }, subtitle));
}
function renderPlaybackRateMenuItem(rate, currentRate, onClick, isPlaybackRateActive) {
  const isSelected = currentRate === PLAYBACK_RATES[rate] && isPlaybackRateActive || rate === REGULAR_PLAYBACK_RATE && !isPlaybackRateActive;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    key: rate
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClick: () => onClick(rate),
    icon: isSelected ? 'check' : undefined,
    customIcon: !isSelected ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
      className: "icon icon-placeholder"
    }) : undefined
  }, rate, "X");
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref4) => {
  let {
    message
  } = _ref4;
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSender)(global, message);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, message.chatId);
  const {
    volume,
    playbackRate,
    isMuted,
    isPlaybackRateActive
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global).audioPlayer;
  return {
    sender,
    chat,
    volume,
    playbackRate,
    isPlaybackRateActive,
    isMuted
  };
})(AudioPlayer));

/***/ }),

/***/ "./src/components/middle/ChatLanguageModal.async.tsx":
/*!***********************************************************!*\
  !*** ./src/components/middle/ChatLanguageModal.async.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatLanguageModalAsync = props => {
  const {
    isOpen
  } = props;
  const ChatLanguageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatLanguageModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ChatLanguageModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatLanguageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatLanguageModalAsync);

/***/ }),

/***/ "./src/components/middle/ChatReportPanel.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/ChatReportPanel.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ChatReportPanel_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ChatReportPanel.scss */ "./src/components/middle/ChatReportPanel.scss");












const ChatReportPanel = _ref => {
  let {
    chatId,
    className,
    chat,
    user,
    settings,
    currentUserId
  } = _ref;
  const {
    openAddContactDialog,
    blockUser,
    reportSpam,
    deleteChat,
    leaveChannel,
    deleteChatUser,
    deleteHistory,
    toggleChatArchived,
    hideChatReportPanel
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [isBlockUserModalOpen, openBlockUserModal, closeBlockUserModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const [shouldReportSpam, setShouldReportSpam] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [shouldDeleteChat, setShouldDeleteChat] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const {
    isAutoArchived,
    canReportSpam,
    canAddContact,
    canBlockContact
  } = settings || {};
  const isBasicGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatBasicGroup)(chat);
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openAddContactDialog({
      userId: chatId
    });
    if (isAutoArchived) {
      toggleChatArchived({
        id: chatId
      });
    }
  });
  const handleConfirmBlock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    closeBlockUserModal();
    blockUser({
      userId: chatId
    });
    if (canReportSpam && shouldReportSpam) {
      reportSpam({
        chatId
      });
    }
    if (shouldDeleteChat) {
      deleteChat({
        chatId
      });
    }
  });
  const handleCloseReportPanel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    hideChatReportPanel({
      chatId
    });
  });
  const handleChatReportSpam = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    closeBlockUserModal();
    reportSpam({
      chatId
    });
    if (isBasicGroup) {
      deleteChatUser({
        chatId,
        userId: currentUserId
      });
      deleteHistory({
        chatId,
        shouldDeleteForAll: false
      });
    } else {
      leaveChannel({
        chatId
      });
    }
  });
  if (!settings || !chat && !user) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('ChatReportPanel', className),
    dir: lang.isRtl ? 'rtl' : undefined
  }, canAddContact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isText: true,
    fluid: true,
    size: "tiny",
    className: "UserReportPanel--Button",
    onClick: handleAddContact
  }, lang('lng_new_contact_add')), canBlockContact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    isText: true,
    fluid: true,
    size: "tiny",
    className: "UserReportPanel--Button",
    onClick: openBlockUserModal
  }, lang('lng_new_contact_block')), canReportSpam && !canBlockContact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    isText: true,
    fluid: true,
    size: "tiny",
    className: "UserReportPanel--Button",
    onClick: openBlockUserModal
  }, lang('lng_report_spam_and_leave')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    round: true,
    ripple: true,
    size: "tiny",
    color: "translucent",
    onClick: handleCloseReportPanel,
    ariaLabel: lang('Close')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-close"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isOpen: isBlockUserModalOpen,
    onClose: closeBlockUserModal,
    title: lang('BlockUserTitle', user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat)),
    text: user ? lang('UserInfo.BlockConfirmationTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user)) : lang('Chat.Confirm.ReportSpam.Channel'),
    confirmIsDestructive: true,
    confirmLabel: lang('Block'),
    confirmHandler: user ? handleConfirmBlock : handleChatReportSpam
  }, user && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__["default"], {
    label: lang('DeleteThisChat'),
    checked: shouldDeleteChat,
    onCheck: setShouldDeleteChat
  }), user && canReportSpam && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__["default"], {
    label: lang('ReportChat'),
    checked: shouldReportSpam,
    onCheck: setShouldReportSpam
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId
  } = _ref2;
  return {
    currentUserId: global.currentUserId,
    chat: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId),
    user: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, chatId)
  };
})(ChatReportPanel)));

/***/ }),

/***/ "./src/components/middle/ContactGreeting.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/ContactGreeting.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ContactGreeting.module.scss */ "./src/components/middle/ContactGreeting.module.scss");








const ContactGreeting = _ref => {
  let {
    defaultStickers,
    connectionState,
    lastUnreadMessageId,
    currentMessageList,
    businessIntro,
    user
  } = _ref;
  const {
    loadGreetingStickers,
    sendMessage,
    markMessageListRead
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();

  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const sticker = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (businessIntro?.sticker) return businessIntro.sticker;
    if (!defaultStickers?.length) return undefined;
    const randomIndex = Math.floor(Math.random() * defaultStickers.length);
    return defaultStickers[randomIndex];
  }, [businessIntro?.sticker, defaultStickers]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (defaultStickers?.length || connectionState !== 'connectionStateReady') {
      return;
    }
    loadGreetingStickers();
  }, [connectionState, loadGreetingStickers, defaultStickers]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (connectionState === 'connectionStateReady' && lastUnreadMessageId) {
      markMessageListRead({
        maxId: lastUnreadMessageId
      });
    }
  }, [connectionState, markMessageListRead, lastUnreadMessageId]);
  const handleStickerSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!currentMessageList) {
      return;
    }
    sendMessage({
      sticker: {
        ...sticker,
        isPreloadedGlobally: true
      },
      messageList: currentMessageList
    });
  });
  const title = businessIntro?.title || lang('Conversation.EmptyPlaceholder');
  const description = businessIntro?.description || lang('Conversation.GreetingText');
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].wrapper
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].title,
    dir: "auto"
  }, title), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].description,
    dir: "auto"
  }, description), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].sticker,
    onClick: handleStickerSelect
  }, sticker && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_6__["default"], {
    containerRef: containerRef,
    sticker: sticker,
    size: 160,
    shouldLoop: true
  }))), businessIntro && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].explainer
  }, lang('Chat.EmptyStateIntroFooter', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    userId
  } = _ref2;
  const {
    stickers
  } = global.stickers.greeting;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, userId);
  if (!chat) {
    return {};
  }
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  const fullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, userId);
  const lastMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatLastMessage)(global, chat.id);
  return {
    defaultStickers: stickers,
    lastUnreadMessageId: lastMessage && lastMessage.id !== chat.lastReadInboxMessageId ? lastMessage.id : undefined,
    connectionState: global.connectionState,
    currentMessageList: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global),
    businessIntro: fullInfo?.businessIntro,
    user
  };
})(ContactGreeting)));

/***/ }),

/***/ "./src/components/middle/EmojiInteractionAnimation.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/middle/EmojiInteractionAnimation.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const EmojiInteractionAnimationAsync = props => {
  const {
    activeEmojiInteraction
  } = props;
  const EmojiInteractionAnimation = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EmojiInteractionAnimation', !activeEmojiInteraction);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return EmojiInteractionAnimation ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EmojiInteractionAnimation, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiInteractionAnimationAsync);

/***/ }),

/***/ "./src/components/middle/FloatingActionButtons.tsx":
/*!*********************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ScrollDownButton */ "./src/components/middle/ScrollDownButton.tsx");
/* harmony import */ var _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./FloatingActionButtons.module.scss */ "./src/components/middle/FloatingActionButtons.module.scss");









const FOCUS_MARGIN = 20;
const FloatingActionButtons = _ref => {
  let {
    withScrollDown,
    canPost,
    messageListType,
    chatId,
    unreadCount,
    unreadReactions,
    unreadMentions,
    reactionsCount,
    mentionsCount,
    withExtraShift
  } = _ref;
  const {
    focusNextReply,
    focusNextReaction,
    focusNextMention,
    fetchUnreadReactions,
    readAllMentions,
    readAllReactions,
    fetchUnreadMentions
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const elementRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const hasUnreadReactions = Boolean(reactionsCount);
  const hasUnreadMentions = Boolean(mentionsCount);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId && !unreadReactions?.length) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions, unreadReactions?.length]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId && !unreadMentions?.length) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions, unreadMentions?.length]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions]);
  const handleScrollDownClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!withScrollDown) {
      return;
    }
    if (messageListType === 'thread') {
      focusNextReply();
    } else {
      const messagesContainer = elementRef.current.parentElement.querySelector('.Transition_slide-active > .MessageList');
      const messageElements = messagesContainer.querySelectorAll('.message-list-item');
      const lastMessageElement = messageElements[messageElements.length - 1];
      if (!lastMessageElement) {
        return;
      }
      (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(messagesContainer, lastMessageElement, 'end', FOCUS_MARGIN);
    }
  });
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].root, (withScrollDown || Boolean(reactionsCount) || Boolean(mentionsCount)) && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].revealed, (Boolean(reactionsCount) || Boolean(mentionsCount)) && !withScrollDown && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hideScrollDown, !canPost && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].noComposer, !withExtraShift && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].noExtraShift);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: elementRef,
    className: fabClassName
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "heart-outline",
    ariaLabelLang: "AccDescrReactionMentionDown",
    onClick: focusNextReaction,
    onReadAll: readAllReactions,
    unreadCount: reactionsCount,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].reactions, !hasUnreadReactions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hidden, !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].transformDown)
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "mention",
    ariaLabelLang: "AccDescrMentionDown",
    onClick: focusNextMention,
    onReadAll: readAllMentions,
    unreadCount: mentionsCount,
    className: !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hidden
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "arrow-down",
    ariaLabelLang: "AccDescrPageDown",
    onClick: handleScrollDownClick,
    unreadCount: unreadCount,
    className: _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].unread
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global);
  if (!currentMessageList) {
    return {};
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const shouldShowCount = chat && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && messageListType === 'thread';
  return {
    messageListType,
    chatId,
    reactionsCount: shouldShowCount ? chat.unreadReactionsCount : undefined,
    unreadReactions: shouldShowCount ? chat.unreadReactions : undefined,
    unreadMentions: shouldShowCount ? chat.unreadMentions : undefined,
    mentionsCount: shouldShowCount ? chat.unreadMentionsCount : undefined,
    unreadCount: shouldShowCount ? chat.unreadCount : undefined
  };
})(FloatingActionButtons)));

/***/ }),

/***/ "./src/components/middle/HeaderPinnedMessage.tsx":
/*!*******************************************************!*\
  !*** ./src/components/middle/HeaderPinnedMessage.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./composer/helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useThumbnail__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useThumbnail */ "./src/hooks/useThumbnail.ts");
/* harmony import */ var _right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../right/hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_MessageSummary__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../common/MessageSummary */ "./src/components/common/MessageSummary.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./PinnedMessageNavigation */ "./src/components/middle/PinnedMessageNavigation.tsx");
/* harmony import */ var _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./HeaderPinnedMessage.module.scss */ "./src/components/middle/HeaderPinnedMessage.module.scss");

























const SHOW_LOADER_DELAY = 450;
const EMOJI_SIZE = 1.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM;
const HeaderPinnedMessage = _ref => {
  let {
    message,
    count,
    index,
    customTitle,
    className,
    onUnpinMessage,
    onClick,
    onAllPinnedClick,
    isLoading,
    isFullWidth
  } = _ref;
  const {
    clickBotInlineButton
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const mediaThumbnail = (0,_hooks_useThumbnail__WEBPACK_IMPORTED_MODULE_13__["default"])(message);
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageMediaHash)(message, 'pictogram'));
  const isSpoiler = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageIsSpoiler)(message);
  const canRenderLoader = (0,_right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_14__["default"])([isLoading], SHOW_LOADER_DELAY);
  const shouldShowLoader = canRenderLoader && isLoading;
  const [isUnpinDialogOpen, openUnpinDialog, closeUnpinDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const handleUnpinMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    closeUnpinDialog();
    if (onUnpinMessage) {
      onUnpinMessage(message.id);
    }
  });
  const inlineButton = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageSingleInlineButton)(message);
  const handleInlineButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (inlineButton) {
      clickBotInlineButton({
        messageId: message.id,
        button: inlineButton
      });
    }
  });
  const [noHoverColor, markNoHoverColor, unmarkNoHoverColor] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_8__.useFastClick)(onClick);
  function renderPictogram(thumbDataUri, blobUrl, spoiler) {
    const {
      width,
      height
    } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.getPictogramDimensions)();
    const srcUrl = blobUrl || thumbDataUri;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinnedThumb
    }, thumbDataUri && !spoiler && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinnedThumbImage,
      src: srcUrl,
      width: width,
      height: height,
      alt: "",
      draggable: false
    }), thumbDataUri && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_16__["default"], {
      thumbDataUri: srcUrl,
      isVisible: Boolean(spoiler),
      width: width,
      height: height
    }));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('HeaderPinnedMessageWrapper', _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].root, isFullWidth && 'full-width', className)
  }, (count > 1 || shouldShowLoader) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
    round: true,
    size: "smaller",
    color: "translucent",
    ariaLabel: lang('EventLogFilterPinnedMessages'),
    onClick: !shouldShowLoader ? onAllPinnedClick : undefined
  }, isLoading && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_21__["default"], {
    color: "blue",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].loading, _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinListIcon, !shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinListIconHidden)
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('icon', 'icon-pin-list', _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinListIcon, shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinListIconHidden)
  })), onUnpinMessage && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
    round: true,
    size: "smaller",
    color: "translucent",
    ariaLabel: lang('UnpinMessageAlertTitle'),
    onClick: openUnpinDialog
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-close"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_19__["default"], {
    isOpen: isUnpinDialogOpen,
    onClose: closeUnpinDialog,
    text: "Would you like to unpin this message?",
    confirmLabel: "Unpin",
    confirmHandler: handleUnpinMessage
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pinnedMessage, noHoverColor && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].noHover),
    onClick: handleClick,
    onMouseDown: handleMouseDown,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_23__["default"], {
    count: count,
    index: index
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_22__["default"], {
    activeKey: message.id,
    name: "slideVertical",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].pictogramTransition
  }, renderPictogram(mediaThumbnail, mediaBlobUrl, isSpoiler)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].messageText, mediaThumbnail && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].withMedia),
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].title,
    dir: lang.isRtl ? 'rtl' : undefined
  }, !customTitle && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_15__["default"], {
    text: `${lang('PinnedMessage')} ${index > 0 ? `#${count - index}` : ''}`
  }), customTitle && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(customTitle)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_22__["default"], {
    activeKey: message.id,
    name: "slideVerticalFade",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].messageTextTransition
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    dir: "auto",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].summary
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageSummary__WEBPACK_IMPORTED_MODULE_17__["default"], {
    lang: lang,
    message: message,
    noEmoji: Boolean(mediaThumbnail),
    emojiSize: EMOJI_SIZE
  })))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_20__["default"], null), inlineButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
    size: "tiny",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].inlineButton,
    onClick: handleInlineButtonClick,
    shouldStopPropagation: true,
    onMouseEnter: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? markNoHoverColor : undefined,
    onMouseLeave: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? unmarkNoHoverColor : undefined
  }, (0,_composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_7__["default"])(lang, inlineButton))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(HeaderPinnedMessage));

/***/ }),

/***/ "./src/components/middle/MessageList.tsx":
/*!***********************************************!*\
  !*** ./src/components/middle/MessageList.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_resetScroll__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/resetScroll */ "./src/util/resetScroll.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _helpers_groupMessages__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./helpers/groupMessages */ "./src/components/middle/helpers/groupMessages.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useHeavyAnimationCheck */ "./src/hooks/useHeavyAnimationCheck.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useNativeCopySelectedMessages__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useNativeCopySelectedMessages */ "./src/hooks/useNativeCopySelectedMessages.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_useContainerHeight__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./hooks/useContainerHeight */ "./src/components/middle/hooks/useContainerHeight.ts");
/* harmony import */ var _hooks_useStickyDates__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./hooks/useStickyDates */ "./src/components/middle/hooks/useStickyDates.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _ContactGreeting__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ContactGreeting */ "./src/components/middle/ContactGreeting.tsx");
/* harmony import */ var _MessageListBotInfo__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./MessageListBotInfo */ "./src/components/middle/MessageListBotInfo.tsx");
/* harmony import */ var _MessageListContent__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./MessageListContent */ "./src/components/middle/MessageListContent.tsx");
/* harmony import */ var _NoMessages__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./NoMessages */ "./src/components/middle/NoMessages.tsx");
/* harmony import */ var _PremiumRequiredMessage__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./PremiumRequiredMessage */ "./src/components/middle/PremiumRequiredMessage.tsx");
/* harmony import */ var _MessageList_scss__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./MessageList.scss */ "./src/components/middle/MessageList.scss");



































const MESSAGE_REACTIONS_POLLING_INTERVAL = 20 * 1000;
const MESSAGE_COMMENTS_POLLING_INTERVAL = 20 * 1000;
const MESSAGE_FACT_CHECK_UPDATE_INTERVAL = 5 * 1000;
const MESSAGE_STORY_POLLING_INTERVAL = 5 * 60 * 1000;
const BOTTOM_THRESHOLD = 50;
const UNREAD_DIVIDER_TOP = 10;
const UNREAD_DIVIDER_TOP_WITH_TOOLS = 60;
const SCROLL_DEBOUNCE = 200;
const MESSAGE_ANIMATION_DURATION = 500;
const BOTTOM_FOCUS_MARGIN = 20;
const SELECT_MODE_ANIMATION_DURATION = 200;
const UNREAD_DIVIDER_CLASS = 'unread-divider';
const runDebouncedForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.debounce)(cb => cb(), SCROLL_DEBOUNCE, false);
const MessageList = _ref => {
  let {
    chatId,
    threadId,
    type,
    hasTools,
    onScrollDownToggle,
    onNotchToggle,
    isChatLoaded,
    isForum,
    isChannelChat,
    isGroupChat,
    canPost,
    isSynced,
    isReady,
    isChatWithSelf,
    isRepliesChat,
    isAnonymousForwards,
    isCreator,
    isBot,
    messageIds,
    messagesById,
    firstUnreadId,
    isComments,
    isViewportNewest,
    isRestricted,
    restrictionReason,
    isEmptyThread,
    focusingId,
    isSelectModeActive,
    lastMessage,
    hasLinkedChat,
    withBottomShift,
    withDefaultBg,
    topic,
    noMessageSendingAnimation,
    isServiceNotificationsChat,
    currentUserId,
    getForceNextPinnedInHeader,
    onPinnedIntersectionChange,
    isContactRequirePremium,
    areAdsEnabled
  } = _ref;
  const {
    loadViewportMessages,
    setScrollOffset,
    loadSponsoredMessages,
    loadMessageReactions,
    copyMessagesByIds,
    loadMessageViews,
    loadPeerStoriesByIds,
    loadFactChecks
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);

  // We update local cached `scrollOffsetRef` when opening chat.
  // Then we update global version every second on scrolling.
  const scrollOffsetRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(type === 'thread' && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectScrollOffset)((0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)(), chatId, threadId) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectLastScrollOffset)((0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)(), chatId, threadId) || 0);
  const anchorIdRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const anchorTopRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const listItemElementsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoFirstUnreadIdRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoUnreadDividerBeforeIdRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoFocusingIdRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isScrollTopJustUpdatedRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const shouldAnimateAppearanceRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(Boolean(lastMessage));
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const hasOpenChatButton = isSavedDialog && threadId !== _config__WEBPACK_IMPORTED_MODULE_5__.ANONYMOUS_USER_ID;
  const areMessagesLoaded = Boolean(messageIds);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    // We only need it first time when message list appears
    if (areMessagesLoaded) {
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.onTickEnd)(() => {
        shouldAnimateAppearanceRef.current = false;
      });
    }
  }, [areMessagesLoaded]);

  // Updated every time (to be used from intersection callback closure)
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    memoFirstUnreadIdRef.current = firstUnreadId;
  }, [firstUnreadId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (areAdsEnabled && isChannelChat && isSynced && isReady) {
      loadSponsoredMessages({
        chatId
      });
    }
  }, [chatId, isSynced, isReady, isChannelChat, areAdsEnabled]);

  // Updated only once when messages are loaded (as we want the unread divider to keep its position)
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    if (areMessagesLoaded) {
      memoUnreadDividerBeforeIdRef.current = memoFirstUnreadIdRef.current;
    }
  }, [areMessagesLoaded]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    memoFocusingIdRef.current = focusingId;
  }, [focusingId]);
  (0,_hooks_useNativeCopySelectedMessages__WEBPACK_IMPORTED_MODULE_22__["default"])(copyMessagesByIds);
  const messageGroups = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!messageIds?.length || !messagesById) {
      return undefined;
    }
    const listedMessages = messageIds.map(id => messagesById[id]).filter(Boolean);

    // Service notifications have local IDs which may be not in sync with real message history
    const orderRule = type === 'scheduled' || isServiceNotificationsChat ? ['date', 'id'] : ['id'];
    return listedMessages.length ? (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_15__.groupMessages)((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_11__.orderBy)(listedMessages, orderRule), memoUnreadDividerBeforeIdRef.current, !isForum ? Number(threadId) : undefined, isChatWithSelf) : undefined;
  }, [messageIds, messagesById, type, isServiceNotificationsChat, isForum, threadId, isChatWithSelf]);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!messageIds || !messagesById || type === 'scheduled') return;
    if (!isChannelChat && !isGroupChat) return;
    const ids = messageIds.filter(id => {
      const message = messagesById[id];
      return message && message.reactions?.results.length && !message.content.action;
    });
    if (!ids.length) return;
    loadMessageReactions({
      chatId,
      ids
    });
  }, MESSAGE_REACTIONS_POLLING_INTERVAL, true);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!messageIds || !messagesById || type === 'scheduled') {
      return;
    }
    const storyDataList = messageIds.map(id => messagesById[id]?.content.storyData).filter(Boolean);
    if (!storyDataList.length) return;
    const storiesByPeerIds = storyDataList.reduce((acc, storyData) => {
      const {
        peerId,
        id
      } = storyData;
      if (!acc[peerId]) {
        acc[peerId] = [];
      }
      acc[peerId].push(id);
      return acc;
    }, {});
    Object.entries(storiesByPeerIds).forEach(_ref2 => {
      let [peerId, storyIds] = _ref2;
      loadPeerStoriesByIds({
        peerId,
        storyIds
      });
    });
  }, MESSAGE_STORY_POLLING_INTERVAL);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!messageIds || !messagesById || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID || type === 'scheduled') {
      return;
    }
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
    const ids = messageIds.filter(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectThreadInfo)(global, chatId, id)?.isCommentsInfo || messagesById[id]?.viewsCount !== undefined);
    if (!ids.length) return;
    loadMessageViews({
      chatId,
      ids
    });
  }, MESSAGE_COMMENTS_POLLING_INTERVAL, true);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!messageIds || !messagesById || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID || type === 'scheduled') {
      return;
    }
    const ids = messageIds.filter(id => messagesById[id]?.factCheck?.shouldFetch);
    if (!ids.length) return;
    loadFactChecks({
      chatId,
      ids
    });
  }, MESSAGE_FACT_CHECK_UPDATE_INTERVAL);
  const loadMoreAround = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (type !== 'thread') {
      return undefined;
    }
    return (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.debounce)(() => loadViewportMessages({
      direction: _types__WEBPACK_IMPORTED_MODULE_4__.LoadMoreDirection.Around
    }), 1000, true, false);
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [loadViewportMessages, messageIds]);
  const {
    isScrolled,
    updateStickyDates
  } = (0,_hooks_useStickyDates__WEBPACK_IMPORTED_MODULE_27__["default"])();
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    if (isScrollTopJustUpdatedRef.current) {
      isScrollTopJustUpdatedRef.current = false;
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    if (!memoFocusingIdRef.current) {
      updateStickyDates(container, hasTools);
    }
    runDebouncedForScroll(() => {
      const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
      const forceNextPinnedInHeader = getForceNextPinnedInHeader() && !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global).focusedMessage?.chatId;
      if (forceNextPinnedInHeader) {
        onPinnedIntersectionChange({
          hasScrolled: true
        });
      }
      if (!container.parentElement) {
        return;
      }
      scrollOffsetRef.current = container.scrollHeight - container.scrollTop;
      if (type === 'thread') {
        setScrollOffset({
          chatId,
          threadId,
          scrollOffset: scrollOffsetRef.current
        });
      }
    });
  });
  const [getContainerHeight, prevContainerHeightRef] = (0,_hooks_useContainerHeight__WEBPACK_IMPORTED_MODULE_26__["default"])(containerRef, canPost && !isSelectModeActive);

  // Initial message loading
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!loadMoreAround || !isChatLoaded || isRestricted || focusingId) {
      return;
    }

    // Loading history while sending a message can return the same message and cause ambiguity
    const isLastMessageLocal = messageIds && (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_12__.isLocalMessageId)(messageIds[messageIds.length - 1]);
    if (isLastMessageLocal) {
      return;
    }
    const container = containerRef.current;
    if (!messageIds || messageIds.length === 1 || messageIds.length < _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 && container.firstElementChild.clientHeight <= container.offsetHeight) {
      loadMoreAround();
    }
  }, [isChatLoaded, messageIds, loadMoreAround, focusingId, isRestricted]);
  const rememberScrollPositionRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_23__.useStateRef)(() => {
    if (!messageIds || !listItemElementsRef.current) {
      return;
    }
    const preservedItemElements = listItemElementsRef.current.filter(element => messageIds.includes(Number(element.dataset.messageId)));

    // We avoid the very first item as it may be a partly-loaded album
    // and also because it may be removed when messages limit is reached
    const anchor = preservedItemElements[1] || preservedItemElements[0];
    if (!anchor) {
      return;
    }
    anchorIdRef.current = anchor.id;
    anchorTopRef.current = anchor.getBoundingClientRect().top;
  });
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_24__["default"])(() => (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.forceMeasure)(() => rememberScrollPositionRef.current()),
  // This will run before modifying content and should match deps for `useLayoutEffectWithPrevDeps` below
  [messageIds, isViewportNewest, hasTools, rememberScrollPositionRef]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => rememberScrollPositionRef.current(),
  // This is only needed to react on signal updates
  [getContainerHeight, rememberScrollPositionRef]);

  // Handles updated message list, takes care of scroll repositioning
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_21__["default"])(_ref3 => {
    let [prevMessageIds, prevIsViewportNewest] = _ref3;
    if (false) {}
    const containerHeight = getContainerHeight();
    const prevContainerHeight = prevContainerHeightRef.current;
    prevContainerHeightRef.current = containerHeight;

    // Skip initial resize observer callback
    if (messageIds === prevMessageIds && isViewportNewest === prevIsViewportNewest && containerHeight !== prevContainerHeight && prevContainerHeight === undefined) {
      return;
    }
    const container = containerRef.current;
    listItemElementsRef.current = Array.from(container.querySelectorAll('.message-list-item'));
    const lastItemElement = listItemElementsRef.current[listItemElementsRef.current.length - 1];
    const firstUnreadElement = memoFirstUnreadIdRef.current ? container.querySelector(`#${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getMessageHtmlId)(memoFirstUnreadIdRef.current)}`) : undefined;
    const hasLastMessageChanged = messageIds && prevMessageIds && messageIds[messageIds.length - 1] !== prevMessageIds[prevMessageIds.length - 1];
    const hasViewportShifted = messageIds?.[0] !== prevMessageIds?.[0] && messageIds?.length === _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 + 1;
    const wasMessageAdded = hasLastMessageChanged && !hasViewportShifted;

    // Add extra height when few messages to allow scroll animation
    if (isViewportNewest && wasMessageAdded && messageIds && messageIds.length < _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 && !container.parentElement.classList.contains('force-messages-scroll') && (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.forceMeasure)(() => container.firstElementChild.clientHeight <= container.offsetHeight * 2)) {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.addExtraClass)(container.parentElement, 'force-messages-scroll');
      container.parentElement.classList.add('force-messages-scroll');
      setTimeout(() => {
        if (container.parentElement) {
          (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.removeExtraClass)(container.parentElement, 'force-messages-scroll');
        }
      }, MESSAGE_ANIMATION_DURATION);
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestForcedReflow)(() => {
      const {
        scrollTop,
        scrollHeight,
        offsetHeight
      } = container;
      const scrollOffset = scrollOffsetRef.current;
      let bottomOffset = scrollOffset - (prevContainerHeight || offsetHeight);
      if (wasMessageAdded) {
        // If two new messages come at once (e.g. when bot responds) then the first message will update `scrollOffset`
        // right away (before animation) which creates inconsistency until the animation completes. To work around that,
        // we calculate `isAtBottom` with a "buffer" of the latest message height (this is approximate).
        const lastItemHeight = lastItemElement ? lastItemElement.offsetHeight : 0;
        bottomOffset -= lastItemHeight;
      }
      const isAtBottom = isViewportNewest && prevIsViewportNewest && bottomOffset <= BOTTOM_THRESHOLD;
      const isAlreadyFocusing = messageIds && memoFocusingIdRef.current === messageIds[messageIds.length - 1];

      // Animate incoming message, but if app is in background mode, scroll to the first unread
      if (wasMessageAdded && isAtBottom && !isAlreadyFocusing) {
        // Break out of `forceLayout`
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestMeasure)(() => {
          const shouldScrollToBottom = !(0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_25__.isBackgroundModeActive)() || !firstUnreadElement;
          (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_9__["default"])(container, shouldScrollToBottom ? lastItemElement : firstUnreadElement, shouldScrollToBottom ? 'end' : 'start', BOTTOM_FOCUS_MARGIN, undefined, undefined, noMessageSendingAnimation ? 0 : undefined);
        });
      }
      const isResized = prevContainerHeight !== undefined && prevContainerHeight !== containerHeight;
      if (isResized && (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_9__.isAnimatingScroll)()) {
        return undefined;
      }
      const anchor = anchorIdRef.current && container.querySelector(`#${anchorIdRef.current}`);
      const unreadDivider = !anchor && memoUnreadDividerBeforeIdRef.current && container.querySelector(`.${UNREAD_DIVIDER_CLASS}`);
      let newScrollTop;
      if (isAtBottom && isResized) {
        newScrollTop = scrollHeight - offsetHeight;
      } else if (anchor) {
        const newAnchorTop = anchor.getBoundingClientRect().top;
        newScrollTop = scrollTop + (newAnchorTop - (anchorTopRef.current || 0));
      } else if (unreadDivider) {
        newScrollTop = Math.min(unreadDivider.offsetTop - (hasTools ? UNREAD_DIVIDER_TOP_WITH_TOOLS : UNREAD_DIVIDER_TOP), scrollHeight - scrollOffset);
      } else {
        newScrollTop = scrollHeight - scrollOffset;
      }
      return () => {
        (0,_util_resetScroll__WEBPACK_IMPORTED_MODULE_13__["default"])(container, Math.ceil(newScrollTop));
        (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_9__.restartCurrentScrollAnimation)();
        scrollOffsetRef.current = Math.max(Math.ceil(scrollHeight - newScrollTop), offsetHeight);
        if (!memoFocusingIdRef.current) {
          isScrollTopJustUpdatedRef.current = true;
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestMeasure)(() => {
            isScrollTopJustUpdatedRef.current = false;
          });
        }
        if (false) {}
      };
    });
    // This should match deps for `useSyncEffect` above
  }, [messageIds, isViewportNewest, hasTools, getContainerHeight, prevContainerHeightRef, noMessageSendingAnimation]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_18__["default"])(_ref4 => {
    let [prevIsSelectModeActive] = _ref4;
    if (prevIsSelectModeActive !== undefined) {
      (0,_hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_19__.dispatchHeavyAnimationEvent)(SELECT_MODE_ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_5__.ANIMATION_END_DELAY);
    }
  }, [isSelectModeActive]);
  const isPrivate = Boolean(chatId && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId)(chatId));
  const withUsers = Boolean(!isPrivate && !isChannelChat || isChatWithSelf || isRepliesChat || isAnonymousForwards);
  const noAvatars = Boolean(!withUsers || isChannelChat);
  const shouldRenderGreeting = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId)(chatId) && !isChatWithSelf && !isBot && !isAnonymousForwards && type === 'thread' && (!messageGroups && !lastMessage && messageIds
  // Used to avoid flickering when deleting a greeting that has just been sent
  && (!listItemElementsRef.current || listItemElementsRef.current.length === 0) || messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'contactSignUp' || lastMessage?.content?.action?.type === 'contactSignUp');
  const isGroupChatJustCreated = isGroupChat && isCreator && messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'chatCreate';
  const isEmptyTopic = messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'topicCreate';
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])('MessageList custom-scroll', noAvatars && 'no-avatars', !canPost && 'no-composer', type === 'pinned' && 'type-pinned', withBottomShift && 'with-bottom-shift', withDefaultBg && 'with-default-bg', isSelectModeActive && 'select-mode-active', isScrolled && 'scrolled', !isReady && 'is-animating', hasOpenChatButton && 'saved-dialog');
  const hasMessages = messageIds && messageGroups || lastMessage;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasMessages) return;
    onScrollDownToggle(false);
  }, [hasMessages, onScrollDownToggle]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: className,
    onScroll: handleScroll,
    onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_16__.preventMessageInputBlur
  }, isRestricted ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "empty"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, restrictionReason ? restrictionReason.text : `This is a private ${isChannelChat ? 'channel' : 'chat'}`)) : isContactRequirePremium && !hasMessages ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PremiumRequiredMessage__WEBPACK_IMPORTED_MODULE_33__["default"], {
    userId: chatId
  }) : isBot && !hasMessages ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListBotInfo__WEBPACK_IMPORTED_MODULE_30__["default"], {
    chatId: chatId
  }) : shouldRenderGreeting ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContactGreeting__WEBPACK_IMPORTED_MODULE_29__["default"], {
    key: chatId,
    userId: chatId
  }) : messageIds && (!messageGroups || isGroupChatJustCreated || isEmptyTopic) ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_NoMessages__WEBPACK_IMPORTED_MODULE_32__["default"], {
    chatId: chatId,
    topic: topic,
    type: type,
    isChatWithSelf: isChatWithSelf,
    isGroupChatJustCreated: isGroupChatJustCreated
  }) : hasMessages ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListContent__WEBPACK_IMPORTED_MODULE_31__["default"], {
    areAdsEnabled: areAdsEnabled,
    chatId: chatId,
    isComments: isComments,
    isChannelChat: isChannelChat,
    isSavedDialog: isSavedDialog,
    messageIds: messageIds || [lastMessage.id],
    messageGroups: messageGroups || (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_15__.groupMessages)([lastMessage]),
    getContainerHeight: getContainerHeight,
    isViewportNewest: Boolean(isViewportNewest),
    isUnread: Boolean(firstUnreadId),
    isEmptyThread: isEmptyThread,
    withUsers: withUsers,
    noAvatars: noAvatars,
    containerRef: containerRef,
    anchorIdRef: anchorIdRef,
    memoUnreadDividerBeforeIdRef: memoUnreadDividerBeforeIdRef,
    memoFirstUnreadIdRef: memoFirstUnreadIdRef,
    threadId: threadId,
    type: type,
    isReady: isReady,
    hasLinkedChat: hasLinkedChat,
    isSchedule: messageGroups ? type === 'scheduled' : false,
    shouldRenderBotInfo: isBot,
    noAppearanceAnimation: !messageGroups || !shouldAnimateAppearanceRef.current,
    onScrollDownToggle: onScrollDownToggle,
    onNotchToggle: onNotchToggle,
    onPinnedIntersectionChange: onPinnedIntersectionChange
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_28__["default"], {
    color: "white",
    backgroundColor: "dark"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, _ref5) => {
  let {
    chatId,
    threadId,
    type
  } = _ref5;
  const currentUserId = global.currentUserId;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!chat) {
    return {
      currentUserId
    };
  }
  const messageIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageIds)(global, chatId, threadId, type);
  const messagesById = type === 'scheduled' ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatScheduledMessages)(global, chatId) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessages)(global, chatId);
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum && !(messagesById && threadId && messagesById[Number(threadId)])) {
    return {
      currentUserId
    };
  }
  const {
    isRestricted,
    restrictionReason
  } = chat;
  const lastMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatLastMessage)(global, chatId, isSavedDialog ? 'saved' : 'all');
  const focusingId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectFocusedMessageId)(global, chatId);
  const withLastMessageWhenPreloading = threadId === _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !messageIds && !chat.unreadCount && !focusingId && lastMessage && !lastMessage.groupedId;
  const chatBot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectBot)(global, chatId);
  const topic = chat.topics?.[threadId];
  const chatFullInfo = !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatFullInfo)(global, chatId) : undefined;
  const isEmptyThread = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectThreadInfo)(global, chatId, threadId)?.messagesCount;
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserPremium)(global);
  const areAdsEnabled = !isCurrentUserPremium || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserFullInfo)(global, currentUserId)?.areAdsEnabled;
  return {
    areAdsEnabled,
    isChatLoaded: true,
    isRestricted,
    restrictionReason,
    isChannelChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatChannel)(chat),
    isGroupChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatGroup)(chat),
    isCreator: chat.isCreator,
    isChatWithSelf: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatWithSelf)(global, chatId),
    isRepliesChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatWithRepliesBot)(chatId),
    isAnonymousForwards: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isAnonymousForwardsChat)(chatId),
    isBot: Boolean(chatBot),
    isSynced: global.isSynced,
    messageIds,
    messagesById,
    firstUnreadId: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectFirstUnreadId)(global, chatId, threadId),
    isViewportNewest: type !== 'thread' || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsViewportNewest)(global, chatId, threadId),
    focusingId,
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsInSelectMode)(global),
    hasLinkedChat: chatFullInfo ? Boolean(chatFullInfo.linkedChatId) : undefined,
    topic,
    noMessageSendingAnimation: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPerformanceSettingsValue)(global, 'messageSendingAnimations'),
    isServiceNotificationsChat: chatId === _config__WEBPACK_IMPORTED_MODULE_5__.SERVICE_NOTIFICATIONS_USER_ID,
    isForum: chat.isForum,
    isEmptyThread,
    currentUserId,
    ...(withLastMessageWhenPreloading && {
      lastMessage
    })
  };
})(MessageList)));

/***/ }),

/***/ "./src/components/middle/MessageListBotInfo.tsx":
/*!******************************************************!*\
  !*** ./src/components/middle/MessageListBotInfo.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/window/useDevicePixelRatio */ "./src/hooks/window/useDevicePixelRatio.ts");
/* harmony import */ var _ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/OptimizedVideo */ "./src/components/ui/OptimizedVideo.tsx");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./MessageListBotInfo.module.scss */ "./src/components/middle/MessageListBotInfo.module.scss");













const MessageListBotInfo = _ref => {
  let {
    botInfo,
    isLoadingBotInfo,
    isInMessageList
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const dpr = (0,_hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const botInfoPhotoUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(botInfo?.photo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getBotCoverMediaHash)(botInfo.photo) : undefined);
  const botInfoGifUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(botInfo?.gif ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoMediaHash)(botInfo.gif, 'full') : undefined);
  const botInfoDimensions = botInfo?.photo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getPhotoFullDimensions)(botInfo.photo) : botInfo?.gif ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoDimensions)(botInfo.gif) : undefined;
  const botInfoRealDimensions = botInfoDimensions && {
    width: botInfoDimensions.width / dpr,
    height: botInfoDimensions.height / dpr
  };
  const isBotInfoEmpty = botInfo && !botInfo.description && !botInfo.gif && !botInfo.photo;
  const {
    width,
    height
  } = botInfoRealDimensions || {};
  const isEmptyOrLoading = isBotInfoEmpty || isLoadingBotInfo;
  if (isEmptyOrLoading && isInMessageList) return undefined;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].root, 'empty')
  }, isLoadingBotInfo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('Loading')), isBotInfoEmpty && !isLoadingBotInfo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('NoMessages')), botInfo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].botInfo,
    style: botInfoRealDimensions && `width: ${botInfoRealDimensions.width}px`
  }, botInfoPhotoUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].media,
    src: botInfoPhotoUrl,
    width: botInfoRealDimensions?.width,
    height: botInfoRealDimensions?.height,
    alt: "Bot info"
  }), botInfoGifUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_10__["default"], {
    canPlay: true,
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].media,
    src: botInfoGifUrl,
    loop: true,
    disablePictureInPicture: true,
    muted: true,
    playsInline: true,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`)
  }), botInfoDimensions && !botInfoPhotoUrl && !botInfoGifUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_11__["default"], {
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].media,
    width: botInfoRealDimensions?.width,
    height: botInfoRealDimensions?.height,
    forceAspectRatio: true
  }), botInfo.description && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].botInfoDescription
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _MessageListBotInfo_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].botInfoTitle
  }, lang('BotInfoTitle')), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(botInfo.description, ['br', 'emoji', 'links']))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId
  } = _ref2;
  const chatBot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectBot)(global, chatId);
  let isLoadingBotInfo = false;
  let botInfo;
  if (chatBot) {
    const chatBotFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, chatBot.id);
    if (chatBotFullInfo) {
      botInfo = chatBotFullInfo.botInfo;
    } else {
      isLoadingBotInfo = true;
    }
  }
  return {
    botInfo,
    isLoadingBotInfo
  };
})(MessageListBotInfo)));

/***/ }),

/***/ "./src/components/middle/MessageListContent.tsx":
/*!******************************************************!*\
  !*** ./src/components/middle/MessageListContent.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./helpers/groupMessages */ "./src/components/middle/helpers/groupMessages.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useMessageObservers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hooks/useMessageObservers */ "./src/components/middle/hooks/useMessageObservers.ts");
/* harmony import */ var _hooks_useScrollHooks__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./hooks/useScrollHooks */ "./src/components/middle/hooks/useScrollHooks.ts");
/* harmony import */ var _ActionMessage__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ActionMessage */ "./src/components/middle/ActionMessage.tsx");
/* harmony import */ var _message_Message__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./message/Message */ "./src/components/middle/message/Message.tsx");
/* harmony import */ var _message_SponsoredMessage__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./message/SponsoredMessage */ "./src/components/middle/message/SponsoredMessage.tsx");
/* harmony import */ var _MessageListBotInfo__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./MessageListBotInfo */ "./src/components/middle/MessageListBotInfo.tsx");



















const UNREAD_DIVIDER_CLASS = 'unread-divider';
const MessageListContent = _ref => {
  let {
    areAdsEnabled,
    chatId,
    threadId,
    messageIds,
    messageGroups,
    getContainerHeight,
    isViewportNewest,
    isUnread,
    isComments,
    isEmptyThread,
    withUsers,
    isChannelChat,
    noAvatars,
    containerRef,
    anchorIdRef,
    memoUnreadDividerBeforeIdRef,
    memoFirstUnreadIdRef,
    type,
    isReady,
    hasLinkedChat,
    isSchedule,
    shouldRenderBotInfo,
    noAppearanceAnimation,
    isSavedDialog,
    onScrollDownToggle,
    onNotchToggle,
    onPinnedIntersectionChange
  } = _ref;
  const {
    openHistoryCalendar
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const getIsReady = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__["default"])(isReady);
  const areDatesClickable = !isSavedDialog && !isSchedule;
  const {
    observeIntersectionForReading,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  } = (0,_hooks_useMessageObservers__WEBPACK_IMPORTED_MODULE_13__["default"])(type, containerRef, memoFirstUnreadIdRef, onPinnedIntersectionChange, chatId);
  const {
    withHistoryTriggers,
    backwardsTriggerRef,
    forwardsTriggerRef,
    fabTriggerRef
  } = (0,_hooks_useScrollHooks__WEBPACK_IMPORTED_MODULE_14__["default"])(type, containerRef, messageIds, getContainerHeight, isViewportNewest, isUnread, onScrollDownToggle, onNotchToggle, isReady);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const unreadDivider = /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(UNREAD_DIVIDER_CLASS, 'local-action-message'),
    key: "unread-messages"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('UnreadMessages')));
  const messageCountToAnimate = noAppearanceAnimation ? 0 : messageGroups.reduce((acc, messageGroup) => {
    return acc + messageGroup.senderGroups.flat().length;
  }, 0);
  let appearanceIndex = 0;
  const prevMessageIds = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__["default"])(messageIds);
  const isNewMessage = Boolean(messageIds && prevMessageIds && messageIds[messageIds.length - 2] === prevMessageIds[prevMessageIds.length - 1]);
  const dateGroups = messageGroups.map((dateGroup, dateGroupIndex, dateGroupsArray) => {
    const senderGroups = dateGroup.senderGroups.map((senderGroup, senderGroupIndex, senderGroupsArray) => {
      if (senderGroup.length === 1 && !(0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__.isAlbum)(senderGroup[0]) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isActionMessage)(senderGroup[0]) && !senderGroup[0].content.action?.phoneCall) {
        const message = senderGroup[0];
        const isLastInList = senderGroupIndex === senderGroupsArray.length - 1 && dateGroupIndex === dateGroupsArray.length - 1;
        return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.compact)([message.id === memoUnreadDividerBeforeIdRef.current && unreadDivider, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ActionMessage__WEBPACK_IMPORTED_MODULE_15__["default"], {
          key: message.id,
          message: message,
          threadId: threadId,
          messageListType: type,
          isInsideTopic: Boolean(threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !isSavedDialog),
          observeIntersectionForReading: observeIntersectionForReading,
          observeIntersectionForLoading: observeIntersectionForLoading,
          observeIntersectionForPlaying: observeIntersectionForPlaying,
          memoFirstUnreadIdRef: memoFirstUnreadIdRef,
          appearanceOrder: messageCountToAnimate - ++appearanceIndex,
          isJustAdded: isLastInList && isNewMessage,
          isLastInList: isLastInList,
          onPinnedIntersectionChange: onPinnedIntersectionChange
        })]);
      }
      let currentDocumentGroupId;
      return senderGroup.map((messageOrAlbum, messageIndex) => {
        const message = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__.isAlbum)(messageOrAlbum) ? messageOrAlbum.mainMessage : messageOrAlbum;
        const album = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__.isAlbum)(messageOrAlbum) ? messageOrAlbum : undefined;
        const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isOwnMessage)(message);
        const isMessageAlbum = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__.isAlbum)(messageOrAlbum);
        const nextMessage = senderGroup[messageIndex + 1];
        if (message.previousLocalId && anchorIdRef.current === (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageHtmlId)(message.previousLocalId)) {
          anchorIdRef.current = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageHtmlId)(message.id);
        }
        const documentGroupId = !isMessageAlbum && message.groupedId ? message.groupedId : undefined;
        const nextDocumentGroupId = nextMessage && !(0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_8__.isAlbum)(nextMessage) ? nextMessage.groupedId : undefined;
        const isTopicTopMessage = message.id === threadId;
        const position = {
          isFirstInGroup: messageIndex === 0,
          isLastInGroup: messageIndex === senderGroup.length - 1,
          isFirstInDocumentGroup: Boolean(documentGroupId && documentGroupId !== currentDocumentGroupId),
          isLastInDocumentGroup: Boolean(documentGroupId && documentGroupId !== nextDocumentGroupId),
          isLastInList: messageIndex === senderGroup.length - 1 && senderGroupIndex === senderGroupsArray.length - 1 && dateGroupIndex === dateGroupsArray.length - 1
        };
        currentDocumentGroupId = documentGroupId;
        const originalId = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageOriginalId)(message);
        // Service notifications saved in cache in previous versions may share the same `previousLocalId`
        const key = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isServiceNotificationMessage)(message) ? `${message.date}_${originalId}` : originalId;
        const noComments = hasLinkedChat === false || !isChannelChat;
        return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.compact)([message.id === memoUnreadDividerBeforeIdRef.current && unreadDivider, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_Message__WEBPACK_IMPORTED_MODULE_16__["default"], {
          key: key,
          message: message,
          observeIntersectionForBottom: observeIntersectionForReading,
          observeIntersectionForLoading: observeIntersectionForLoading,
          observeIntersectionForPlaying: observeIntersectionForPlaying,
          album: album,
          noAvatars: noAvatars,
          withAvatar: position.isLastInGroup && withUsers && !isOwn && (!isTopicTopMessage || !isComments),
          withSenderName: position.isFirstInGroup && withUsers && !isOwn,
          threadId: threadId,
          messageListType: type,
          noComments: noComments,
          noReplies: !noComments || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || type === 'scheduled',
          appearanceOrder: messageCountToAnimate - ++appearanceIndex,
          isJustAdded: position.isLastInList && isNewMessage,
          isFirstInGroup: position.isFirstInGroup,
          isLastInGroup: position.isLastInGroup,
          isFirstInDocumentGroup: position.isFirstInDocumentGroup,
          isLastInDocumentGroup: position.isLastInDocumentGroup,
          isLastInList: position.isLastInList,
          memoFirstUnreadIdRef: memoFirstUnreadIdRef,
          onPinnedIntersectionChange: onPinnedIntersectionChange,
          getIsMessageListReady: getIsReady
        }), message.id === threadId && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "local-action-message",
          key: "discussion-started"
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang(isEmptyThread ? isComments ? 'NoComments' : 'NoReplies' : 'DiscussionStarted')))]);
      }).flat();
    });
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-date-group",
      key: dateGroup.datetime,
      onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_9__.preventMessageInputBlur,
      teactFastList: true
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('sticky-date', areDatesClickable && 'interactive'),
      key: "date-header",
      onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_9__.preventMessageInputBlur,
      onClick: areDatesClickable ? () => openHistoryCalendar({
        selectedAt: dateGroup.datetime
      }) : undefined
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      dir: "auto"
    }, isSchedule && dateGroup.originalDate === _config__WEBPACK_IMPORTED_MODULE_3__.SCHEDULED_WHEN_ONLINE && lang('MessageScheduledUntilOnline'), isSchedule && dateGroup.originalDate !== _config__WEBPACK_IMPORTED_MODULE_3__.SCHEDULED_WHEN_ONLINE && lang('MessageScheduledOn', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatHumanDate)(lang, dateGroup.datetime, undefined, true)), !isSchedule && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatHumanDate)(lang, dateGroup.datetime))), senderGroups.flat());
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messages-container",
    teactFastList: true
  }, withHistoryTriggers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: backwardsTriggerRef,
    key: "backwards-trigger",
    className: "backwards-trigger"
  }), shouldRenderBotInfo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListBotInfo__WEBPACK_IMPORTED_MODULE_18__["default"], {
    isInMessageList: true,
    key: `bot_info_${chatId}`,
    chatId: chatId
  }), dateGroups.flat(), areAdsEnabled && isViewportNewest && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_SponsoredMessage__WEBPACK_IMPORTED_MODULE_17__["default"], {
    key: chatId,
    chatId: chatId,
    containerRef: containerRef
  }), withHistoryTriggers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: forwardsTriggerRef,
    key: "forwards-trigger",
    className: "forwards-trigger"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: fabTriggerRef,
    key: "fab-trigger",
    className: "fab-trigger"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageListContent));

/***/ }),

/***/ "./src/components/middle/MessageListHistoryHandler.tsx":
/*!*************************************************************!*\
  !*** ./src/components/middle/MessageListHistoryHandler.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }





// Actual `MessageList` components are unmounted when deep in the history,
// so we need a separate component just for handling history
const MessageListHistoryHandler = _ref => {
  let {
    messageLists
  } = _ref;
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const closeChat = () => {
    openChat({
      id: undefined
    }, {
      forceSyncOnIOs: true
    });
  };
  const MessageHistoryRecord = _ref2 => {
    let {
      chatId,
      type,
      threadId
    } = _ref2;
    (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__["default"])({
      isActive: true,
      hash: (0,_util_routing__WEBPACK_IMPORTED_MODULE_3__.createLocationHash)(chatId, type, threadId),
      onBack: closeChat
    });
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, messageLists?.map((messageList, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageHistoryRecord
  // eslint-disable-next-line react/no-array-index-key
  , _extends({
    key: `${messageList.chatId}_${messageList.threadId}_${messageList.type}_${i}`
    // eslint-disable-next-line react/jsx-props-no-spreading
  }, messageList))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    messageLists: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global).messageLists
  };
})(MessageListHistoryHandler)));

/***/ }),

/***/ "./src/components/middle/MessageSelectToolbar.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/middle/MessageSelectToolbar.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MessageSelectToolbarAsync = props => {
  const {
    isActive
  } = props;
  const MessageSelectToolbar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MessageSelectToolbar', !isActive);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return MessageSelectToolbar ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageSelectToolbar, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageSelectToolbarAsync);

/***/ }),

/***/ "./src/components/middle/MiddleColumn.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/MiddleColumn.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useCustomBackground */ "./src/hooks/useCustomBackground.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/usePrevDuringAnimation */ "./src/hooks/usePrevDuringAnimation.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useResize__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useResize */ "./src/hooks/useResize.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./hooks/usePinnedMessage */ "./src/components/middle/hooks/usePinnedMessage.ts");
/* harmony import */ var _common_Composer__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../common/Composer */ "./src/components/common/Composer.tsx");
/* harmony import */ var _common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../common/PrivacySettingsNoticeModal.async */ "./src/components/common/PrivacySettingsNoticeModal.async.tsx");
/* harmony import */ var _common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../common/SeenByModal.async */ "./src/components/common/SeenByModal.async.tsx");
/* harmony import */ var _common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../common/UnpinAllMessagesModal.async */ "./src/components/common/UnpinAllMessagesModal.async.tsx");
/* harmony import */ var _main_premium_GiftPremiumModal_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../main/premium/GiftPremiumModal.async */ "./src/components/main/premium/GiftPremiumModal.async.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ChatLanguageModal.async */ "./src/components/middle/ChatLanguageModal.async.tsx");
/* harmony import */ var _composer_DropArea__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./composer/DropArea */ "./src/components/middle/composer/DropArea.tsx");
/* harmony import */ var _EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./EmojiInteractionAnimation.async */ "./src/components/middle/EmojiInteractionAnimation.async.tsx");
/* harmony import */ var _FloatingActionButtons__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./FloatingActionButtons */ "./src/components/middle/FloatingActionButtons.tsx");
/* harmony import */ var _MessageList__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./MessageList */ "./src/components/middle/MessageList.tsx");
/* harmony import */ var _MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./MessageSelectToolbar.async */ "./src/components/middle/MessageSelectToolbar.async.tsx");
/* harmony import */ var _MiddleHeader__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./MiddleHeader */ "./src/components/middle/MiddleHeader.tsx");
/* harmony import */ var _MobileSearch_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./MobileSearch.async */ "./src/components/middle/MobileSearch.async.tsx");
/* harmony import */ var _PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./PremiumRequiredPlaceholder */ "./src/components/middle/PremiumRequiredPlaceholder.tsx");
/* harmony import */ var _ReactorListModal_async__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./ReactorListModal.async */ "./src/components/middle/ReactorListModal.async.tsx");
/* harmony import */ var _MiddleColumn_scss__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./MiddleColumn.scss */ "./src/components/middle/MiddleColumn.scss");
/* harmony import */ var _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./MiddleColumn.module.scss */ "./src/components/middle/MiddleColumn.module.scss");











































function isImage(item) {
  return item.kind === 'file' && item.type && _config__WEBPACK_IMPORTED_MODULE_3__.SUPPORTED_IMAGE_CONTENT_TYPES.has(item.type);
}
const LAYER_ANIMATION_DURATION_MS = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
function MiddleColumn(_ref) {
  let {
    leftColumnRef,
    chatId,
    threadId,
    isComments,
    messageListType,
    isMobile,
    chat,
    draftReplyInfo,
    isPrivate,
    isPinnedMessageList,
    canPost,
    currentUserBannedRights,
    defaultBannedRights,
    hasPinned,
    hasAudioPlayer,
    hasButtonInHeader,
    pinnedMessagesCount,
    customBackground,
    theme,
    backgroundColor,
    patternColor,
    isLeftColumnShown,
    isRightColumnShown,
    isBackgroundBlurred,
    leftColumnWidth,
    hasCurrentTextSearch,
    isSelectModeActive,
    isSeenByModalOpen,
    isPrivacySettingsNoticeModalOpen,
    isReactorListModalOpen,
    isGiftPremiumModalOpen,
    isChatLanguageModalOpen,
    withInterfaceAnimations,
    shouldSkipHistoryAnimations,
    currentTransitionKey,
    isChannel,
    areChatSettingsLoaded,
    canSubscribe,
    canStartBot,
    canRestartBot,
    activeEmojiInteractions,
    shouldJoinToSend,
    shouldSendJoinRequest,
    shouldLoadFullChat,
    pinnedIds,
    topMessageId,
    canUnpin,
    canUnblock,
    isSavedDialog,
    canShowOpenChatButton,
    isContactRequirePremium
  } = _ref;
  const {
    openChat,
    openPreviousChat,
    unpinAllMessages,
    loadUser,
    loadChatSettings,
    closeLocalTextSearch,
    exitMessageSelectMode,
    joinChannel,
    sendBotCommand,
    restartBot,
    showNotification,
    loadFullChat,
    setLeftColumnWidth,
    resetLeftColumnWidth,
    unblockUser
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const {
    isTablet,
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const [dropAreaState, setDropAreaState] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_composer_DropArea__WEBPACK_IMPORTED_MODULE_32__.DropAreaState.None);
  const [isScrollDownShown, setIsScrollDownShown] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isNotchShown, setIsNotchShown] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isUnpinModalOpen, setIsUnpinModalOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    onIntersectionChanged,
    onFocusPinnedMessage,
    getCurrentPinnedIndexes,
    getLoadingPinnedId,
    getForceNextPinnedInHeader
  } = (0,_hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_23__["default"])(chatId, threadId, pinnedIds, topMessageId);
  const isMobileSearchActive = isMobile && hasCurrentTextSearch;
  const closeAnimationDuration = isMobile ? LAYER_ANIMATION_DURATION_MS : undefined;
  const hasTools = hasPinned && (windowWidth < _config__WEBPACK_IMPORTED_MODULE_3__.MOBILE_SCREEN_MAX_WIDTH || hasAudioPlayer || isRightColumnShown && windowWidth > _config__WEBPACK_IMPORTED_MODULE_3__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN && windowWidth < _config__WEBPACK_IMPORTED_MODULE_3__.SAFE_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN || !isMobile && hasButtonInHeader && windowWidth < _config__WEBPACK_IMPORTED_MODULE_3__.MAX_SCREEN_WIDTH_FOR_EXPAND_PINNED_MESSAGES);
  const renderingChatId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(chatId, closeAnimationDuration);
  const renderingThreadId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(threadId, closeAnimationDuration);
  const renderingMessageListType = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(messageListType, closeAnimationDuration);
  const renderingCanSubscribe = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(canSubscribe, closeAnimationDuration);
  const renderingCanStartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(canStartBot, closeAnimationDuration);
  const renderingCanRestartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(canRestartBot, closeAnimationDuration);
  const renderingCanUnblock = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(canUnblock, closeAnimationDuration);
  const renderingCanPost = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(canPost, closeAnimationDuration) && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && !renderingCanUnblock && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID && !isContactRequirePremium;
  const renderingHasTools = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(hasTools, closeAnimationDuration);
  const renderingIsScrollDownShown = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(isScrollDownShown, closeAnimationDuration) && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID;
  const renderingIsChannel = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(isChannel, closeAnimationDuration);
  const renderingShouldJoinToSend = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(shouldJoinToSend, closeAnimationDuration);
  const renderingShouldSendJoinRequest = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(shouldSendJoinRequest, closeAnimationDuration);
  const renderingOnPinnedIntersectionChange = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_18__["default"])(chatId ? onIntersectionChanged : undefined, closeAnimationDuration);
  const prevTransitionKey = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_19__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const {
    isReady,
    handleCssTransitionEnd,
    handleSlideTransitionStop
  } = useIsReady(!shouldSkipHistoryAnimations && withInterfaceAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
      openChat({
        id: undefined
      });
    }) : undefined;
  }, [chatId, openChat]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_32__.DropAreaState.None);
    setIsNotchShown(undefined);
  }, [chatId]);

  // Fix for mobile virtual keyboard
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_IOS && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_ANDROID) {
      return undefined;
    }
    const {
      visualViewport
    } = window;
    if (!visualViewport) {
      return undefined;
    }
    const handleResize = () => {
      const isFixNeeded = visualViewport.height !== document.documentElement.clientHeight;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
        document.body.classList.toggle('keyboard-visible', isFixNeeded);
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
          if (!isFixNeeded && visualViewport.offsetTop) {
            (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
              window.scrollTo({
                top: 0
              });
            });
          }
        });
      });
    };
    visualViewport.addEventListener('resize', handleResize);
    return () => {
      visualViewport.removeEventListener('resize', handleResize);
    };
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPrivate) {
      loadUser({
        userId: chatId
      });
    }
  }, [chatId, isPrivate, loadUser]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!areChatSettingsLoaded) {
      loadChatSettings({
        chatId: chatId
      });
    }
  }, [chatId, isPrivate, areChatSettingsLoaded]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && shouldLoadFullChat && isReady) {
      loadFullChat({
        chatId
      });
    }
  }, [shouldLoadFullChat, chatId, isReady, loadFullChat]);
  const {
    initResize,
    resetResize,
    handleMouseUp
  } = (0,_hooks_useResize__WEBPACK_IMPORTED_MODULE_20__.useResize)(leftColumnRef, n => setLeftColumnWidth({
    leftColumnWidth: n
  }), resetLeftColumnWidth, leftColumnWidth, '--left-column-width');
  const handleDragEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(e => {
    const {
      items
    } = e.dataTransfer || {};
    const shouldDrawQuick = items && items.length > 0 && Array.from(items)
    // Filter unnecessary element for drag and drop images in Firefox (https://github.com/Ajaxy/telegram-tt/issues/49)
    // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types#image
    .filter(item => item.type !== 'text/uri-list')
    // As of September 2021, native clients suggest "send quick, but compressed" only for images
    .every(isImage);
    setDropAreaState(shouldDrawQuick ? _composer_DropArea__WEBPACK_IMPORTED_MODULE_32__.DropAreaState.QuickFile : _composer_DropArea__WEBPACK_IMPORTED_MODULE_32__.DropAreaState.Document);
  });
  const handleHideDropArea = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_32__.DropAreaState.None);
  });
  const handleOpenUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    setIsUnpinModalOpen(true);
  });
  const closeUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    setIsUnpinModalOpen(false);
  });
  const handleOpenChatFromSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    openChat({
      id: String(threadId)
    });
  });
  const handleUnpinAllMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    unpinAllMessages({
      chatId: chatId,
      threadId: threadId
    });
    closeUnpinModal();
    openPreviousChat();
  });
  const handleTabletFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    openChat({
      id: chatId
    });
  });
  const handleSubscribeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    joinChannel({
      chatId: chatId
    });
    if (renderingShouldSendJoinRequest) {
      showNotification({
        message: isChannel ? lang('RequestToJoinChannelSentDescription') : lang('RequestToJoinGroupSentDescription')
      });
    }
  });
  const handleStartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    sendBotCommand({
      command: '/start'
    });
  });
  const handleRestartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    restartBot({
      chatId: chatId
    });
  });
  const handleUnblock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    unblockUser({
      userId: chatId
    });
  });
  const customBackgroundValue = (0,_hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_13__["default"])(theme, customBackground);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(renderingHasTools && 'has-header-tools', _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.MASK_IMAGE_DISABLED ? 'mask-image-disabled' : 'mask-image-enabled');
  const bgClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].background, _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].withTransition, customBackground && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].customBgImage, backgroundColor && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].customBgColor, customBackground && isBackgroundBlurred && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].blurred, isRightColumnShown && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].withRightColumn, _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_ELECTRON && !(renderingChatId && renderingThreadId) && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_42__["default"].draggable);
  const messagingDisabledClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('messaging-disabled', !isSelectModeActive && 'shown');
  const messageSendingRestrictionReason = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSendingRestrictionReason)(lang, currentUserBannedRights, defaultBannedRights);
  const forumComposerPlaceholder = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getForumComposerPlaceholder)(lang, chat, threadId, Boolean(draftReplyInfo));
  const composerRestrictionMessage = messageSendingRestrictionReason ?? forumComposerPlaceholder ?? (isContactRequirePremium ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_39__["default"], {
    userId: chatId
  }) : undefined);

  // CSS Variables calculation doesn't work properly with transforms, so we calculate transform values in JS
  const {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  } = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_11__["default"])(windowWidth, renderingCanPost), [renderingCanPost, windowWidth]);
  const footerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('middle-column-footer', !renderingCanPost && 'no-composer', renderingCanPost && isNotchShown && !isSelectModeActive && 'with-notch');
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_15__["default"])({
    isActive: isSelectModeActive,
    onBack: exitMessageSelectMode
  });
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_15__["default"])({
    isActive: isMobileSearchActive,
    onBack: closeLocalTextSearch
  });
  const isMessagingDisabled = Boolean(!isPinnedMessageList && !isSavedDialog && !renderingCanPost && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && composerRestrictionMessage);
  const withMessageListBottomShift = Boolean(renderingCanRestartBot || renderingCanSubscribe || renderingShouldSendJoinRequest || renderingCanStartBot || isPinnedMessageList && canUnpin || canShowOpenChatButton || renderingCanUnblock);
  const withExtraShift = Boolean(isMessagingDisabled || isSelectModeActive);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "MiddleColumn",
    className: className,
    onTransitionEnd: handleCssTransitionEnd,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_8__["default"])(`--composer-hidden-scale: ${composerHiddenScale}`, `--toolbar-hidden-scale: ${toolbarHiddenScale}`, `--unpin-hidden-scale: ${unpinHiddenScale}`, `--toolbar-unpin-hidden-scale: ${toolbarForUnpinHiddenScale},`, `--composer-translate-x: ${composerTranslateX}px`, `--toolbar-translate-x: ${toolbarTranslateX}px`, `--pattern-color: ${patternColor}`, backgroundColor && `--theme-background-color: ${backgroundColor}`),
    onClick: isTablet && isLeftColumnShown ? handleTabletFocus : undefined
  }, isDesktop && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "resize-handle",
    onMouseDown: initResize,
    onMouseUp: handleMouseUp,
    onDoubleClick: resetResize
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: bgClassName,
    style: customBackgroundValue ? `--custom-background: ${customBackgroundValue}` : undefined
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "middle-column-portals"
  }), Boolean(renderingChatId && renderingThreadId) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messages-layout",
    onDragEnter: renderingCanPost ? handleDragEnter : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MiddleHeader__WEBPACK_IMPORTED_MODULE_37__["default"], {
    chatId: renderingChatId,
    threadId: renderingThreadId,
    messageListType: renderingMessageListType,
    isComments: isComments,
    isReady: isReady,
    isMobile: isMobile,
    getCurrentPinnedIndexes: getCurrentPinnedIndexes,
    getLoadingPinnedId: getLoadingPinnedId,
    onFocusPinnedMessage: onFocusPinnedMessage
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_30__["default"], {
    name: shouldSkipHistoryAnimations ? 'none' : withInterfaceAnimations ? 'slide' : 'fade',
    activeKey: currentTransitionKey,
    shouldCleanup: true,
    cleanupExceptionKey: cleanupExceptionKey,
    onStop: handleSlideTransitionStop
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageList__WEBPACK_IMPORTED_MODULE_35__["default"], {
    key: `${renderingChatId}-${renderingThreadId}-${renderingMessageListType}`,
    chatId: renderingChatId,
    threadId: renderingThreadId,
    type: renderingMessageListType,
    isComments: isComments,
    canPost: renderingCanPost,
    hasTools: renderingHasTools,
    onScrollDownToggle: setIsScrollDownShown,
    onNotchToggle: setIsNotchShown,
    isReady: isReady,
    isContactRequirePremium: isContactRequirePremium,
    withBottomShift: withMessageListBottomShift,
    withDefaultBg: Boolean(!customBackground && !backgroundColor),
    onPinnedIntersectionChange: renderingOnPinnedIntersectionChange,
    getForceNextPinnedInHeader: getForceNextPinnedInHeader
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: footerClassName
  }, renderingCanPost && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Composer__WEBPACK_IMPORTED_MODULE_24__["default"], {
    type: "messageList",
    chatId: renderingChatId,
    threadId: renderingThreadId,
    messageListType: renderingMessageListType,
    dropAreaState: dropAreaState,
    onDropHide: handleHideDropArea,
    isReady: isReady,
    isMobile: isMobile,
    editableInputId: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_ID,
    editableInputCssSelector: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR,
    inputId: "message-input-text"
  }), isPinnedMessageList && canUnpin && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    color: "secondary",
    className: "composer-button unpin-all-button",
    onClick: handleOpenUnpinModal
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-unpin"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('Chat.Pinned.UnpinAll', pinnedMessagesCount, 'i')))), canShowOpenChatButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    color: "secondary",
    className: "composer-button open-chat-button",
    onClick: handleOpenChatFromSaved
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('SavedOpenChat')))), isMessagingDisabled && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: messagingDisabledClassName
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messaging-disabled-inner"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, composerRestrictionMessage))), isMobile && (renderingCanSubscribe || renderingShouldJoinToSend && !renderingShouldSendJoinRequest) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleSubscribeClick
  }, lang(renderingIsChannel ? 'ProfileJoinChannel' : 'ProfileJoinGroup'))), isMobile && renderingShouldSendJoinRequest && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleSubscribeClick
  }, lang('ChannelJoinRequest'))), isMobile && renderingCanStartBot && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleStartBot
  }, lang('BotStart'))), isMobile && renderingCanRestartBot && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleRestartBot
  }, lang('BotRestart'))), isMobile && renderingCanUnblock && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleUnblock
  }, lang('Unblock'))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_36__["default"], {
    messageListType: renderingMessageListType,
    isActive: isSelectModeActive,
    canPost: renderingCanPost
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_26__["default"], {
    isOpen: isSeenByModalOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_25__["default"], {
    isOpen: isPrivacySettingsNoticeModalOpen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ReactorListModal_async__WEBPACK_IMPORTED_MODULE_40__["default"], {
    isOpen: isReactorListModalOpen
  }), _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_TRANSLATION_SUPPORTED && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
    isOpen: isChatLanguageModalOpen
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FloatingActionButtons__WEBPACK_IMPORTED_MODULE_34__["default"], {
    withScrollDown: renderingIsScrollDownShown,
    canPost: renderingCanPost,
    withExtraShift: withExtraShift
  })), isMobile && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MobileSearch_async__WEBPACK_IMPORTED_MODULE_38__["default"], {
    isActive: Boolean(isMobileSearchActive)
  })), chatId && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_27__["default"], {
    isOpen: isUnpinModalOpen,
    chatId: chatId,
    pinnedMessagesCount: pinnedMessagesCount,
    onClose: closeUnpinModal,
    onUnpin: handleUnpinAllMessages
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    teactFastList: true
  }, activeEmojiInteractions?.map((activeEmojiInteraction, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_33__["default"], {
    teactOrderKey: i,
    key: activeEmojiInteraction.id,
    activeEmojiInteraction: activeEmojiInteraction
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_main_premium_GiftPremiumModal_async__WEBPACK_IMPORTED_MODULE_28__["default"], {
    isOpen: isGiftPremiumModalOpen
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    isMobile
  } = _ref2;
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global);
  const {
    isBlurred: isBackgroundBlurred,
    background: customBackground,
    backgroundColor,
    patternColor
  } = global.settings.themes[theme] || {};
  const {
    messageLists,
    isLeftColumnShown,
    activeEmojiInteractions,
    seenByModal,
    giftPremiumModal,
    reactorModal,
    audioPlayer,
    shouldSkipHistoryAnimations,
    chatLanguageModal,
    privacySettingsNoticeModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global);
  const {
    leftColumnWidth
  } = global;
  const state = {
    theme,
    customBackground,
    backgroundColor,
    patternColor,
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isBackgroundBlurred,
    hasCurrentTextSearch: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentTextSearch)(global)),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsInSelectMode)(global),
    isSeenByModalOpen: Boolean(seenByModal),
    isPrivacySettingsNoticeModalOpen: Boolean(privacySettingsNoticeModal),
    isReactorListModalOpen: Boolean(reactorModal),
    isGiftPremiumModalOpen: giftPremiumModal?.isOpen,
    isChatLanguageModalOpen: Boolean(chatLanguageModal),
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    activeEmojiInteractions,
    leftColumnWidth
  };
  if (!currentMessageList) {
    return state;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const isPrivate = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectBot)(global, chatId);
  const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPinnedIds)(global, chatId, threadId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId) : undefined;
  const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadInfo)(global, chatId, threadId);
  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);
  const canPost = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanPostInChat)(chat, threadId, isMessageThread, chatFullInfo);
  const isBotNotStarted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatBotNotStarted)(global, chatId);
  const isPinnedMessageList = messageListType === 'pinned';
  const isMainThread = messageListType === 'thread' && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isChannel = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat));
  const canSubscribe = Boolean(chat && isMainThread && (isChannel || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatSuperGroup)(chat)) && chat.isNotJoined && !chat.joinRequests);
  const shouldJoinToSend = Boolean(chat?.isNotJoined && chat.isJoinToSend);
  const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);
  const isUserBlocked = isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsUserBlocked)(global, chatId) : false;
  const canRestartBot = Boolean(bot && isUserBlocked);
  const canStartBot = !canRestartBot && isBotNotStarted;
  const canUnblock = isUserBlocked && !bot;
  const shouldLoadFullChat = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat) && !chatFullInfo);
  const draftReplyInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const shouldBlockSendInForum = chat?.isForum ? threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !draftReplyInfo && chat.topics?.[_config__WEBPACK_IMPORTED_MODULE_3__.GENERAL_TOPIC_ID]?.isClosed : false;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const canShowOpenChatButton = isSavedDialog && threadId !== _config__WEBPACK_IMPORTED_MODULE_3__.ANONYMOUS_USER_ID;
  const isCommentThread = threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum;
  const topMessageId = isCommentThread ? Number(threadId) : undefined;
  const canUnpin = chat && (isPrivate || chat?.isCreator || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserRightBanned)(chat, 'pinMessages') || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'pinMessages'));
  const isContactRequirePremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, chatId)?.isContactRequirePremium;
  return {
    ...state,
    chatId,
    threadId,
    messageListType,
    chat,
    draftReplyInfo,
    isPrivate,
    areChatSettingsLoaded: Boolean(chat?.settings),
    isComments: isMessageThread,
    canPost: !isPinnedMessageList && (!chat || canPost) && !isBotNotStarted && !(shouldJoinToSend && chat?.isNotJoined) && !shouldBlockSendInForum && !isSavedDialog,
    isPinnedMessageList,
    currentUserBannedRights: chat?.currentUserBannedRights,
    defaultBannedRights: chat?.defaultBannedRights,
    hasPinned: isCommentThread || Boolean(!isPinnedMessageList && pinnedIds?.length),
    hasAudioPlayer: Boolean(audioMessage),
    hasButtonInHeader: canStartBot || canRestartBot || canSubscribe || shouldSendJoinRequest,
    pinnedMessagesCount: pinnedIds ? pinnedIds.length : 0,
    shouldSkipHistoryAnimations,
    isChannel,
    canSubscribe,
    canStartBot,
    canRestartBot,
    shouldJoinToSend,
    shouldSendJoinRequest,
    shouldLoadFullChat,
    pinnedIds,
    topMessageId,
    canUnpin,
    canUnblock,
    isSavedDialog,
    canShowOpenChatButton,
    isContactRequirePremium
  };
})(MiddleColumn)));
function useIsReady(withAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile) {
  const [isReady, setIsReady] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isMobile);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const willSwitchMessageList = prevTransitionKey !== undefined && prevTransitionKey !== currentTransitionKey;
  if (willSwitchMessageList) {
    if (withAnimations) {
      setIsReady(false);

      // Make sure to end even if end callback was not called (which was some hardly-reproducible bug)
      setTimeout(() => {
        setIsReady(true);
      }, LAYER_ANIMATION_DURATION_MS);
    } else {
      forceUpdate();
    }
  }
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!withAnimations) {
      setIsReady(true);
    }
  }, [withAnimations]);
  function handleCssTransitionEnd(e) {
    if (e.propertyName === 'transform' && e.target === e.currentTarget) {
      setIsReady(Boolean(chatId));
    }
  }
  function handleSlideTransitionStop() {
    setIsReady(true);
  }
  return {
    isReady: isReady && !willSwitchMessageList,
    handleCssTransitionEnd: withAnimations ? handleCssTransitionEnd : undefined,
    handleSlideTransitionStop: withAnimations ? handleSlideTransitionStop : undefined
  };
}

/***/ }),

/***/ "./src/components/middle/MiddleHeader.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/MiddleHeader.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../calls/group/GroupCallTopPane */ "./src/components/calls/group/GroupCallTopPane.tsx");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _AudioPlayer__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./AudioPlayer */ "./src/components/middle/AudioPlayer.tsx");
/* harmony import */ var _ChatReportPanel__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ChatReportPanel */ "./src/components/middle/ChatReportPanel.tsx");
/* harmony import */ var _HeaderActions__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./HeaderActions */ "./src/components/middle/HeaderActions.tsx");
/* harmony import */ var _HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./HeaderPinnedMessage */ "./src/components/middle/HeaderPinnedMessage.tsx");
/* harmony import */ var _MiddleHeader_scss__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./MiddleHeader.scss */ "./src/components/middle/MiddleHeader.scss");


































const ANIMATION_DURATION = 350;
const BACK_BUTTON_INACTIVE_TIME = 450;
const EMOJI_STATUS_SIZE = 22;
const MiddleHeader = _ref => {
  let {
    chatId,
    threadId,
    messageListType,
    isReady,
    isMobile,
    pinnedMessageIds,
    messagesById,
    canUnpin,
    topMessageSender,
    typingStatus,
    isSelectModeActive,
    isLeftColumnShown,
    isRightColumnShown,
    audioMessage,
    chat,
    messagesCount,
    isComments,
    isChatWithSelf,
    hasButtonInHeader,
    shouldSkipHistoryAnimations,
    currentTransitionKey,
    connectionState,
    isSyncing,
    isSynced,
    isFetchingDifference,
    getCurrentPinnedIndexes,
    getLoadingPinnedId,
    emojiStatusSticker,
    isSavedDialog,
    onFocusPinnedMessage
  } = _ref;
  const {
    openThreadWithInfo,
    pinMessage,
    focusMessage,
    openChat,
    openPreviousChat,
    loadPinnedMessages,
    toggleLeftColumn,
    exitMessageSelectMode,
    openPremiumModal,
    openThread,
    openStickerSet
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const isBackButtonActive = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    isTablet
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const currentPinnedIndexes = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_14__["default"])(getCurrentPinnedIndexes);
  const currentPinnedIndex = currentPinnedIndexes[`${chatId}_${threadId}`] || 0;
  const waitingForPinnedId = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_14__["default"])(getLoadingPinnedId);
  const pinnedMessageId = Array.isArray(pinnedMessageIds) ? pinnedMessageIds[currentPinnedIndex] : pinnedMessageIds;
  const pinnedMessage = messagesById && pinnedMessageId ? messagesById[pinnedMessageId] : undefined;
  const pinnedMessagesCount = Array.isArray(pinnedMessageIds) ? pinnedMessageIds.length : pinnedMessageIds ? 1 : undefined;
  const chatTitleLength = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getChatTitle)(lang, chat).length;
  const topMessageTitle = topMessageSender ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getSenderTitle)(lang, topMessageSender) : undefined;
  const {
    settings
  } = chat || {};
  const isForum = chat?.isForum;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isSynced && isReady && (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || isForum)) {
      loadPinnedMessages({
        chatId,
        threadId
      });
    }
  }, [chatId, threadId, isSynced, isReady, isForum]);
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__["default"])(chatId, pinnedMessageId, pinnedMessage);
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const isLeftColumnHideable = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN;
  const shouldShowCloseButton = isTablet && isLeftColumnShown;

  // eslint-disable-next-line no-null/no-null
  const componentRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const shouldAnimateTools = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    handleClick: handleHeaderClick,
    handleMouseDown: handleHeaderMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__.useFastClick)(e => {
    if (e.type === 'mousedown' && e.target.closest('.title > .custom-emoji')) return;
    openThreadWithInfo({
      chatId,
      threadId
    });
  });
  const handleUnpinMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(messageId => {
    pinMessage({
      messageId,
      isUnpin: true
    });
  });
  const handlePinnedMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(e => {
    const messageId = e.shiftKey && Array.isArray(pinnedMessageIds) ? pinnedMessageIds[(0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_9__["default"])(pinnedMessageIds.length, pinnedMessageIds.indexOf(pinnedMessageId) - 2)] : pinnedMessageId;
    if (onFocusPinnedMessage(messageId)) {
      focusMessage({
        chatId,
        threadId,
        messageId,
        noForumTopicPanel: true
      });
    }
  });
  const handleAllPinnedClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    openThread({
      chatId,
      threadId,
      type: 'pinned'
    });
  });
  const setBackButtonActive = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    setTimeout(() => {
      isBackButtonActive.current = true;
    }, BACK_BUTTON_INACTIVE_TIME);
  });
  const handleUserStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    openPremiumModal({
      fromUserId: chatId
    });
  });
  const handleChannelStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    openStickerSet({
      stickerSetInfo: emojiStatusSticker.stickerSetInfo
    });
  });
  const handleBackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(e => {
    if (!isBackButtonActive.current) return;

    // Workaround for missing UI when quickly clicking the Back button
    isBackButtonActive.current = false;
    if (isMobile) {
      const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_4__.EDITABLE_INPUT_CSS_SELECTOR);
      messageInput?.blur();
    }
    if (isSelectModeActive) {
      exitMessageSelectMode();
      setBackButtonActive();
      return;
    }
    if (messageListType === 'thread' && currentTransitionKey === 0) {
      if (!isTablet || shouldShowCloseButton) {
        e.stopPropagation(); // Stop propagation to prevent chat re-opening on tablets
        openChat({
          id: undefined
        }, {
          forceOnHeavyAnimation: true
        });
      } else {
        toggleLeftColumn();
      }
      setBackButtonActive();
      return;
    }
    openPreviousChat();
    setBackButtonActive();
  });
  const canToolsCollideWithChatInfo = windowWidth >= _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN && windowWidth < _config__WEBPACK_IMPORTED_MODULE_4__.SAFE_SCREEN_WIDTH_FOR_CHAT_INFO || windowWidth > _config__WEBPACK_IMPORTED_MODULE_4__.MOBILE_SCREEN_MAX_WIDTH && windowWidth < _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN && (!chatTitleLength || chatTitleLength > 30);
  const shouldUseStackedToolsClass = canToolsCollideWithChatInfo || windowWidth > _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN && windowWidth < _config__WEBPACK_IMPORTED_MODULE_4__.SAFE_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN;
  const hasChatSettings = Boolean(settings?.canAddContact || settings?.canBlockContact || settings?.canReportSpam);
  const {
    shouldRender: shouldShowChatReportPanel,
    transitionClassNames: chatReportPanelClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__["default"])(hasChatSettings);
  const renderingChatSettings = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(hasChatSettings ? settings : undefined, true);
  const {
    shouldRender: shouldRenderAudioPlayer,
    transitionClassNames: audioPlayerClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__["default"])(Boolean(audioMessage));
  const renderingAudioMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(audioMessage, true);
  const {
    shouldRender: shouldRenderPinnedMessage,
    transitionClassNames: pinnedMessageClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__["default"])(Boolean(pinnedMessage), undefined, true);
  const renderingPinnedMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(pinnedMessage, true);
  const renderingPinnedMessagesCount = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(pinnedMessagesCount, true);
  const renderingCanUnpin = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(canUnpin, true);
  const renderingPinnedMessageTitle = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(topMessageTitle);
  const prevTransitionKey = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_20__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const canRevealTools = shouldRenderPinnedMessage && renderingPinnedMessage || shouldRenderAudioPlayer && renderingAudioMessage;

  // Logic for transition to and from custom display of AudioPlayer/PinnedMessage on smaller screens
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const componentEl = componentRef.current;
    if (!componentEl) {
      return;
    }
    if (!shouldUseStackedToolsClass || !canRevealTools) {
      componentEl.classList.remove('tools-stacked', 'animated');
      shouldAnimateTools.current = true;
      return;
    }
    if (isRightColumnShown || canToolsCollideWithChatInfo) {
      if (shouldAnimateTools.current) {
        componentEl.classList.add('tools-stacked', 'animated');
        shouldAnimateTools.current = false;
      }

      // Remove animation class to prevent it messing up the show transitions
      setTimeout(() => {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_5__.requestMutation)(() => {
          componentEl.classList.remove('animated');
        });
      }, ANIMATION_DURATION);
    } else {
      componentEl.classList.remove('tools-stacked');
      shouldAnimateTools.current = true;
    }
  }, [shouldUseStackedToolsClass, canRevealTools, canToolsCollideWithChatInfo, isRightColumnShown]);
  const {
    connectionStatusText
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_12__["default"])(lang, connectionState, isSyncing || isFetchingDifference, true);
  function renderInfo() {
    if (messageListType === 'thread') {
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || isSavedDialog || chat?.isForum) {
        return renderChatInfo();
      }
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderBackButton(), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", null, messagesCount !== undefined ? messageListType === 'thread' ? messagesCount ? lang(isComments ? 'Comments' : 'Replies', messagesCount, 'i') : lang(isComments ? 'CommentsTitle' : 'RepliesTitle') : messageListType === 'pinned' ? lang('PinnedMessagesCount', messagesCount, 'i') : messageListType === 'scheduled' ? isChatWithSelf ? lang('Reminders') : lang('messages', messagesCount, 'i') : undefined : lang('Loading')));
  }
  function renderChatInfo() {
    // TODO Implement count
    const savedMessagesStatus = isSavedDialog ? lang('SavedMessages') : undefined;
    const realChatId = isSavedDialog ? String(threadId) : chatId;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, (isLeftColumnHideable || currentTransitionKey > 0) && renderBackButton(shouldShowCloseButton, !isSavedDialog), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "chat-info-wrapper",
      onClick: handleHeaderClick,
      onMouseDown: handleHeaderMouseDown
    }, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isUserId)(realChatId) ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_25__["default"], {
      key: realChatId,
      userId: realChatId,
      typingStatus: typingStatus,
      status: connectionStatusText || savedMessagesStatus,
      withDots: Boolean(connectionStatusText),
      withFullInfo: true,
      withMediaViewer: true,
      withStory: !isChatWithSelf,
      withUpdatingStatus: true,
      isSavedDialog: isSavedDialog,
      storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
      emojiStatusSize: EMOJI_STATUS_SIZE,
      noRtl: true,
      onEmojiStatusClick: handleUserStatusClick
    }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_24__["default"], {
      key: realChatId,
      chatId: realChatId,
      threadId: !isSavedDialog ? threadId : undefined,
      typingStatus: typingStatus,
      status: connectionStatusText || savedMessagesStatus,
      withDots: Boolean(connectionStatusText),
      withMediaViewer: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      withFullInfo: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      withUpdatingStatus: true,
      withStory: true,
      isSavedDialog: isSavedDialog,
      storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
      emojiStatusSize: EMOJI_STATUS_SIZE,
      onEmojiStatusClick: handleChannelStatusClick,
      noRtl: true
    })));
  }
  function renderBackButton() {
    let asClose = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
    let withUnreadCounter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "back-button"
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_27__["default"], {
      round: true,
      size: "smaller",
      color: "translucent",
      onClick: handleBackClick,
      ariaLabel: lang(asClose ? 'Close' : 'Back')
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('animated-close-icon', !asClose && 'state-back')
    })), withUnreadCounter && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_26__["default"], null));
  }
  const isAudioPlayerRendered = Boolean(shouldRenderAudioPlayer && renderingAudioMessage);
  const isPinnedMessagesFullWidth = isAudioPlayerRendered || !isMobile && hasButtonInHeader && windowWidth < _config__WEBPACK_IMPORTED_MODULE_4__.MAX_SCREEN_WIDTH_FOR_EXPAND_PINNED_MESSAGES;
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_15__["default"])(componentRef);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "MiddleHeader",
    ref: componentRef
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_28__["default"], {
    name: shouldSkipHistoryAnimations ? 'none' : 'slideFade',
    activeKey: currentTransitionKey,
    shouldCleanup: true,
    cleanupExceptionKey: cleanupExceptionKey
  }, renderInfo()), threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !chat?.isForum && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_23__["default"], {
    hasPinnedOffset: shouldRenderPinnedMessage && Boolean(renderingPinnedMessage) || shouldRenderAudioPlayer && Boolean(renderingAudioMessage),
    chatId: chatId
  }), shouldRenderPinnedMessage && renderingPinnedMessage && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_32__["default"], {
    key: chatId,
    message: renderingPinnedMessage,
    count: renderingPinnedMessagesCount || 0,
    index: currentPinnedIndex,
    customTitle: renderingPinnedMessageTitle,
    className: pinnedMessageClassNames,
    onUnpinMessage: renderingCanUnpin ? handleUnpinMessage : undefined,
    onClick: handlePinnedMessageClick,
    onAllPinnedClick: handleAllPinnedClick,
    isLoading: waitingForPinnedId !== undefined,
    isFullWidth: isPinnedMessagesFullWidth
  }), shouldShowChatReportPanel && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatReportPanel__WEBPACK_IMPORTED_MODULE_30__["default"], {
    key: chatId,
    chatId: chatId,
    settings: renderingChatSettings,
    className: chatReportPanelClassNames
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "header-tools"
  }, isAudioPlayerRendered && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AudioPlayer__WEBPACK_IMPORTED_MODULE_29__["default"], {
    key: (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_10__.getMessageKey)(renderingAudioMessage),
    message: renderingAudioMessage,
    className: audioPlayerClassNames
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HeaderActions__WEBPACK_IMPORTED_MODULE_31__["default"], {
    chatId: chatId,
    threadId: threadId,
    messageListType: messageListType,
    isMobile: isMobile,
    canExpandActions: !isAudioPlayerRendered
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId,
    threadId,
    messageListType,
    isMobile
  } = _ref2;
  const {
    isLeftColumnShown,
    shouldSkipHistoryAnimations,
    audioPlayer,
    messageLists
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  let messagesCount;
  if (messageListType === 'pinned') {
    const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPinnedIds)(global, chatId, threadId);
    messagesCount = pinnedIds?.length;
  } else if (messageListType === 'scheduled') {
    const scheduledIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectScheduledIds)(global, chatId, threadId);
    messagesCount = scheduledIds?.length;
  } else if (messageListType === 'thread' && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID) {
    const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectThreadInfo)(global, chatId, threadId);
    messagesCount = threadInfo?.messagesCount || 0;
  }
  const isMainThread = messageListType === 'thread' && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isChatWithBot = chat && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatWithBot)(global, chat);
  const canRestartBot = Boolean(isChatWithBot && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsUserBlocked)(global, chatId));
  const canStartBot = isChatWithBot && !canRestartBot && Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatBotNotStarted)(global, chatId));
  const canSubscribe = Boolean(chat && (isMainThread || chat.isForum) && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatSuperGroup)(chat)) && chat.isNotJoined);
  const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);
  const typingStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectThreadParam)(global, chatId, threadId, 'typingStatus');
  const emojiStatus = chat?.emojiStatus;
  const emojiStatusSticker = emojiStatus && global.customEmojis.byId[emojiStatus.documentId];
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const state = {
    typingStatus,
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsRightColumnShown)(global, isMobile),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsInSelectMode)(global),
    audioMessage,
    chat,
    messagesCount,
    isChatWithSelf: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatWithSelf)(global, chatId),
    shouldSkipHistoryAnimations,
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    connectionState: global.connectionState,
    isSyncing: global.isSyncing,
    isSynced: global.isSynced,
    isFetchingDifference: global.isFetchingDifference,
    emojiStatusSticker,
    hasButtonInHeader: canStartBot || canRestartBot || canSubscribe || shouldSendJoinRequest,
    isSavedDialog
  };
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessages)(global, chatId);
  if (messageListType !== 'thread' || !messagesById) {
    return state;
  }
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum) {
    const pinnedMessageId = Number(threadId);
    const message = pinnedMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, chatId, pinnedMessageId) : undefined;
    const topMessageSender = message ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectForwardedSender)(global, message) : undefined;
    return {
      ...state,
      pinnedMessageIds: pinnedMessageId,
      messagesById,
      canUnpin: false,
      topMessageSender
    };
  }
  const pinnedMessageIds = !isSavedDialog ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPinnedIds)(global, chatId, threadId) : undefined;
  if (pinnedMessageIds?.length) {
    const firstPinnedMessage = messagesById[pinnedMessageIds[0]];
    const {
      canUnpin = false
    } = firstPinnedMessage && pinnedMessageIds.length === 1 && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectAllowedMessageActions)(global, firstPinnedMessage, threadId) || {};
    return {
      ...state,
      pinnedMessageIds,
      messagesById,
      canUnpin
    };
  }
  return state;
})(MiddleHeader)));

/***/ }),

/***/ "./src/components/middle/MobileSearch.async.tsx":
/*!******************************************************!*\
  !*** ./src/components/middle/MobileSearch.async.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MobileSearchAsync = props => {
  const {
    isActive
  } = props;
  const MobileSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MobileSearch', !isActive, true);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return MobileSearch ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MobileSearch, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MobileSearchAsync);

/***/ }),

/***/ "./src/components/middle/NoMessages.tsx":
/*!**********************************************!*\
  !*** ./src/components/middle/NoMessages.tsx ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_TopicIcon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _NoMessages_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./NoMessages.scss */ "./src/components/middle/NoMessages.scss");






const ICON_SIZE = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const NoMessages = _ref => {
  let {
    isChatWithSelf,
    type,
    isGroupChatJustCreated,
    topic
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  if (type === 'scheduled') {
    return renderScheduled(lang);
  }
  if (isChatWithSelf) {
    return renderSavedMessages(lang);
  }
  if (isGroupChatJustCreated) {
    return renderGroup(lang);
  }
  if (topic) {
    return renderTopic(lang, topic);
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "empty"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('NoMessages')));
};
function renderTopic(lang, topic) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TopicIcon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    topic: topic,
    size: ICON_SIZE,
    className: "no-messages-icon topic-icon"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('Chat.EmptyTopicPlaceholder.Title')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description topic-description"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__["default"])(lang('Chat.EmptyTopicPlaceholder.Text'), ['br']))));
}
function renderScheduled(lang) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "empty"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('ScheduledMessages.EmptyPlaceholder')));
}
function renderSavedMessages(lang) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon no-messages-icon icon-cloud-download"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('Conversation.CloudStorageInfo.Title')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("ul", {
    className: "description"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description1')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description2')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description3')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description4')))));
}
function renderGroup(lang) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('EmptyGroupInfo.Title')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description"
  }, lang('EmptyGroupInfo.Subtitle')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("ul", {
    className: "list-checkmarks"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line1')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line2')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line3')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line4')))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(NoMessages));

/***/ }),

/***/ "./src/components/middle/PinnedMessageNavigation.tsx":
/*!***********************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PinnedMessageNavigation.module.scss */ "./src/components/middle/PinnedMessageNavigation.module.scss");



const BORDER_MASK_LEVEL = 4;
const PinnedMessageNavigation = _ref => {
  let {
    count,
    index
  } = _ref;
  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const markupParams = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return calculateMarkup(count, index);
  }, [count, index]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!containerRef.current) {
      return;
    }
    const {
      trackHeight,
      trackTranslateY,
      markHeight,
      markTranslateY,
      clipPathId,
      clipPath
    } = markupParams;
    const firstChild = containerRef.current.firstElementChild;
    if (containerRef?.current) {
      const currentElement = containerRef.current;
      const {
        style
      } = currentElement;
      style.height = `${trackHeight}px`;
      style.transform = `translateY(-${trackTranslateY}px)`;
      style.clipPath = `url("#${clipPathId}")`;
      const svg = currentElement.querySelector('svg');
      const div = currentElement.querySelector('div');
      const defs = currentElement.querySelector('defs');
      if (!svg) {
        if (firstChild) {
          firstChild.innerHTML = `<svg height="0" width="0"><defs> ${clipPath} </defs></svg>`;
        }
      }
      if (defs) {
        defs.innerHTML = clipPath;
      }
      if (div) {
        div.style.height = `${markHeight}px`;
        div.style.transform = `translateY(${markTranslateY}px)`;
      }
    }
  }, [markupParams]);
  if (count === 1) {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper1,
      ref: containerRef
    }));
  }
  const {
    trackHeight,
    trackTranslateY,
    markHeight,
    markTranslateY,
    clipPathId
  } = markupParams;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder, count > BORDER_MASK_LEVEL && _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMask)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper,
    ref: containerRef,
    style: `clip-path: url("#${clipPathId}"); width: 2px;
          height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMark,
    style: `--height: ${markHeight}px; --translate-y: ${markTranslateY}px; ` + `--translate-track: ${trackTranslateY}px;`
  })));
};
function calculateMarkup(count, index) {
  const reverseIndex = count - index - 1;
  const barHeight = getBarHeight(count);
  const markHeight = getMarkHeight(count, reverseIndex);
  const trackHeight = getTrackHeight(count, barHeight);
  const clipPathId = `clipPath${count}`;
  const clipPath = getClipPath(clipPathId, barHeight, count);
  const markTranslateY = getMarkTranslateY(reverseIndex, barHeight, count);
  const trackTranslateY = getTrackTranslateY(reverseIndex, count, barHeight, trackHeight);
  return {
    markHeight,
    clipPath,
    markTranslateY,
    trackTranslateY,
    trackHeight,
    clipPathId
  };
}
function getBarHeight(count) {
  let barHeight = 8;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getMarkHeight(count, index) {
  let barHeight = 36;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = index === 1 ? 12 : 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getTrackHeight(count, barHeight) {
  return count <= 3 ? 36 : barHeight * count + 2 * (count - 1);
}
function getClipPath(id, barHeight, count) {
  const radius = 1;
  let d = '';
  if (count === 3) {
    d = drawRect(0, 0, 2, barHeight, radius) + drawRect(0, 12, 2, barHeight + 1, radius) + drawRect(0, 25, 2, barHeight, radius);
  } else {
    for (let i = 0; i < count; i++) {
      d += drawRect(0, (barHeight + 2) * i, 2, barHeight, radius);
    }
  }
  return `<clipPath id="${id}">
      <path d="${d}" />
    </clipPath>`;
}
function drawRect(x, y, width, height, radius) {
  return `M${x},${y + radius}a${radius},${radius},0,0,1,
  ${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;
}
function getMarkTranslateY(index, barHeight, count) {
  if (count === 1) {
    return 0;
  } else if (count === 2) {
    return index === 0 ? 0 : barHeight + 2;
  }
  if (count === 3) {
    if (index === 0) {
      return 0;
    } else if (index === 1) {
      return 12;
    }
    return 25;
  } else {
    return (barHeight + 2) * index;
  }
}
function getTrackTranslateY(index, count, barHeight, trackHeight) {
  if (count <= 4) {
    return 0;
  }
  if (index <= 1) {
    return 0;
  } else if (index >= count - 2) {
    return trackHeight - 36;
  }
  return (barHeight + 4) / 2 + (index - 2) * (barHeight + 2);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PinnedMessageNavigation));

/***/ }),

/***/ "./src/components/middle/PremiumRequiredMessage.tsx":
/*!**********************************************************!*\
  !*** ./src/components/middle/PremiumRequiredMessage.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./PremiumRequiredMessage.module.scss */ "./src/components/middle/PremiumRequiredMessage.module.scss");












function PremiumRequiredMessage(_ref) {
  let {
    patternColor,
    userName
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => openPremiumModal());
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].inner
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].iconsContainer
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__["default"], {
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_4__.LOCAL_TGS_URLS.Unlock,
    size: 54,
    color: patternColor,
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].animatedUnlock
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "comments-sticker",
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].commentsIcon
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].description
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lang('MessageLockedPremium', userName), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    color: "translucent-black",
    size: "tiny",
    onClick: handleOpenPremiumModal,
    className: _PremiumRequiredMessage_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].button
  }, lang('MessagePremiumUnlock'))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    userId
  } = _ref2;
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTheme)(global);
  const {
    patternColor
  } = global.settings.themes[theme] || {};
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  return {
    patternColor,
    userName: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user)
  };
})(PremiumRequiredMessage)));

/***/ }),

/***/ "./src/components/middle/PremiumRequiredPlaceholder.tsx":
/*!**************************************************************!*\
  !*** ./src/components/middle/PremiumRequiredPlaceholder.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");







function PremiumRequiredPlaceholder(_ref) {
  let {
    userName
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => openPremiumModal());
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, lang('Chat.MessagingRestrictedPlaceholder', userName)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isPrimary: true,
    onClick: handleOpenPremiumModal
  }, lang('Chat.MessagingRestrictedPlaceholderAction')));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    userId
  } = _ref2;
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  return {
    userName: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user)
  };
})(PremiumRequiredPlaceholder)));

/***/ }),

/***/ "./src/components/middle/ReactorListModal.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/middle/ReactorListModal.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReactorListModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReactorListModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReactorListModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ReactorListModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReactorListModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactorListModalAsync);

/***/ }),

/***/ "./src/components/middle/ScrollDownButton.tsx":
/*!****************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ScrollDownButton.module.scss */ "./src/components/middle/ScrollDownButton.module.scss");









const ScrollDownButton = _ref => {
  let {
    icon,
    ariaLabelLang,
    unreadCount,
    onClick,
    onReadAll,
    className
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__["default"])();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    isContextMenuOpen,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, !onReadAll);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].root, className),
    ref: ref
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    color: "secondary",
    round: true,
    className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].button,
    onClick: onClick,
    onContextMenu: handleContextMenu,
    ariaLabel: lang(ariaLabelLang)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].icon, 'icon', `icon-${icon}`)
  })), Boolean(unreadCount) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].unreadCount
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_2__.formatIntegerCompact)(unreadCount)), onReadAll && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isOpen: isContextMenuOpen,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    autoClose: true,
    positionX: "right",
    positionY: "bottom"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "readchats",
    onClick: onReadAll
  }, lang('MarkAllAsRead'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ScrollDownButton));

/***/ }),

/***/ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts":
/*!**************************************************************************!*\
  !*** ./src/components/middle/helpers/calculateMiddleFooterTransforms.ts ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MIN_LEFT_COLUMN_WIDTH: () => (/* binding */ MIN_LEFT_COLUMN_WIDTH),
/* harmony export */   SIDE_COLUMN_MAX_WIDTH: () => (/* binding */ SIDE_COLUMN_MAX_WIDTH),
/* harmony export */   "default": () => (/* binding */ calculateMiddleFooterTransforms)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");


const MAX_TOOLBAR_WIDTH = 32 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MAX_MESSAGES_LIST_WIDTH = 45.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const SIDE_COLUMN_MAX_WIDTH = 26.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MIN_LEFT_COLUMN_WIDTH = 16 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const UNPIN_BUTTON_WIDTH = 16.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
function calculateMiddleFooterTransforms(windowWidth, canPost) {
  const sidePadding = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM : 2 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const messageListWidth = getMessageListWidth(windowWidth);
  const sendButtonWidth = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? 3.375 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM : 4 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const composerWidth = canPost ? messageListWidth - sidePadding - sendButtonWidth : messageListWidth - sidePadding;
  const toolbarWidth = windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? Math.min(messageListWidth - sidePadding, MAX_TOOLBAR_WIDTH) : messageListWidth - sidePadding;
  const composerHiddenScale = toolbarWidth / composerWidth;
  const toolbarHiddenScale = composerWidth / toolbarWidth;
  const unpinHiddenScale = toolbarWidth / UNPIN_BUTTON_WIDTH;
  const toolbarForUnpinHiddenScale = UNPIN_BUTTON_WIDTH / toolbarWidth;
  const composerTranslateX = canPost ? sendButtonWidth / 2 * toolbarHiddenScale : 0;
  const toolbarTranslateX = canPost ? sendButtonWidth / 2 * -1 * composerHiddenScale : 0;
  return {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  };
}
function getMessageListWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.25, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    const rightColumnWidth = Math.min(windowWidth * 0.25, SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth - rightColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.4, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > MAX_MESSAGES_LIST_WIDTH) {
    return MAX_MESSAGES_LIST_WIDTH;
  }
  return windowWidth;
}

/***/ }),

/***/ "./src/components/middle/helpers/groupMessages.ts":
/*!********************************************************!*\
  !*** ./src/components/middle/helpers/groupMessages.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   groupMessages: () => (/* binding */ groupMessages),
/* harmony export */   isAlbum: () => (/* binding */ isAlbum)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");


const GROUP_INTERVAL_SECONDS = 600; // 10 minutes

function isAlbum(messageOrAlbum) {
  return 'albumId' in messageOrAlbum;
}
function groupMessages(messages, firstUnreadId, topMessageId, isChatWithSelf) {
  let currentSenderGroup = [];
  let currentDateGroup = {
    originalDate: messages[0].date,
    datetime: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.getDayStartAt)(messages[0].date * 1000),
    senderGroups: [currentSenderGroup]
  };
  let currentAlbum;
  const dateGroups = [currentDateGroup];
  messages.forEach((message, index) => {
    if (message.isInAlbum) {
      if (!currentAlbum) {
        currentAlbum = {
          albumId: message.groupedId,
          messages: [message],
          mainMessage: message,
          hasMultipleCaptions: false
        };
      } else {
        currentAlbum.messages.push(message);
        if (message.hasComments) {
          currentAlbum.commentsMessage = message;
        }
        if (message.content.text && !currentAlbum.hasMultipleCaptions) {
          if (currentAlbum.captionMessage) {
            currentAlbum.hasMultipleCaptions = true;
            currentAlbum.captionMessage = undefined;
          } else {
            currentAlbum.captionMessage = message;
          }
        }
      }
    } else if ((message.content.paidMedia?.extendedMedia.length || 0) > 1) {
      currentSenderGroup.push({
        albumId: `paid-${message.id}`,
        messages: [message],
        mainMessage: message,
        hasMultipleCaptions: false,
        isPaidMedia: true
      });
    } else {
      currentSenderGroup.push(message);
    }
    const nextMessage = messages[index + 1];
    if (currentAlbum && (!nextMessage || !nextMessage.groupedId || nextMessage.groupedId !== currentAlbum.albumId)) {
      currentSenderGroup.push(currentAlbum);
      currentAlbum = undefined;
    }
    const lastSenderGroupItem = currentSenderGroup[currentSenderGroup.length - 1];
    if (nextMessage) {
      const nextMessageDayStartsAt = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.getDayStartAt)(nextMessage.date * 1000);
      if (currentDateGroup.datetime !== nextMessageDayStartsAt) {
        currentDateGroup = {
          originalDate: nextMessage.date,
          datetime: nextMessageDayStartsAt,
          senderGroups: []
        };
        dateGroups.push(currentDateGroup);
        currentSenderGroup = [];
        currentDateGroup.senderGroups.push(currentSenderGroup);
      } else if (nextMessage.id === firstUnreadId || message.senderId !== nextMessage.senderId || message.isOutgoing !== nextMessage.isOutgoing || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.isActionMessage)(message) && !message.content.action?.phoneCall || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.isActionMessage)(nextMessage) && !nextMessage.content.action?.phoneCall || message.inlineButtons || nextMessage.inlineButtons || nextMessage.date - message.date > GROUP_INTERVAL_SECONDS || topMessageId && (message.id === topMessageId || lastSenderGroupItem && 'mainMessage' in lastSenderGroupItem && lastSenderGroupItem.mainMessage?.id === topMessageId) && nextMessage.id !== topMessageId || isChatWithSelf && message.forwardInfo?.fromId !== nextMessage.forwardInfo?.fromId) {
        currentSenderGroup = [];
        currentDateGroup.senderGroups.push(currentSenderGroup);
      }
    }
  });
  return dateGroups;
}

/***/ }),

/***/ "./src/components/middle/hooks/useContainerHeight.ts":
/*!***********************************************************!*\
  !*** ./src/components/middle/hooks/useContainerHeight.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useContainerHeight)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");



function useContainerHeight(containerRef, isComposerVisible) {
  const [getContainerHeight, setContainerHeight] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();

  // Container resize observer (caused by Composer reply/webpage panels)
  const handleResize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(entry => {
    setContainerHeight(entry.contentRect.height);
  });
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_2__["default"])(containerRef, handleResize);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const currentNormalHeight = Number(containerRef.current.dataset.normalHeight) || 0;
    const containerHeight = getContainerHeight();
    if (containerHeight && containerHeight > currentNormalHeight && isComposerVisible) {
      containerRef.current.dataset.normalHeight = String(containerHeight);
    }
  }, [isComposerVisible, containerRef, getContainerHeight]);
  const prevContainerHeight = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  return [getContainerHeight, prevContainerHeight];
}

/***/ }),

/***/ "./src/components/middle/hooks/useMessageObservers.ts":
/*!************************************************************!*\
  !*** ./src/components/middle/hooks/useMessageObservers.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMessageObservers)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");





const INTERSECTION_THROTTLE_FOR_READING = 150;
const INTERSECTION_THROTTLE_FOR_MEDIA = _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_ANDROID ? 1000 : 350;
function useMessageObservers(type, containerRef, memoFirstUnreadIdRef, onPinnedIntersectionChange, chatId) {
  const {
    markMessageListRead,
    markMentionsRead,
    animateUnreadReaction,
    scheduleForViewsIncrement
  } = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const INTERSECTION_MARGIN_FOR_LOADING = isMobile ? 300 : 500;
  const {
    observe: observeIntersectionForReading,
    freeze: freezeForReading,
    unfreeze: unfreezeForReading
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_READING
  }, entries => {
    if (type !== 'thread' || (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__.isBackgroundModeActive)()) {
      return;
    }
    let maxId = 0;
    const mentionIds = [];
    const reactionIds = [];
    const viewportPinnedIdsToAdd = [];
    const viewportPinnedIdsToRemove = [];
    const scheduledToUpdateViews = [];
    let isReversed = false;
    entries.forEach(entry => {
      const {
        isIntersecting,
        target,
        boundingClientRect,
        rootBounds
      } = entry;
      const {
        dataset
      } = target;
      const messageId = Number(dataset.lastMessageId || dataset.messageId);
      const shouldUpdateViews = dataset.shouldUpdateViews === 'true';
      const albumMainId = dataset.albumMainId ? Number(dataset.albumMainId) : undefined;
      if (!isIntersecting) {
        if (dataset.isPinned) {
          if (rootBounds && boundingClientRect.bottom < rootBounds.top) {
            isReversed = true;
          }
          viewportPinnedIdsToRemove.push(albumMainId || messageId);
        }
        return;
      }
      if (messageId > maxId) {
        maxId = messageId;
      }
      if (dataset.hasUnreadMention) {
        mentionIds.push(messageId);
      }
      if (dataset.hasUnreadReaction) {
        reactionIds.push(messageId);
      }
      if (dataset.isPinned) {
        viewportPinnedIdsToAdd.push(albumMainId || messageId);
      }
      if (shouldUpdateViews) {
        scheduledToUpdateViews.push(albumMainId || messageId);
      }
    });
    if (memoFirstUnreadIdRef.current && maxId >= memoFirstUnreadIdRef.current) {
      markMessageListRead({
        maxId
      });
    }
    if (mentionIds.length) {
      markMentionsRead({
        messageIds: mentionIds
      });
    }
    if (reactionIds.length) {
      animateUnreadReaction({
        messageIds: reactionIds
      });
    }
    if (viewportPinnedIdsToAdd.length || viewportPinnedIdsToRemove.length) {
      onPinnedIntersectionChange({
        viewportPinnedIdsToAdd,
        viewportPinnedIdsToRemove,
        isReversed
      });
    }
    if (scheduledToUpdateViews.length) {
      scheduleForViewsIncrement({
        chatId,
        ids: scheduledToUpdateViews
      });
    }
  });
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__["default"])(freezeForReading, unfreezeForReading);
  const {
    observe: observeIntersectionForLoading
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_MEDIA,
    margin: INTERSECTION_MARGIN_FOR_LOADING
  });
  const {
    observe: observeIntersectionForPlaying
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_MEDIA
  });
  return {
    observeIntersectionForReading,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  };
}

/***/ }),

/***/ "./src/components/middle/hooks/usePinnedMessage.ts":
/*!*********************************************************!*\
  !*** ./src/components/middle/hooks/usePinnedMessage.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePinnedMessage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_math__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/math */ "./src/util/math.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");







function usePinnedMessage(chatId, threadId, pinnedIds, topMessageId) {
  const [getCurrentPinnedIndexes, setCurrentPinnedIndexes] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)({});
  const [getForceNextPinnedInHeader, setForceNextPinnedInHeader] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();
  const viewportPinnedIdsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [getLoadingPinnedId, setLoadingPinnedId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();
  const key = chatId ? `${chatId}_${threadId}` : undefined;

  // Reset when switching chat
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setForceNextPinnedInHeader(undefined);
    viewportPinnedIdsRef.current = undefined;
    setLoadingPinnedId(undefined);
  }, [chatId, setCurrentPinnedIndexes, setForceNextPinnedInHeader, setLoadingPinnedId, threadId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!key) return;
    const currentPinnedIndex = getCurrentPinnedIndexes()[key];
    const pinnedLength = pinnedIds?.length || 0;
    if (currentPinnedIndex >= pinnedLength) {
      setCurrentPinnedIndexes({
        ...getCurrentPinnedIndexes(),
        [key]: Math.max(0, pinnedLength - 1)
      });
    }
  }, [getCurrentPinnedIndexes, key, pinnedIds?.length, setCurrentPinnedIndexes]);
  const onIntersectionChanged = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(_ref => {
    let {
      viewportPinnedIdsToAdd = [],
      viewportPinnedIdsToRemove = [],
      isReversed,
      hasScrolled,
      isUnmount
    } = _ref;
    if (!chatId || !threadId || !key) return;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const pinnedMessagesCount = pinnedIds?.length || 0;
    if (!pinnedMessagesCount || !pinnedIds) return;
    const waitingForPinnedId = getLoadingPinnedId();
    if (waitingForPinnedId && !hasScrolled) {
      const newPinnedIndex = pinnedIds.indexOf(waitingForPinnedId);
      setCurrentPinnedIndexes({
        ...getCurrentPinnedIndexes(),
        [key]: newPinnedIndex
      });
      setLoadingPinnedId(undefined);
    }
    if (hasScrolled) {
      setForceNextPinnedInHeader(undefined);
      setLoadingPinnedId(undefined);
    }
    const forceNextPinnedInHeader = getForceNextPinnedInHeader();
    const currentViewportPinnedIds = viewportPinnedIdsRef.current;

    // Unmounting the Message component will fire this action, and if we've already marked the pin as
    // outside the viewport, we don't need to do anything
    if (isUnmount && viewportPinnedIdsToAdd.length === 0 && viewportPinnedIdsToRemove.length === 1 && !currentViewportPinnedIds?.includes(viewportPinnedIdsToRemove[0])) {
      return;
    }
    const newPinnedViewportIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)((currentViewportPinnedIds?.filter(id => !viewportPinnedIdsToRemove.includes(id)) || []).concat(viewportPinnedIdsToAdd));
    viewportPinnedIdsRef.current = newPinnedViewportIds;
    const focusedMessageId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectFocusedMessageId)(global, chatId);
    // Focused to some non-pinned message
    if (!newPinnedViewportIds.length && isUnmount && focusedMessageId && !pinnedIds.includes(focusedMessageId)) {
      const firstPinnedIdAfterFocused = pinnedIds.find(id => id < focusedMessageId);
      if (firstPinnedIdAfterFocused) {
        const newIndex = pinnedIds.indexOf(firstPinnedIdAfterFocused);
        setCurrentPinnedIndexes({
          ...getCurrentPinnedIndexes(),
          [key]: newIndex
        });
      }
    }
    if (forceNextPinnedInHeader || isUnmount) {
      return;
    }
    const maxId = Math.max(...newPinnedViewportIds);
    const maxIdIndex = pinnedIds.findIndex(id => id === maxId);
    const delta = isReversed ? 0 : 1;
    const newIndex = newPinnedViewportIds.length ? maxIdIndex : currentViewportPinnedIds?.length ? (0,_util_math__WEBPACK_IMPORTED_MODULE_5__.clamp)(pinnedIds.indexOf(currentViewportPinnedIds[0]) + delta, 0, pinnedIds.length - 1) : 0;
    setCurrentPinnedIndexes({
      ...getCurrentPinnedIndexes(),
      [key]: newIndex
    });
  });
  const onFocusPinnedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(messageId => {
    if (!chatId || !threadId || !key || getLoadingPinnedId()) return false;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    if (!pinnedIds?.length) {
      // Focusing on a post in comments
      return topMessageId === messageId;
    }
    const index = pinnedIds.indexOf(messageId);
    const newPinnedIndex = (0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__["default"])(pinnedIds.length, index + 1);
    setForceNextPinnedInHeader(true);
    const listedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectListedIds)(global, chatId, threadId);
    const isMessageLoaded = listedIds?.includes(messageId) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectOutlyingListByMessageId)(global, chatId, threadId, messageId);
    if (isMessageLoaded) {
      setCurrentPinnedIndexes({
        ...getCurrentPinnedIndexes(),
        [key]: newPinnedIndex
      });
      return true;
    } else {
      setLoadingPinnedId(pinnedIds[newPinnedIndex]);
      return true;
    }
  });
  return {
    onIntersectionChanged,
    onFocusPinnedMessage,
    getCurrentPinnedIndexes,
    getLoadingPinnedId,
    getForceNextPinnedInHeader
  };
}

/***/ }),

/***/ "./src/components/middle/hooks/useScrollHooks.ts":
/*!*******************************************************!*\
  !*** ./src/components/middle/hooks/useScrollHooks.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useScrollHooks)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useSignalEffect */ "./src/hooks/useSignalEffect.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");











const FAB_THRESHOLD = 50;
const NOTCH_THRESHOLD = 1; // Notch has zero height so we at least need a 1px margin to intersect
const CONTAINER_HEIGHT_DEBOUNCE = 200;
const TOOLS_FREEZE_TIMEOUT = 350; // Approximate message sending animation duration

function useScrollHooks(type, containerRef, messageIds, getContainerHeight, isViewportNewest, isUnread, onScrollDownToggle, onNotchToggle, isReady) {
  const {
    loadViewportMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [loadMoreBackwards, loadMoreForwards] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => type === 'thread' ? [(0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.debounce)(() => loadViewportMessages({
    direction: _types__WEBPACK_IMPORTED_MODULE_2__.LoadMoreDirection.Backwards
  }), 1000, true, false), (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.debounce)(() => loadViewportMessages({
    direction: _types__WEBPACK_IMPORTED_MODULE_2__.LoadMoreDirection.Forwards
  }), 1000, true, false)] : [],
  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  [loadViewportMessages, messageIds]);

  // eslint-disable-next-line no-null/no-null
  const backwardsTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const forwardsTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const fabTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const toggleScrollTools = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!isReady) return;
    if (!messageIds?.length) {
      onScrollDownToggle(false);
      onNotchToggle(false);
      return;
    }
    if (!isViewportNewest) {
      onScrollDownToggle(true);
      onNotchToggle(true);
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const {
      offsetHeight,
      scrollHeight,
      scrollTop
    } = container;
    const scrollBottom = Math.round(scrollHeight - scrollTop - offsetHeight);
    const isNearBottom = scrollBottom <= FAB_THRESHOLD;
    const isAtBottom = scrollBottom <= NOTCH_THRESHOLD;
    if (scrollHeight === 0) return;
    onScrollDownToggle(isUnread ? !isAtBottom : !isNearBottom);
    onNotchToggle(!isAtBottom);
  });
  const {
    observe: observeIntersectionForHistory
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SENSITIVE_AREA
  }, entries => {
    if (!loadMoreForwards || !loadMoreBackwards) {
      return;
    }
    entries.forEach(_ref => {
      let {
        isIntersecting,
        target
      } = _ref;
      if (!isIntersecting) return;
      if (target.className === 'backwards-trigger') {
        loadMoreBackwards();
      }
      if (target.className === 'forwards-trigger') {
        loadMoreForwards();
      }
    });
  });
  const withHistoryTriggers = messageIds && messageIds.length > 1;
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(backwardsTriggerRef, withHistoryTriggers ? observeIntersectionForHistory : undefined);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(forwardsTriggerRef, withHistoryTriggers ? observeIntersectionForHistory : undefined);
  const {
    observe: observeIntersectionForFab,
    freeze: freezeForFab,
    unfreeze: unfreezeForFab
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: FAB_THRESHOLD * 2,
    throttleScheduler: _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMeasure
  }, toggleScrollTools);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(fabTriggerRef, observeIntersectionForFab);
  const {
    observe: observeIntersectionForNotch,
    freeze: freezeForNotch,
    unfreeze: unfreezeForNotch
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: NOTCH_THRESHOLD,
    throttleScheduler: _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMeasure
  }, toggleScrollTools);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(fabTriggerRef, observeIntersectionForNotch);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isReady) {
      toggleScrollTools();
    }
  }, [isReady, toggleScrollTools]);
  const freezeShortly = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    freezeForFab();
    freezeForNotch();
    setTimeout(() => {
      unfreezeForNotch();
      unfreezeForFab();
    }, TOOLS_FREEZE_TIMEOUT);
  });

  // Workaround for FAB and notch flickering with tall incoming message
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_10__["default"])(freezeShortly, [freezeShortly, messageIds]);

  // Workaround for notch flickering when opening Composer Embedded Message
  const getContainerHeightDebounced = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_6__.useDebouncedSignal)(getContainerHeight, CONTAINER_HEIGHT_DEBOUNCE);
  (0,_hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__.useSignalEffect)(freezeShortly, [freezeShortly, getContainerHeightDebounced]);
  return {
    withHistoryTriggers,
    backwardsTriggerRef,
    forwardsTriggerRef,
    fabTriggerRef
  };
}

/***/ }),

/***/ "./src/components/middle/hooks/useStickyDates.ts":
/*!*******************************************************!*\
  !*** ./src/components/middle/hooks/useStickyDates.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useStickyDates)
/* harmony export */ });
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");




const DEBOUNCE = 1000;
const STICKY_TOP = 10;
const STICKY_TOP_WITH_TOOLS = 60;
function useStickyDates() {
  // For some reason we can not synchronously hide a sticky element (from `useLayoutEffect`) when chat opens
  // so we will add `position: sticky` only after first scroll. There would be no animation on the first show though.
  const [isScrolled, markIsScrolled] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_1__["default"])(false);
  const runDebounced = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__["default"])(DEBOUNCE, true);
  const updateStickyDates = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])((container, hasTools) => {
    markIsScrolled();
    if (!document.body.classList.contains('is-scrolling-messages')) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
        document.body.classList.add('is-scrolling-messages');
      });
    }
    runDebounced(() => {
      const stuckDateEl = findStuckDate(container, hasTools);
      if (stuckDateEl) {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
          stuckDateEl.classList.add('stuck');
        });
      }
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
        const currentStuck = document.querySelector('.stuck');
        if (currentStuck) {
          currentStuck.classList.remove('stuck');
        }
        document.body.classList.remove('is-scrolling-messages');
      });
    });
  });
  return {
    isScrolled,
    updateStickyDates
  };
}
function findStuckDate(container, hasTools) {
  const allElements = container.querySelectorAll('.sticky-date');
  const containerTop = container.scrollTop;
  return Array.from(allElements).find(el => {
    const {
      offsetTop,
      offsetHeight
    } = el;
    const top = offsetTop - containerTop;
    return -offsetHeight <= top && top <= (hasTools ? STICKY_TOP_WITH_TOOLS : STICKY_TOP);
  });
}

/***/ }),

/***/ "./src/components/middle/message/Album.tsx":
/*!*************************************************!*\
  !*** ./src/components/middle/message/Album.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/calculateAlbumLayout */ "./src/components/middle/message/helpers/calculateAlbumLayout.ts");
/* harmony import */ var _hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./hocs/withSelectControl */ "./src/components/middle/message/hocs/withSelectControl.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _Album_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Album.scss */ "./src/components/middle/message/Album.scss");











const PhotoWithSelect = (0,_hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__["default"])(_Photo__WEBPACK_IMPORTED_MODULE_8__["default"]);
const VideoWithSelect = (0,_hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__["default"])(_Video__WEBPACK_IMPORTED_MODULE_9__["default"]);
const Album = _ref => {
  let {
    album,
    observeIntersection,
    hasCustomAppendix,
    isOwn,
    isProtected,
    albumLayout,
    onMediaClick,
    uploadsByKey,
    activeDownloads,
    theme
  } = _ref;
  const {
    cancelUploadMedia
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    content: {
      paidMedia
    }
  } = album.mainMessage;
  const mediaCount = album.isPaidMedia ? paidMedia.extendedMedia.length : album.messages.length;
  const handlePaidMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(index => {
    onMediaClick(album.mainMessage.id, index);
  });
  const handleAlbumMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(messageId => {
    onMediaClick(messageId);
  });
  const handleCancelUpload = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(messageId => {
    cancelUploadMedia({
      chatId: album.mainMessage.chatId,
      messageId
    });
  });
  const messages = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (album.isPaidMedia) {
      return album.mainMessage.content.paidMedia.extendedMedia.map(() => album.mainMessage);
    }
    return album.messages;
  }, [album]);
  function renderAlbumMessage(message, index) {
    const renderingPaidMedia = album.isPaidMedia ? message.content.paidMedia?.extendedMedia[index] : undefined;
    const paidPhotoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia ? renderingPaidMedia : renderingPaidMedia?.photo;
    const paidVideoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia ? renderingPaidMedia : renderingPaidMedia?.video;
    const photo = paidPhotoOrPreview || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessagePhoto)(message);
    const video = paidVideoOrPreview || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message).video;
    const fileUpload = uploadsByKey[(0,_util_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message)];
    const uploadProgress = fileUpload?.progress;
    const {
      dimensions,
      sides
    } = albumLayout.layout[index];

    // Ignoring global updates is a known drawback here
    const canAutoLoad = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAutoLoadMedia)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
    const canAutoPlay = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAutoPlayMedia)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
    if (photo) {
      const shouldAffectAppendix = hasCustomAppendix && (
      // eslint-disable-next-line no-bitwise
      isOwn ? index === mediaCount - 1 : Boolean(sides & _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__.AlbumRectPart.Left && sides & _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__.AlbumRectPart.Bottom));
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PhotoWithSelect, {
        id: `album-media-${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageHtmlId)(message.id, album.isPaidMedia ? index : undefined)}`,
        photo: photo,
        isOwn: isOwn,
        observeIntersectionForLoading: observeIntersection,
        canAutoLoad: canAutoLoad,
        shouldAffectAppendix: shouldAffectAppendix,
        uploadProgress: uploadProgress,
        dimensions: dimensions,
        isProtected: isProtected,
        clickArg: album.isPaidMedia ? index : message.id,
        onClick: album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick,
        onCancelUpload: handleCancelUpload,
        isDownloading: photo.mediaType !== 'extendedMediaPreview' && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getIsDownloading)(activeDownloads, photo),
        theme: theme
      });
    } else if (video) {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(VideoWithSelect, {
        id: `album-media-${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageHtmlId)(message.id)}`,
        video: video,
        observeIntersectionForLoading: observeIntersection,
        canAutoLoad: canAutoLoad,
        canAutoPlay: canAutoPlay,
        uploadProgress: uploadProgress,
        dimensions: dimensions,
        isProtected: isProtected,
        clickArg: album.isPaidMedia ? index : message.id,
        onClick: album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick,
        onCancelUpload: handleCancelUpload,
        isDownloading: video.mediaType !== 'extendedMediaPreview' && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getIsDownloading)(activeDownloads, video),
        theme: theme
      });
    }
    return undefined;
  }
  const {
    width: containerWidth,
    height: containerHeight
  } = albumLayout.containerStyle;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Album",
    style: `width: ${containerWidth}px; height: ${containerHeight}px;`
  }, messages.map(renderAlbumMessage));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTheme)(global);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectActiveDownloads)(global);
  return {
    theme,
    uploadsByKey: global.fileUploads.byMessageKey,
    activeDownloads
  };
})(Album));

/***/ }),

/***/ "./src/components/middle/message/AnimatedCustomEmoji.tsx":
/*!***************************************************************!*\
  !*** ./src/components/middle/message/AnimatedCustomEmoji.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../composer/helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/hooks/useAnimatedEmoji */ "./src/components/common/hooks/useAnimatedEmoji.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _AnimatedEmoji_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./AnimatedEmoji.scss */ "./src/components/middle/message/AnimatedEmoji.scss");









const AnimatedCustomEmoji = _ref => {
  let {
    isOwn,
    customEmojiId,
    messageId,
    chatId,
    activeEmojiInteractions,
    sticker,
    effect,
    soundId,
    noPlay,
    observeIntersection
  } = _ref;
  const {
    ref,
    size,
    style,
    handleClick
  } = (0,_common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji, (0,_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_5__.getCustomEmojiSize)(1));
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_7__["default"], {
    ref: ref,
    documentId: customEmojiId,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('AnimatedEmoji media-inner', sticker?.id === _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.LIKE_STICKER_ID && 'like-sticker-thumb'),
    style: style,
    size: size,
    isBig: true,
    noPlay: noPlay,
    withSharedAnimation: true,
    forceOnHeavyAnimation: Boolean(effect && activeEmojiInteractions?.length),
    observeIntersectionForLoading: observeIntersection,
    onClick: handleClick
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    customEmojiId,
    withEffects
  } = _ref2;
  const sticker = global.customEmojis.byId[customEmojiId];
  return {
    sticker,
    effect: sticker?.emoji && withEffects ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiEffect)(global, sticker.emoji) : undefined,
    soundId: sticker?.emoji && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiSound)(global, sticker.emoji),
    noPlay: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCanPlayAnimatedEmojis)(global)
  };
})(AnimatedCustomEmoji)));

/***/ }),

/***/ "./src/components/middle/message/AnimatedEmoji.tsx":
/*!*********************************************************!*\
  !*** ./src/components/middle/message/AnimatedEmoji.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/hooks/useAnimatedEmoji */ "./src/components/common/hooks/useAnimatedEmoji.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _AnimatedEmoji_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./AnimatedEmoji.scss */ "./src/components/middle/message/AnimatedEmoji.scss");









const QUALITY = 1;
const AnimatedEmoji = _ref => {
  let {
    isOwn,
    observeIntersection,
    forceLoadPreview,
    messageId,
    chatId,
    activeEmojiInteractions,
    sticker,
    effect,
    soundId
  } = _ref;
  const {
    ref,
    size,
    style,
    handleClick
  } = (0,_common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji);
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__.useIsIntersecting)(ref, observeIntersection);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__["default"], {
    sticker: sticker,
    size: size,
    quality: QUALITY,
    noLoad: !isIntersecting,
    forcePreview: forceLoadPreview,
    play: isIntersecting,
    forceAlways: true,
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('AnimatedEmoji media-inner', sticker?.id === _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.LIKE_STICKER_ID && 'like-sticker-thumb'),
    style: style,
    onClick: handleClick
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    emoji,
    withEffects
  } = _ref2;
  return {
    sticker: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmoji)(global, emoji),
    effect: withEffects ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiEffect)(global, emoji) : undefined,
    soundId: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiSound)(global, emoji)
  };
})(AnimatedEmoji)));

/***/ }),

/***/ "./src/components/middle/message/CommentButton.tsx":
/*!*********************************************************!*\
  !*** ./src/components/middle/message/CommentButton.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../right/hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _CommentButton_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./CommentButton.scss */ "./src/components/middle/message/CommentButton.scss");












const SHOW_LOADER_DELAY = 450;
const CommentButton = _ref => {
  let {
    isCustomShape,
    threadInfo,
    disabled,
    isLoading
  } = _ref;
  const {
    openThread
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const shouldRenderLoading = (0,_right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_7__["default"])([isLoading], SHOW_LOADER_DELAY);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    originMessageId,
    chatId,
    messagesCount,
    lastMessageId,
    lastReadInboxMessageId,
    recentReplierIds,
    originChannelId
  } = threadInfo;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openThread({
      isComments: true,
      chatId,
      originMessageId,
      originChannelId
    });
  });
  const recentRepliers = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!recentReplierIds?.length) {
      return undefined;
    }

    // No need for expensive global updates on chats and users, so we avoid them
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return recentReplierIds.map(peerId => {
      return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, peerId);
    }).filter(Boolean);
  }, [recentReplierIds]);
  if (messagesCount === undefined) {
    return undefined;
  }
  function renderRecentRepliers() {
    return Boolean(recentRepliers?.length) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "recent-repliers",
      dir: lang.isRtl ? 'rtl' : 'ltr'
    }, recentRepliers.map(peer => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_9__["default"], {
      key: peer.id,
      size: "small",
      peer: peer
    })));
  }
  const hasUnread = Boolean(lastReadInboxMessageId && lastMessageId && lastReadInboxMessageId < lastMessageId);
  const commentsText = messagesCount ? lang('CommentsCount', '%COMMENTS_COUNT%', undefined, messagesCount).split('%').map(s => {
    return s === 'COMMENTS_COUNT' ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__["default"], {
      text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(messagesCount)
    }) : s;
  }) : undefined;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    "data-cnt": (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(messagesCount),
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton', hasUnread && 'has-unread', disabled && 'disabled', isCustomShape && 'CommentButton-custom-shape', isLoading && 'loading'),
    dir: lang.isRtl ? 'rtl' : 'ltr',
    onClick: handleClick,
    role: "button",
    tabIndex: 0
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_icon-comments icon icon-comments-sticker', isLoading && shouldRenderLoading && 'CommentButton_hidden'),
    "aria-hidden": true
  }), !recentRepliers?.length && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-comments",
    "aria-hidden": true
  }), renderRecentRepliers(), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "label",
    dir: "auto"
  }, messagesCount ? commentsText : lang('LeaveAComment')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "CommentButton_right"
  }, isLoading && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_10__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_loading', !shouldRenderLoading && 'CommentButton_hidden'),
    color: isCustomShape ? 'white' : 'blue'
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_icon-open icon icon-next', isLoading && shouldRenderLoading && 'CommentButton_hidden'),
    "aria-hidden": true
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(CommentButton));

/***/ }),

/***/ "./src/components/middle/message/Contact.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/message/Contact.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_phoneNumber__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/phoneNumber */ "./src/util/phoneNumber.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Contact.module.scss */ "./src/components/middle/message/Contact.module.scss");












const UNREGISTERED_CONTACT_ID = '0';
const Contact = _ref => {
  let {
    contact,
    user,
    phoneCodeList,
    noUserColors
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    openChat,
    openAddContactDialog,
    showNotification,
    openChatWithInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    phoneNumber,
    userId
  } = contact;
  const isRegistered = userId !== UNREGISTERED_CONTACT_ID;
  const canAddContact = isRegistered && user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCanAddContact)(user);
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openChat({
      id: userId
    });
  });
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openAddContactDialog({
      userId: user?.id
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (user) {
      openChatWithInfo({
        id: userId
      });
    } else {
      (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_4__.copyTextToClipboard)(phoneNumber);
      showNotification({
        message: lang('PhoneCopied')
      });
    }
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_9__["default"], {
    noUserColors: noUserColors,
    peer: user,
    emojiIconClassName: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].emojiIconBackground,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].infoContainer,
    onClick: handleClick
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
    size: "large",
    peer: user,
    text: getContactName(contact)
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].info
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].name
  }, user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user) : getContactName(contact)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].phone
  }, (0,_util_phoneNumber__WEBPACK_IMPORTED_MODULE_5__.formatPhoneNumberWithCode)(phoneCodeList, phoneNumber)))), isRegistered && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].divider
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].buttons
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isText: true,
    color: "translucent",
    ripple: true,
    onClick: handleOpenChat,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].button
  }, lang('SharedContactMessage')), canAddContact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isText: true,
    color: "translucent",
    ripple: true,
    onClick: handleAddContact,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].button
  }, lang('SharedContactAdd')))));
};
function getContactName(contact) {
  if (contact.firstName && contact.lastName) {
    return `${contact.firstName} ${contact.lastName}`;
  }
  if (contact.firstName) {
    return contact.firstName;
  }
  if (contact.lastName) {
    return contact.lastName;
  }
  return '';
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    contact
  } = _ref2;
  const {
    countryList: {
      phoneCodes: phoneCodeList
    }
  } = global;
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, contact.userId);
  return {
    user,
    phoneCodeList
  };
})(Contact));

/***/ }),

/***/ "./src/components/middle/message/FactCheck.tsx":
/*!*****************************************************!*\
  !*** ./src/components/middle/message/FactCheck.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_element_useCollapsibleLines__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/element/useCollapsibleLines */ "./src/hooks/element/useCollapsibleLines.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./FactCheck.module.scss */ "./src/components/middle/message/FactCheck.module.scss");










const COLOR = {
  color: 0
};
const MAX_LINES = 4;
const FactCheck = _ref => {
  let {
    factCheck,
    isToggleDisabled
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const cutoutRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    isCollapsed,
    isCollapsible,
    setIsCollapsed
  } = (0,_hooks_element_useCollapsibleLines__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, MAX_LINES, cutoutRef);
  const countryLocalized = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!factCheck.countryCode || !lang.code) return undefined;
    const displayNames = new Intl.DisplayNames([lang.code], {
      type: 'region'
    });
    return displayNames.of(factCheck.countryCode);
  }, [factCheck.countryCode, lang.code]);
  const canExpand = !isToggleDisabled && isCollapsed;
  const handleExpand = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setIsCollapsed(false);
  });
  const handleToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setIsCollapsed(prev => !prev);
  });
  if (!factCheck.text) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_7__["default"], {
    peerColor: COLOR,
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root,
    onClick: canExpand ? handleExpand : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: cutoutRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].cutoutWrapper, isCollapsed && _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].collapsed)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].title
  }, lang('FactCheck')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].content
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)({
    text: factCheck.text.text,
    entities: factCheck.text.entities
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Separator__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].separator
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].footnote
  }, lang('FactCheckFooter', countryLocalized))), isCollapsible && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].collapseIcon, !isToggleDisabled && _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].clickable),
    onClick: !isToggleDisabled ? handleToggle : undefined,
    "aria-hidden": true
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: isCollapsed ? 'down' : 'up'
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(FactCheck));

/***/ }),

/***/ "./src/components/middle/message/Game.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/message/Game.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Game_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Game.scss */ "./src/components/middle/message/Game.scss");






const DEFAULT_PREVIEW_DIMENSIONS = {
  width: 480,
  height: 270
};
const Game = _ref => {
  let {
    message,
    canAutoLoadMedia
  } = _ref;
  const {
    clickBotInlineButton
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const game = message.content.game;
  const {
    title,
    description
  } = game;
  const photoHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getGamePreviewPhotoHash)(game);
  const videoHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getGamePreviewVideoHash)(game);
  const photoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(photoHash, !canAutoLoadMedia);
  const videoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(videoHash, !canAutoLoadMedia);
  const handleGameClick = () => {
    clickBotInlineButton({
      messageId: message.id,
      button: message.inlineButtons[0][0]
    });
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Game"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "preview",
    style: `width: ${DEFAULT_PREVIEW_DIMENSIONS.width}px; height: ${DEFAULT_PREVIEW_DIMENSIONS.height}px`,
    onClick: handleGameClick
  }, !photoBlobUrl && !videoBlobUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_4__["default"], {
    className: "skeleton preview-content"
  }), photoBlobUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "preview-content",
    src: photoBlobUrl,
    alt: title,
    draggable: false
  }), videoBlobUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("video", {
    className: "preview-content",
    playsInline: true,
    muted: true,
    disablePictureInPicture: true,
    autoPlay: true,
    loop: true,
    src: videoBlobUrl
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title"
  }, title), !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageText)(message) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "description"
  }, description));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Game));

/***/ }),

/***/ "./src/components/middle/message/Giveaway.tsx":
/*!****************************************************!*\
  !*** ./src/components/middle/message/Giveaway.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_emoji_emoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/emoji/emoji */ "./src/util/emoji/emoji.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PickerSelectedItem */ "./src/components/common/PickerSelectedItem.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./Giveaway.module.scss */ "./src/components/middle/message/Giveaway.module.scss");




















const NBSP = '\u00A0';
const GIFT_STICKER_SIZE = 175;
const RESULT_STICKER_SIZE = 150;
const Giveaway = _ref => {
  let {
    chat,
    sender,
    message,
    canPlayAnimatedEmojis,
    giftSticker
  } = _ref;
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isLoadingInfo = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [giveawayInfo, setGiveawayInfo] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    giveaway,
    giveawayResults
  } = message.content;
  const isResults = Boolean(giveawayResults);
  const {
    months,
    untilDate,
    prizeDescription
  } = giveaway || giveawayResults;
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isOwnMessage)(message);
  const quantity = isResults ? giveawayResults.winnersCount : giveaway.quantity;
  const hasEnded = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)() > untilDate;
  const countryList = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isResults) return undefined;
    const translatedNames = new Intl.DisplayNames([lang.code, 'en'].filter(Boolean), {
      type: 'region'
    });
    return giveaway?.countries?.map(countryCode => `${(0,_util_emoji_emoji__WEBPACK_IMPORTED_MODULE_6__.isoToEmoji)(countryCode)}${NBSP}${translatedNames.of(countryCode)}`).join(', ');
  }, [giveaway, isResults, lang.code]);
  const handlePeerClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(channelId => {
    openChat({
      id: channelId
    });
  });
  const handleShowInfoClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(async () => {
    if (isLoadingInfo.current) return;
    isLoadingInfo.current = true;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchGiveawayInfo', {
      peer: chat,
      messageId: message.id
    });
    setGiveawayInfo(result);
    isLoadingInfo.current = false;
  });
  const handleCloseInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setGiveawayInfo(undefined);
  });
  const giveawayInfoTitle = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!giveawayInfo) return undefined;
    return lang(giveawayInfo.type === 'results' ? 'BoostingGiveawayEnd' : 'BoostingGiveAwayAbout');
  }, [giveawayInfo, lang]);
  function renderGiveawayDescription(media) {
    const channelIds = media.channelIds;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayPrizes'), ['simple_markdown'])), prizeDescription && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayMsgPrizes', [quantity, prizeDescription], undefined, quantity), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Separator__WEBPACK_IMPORTED_MODULE_18__["default"], null, lang('BoostingGiveawayMsgWithDivider'))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('Chat.Giveaway.Info.Subscriptions', quantity), ['simple_markdown']), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("br", null), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('ActionGiftPremiumSubtitle', lang('Chat.Giveaway.Info.Months', months)), ['simple_markdown']))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayMsgParticipants'), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayMsgAllSubsPlural', channelIds.length), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].peers
    }, channelIds.map(peerId => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
      peerId: peerId,
      forceShowSelf: true,
      fluid: true,
      withPeerColors: !isOwn,
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].peer,
      clickArg: peerId,
      onClick: handlePeerClick
    }))), countryList && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('Chat.Giveaway.Message.CountriesFrom', countryList)))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingWinnersDate'), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatDateTimeToString)(untilDate * 1000, lang.code, true))));
  }
  function renderGiveawayResultsDescription(media) {
    const winnerIds = media.winnerIds;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayResultsMsgWinnersSelected'), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lang('BoostingGiveawayResultsMsgWinnersTitle', winnerIds.length), ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].title
    }, lang('lng_prizes_results_winners')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].peers
    }, winnerIds.map(peerId => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PickerSelectedItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
      peerId: peerId,
      forceShowSelf: true,
      fluid: true,
      withPeerColors: !isOwn,
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].peer,
      clickArg: peerId,
      onClick: handlePeerClick
    })))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description
    }, lang('BoostingGiveawayResultsMsgAllWinnersReceivedLinks'))));
  }
  function renderGiveawayInfo() {
    if (!sender || !giveawayInfo) return undefined;
    const isResultsInfo = giveawayInfo.type === 'results';
    const chatTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isApiPeerChat)(sender) ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, sender) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(sender);
    const duration = lang('Chat.Giveaway.Info.Months', months);
    const endDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatDateAtTime)(lang, untilDate * 1000);
    const otherChannelsCount = giveaway?.channelIds ? giveaway.channelIds.length - 1 : 0;
    const otherChannelsString = lang('Chat.Giveaway.Info.OtherChannels', otherChannelsCount);
    const isSeveral = otherChannelsCount > 0;
    const firstKey = isResultsInfo ? 'BoostingGiveawayHowItWorksTextEnd' : 'BoostingGiveawayHowItWorksText';
    const firstParagraph = lang(firstKey, [chatTitle, quantity, duration], undefined, quantity);
    const additionalPrizes = prizeDescription ? lang('BoostingGiveawayHowItWorksIncludeText', [chatTitle, quantity, prizeDescription], undefined, quantity) : undefined;
    let secondKey = '';
    if (isResultsInfo) {
      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveralEnd' : 'BoostingGiveawayHowItWorksSubTextEnd';
    } else {
      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveral' : 'BoostingGiveawayHowItWorksSubText';
    }
    let secondParagraph = lang(secondKey, [endDate, quantity, chatTitle, otherChannelsCount], undefined, quantity);
    if (isResultsInfo && giveawayInfo.activatedCount) {
      secondParagraph += ` ${lang('BoostingGiveawayUsedLinksPlural', giveawayInfo.activatedCount)}`;
    }
    let result = '';
    if (isResultsInfo) {
      if (giveawayInfo.isRefunded) {
        result = lang('BoostingGiveawayCanceledByPayment');
      } else {
        result = lang(giveawayInfo.isWinner ? 'BoostingGiveawayYouWon' : 'BoostingGiveawayYouNotWon');
      }
    }
    let lastParagraph = '';
    if (isResultsInfo) {
      // Nothing
    } else if (giveawayInfo.disallowedCountry) {
      lastParagraph = lang('BoostingGiveawayNotEligibleCountry');
    } else if (giveawayInfo.adminDisallowedChatId) {
      // Since rerenders are not expected, we can use the global state directly
      const chatsById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chats.byId;
      const disallowedChat = chatsById[giveawayInfo.adminDisallowedChatId];
      const disallowedChatTitle = disallowedChat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, disallowedChat);
      lastParagraph = lang('BoostingGiveawayNotEligibleAdmin', disallowedChatTitle);
    } else if (giveawayInfo.joinedTooEarlyDate) {
      const joinedTooEarlyDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatDateAtTime)(lang, giveawayInfo.joinedTooEarlyDate * 1000);
      lastParagraph = lang('BoostingGiveawayNotEligible', joinedTooEarlyDate);
    } else if (giveawayInfo.isParticipating) {
      lastParagraph = isSeveral ? lang('Chat.Giveaway.Info.ParticipatingMany', [chatTitle, otherChannelsCount]) : lang('Chat.Giveaway.Info.Participating', chatTitle);
    } else {
      lastParagraph = isSeveral ? lang('Chat.Giveaway.Info.NotQualifiedMany', [chatTitle, otherChannelsString, endDate]) : lang('Chat.Giveaway.Info.NotQualified', [chatTitle, endDate]);
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, result && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].result
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(result, ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(firstParagraph, ['simple_markdown'])), additionalPrizes && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(additionalPrizes, ['simple_markdown'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(secondParagraph, ['simple_markdown'])), lastParagraph && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(lastParagraph, ['simple_markdown'])));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].root
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].sticker, isResults && _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].resultSticker)
  }, isResults ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: RESULT_STICKER_SIZE,
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_9__.LOCAL_TGS_URLS.PartyPopper,
    nonInteractive: true,
    noLoop: true
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_13__["default"], {
    sticker: giftSticker,
    play: canPlayAnimatedEmojis && hasEnded,
    noLoop: true,
    nonInteractive: true,
    size: GIFT_STICKER_SIZE
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].count
  }, `x${quantity}`)), isResults ? renderGiveawayResultsDescription(giveawayResults) : renderGiveawayDescription(giveaway), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_16__["default"], {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].button,
    color: "adaptive",
    size: "smaller",
    onClick: handleShowInfoClick
  }, lang('BoostingHowItWork')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_17__["default"], {
    isOpen: Boolean(giveawayInfo),
    isOnlyConfirm: true,
    title: giveawayInfoTitle,
    confirmHandler: handleCloseInfo,
    onClose: handleCloseInfo
  }, renderGiveawayInfo()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    message
  } = _ref2;
  const {
    giveaway
  } = message.content;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, message.chatId);
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, giveaway?.channelIds[0]) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectForwardedSender)(global, message) || chat;
  const sticker = giveaway && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectGiftStickerForDuration)(global, giveaway.months);
  return {
    chat,
    sender,
    giftSticker: sticker,
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanPlayAnimatedEmojis)(global)
  };
})(Giveaway)));

/***/ }),

/***/ "./src/components/middle/message/InlineButtons.tsx":
/*!*********************************************************!*\
  !*** ./src/components/middle/message/InlineButtons.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../composer/helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _InlineButtons_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./InlineButtons.scss */ "./src/components/middle/message/InlineButtons.scss");







const InlineButtons = _ref => {
  let {
    message,
    onClick
  } = _ref;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const renderIcon = button => {
    const {
      type
    } = button;
    switch (type) {
      case 'url':
        {
          if (!_config__WEBPACK_IMPORTED_MODULE_1__.RE_TME_LINK.test(button.url)) {
            return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
              className: "corner-icon",
              name: "arrow-right"
            });
          }
          break;
        }
      case 'urlAuth':
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "arrow-right"
        });
      case 'buy':
      case 'receipt':
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "card"
        });
      case 'switchBotInline':
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "share-filled"
        });
      case 'webView':
      case 'simpleWebView':
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "webapp"
        });
    }
    return undefined;
  };
  const buttonTexts = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const texts = [];
    message.inlineButtons.forEach(row => {
      texts.push(row.map(button => (0,_composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_2__["default"])(lang, button)));
    });
    return texts;
  }, [lang, message.inlineButtons]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "InlineButtons"
  }, message.inlineButtons.map((row, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "row"
  }, row.map((button, j) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    size: "tiny",
    ripple: true,
    disabled: button.type === 'unsupported'
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClick: () => onClick({
      messageId: message.id,
      button
    })
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "inline-button-text"
  }, buttonTexts[i][j]), renderIcon(button))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InlineButtons));

/***/ }),

/***/ "./src/components/middle/message/Invoice.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/message/Invoice.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/getCustomAppendixBg */ "./src/components/middle/message/helpers/getCustomAppendixBg.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./hooks/useBlurredMediaThumbRef */ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Invoice_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Invoice.scss */ "./src/components/middle/message/Invoice.scss");














const Invoice = _ref => {
  let {
    message,
    shouldAffectAppendix,
    isInSelectMode,
    isSelected,
    theme,
    forcedWidth
  } = _ref;
  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const invoice = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageInvoice)(message);
  const {
    title,
    text,
    amount,
    currency,
    isTest,
    photo
  } = invoice;
  const photoUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_9__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getWebDocumentHash)(photo));
  const withBlurredBackground = Boolean(forcedWidth);
  const blurredBackgroundRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_11__["default"])(photoUrl, !withBlurredBackground);
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_8__["default"])(_ref2 => {
    let [prevShouldAffectAppendix] = _ref2;
    if (!shouldAffectAppendix) {
      if (prevShouldAffectAppendix) {
        ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_CONTENT_SELECTOR).removeAttribute(_config__WEBPACK_IMPORTED_MODULE_1__.CUSTOM_APPENDIX_ATTRIBUTE);
      }
      return;
    }
    if (photoUrl) {
      const contentEl = ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_CONTENT_SELECTOR);
      (0,_helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_7__["default"])(photoUrl, false, isSelected, theme).then(appendixBg => {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
          contentEl.style.setProperty('--appendix-bg', appendixBg);
          contentEl.setAttribute(_config__WEBPACK_IMPORTED_MODULE_1__.CUSTOM_APPENDIX_ATTRIBUTE, '');
        });
      });
    }
  }, [shouldAffectAppendix, photoUrl, isInSelectMode, isSelected, theme]);
  const width = forcedWidth || photo?.dimensions?.width;
  const style = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(photo?.dimensions && `width: ${width}px`, photo?.dimensions && `aspect-ratio: ${photo.dimensions.width} / ${photo.dimensions.height}`, Boolean(!photo?.dimensions && forcedWidth) && `width: ${forcedWidth}px`);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: "Invoice"
  }, title && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "title"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(title)), text && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(text, ['emoji', 'br'])), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `description ${photo ? 'has-image' : ''}`
  }, Boolean(photo) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "invoice-image-container"
  }, withBlurredBackground && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: blurredBackgroundRef,
    className: "thumbnail blurred-bg"
  }), photoUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "invoice-image",
    src: photoUrl,
    alt: "",
    style: style,
    crossOrigin: "anonymous",
    draggable: false
  }), !photoUrl && photo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_12__["default"], {
    width: width,
    height: photo.dimensions?.height,
    forceAspectRatio: true
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description-text"
  }, (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrency)(amount, currency, lang.code, {
    iconClassName: 'invoice-currency-icon'
  }), isTest && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "test-invoice"
  }, lang('PaymentTestInvoice')))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Invoice));

/***/ }),

/***/ "./src/components/middle/message/InvoiceMediaPreview.tsx":
/*!***************************************************************!*\
  !*** ./src/components/middle/message/InvoiceMediaPreview.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./InvoiceMediaPreview.module.scss */ "./src/components/middle/message/InvoiceMediaPreview.module.scss");











const POLLING_INTERVAL = 30000;
const InvoiceMediaPreview = _ref => {
  let {
    message,
    isConnected
  } = _ref;
  const {
    openInvoice,
    loadExtendedMedia
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const invoice = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageInvoice)(message);
  const {
    chatId,
    id
  } = message;
  const refreshExtendedMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    loadExtendedMedia({
      chatId,
      ids: [id]
    });
  });
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__["default"])(refreshExtendedMedia, isConnected ? POLLING_INTERVAL : undefined);
  const {
    amount,
    currency,
    extendedMedia
  } = invoice;
  const {
    width,
    height,
    thumbnail,
    duration
  } = extendedMedia;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openInvoice({
      type: 'message',
      chatId,
      messageId: id,
      isExtendedMedia: true
    });
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, 'media-inner'),
    onClick: handleClick
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_9__["default"], {
    thumbDataUri: thumbnail?.dataUri,
    width: width,
    height: height,
    isVisible: true,
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].spoiler
  }), Boolean(duration) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].duration
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatMediaDuration)(duration)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].buy
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('icon', 'icon-lock', _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].lock)
  }), lang('Checkout.PayPrice', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrencyAsString)(amount, currency))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InvoiceMediaPreview));

/***/ }),

/***/ "./src/components/middle/message/Location.tsx":
/*!****************************************************!*\
  !*** ./src/components/middle/message/Location.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_map__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/map */ "./src/util/map.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/window/useDevicePixelRatio */ "./src/hooks/window/useDevicePixelRatio.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Location_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./Location.scss */ "./src/components/middle/message/Location.scss");
/* harmony import */ var _assets_map_pin_svg__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../assets/map-pin.svg */ "./src/assets/map-pin.svg");




















const TIMER_RADIUS = 12;
const TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;
const MOVE_THRESHOLD = 0.0001; // ~11m
const DEFAULT_MAP_CONFIG = {
  width: 400,
  height: 300,
  zoom: 16
};
const Location = _ref => {
  let {
    message,
    peer
  } = _ref;
  const {
    openMapModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const countdownRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const location = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageLocation)(message);
  const {
    mediaType,
    geo
  } = location;
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)();
  const isExpired = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isGeoLiveExpired)(message);
  const secondsBeforeEnd = mediaType === 'geoLive' && !isExpired ? message.date + location.period - serverTime : undefined;
  const [point, setPoint] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(geo);
  const shouldRenderText = mediaType === 'venue' || mediaType === 'geoLive' && !isExpired;
  const {
    width,
    height,
    zoom
  } = DEFAULT_MAP_CONFIG;
  const dpr = (0,_hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const mediaHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.buildStaticMapHash)(point, width, height, zoom, dpr);
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__["default"])(mediaHash);
  const prevMediaBlobUrl = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_14__["default"])(mediaBlobUrl, true);
  const mapBlobUrl = mediaBlobUrl || prevMediaBlobUrl;
  const accuracyRadiusPx = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (mediaType !== 'geoLive' || !point.accuracyRadius) {
      return 0;
    }
    const {
      lat,
      accuracyRadius
    } = point;
    return accuracyRadius / (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getMetersPerPixel)(lat, zoom);
  }, [mediaType, point, zoom]);
  const handleClick = () => {
    openMapModal({
      geoPoint: point,
      zoom
    });
  };
  const updateCountdown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(countdownEl => {
    if (mediaType !== 'geoLive') return;
    const svgEl = countdownEl.lastElementChild;
    const timerEl = countdownEl.firstElementChild;
    const timeLeft = message.date + location.period - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)();
    const strokeDashOffset = (1 - timeLeft / location.period) * TIMER_CIRCUMFERENCE;
    const text = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatCountdownShort)(lang, timeLeft * 1000);
    timerEl.textContent = text;
    svgEl.firstElementChild.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (countdownRef.current) {
      updateCountdown(countdownRef.current);
    }
  }, [updateCountdown]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // Prevent map refetching for slight location changes
    if (Math.abs(geo.lat - point.lat) < MOVE_THRESHOLD && Math.abs(geo.long - point.long) < MOVE_THRESHOLD) {
      if (point.accuracyRadius !== geo.accuracyRadius) {
        setPoint({
          ...point,
          accuracyRadius: geo.accuracyRadius
        });
      }
      return;
    }
    setPoint(geo);
  }, [geo, point]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    forceUpdate();
  }, !isExpired ? (secondsBeforeEnd || 0) * 1000 : undefined);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
      const countdownEl = countdownRef.current;
      if (countdownEl) {
        updateCountdown(countdownEl);
      }
    });
  }, secondsBeforeEnd ? 1000 : undefined);
  function renderInfo() {
    if (!shouldRenderText) return undefined;
    if (mediaType === 'venue') {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info"
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-title"
      }, location.title), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-subtitle"
      }, location.address));
    }
    if (mediaType === 'geoLive') {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info"
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-title"
      }, lang('AttachLiveLocation')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-subtitle"
      }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatLastUpdated)(lang, serverTime, message.editDate)), !isExpired && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "geo-countdown",
        ref: countdownRef
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "geo-countdown-text"
      }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
        width: "32px",
        height: "32px"
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
        cx: "16",
        cy: "16",
        r: TIMER_RADIUS,
        className: "geo-countdown-progress",
        transform: "rotate(-90, 16, 16)",
        "stroke-dasharray": TIMER_CIRCUMFERENCE,
        "stroke-dashoffset": "0"
      }))));
    }
    return undefined;
  }
  function renderMap() {
    if (!mapBlobUrl) return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_17__["default"], {
      width: width,
      height: height
    });
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: "full-media map",
      src: mapBlobUrl,
      alt: "Location on a map",
      draggable: false,
      style: `width: ${DEFAULT_MAP_CONFIG.width}px; height: ${DEFAULT_MAP_CONFIG.height}px;`
    });
  }
  function renderPin() {
    const pinClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('pin', mediaType, isExpired && 'expired');
    if (mediaType === 'geoLive') {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: pinClassName
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PinSvg, null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
        peer: peer,
        className: "location-avatar"
      }), location.heading !== undefined && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "direction",
        style: `--direction: ${location.heading}deg`
      }));
    }
    if (mediaType === 'venue') {
      const color = (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getVenueColor)(location.venueType);
      const iconSrc = (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getVenueIconUrl)(location.venueType);
      if (iconSrc) {
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: pinClassName,
          style: `--pin-color: ${color}`
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PinSvg, null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
          src: iconSrc,
          draggable: false,
          className: "venue-icon",
          alt: ""
        }));
      }
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: pinClassName,
      draggable: false,
      src: _assets_map_pin_svg__WEBPACK_IMPORTED_MODULE_19__,
      alt: ""
    });
  }
  function renderOverlay() {
    if (!mapBlobUrl) return undefined;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, Boolean(accuracyRadiusPx) && !isExpired && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "location-accuracy",
      style: `width: ${accuracyRadiusPx * 2}px; height: ${accuracyRadiusPx * 2}px`
    }), renderPin());
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: "Location media-inner interactive",
    onClick: handleClick
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "map-wrapper"
  }, renderMap(), renderOverlay()), renderInfo());
};
function PinSvg() {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "round-pin",
    style: "enable-background:new 0 0 64 64",
    viewBox: "0 0 64 64"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
    cx: "32",
    cy: "32",
    r: "24.5"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M32 8c13.23 0 24 10.77 24 24S45.23 56 32 56 8 45.23 8 32 18.77 8 32 8m0-1C18.19 7 7 18.19 7 32s11.19 25 25 25 25-11.19 25-25S45.81 7 32 7z"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "m29.38 57.67-1.98-1.59 3.02-1.66L32 51.54l1.58 2.88 3.02 1.66-1.91 1.53L32 60.73z"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "m32 52.58 1.07 1.95.14.26.26.14 2.24 1.22-1.33 1.06-.07.06-.06.07L32 59.96l-2.24-2.61-.06-.07-.07-.06-1.33-1.06 2.24-1.22.26-.14.14-.26L32 52.58m0-2.08-1.94 3.56L26.5 56l2.5 2 3 3.5 3-3.5 2.5-2-3.56-1.94L32 50.5z"
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Location));

/***/ }),

/***/ "./src/components/middle/message/Message.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/message/Message.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_replies__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_isElementInViewport__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/isElementInViewport */ "./src/util/isElementInViewport.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../composer/helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _helpers_buildContentClassName__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./helpers/buildContentClassName */ "./src/components/middle/message/helpers/buildContentClassName.ts");
/* harmony import */ var _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./helpers/calculateAlbumLayout */ "./src/components/middle/message/helpers/calculateAlbumLayout.ts");
/* harmony import */ var _helpers_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./helpers/getSingularPaidMedia */ "./src/components/middle/message/helpers/getSingularPaidMedia.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../hooks/useHeavyAnimationCheck */ "./src/hooks/useHeavyAnimationCheck.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useTextLanguage__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../../../hooks/useTextLanguage */ "./src/hooks/useTextLanguage.ts");
/* harmony import */ var _hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../../../hooks/useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");
/* harmony import */ var _hooks_useDetectChatLanguage__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./hooks/useDetectChatLanguage */ "./src/components/middle/message/hooks/useDetectChatLanguage.ts");
/* harmony import */ var _hooks_useFocusMessage__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./hooks/useFocusMessage */ "./src/components/middle/message/hooks/useFocusMessage.ts");
/* harmony import */ var _hooks_useInnerHandlers__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./hooks/useInnerHandlers */ "./src/components/middle/message/hooks/useInnerHandlers.ts");
/* harmony import */ var _hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./hooks/useMessageTranslation */ "./src/components/middle/message/hooks/useMessageTranslation.ts");
/* harmony import */ var _hooks_useOuterHandlers__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./hooks/useOuterHandlers */ "./src/components/middle/message/hooks/useOuterHandlers.ts");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_DotAnimation__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../../common/DotAnimation */ "./src/components/common/DotAnimation.tsx");
/* harmony import */ var _common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../../common/embedded/EmbeddedMessage */ "./src/components/common/embedded/EmbeddedMessage.tsx");
/* harmony import */ var _common_embedded_EmbeddedStory__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../../common/embedded/EmbeddedStory */ "./src/components/common/embedded/EmbeddedStory.tsx");
/* harmony import */ var _common_FakeIcon__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../../common/FakeIcon */ "./src/components/common/FakeIcon.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_MessageText__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ../../common/MessageText */ "./src/components/common/MessageText.tsx");
/* harmony import */ var _common_ReactionStaticEmoji__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ../../common/ReactionStaticEmoji */ "./src/components/common/ReactionStaticEmoji.tsx");
/* harmony import */ var _common_TopicChip__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ../../common/TopicChip */ "./src/components/common/TopicChip.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _Album__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./Album */ "./src/components/middle/message/Album.tsx");
/* harmony import */ var _AnimatedCustomEmoji__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./AnimatedCustomEmoji */ "./src/components/middle/message/AnimatedCustomEmoji.tsx");
/* harmony import */ var _AnimatedEmoji__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./AnimatedEmoji */ "./src/components/middle/message/AnimatedEmoji.tsx");
/* harmony import */ var _CommentButton__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./CommentButton */ "./src/components/middle/message/CommentButton.tsx");
/* harmony import */ var _Contact__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./Contact */ "./src/components/middle/message/Contact.tsx");
/* harmony import */ var _ContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./ContextMenuContainer.async */ "./src/components/middle/message/ContextMenuContainer.async.tsx");
/* harmony import */ var _FactCheck__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./FactCheck */ "./src/components/middle/message/FactCheck.tsx");
/* harmony import */ var _Game__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./Game */ "./src/components/middle/message/Game.tsx");
/* harmony import */ var _Giveaway__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./Giveaway */ "./src/components/middle/message/Giveaway.tsx");
/* harmony import */ var _InlineButtons__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./InlineButtons */ "./src/components/middle/message/InlineButtons.tsx");
/* harmony import */ var _Invoice__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ./Invoice */ "./src/components/middle/message/Invoice.tsx");
/* harmony import */ var _InvoiceMediaPreview__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! ./InvoiceMediaPreview */ "./src/components/middle/message/InvoiceMediaPreview.tsx");
/* harmony import */ var _Location__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ./Location */ "./src/components/middle/message/Location.tsx");
/* harmony import */ var _MessageAppendix__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! ./MessageAppendix */ "./src/components/middle/message/MessageAppendix.tsx");
/* harmony import */ var _MessageEffect__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! ./MessageEffect */ "./src/components/middle/message/MessageEffect.tsx");
/* harmony import */ var _MessageMeta__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(/*! ./MessageMeta */ "./src/components/middle/message/MessageMeta.tsx");
/* harmony import */ var _MessagePhoneCall__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(/*! ./MessagePhoneCall */ "./src/components/middle/message/MessagePhoneCall.tsx");
/* harmony import */ var _PaidMediaOverlay__WEBPACK_IMPORTED_MODULE_72__ = __webpack_require__(/*! ./PaidMediaOverlay */ "./src/components/middle/message/PaidMediaOverlay.tsx");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_73__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _Poll__WEBPACK_IMPORTED_MODULE_74__ = __webpack_require__(/*! ./Poll */ "./src/components/middle/message/Poll.tsx");
/* harmony import */ var _reactions_Reactions__WEBPACK_IMPORTED_MODULE_75__ = __webpack_require__(/*! ./reactions/Reactions */ "./src/components/middle/message/reactions/Reactions.tsx");
/* harmony import */ var _RoundVideo__WEBPACK_IMPORTED_MODULE_76__ = __webpack_require__(/*! ./RoundVideo */ "./src/components/middle/message/RoundVideo.tsx");
/* harmony import */ var _Sticker__WEBPACK_IMPORTED_MODULE_77__ = __webpack_require__(/*! ./Sticker */ "./src/components/middle/message/Sticker.tsx");
/* harmony import */ var _Story__WEBPACK_IMPORTED_MODULE_78__ = __webpack_require__(/*! ./Story */ "./src/components/middle/message/Story.tsx");
/* harmony import */ var _StoryMention__WEBPACK_IMPORTED_MODULE_79__ = __webpack_require__(/*! ./StoryMention */ "./src/components/middle/message/StoryMention.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_80__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _WebPage__WEBPACK_IMPORTED_MODULE_81__ = __webpack_require__(/*! ./WebPage */ "./src/components/middle/message/WebPage.tsx");
/* harmony import */ var _Message_scss__WEBPACK_IMPORTED_MODULE_82__ = __webpack_require__(/*! ./Message.scss */ "./src/components/middle/message/Message.scss");



















































































const NBSP = '\u00A0';
const APPEARANCE_DELAY = 10;
const NO_MEDIA_CORNERS_THRESHOLD = 18;
const QUICK_REACTION_SIZE = 1.75 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__.REM;
const EXTRA_SPACE_FOR_REACTIONS = 2.25 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__.REM;
const BOTTOM_FOCUS_SCROLL_THRESHOLD = 5;
const THROTTLE_MS = 300;
const RESIZE_ANIMATION_DURATION = 400;
const Message = _ref => {
  let {
    message,
    observeIntersectionForBottom,
    observeIntersectionForLoading,
    observeIntersectionForPlaying,
    album,
    noAvatars,
    withAvatar,
    withSenderName,
    noComments,
    noReplies,
    appearanceOrder,
    isJustAdded,
    isFirstInGroup,
    isPremium,
    isLastInGroup,
    isFirstInDocumentGroup,
    isLastInDocumentGroup,
    isTranscribing,
    transcribedText,
    isLastInList,
    theme,
    forceSenderName,
    sender,
    canShowSender,
    originSender,
    botSender,
    isThreadTop,
    shouldHideReply,
    replyMessage,
    replyMessageSender,
    replyMessageForwardSender,
    replyMessageChat,
    replyStory,
    isReplyPrivate,
    storySender,
    outgoingStatus,
    uploadProgress,
    isInDocumentGroup,
    isLoadingComments,
    isProtected,
    isChatProtected,
    isFocused,
    focusDirection,
    focusedQuote,
    noFocusHighlight,
    scrollTargetPosition,
    isResizingContainer,
    isForwarding,
    isChatWithSelf,
    isRepliesChat,
    isAnonymousForwards,
    isChannel,
    isGroup,
    canReply,
    highlight,
    animatedEmoji,
    animatedCustomEmoji,
    hasActiveReactions,
    hasLinkedChat,
    isInSelectMode,
    isSelected,
    isGroupSelected,
    threadId,
    reactionMessage,
    availableReactions,
    defaultReaction,
    activeEmojiInteractions,
    messageListType,
    isPinnedList,
    isPinned,
    isDownloading,
    canAutoLoadMedia,
    canAutoPlayMedia,
    shouldLoopStickers,
    autoLoadFileMaxSizeMb,
    repliesThreadInfo,
    hasUnreadReaction,
    memoFirstUnreadIdRef,
    senderAdminMember,
    messageTopic,
    hasTopicChip,
    chatTranslations,
    areTranslationsEnabled,
    shouldDetectChatLanguage,
    requestedTranslationLanguage,
    requestedChatTranslationLanguage,
    withAnimatedEffects,
    webPageStory,
    isConnected,
    getIsMessageListReady,
    shouldWarnAboutSvg,
    senderBoosts,
    tags,
    canTranscribeVoice,
    viaBusinessBot,
    effect,
    onPinnedIntersectionChange
  } = _ref;
  const {
    toggleMessageSelection,
    clickBotInlineButton,
    disableContextMenuHint,
    animateUnreadReaction,
    focusLastMessage,
    markMentionsRead
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const bottomMarkerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const quickReactionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const messageHeightRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_30__["default"])();
  const [isTranscriptionHidden, setTranscriptionHidden] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPlayEffect, requestEffect, hideEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_26__["default"])();
  const {
    isMobile,
    isTouchScreen
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_22__["default"])();
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_28__.useOnIntersect)(bottomMarkerRef, observeIntersectionForBottom);
  const {
    isContextMenuOpen,
    contextMenuPosition,
    contextMenuTarget,
    handleBeforeContextMenu,
    handleContextMenu: onContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_23__["default"])(ref, isTouchScreen && isInSelectMode, !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_13__.IS_ELECTRON, _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_13__.IS_ANDROID, getIsMessageListReady);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isContextMenuOpen) {
      disableContextMenuHint();
    }
  }, [isContextMenuOpen, disableContextMenuHint]);
  const noAppearanceAnimation = appearanceOrder <= 0;
  const [isShown, markShown] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_26__["default"])(noAppearanceAnimation);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (noAppearanceAnimation) {
      return;
    }
    setTimeout(markShown, appearanceOrder * APPEARANCE_DELAY);
  }, [appearanceOrder, markShown, noAppearanceAnimation]);
  const {
    transitionClassNames
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_33__["default"])(isShown || isJustAdded, undefined, noAppearanceAnimation && !isJustAdded, false);
  const {
    id: messageId,
    chatId,
    forwardInfo,
    viaBotId,
    isTranscriptionError,
    factCheck
  } = message;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isPinned) return undefined;
    const id = album ? album.mainMessage.id : messageId;
    return () => {
      onPinnedIntersectionChange({
        viewportPinnedIdsToRemove: [id],
        isUnmount: true
      });
    };
  }, [album, isPinned, messageId, onPinnedIntersectionChange]);
  const isLocal = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageLocal)(message);
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isOwnMessage)(message);
  const isScheduled = messageListType === 'scheduled' || message.isScheduled;
  const hasMessageReply = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isReplyToMessage)(message) && !shouldHideReply;
  const {
    paidMedia
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(message);
  const {
    photo: paidMediaPhoto,
    video: paidMediaVideo
  } = (0,_helpers_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_20__["default"])(paidMedia);
  const {
    photo = paidMediaPhoto,
    video = paidMediaVideo,
    audio,
    voice,
    document,
    sticker,
    contact,
    poll,
    webPage,
    invoice,
    location,
    action,
    game,
    storyData,
    giveaway,
    giveawayResults
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(message);
  const messageReplyInfo = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_6__.getMessageReplyInfo)(message);
  const storyReplyInfo = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_6__.getStoryReplyInfo)(message);
  const hasStoryReply = Boolean(storyReplyInfo);
  const hasThread = Boolean(repliesThreadInfo) && messageListType === 'thread';
  const isCustomShape = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageCustomShape)(message);
  const hasAnimatedEmoji = isCustomShape && (animatedEmoji || animatedCustomEmoji);
  const hasReactions = reactionMessage?.reactions && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.areReactionsEmpty)(reactionMessage.reactions);
  const asForwarded = forwardInfo && (!isChatWithSelf || isScheduled) && !isRepliesChat && !isAnonymousForwards && !forwardInfo.isLinkedChannelPost && !isCustomShape || Boolean(storyData && !storyData.isMention);
  const canShowSenderBoosts = Boolean(senderBoosts) && !asForwarded && isFirstInGroup;
  const isStoryMention = storyData?.isMention;
  const isRoundVideo = video?.mediaType === 'video' && video.isRound;
  const isAlbum = Boolean(album) && (album.isPaidMedia && paidMedia.extendedMedia.length > 1 || album.messages.length > 1) && !album.messages.some(msg => Object.keys(msg.content).length === 0);
  const isInDocumentGroupNotFirst = isInDocumentGroup && !isFirstInDocumentGroup;
  const isInDocumentGroupNotLast = isInDocumentGroup && !isLastInDocumentGroup;
  const isContextMenuShown = contextMenuPosition !== undefined;
  const canShowActionButton = !(isContextMenuShown || isInSelectMode || isForwarding) && !isInDocumentGroupNotLast && !isStoryMention;
  const canForward = isChannel && !isScheduled && message.isForwardingAllowed && !isChatProtected;
  const canFocus = Boolean(isPinnedList || forwardInfo && (forwardInfo.isChannelPost || isChatWithSelf && !isOwn || isRepliesChat || isAnonymousForwards) && forwardInfo.fromMessageId);
  const noUserColors = isOwn && !isCustomShape;
  const hasFactCheck = Boolean(factCheck?.text);
  const hasSubheader = hasTopicChip || hasMessageReply || hasStoryReply;
  const selectMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_29__["default"])((e, groupedId) => {
    toggleMessageSelection({
      messageId,
      groupedId,
      ...(e?.shiftKey && {
        withShift: true
      }),
      ...(isAlbum && {
        childMessageIds: album.messages.map(_ref2 => {
          let {
            id
          } = _ref2;
          return id;
        })
      })
    });
  });
  const messageSender = canShowSender ? sender : undefined;
  const withVoiceTranscription = Boolean(!isTranscriptionHidden && (isTranscriptionError || transcribedText));
  const shouldPreferOriginSender = forwardInfo && (isChatWithSelf || isRepliesChat || isAnonymousForwards || !messageSender);
  const avatarPeer = shouldPreferOriginSender ? originSender : messageSender;
  const messageColorPeer = originSender || sender;
  const senderPeer = forwardInfo || storyData ? originSender : messageSender;
  const hasTtl = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.hasMessageTtl)(message);
  const {
    handleMouseDown,
    handleClick,
    handleContextMenu,
    handleDoubleClick,
    handleContentDoubleClick,
    handleMouseMove,
    handleSendQuickReaction,
    handleMouseLeave,
    isSwiped,
    isQuickReactionVisible,
    handleDocumentGroupMouseEnter
  } = (0,_hooks_useOuterHandlers__WEBPACK_IMPORTED_MODULE_40__["default"])(selectMessage, ref, messageId, Boolean(isInSelectMode), Boolean(canReply), Boolean(isProtected), onContextMenu, handleBeforeContextMenu, chatId, isContextMenuShown, quickReactionRef, isInDocumentGroupNotLast, getIsMessageListReady);
  const {
    handleAvatarClick,
    handleSenderClick,
    handleViaBotClick,
    handleReplyClick,
    handleMediaClick,
    handleAudioPlay,
    handleAlbumMediaClick,
    handlePhotoMediaClick,
    handleVideoMediaClick,
    handleMetaClick,
    handleTranslationClick,
    handleOpenThread,
    handleReadMedia,
    handleCancelUpload,
    handleVoteSend,
    handleGroupForward,
    handleForward,
    handleFocus,
    handleFocusForwarded,
    handleDocumentGroupSelectAll,
    handleTopicChipClick,
    handleStoryClick
  } = (0,_hooks_useInnerHandlers__WEBPACK_IMPORTED_MODULE_38__["default"])(lang, selectMessage, message, chatId, threadId, isInDocumentGroup, asForwarded, isScheduled, album, avatarPeer, senderPeer, botSender, messageTopic, Boolean(requestedChatTranslationLanguage), replyStory && 'content' in replyStory ? replyStory : undefined, isReplyPrivate, isRepliesChat);
  const handleEffectClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_29__["default"])(e => {
    e.stopPropagation();
    requestEffect();
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isLastInList) {
      return;
    }
    if (withVoiceTranscription && transcribedText) {
      focusLastMessage();
    }
  }, [focusLastMessage, isLastInList, transcribedText, withVoiceTranscription]);
  const textMessage = album?.hasMultipleCaptions ? undefined : album?.captionMessage || message;
  const hasTextContent = textMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.hasMessageText)(textMessage);
  const hasText = hasTextContent || hasFactCheck;
  const containerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('Message message-list-item', isFirstInGroup && 'first-in-group', isProtected && !hasTextContent ? 'is-protected' : 'allow-selection', isLastInGroup && 'last-in-group', isFirstInDocumentGroup && 'first-in-document-group', isLastInDocumentGroup && 'last-in-document-group', isLastInList && 'last-in-list', isOwn && 'own', Boolean(message.viewsCount) && 'has-views', message.isEdited && 'was-edited', hasMessageReply && 'has-reply', isContextMenuOpen && 'has-menu-open', isFocused && !noFocusHighlight && 'focused', isForwarding && 'is-forwarding', message.isDeleting && 'is-deleting', isInDocumentGroup && 'is-in-document-group', isAlbum && 'is-album', message.hasUnreadMention && 'has-unread-mention', isSelected && 'is-selected', isInSelectMode && 'is-in-selection-mode', isThreadTop && !withAvatar && 'is-thread-top', Boolean(message.inlineButtons) && 'has-inline-buttons', isSwiped && 'is-swiped', transitionClassNames, isJustAdded && 'is-just-added', (hasActiveReactions || shouldPlayEffect) && 'has-active-effect', isStoryMention && 'is-story-mention');
  const text = textMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(textMessage).text;
  const isInvertedMedia = Boolean(message.isInvertedMedia);
  const {
    replyToMsgId,
    replyToPeerId,
    isQuote
  } = messageReplyInfo || {};
  const {
    peerId: storyReplyPeerId,
    storyId: storyReplyId
  } = storyReplyInfo || {};
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if ((sticker?.hasEffect || effect) && (memoFirstUnreadIdRef.current && messageId >= memoFirstUnreadIdRef.current || isLocal)) {
      requestEffect();
    }
  }, [effect, isLocal, memoFirstUnreadIdRef, messageId, sticker?.hasEffect]);
  const detectedLanguage = (0,_hooks_useTextLanguage__WEBPACK_IMPORTED_MODULE_34__["default"])(text?.text, !(areTranslationsEnabled || shouldDetectChatLanguage), getIsMessageListReady);
  (0,_hooks_useDetectChatLanguage__WEBPACK_IMPORTED_MODULE_36__["default"])(message, detectedLanguage, !shouldDetectChatLanguage, getIsMessageListReady);
  const shouldTranslate = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageTranslatable)(message, !requestedChatTranslationLanguage);
  const {
    isPending: isTranslationPending,
    translatedText
  } = (0,_hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_39__["default"])(chatTranslations, chatId, shouldTranslate ? messageId : undefined, requestedTranslationLanguage);
  // Used to display previous result while new one is loading
  const previousTranslatedText = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_31__["default"])(translatedText, Boolean(shouldTranslate));
  const currentTranslatedText = translatedText || previousTranslatedText;
  const {
    phoneCall
  } = action || {};
  const isMediaWithCommentButton = (repliesThreadInfo || hasLinkedChat && isChannel && isLocal) && !isInDocumentGroupNotLast && messageListType === 'thread' && !noComments;
  const withCommentButton = repliesThreadInfo?.isCommentsInfo && !isInDocumentGroupNotLast && messageListType === 'thread' && !noComments;
  const withQuickReactionButton = !isTouchScreen && !phoneCall && !isInSelectMode && defaultReaction && !isInDocumentGroupNotLast && !isStoryMention && !hasTtl;
  const hasOutsideReactions = hasReactions && (isCustomShape || (photo || video || storyData || location?.mediaType === 'geo') && !hasText);
  const contentClassName = (0,_helpers_buildContentClassName__WEBPACK_IMPORTED_MODULE_18__.buildContentClassName)(message, album, {
    hasSubheader,
    isCustomShape,
    isLastInGroup,
    asForwarded,
    hasThread: hasThread && !noComments,
    forceSenderName,
    hasCommentCounter: hasThread && repliesThreadInfo.messagesCount > 0,
    hasActionButton: canForward || canFocus,
    hasReactions,
    isGeoLiveActive: location?.mediaType === 'geoLive' && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isGeoLiveExpired)(message),
    withVoiceTranscription,
    peerColorClass: (0,_common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_15__.getPeerColorClass)(messageColorPeer, noUserColors),
    hasOutsideReactions
  });
  const withAppendix = contentClassName.includes('has-appendix');
  const emojiSize = (0,_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_17__.getCustomEmojiSize)(message.emojiOnlyCount);
  let metaPosition;
  if (phoneCall) {
    metaPosition = 'none';
  } else if (isInDocumentGroupNotLast) {
    metaPosition = 'none';
  } else if (hasText && !webPage && !emojiSize && !isInvertedMedia) {
    metaPosition = 'in-text';
  } else if (isInvertedMedia && !emojiSize && (hasFactCheck || webPage)) {
    metaPosition = 'in-text';
  } else {
    metaPosition = 'standalone';
  }
  let reactionsPosition;
  if (hasReactions) {
    if (hasOutsideReactions) {
      reactionsPosition = 'outside';
    } else if (asForwarded) {
      metaPosition = 'standalone';
      reactionsPosition = 'inside';
    } else {
      reactionsPosition = 'inside';
    }
  } else {
    reactionsPosition = 'none';
  }
  const quickReactionPosition = isCustomShape ? 'in-meta' : 'in-content';
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_24__["default"])(replyToPeerId || chatId, replyToMsgId, replyMessage, message.id, shouldHideReply || isQuote || isReplyPrivate);
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_25__["default"])(storyReplyPeerId || chatId, storyReplyId, replyStory);
  (0,_hooks_useFocusMessage__WEBPACK_IMPORTED_MODULE_37__["default"])(ref, chatId, isFocused, focusDirection, noFocusHighlight, isResizingContainer, isJustAdded, Boolean(focusedQuote), scrollTargetPosition);
  const viaBusinessBotTitle = viaBusinessBot ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getSenderTitle)(lang, viaBusinessBot) : undefined;
  const signature = viaBusinessBotTitle || isChannel && message.postAuthorTitle || (asForwarded || isChatWithSelf) && forwardInfo?.postAuthorTitle || undefined;
  const shouldFocusOnResize = isLastInList;
  const handleResize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_29__["default"])(entry => {
    const lastHeight = messageHeightRef.current;
    const newHeight = entry.contentRect.height;
    messageHeightRef.current = newHeight;
    if ((0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_8__.isAnimatingScroll)() || !lastHeight || newHeight <= lastHeight) return;
    const container = entry.target.closest('.MessageList');
    if (!container) return;
    (0,_hooks_useHeavyAnimationCheck__WEBPACK_IMPORTED_MODULE_27__.dispatchHeavyAnimationEvent)(RESIZE_ANIMATION_DURATION);
    const resizeDiff = newHeight - lastHeight;
    const {
      offsetHeight,
      scrollHeight,
      scrollTop
    } = container;
    const currentScrollBottom = Math.round(scrollHeight - scrollTop - offsetHeight);
    const previousScrollBottom = currentScrollBottom - resizeDiff;
    if (previousScrollBottom <= BOTTOM_FOCUS_SCROLL_THRESHOLD) {
      focusLastMessage();
    }
  });
  const throttledResize = (0,_hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_35__["default"])(handleResize, [handleResize], THROTTLE_MS, false);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_32__["default"])(ref, throttledResize, !shouldFocusOnResize);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const bottomMarker = bottomMarkerRef.current;
    if (!bottomMarker || !(0,_util_isElementInViewport__WEBPACK_IMPORTED_MODULE_10__.isElementInViewport)(bottomMarker)) return;
    if (hasUnreadReaction) {
      animateUnreadReaction({
        messageIds: [messageId]
      });
    }
    if (message.hasUnreadMention) {
      markMentionsRead({
        messageIds: [messageId]
      });
    }
  }, [hasUnreadReaction, messageId, animateUnreadReaction, message.hasUnreadMention]);
  const albumLayout = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return isAlbum ? (0,_helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_19__.calculateAlbumLayout)(isOwn, Boolean(asForwarded), Boolean(noAvatars), album, isMobile) : undefined;
  }, [isAlbum, isOwn, asForwarded, noAvatars, album, isMobile]);
  const extraPadding = asForwarded ? 28 : 0;
  const sizeCalculations = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    let calculatedWidth;
    let contentWidth;
    let noMediaCorners = false;
    let style = '';
    let reactionsMaxWidth;
    if (!isAlbum && (photo || video || invoice?.extendedMedia)) {
      let width;
      if (photo) {
        width = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__.calculateMediaDimensions)({
          media: photo,
          isOwn,
          asForwarded,
          noAvatars,
          isMobile
        }).width;
      } else if (video) {
        if (isRoundVideo) {
          width = _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__.ROUND_VIDEO_DIMENSIONS_PX;
        } else {
          width = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__.calculateMediaDimensions)({
            media: video,
            isOwn,
            asForwarded,
            noAvatars,
            isMobile
          }).width;
        }
      } else if (invoice?.extendedMedia && invoice.extendedMedia.width && invoice.extendedMedia.height) {
        const {
          width: previewWidth,
          height: previewHeight
        } = invoice.extendedMedia;
        width = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__.calculateDimensionsForMessageMedia)({
          width: previewWidth,
          height: previewHeight,
          fromOwnMessage: isOwn,
          asForwarded,
          noAvatars,
          isMobile
        }).width;
      }
      if (width) {
        if (width < _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__.MIN_MEDIA_WIDTH_WITH_TEXT) {
          contentWidth = width;
        }
        calculatedWidth = Math.max((0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__.getMinMediaWidth)(text?.text, isMediaWithCommentButton), width);
        if (invoice?.extendedMedia && calculatedWidth - width > NO_MEDIA_CORNERS_THRESHOLD) {
          noMediaCorners = true;
        }
      }
    } else if (albumLayout) {
      calculatedWidth = Math.max((0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_21__.getMinMediaWidth)(text?.text, isMediaWithCommentButton), albumLayout.containerStyle.width);
      if (calculatedWidth - albumLayout.containerStyle.width > NO_MEDIA_CORNERS_THRESHOLD) {
        noMediaCorners = true;
      }
    }
    if (calculatedWidth) {
      style = `width: ${calculatedWidth + extraPadding}px`;
      reactionsMaxWidth = calculatedWidth + EXTRA_SPACE_FOR_REACTIONS;
    } else if (sticker && !hasSubheader) {
      const {
        width
      } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_14__.getStickerDimensions)(sticker, isMobile);
      style = `width: ${width + extraPadding}px`;
      reactionsMaxWidth = width + EXTRA_SPACE_FOR_REACTIONS;
    }
    return {
      contentWidth,
      noMediaCorners,
      style,
      reactionsMaxWidth
    };
  }, [albumLayout, asForwarded, extraPadding, hasSubheader, invoice?.extendedMedia, isAlbum, isMediaWithCommentButton, isMobile, isOwn, noAvatars, photo, sticker, text?.text, video, isRoundVideo]);
  const {
    contentWidth,
    noMediaCorners,
    style,
    reactionsMaxWidth
  } = sizeCalculations;
  function renderAvatar() {
    const hiddenName = !avatarPeer && forwardInfo ? forwardInfo.hiddenUserName : undefined;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_42__["default"], {
      size: isMobile ? 'small-mobile' : 'small',
      peer: avatarPeer,
      text: hiddenName,
      onClick: avatarPeer ? handleAvatarClick : undefined
    });
  }
  function renderMessageText(isForAnimation) {
    if (!textMessage) return undefined;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageText__WEBPACK_IMPORTED_MODULE_51__["default"], {
      messageOrStory: textMessage,
      translatedText: requestedTranslationLanguage ? currentTranslatedText : undefined,
      isForAnimation: isForAnimation,
      focusedQuote: focusedQuote,
      emojiSize: emojiSize,
      highlight: highlight,
      isProtected: isProtected,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      withTranslucentThumbs: isCustomShape,
      isInSelectMode: isInSelectMode
    });
  }
  const renderQuickReactionButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!defaultReaction) return undefined;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('quick-reaction', isQuickReactionVisible && !hasActiveReactions && 'visible'),
      onClick: handleSendQuickReaction,
      ref: quickReactionRef
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_ReactionStaticEmoji__WEBPACK_IMPORTED_MODULE_52__["default"], {
      reaction: defaultReaction,
      size: QUICK_REACTION_SIZE,
      availableReactions: availableReactions,
      observeIntersection: observeIntersectionForPlaying
    }));
  }, [hasActiveReactions, availableReactions, defaultReaction, handleSendQuickReaction, isQuickReactionVisible, observeIntersectionForPlaying]);
  function renderReactionsAndMeta() {
    const meta = /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageMeta__WEBPACK_IMPORTED_MODULE_70__["default"], {
      message: message,
      isPinned: isPinned,
      withFullDate: isChatWithSelf && !isOwn,
      noReplies: noReplies,
      repliesThreadInfo: repliesThreadInfo,
      outgoingStatus: outgoingStatus,
      signature: signature,
      withReactionOffset: reactionsPosition === 'inside',
      renderQuickReactionButton: withQuickReactionButton && quickReactionPosition === 'in-meta' ? renderQuickReactionButton : undefined,
      availableReactions: availableReactions,
      isTranslated: Boolean(requestedTranslationLanguage ? currentTranslatedText : undefined),
      effectEmoji: effect?.emoticon,
      onClick: handleMetaClick,
      onEffectClick: handleEffectClick,
      onTranslationClick: handleTranslationClick,
      onOpenThread: handleOpenThread
    });
    if (reactionsPosition !== 'inside') {
      return meta;
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_reactions_Reactions__WEBPACK_IMPORTED_MODULE_75__["default"], {
      message: reactionMessage,
      metaChildren: meta,
      observeIntersection: observeIntersectionForPlaying,
      noRecentReactors: isChannel,
      tags: tags,
      isCurrentUserPremium: isPremium,
      getIsMessageListReady: getIsMessageListReady
    });
  }
  function renderContent() {
    const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('content-inner', asForwarded && 'forwarded-message', hasSubheader && 'with-subheader', noMediaCorners && 'no-media-corners');
    const hasCustomAppendix = isLastInGroup && (!hasText || isInvertedMedia && !hasFactCheck && !hasReactions) && !asForwarded && !withCommentButton;
    const textContentClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('text-content', 'clearfix', metaPosition === 'in-text' && 'with-meta', outgoingStatus && 'with-outgoing-icon');
    const shouldReadMedia = !hasTtl || !isOwn || isChatWithSelf;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: className,
      onDoubleClick: handleContentDoubleClick,
      dir: "auto"
    }, !asForwarded && renderSenderName(), hasSubheader && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-subheader"
    }, hasTopicChip && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TopicChip__WEBPACK_IMPORTED_MODULE_53__["default"], {
      topic: messageTopic,
      onClick: handleTopicChipClick,
      className: "message-topic"
    }), hasMessageReply && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_46__["default"], {
      message: replyMessage,
      replyInfo: messageReplyInfo,
      noUserColors: noUserColors,
      isProtected: isProtected,
      sender: replyMessageSender,
      senderChat: replyMessageChat,
      forwardSender: replyMessageForwardSender,
      chatTranslations: chatTranslations,
      requestedChatTranslationLanguage: requestedChatTranslationLanguage,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      onClick: handleReplyClick
    }), hasStoryReply && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmbeddedStory__WEBPACK_IMPORTED_MODULE_47__["default"], {
      story: replyStory,
      sender: storySender,
      noUserColors: noUserColors,
      isProtected: isProtected,
      observeIntersectionForLoading: observeIntersectionForLoading,
      onClick: handleStoryClick
    })), sticker && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Sticker__WEBPACK_IMPORTED_MODULE_77__["default"], {
      message: message,
      observeIntersection: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      shouldLoop: shouldLoopStickers,
      shouldPlayEffect: shouldPlayEffect,
      withEffect: withAnimatedEffects,
      onStopEffect: hideEffect
    }), hasAnimatedEmoji && animatedCustomEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedCustomEmoji__WEBPACK_IMPORTED_MODULE_56__["default"], {
      customEmojiId: animatedCustomEmoji,
      withEffects: withAnimatedEffects && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId) && !effect,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      forceLoadPreview: isLocal,
      messageId: messageId,
      chatId: chatId,
      activeEmojiInteractions: activeEmojiInteractions
    }), hasAnimatedEmoji && animatedEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedEmoji__WEBPACK_IMPORTED_MODULE_57__["default"], {
      emoji: animatedEmoji,
      withEffects: withAnimatedEffects && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId) && !effect,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      forceLoadPreview: isLocal,
      messageId: messageId,
      chatId: chatId,
      activeEmojiInteractions: activeEmojiInteractions
    }), withAnimatedEffects && effect && !isLocal && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageEffect__WEBPACK_IMPORTED_MODULE_69__["default"], {
      shouldPlay: shouldPlayEffect,
      messageId: message.id,
      isMirrored: !message.isOutgoing,
      effect: effect,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      onStop: hideEffect
    }), phoneCall && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessagePhoneCall__WEBPACK_IMPORTED_MODULE_71__["default"], {
      message: message,
      phoneCall: phoneCall,
      chatId: chatId
    }), !isAlbum && isRoundVideo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RoundVideo__WEBPACK_IMPORTED_MODULE_76__["default"], {
      message: message,
      observeIntersection: observeIntersectionForLoading,
      canAutoLoad: canAutoLoadMedia,
      isDownloading: isDownloading,
      onReadMedia: shouldReadMedia ? handleReadMedia : undefined
    }), (audio || voice) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_41__["default"], {
      theme: theme,
      message: message,
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Inline,
      uploadProgress: uploadProgress,
      isSelectable: isInDocumentGroup,
      isSelected: isSelected,
      noAvatars: noAvatars,
      onPlay: handleAudioPlay,
      onReadMedia: voice && shouldReadMedia ? handleReadMedia : undefined,
      onCancelUpload: handleCancelUpload,
      isDownloading: isDownloading,
      isTranscribing: isTranscribing,
      isTranscriptionHidden: isTranscriptionHidden,
      isTranscribed: Boolean(transcribedText),
      isTranscriptionError: isTranscriptionError,
      canDownload: !isProtected,
      onHideTranscription: setTranscriptionHidden,
      canTranscribe: canTranscribeVoice && !hasTtl
    }), document && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_44__["default"], {
      document: document,
      observeIntersection: observeIntersectionForLoading,
      canAutoLoad: canAutoLoadMedia,
      autoLoadFileMaxSizeMb: autoLoadFileMaxSizeMb,
      uploadProgress: uploadProgress,
      isSelectable: isInDocumentGroup,
      isSelected: isSelected,
      onMediaClick: handleMediaClick,
      onCancelUpload: handleCancelUpload,
      isDownloading: isDownloading,
      shouldWarnAboutSvg: shouldWarnAboutSvg
    }), storyData && !isStoryMention && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Story__WEBPACK_IMPORTED_MODULE_78__["default"], {
      message: message,
      isProtected: isProtected
    }), isStoryMention && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StoryMention__WEBPACK_IMPORTED_MODULE_79__["default"], {
      message: message
    }), contact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Contact__WEBPACK_IMPORTED_MODULE_59__["default"], {
      contact: contact,
      noUserColors: isOwn
    }), poll && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Poll__WEBPACK_IMPORTED_MODULE_74__["default"], {
      message: message,
      poll: poll,
      onSendVote: handleVoteSend
    }), (giveaway || giveawayResults) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Giveaway__WEBPACK_IMPORTED_MODULE_63__["default"], {
      message: message
    }), game && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Game__WEBPACK_IMPORTED_MODULE_62__["default"], {
      message: message,
      canAutoLoadMedia: canAutoLoadMedia
    }), invoice?.extendedMedia && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_InvoiceMediaPreview__WEBPACK_IMPORTED_MODULE_66__["default"], {
      message: message,
      isConnected: isConnected
    }), withVoiceTranscription && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('transcription', !isTranscriptionHidden && isTranscriptionError && 'transcription-error'),
      dir: "auto"
    }, isTranscriptionError ? lang('NoWordsRecognized') : isTranscribing && transcribedText ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_DotAnimation__WEBPACK_IMPORTED_MODULE_45__["default"], {
      content: transcribedText
    }) : transcribedText), isInvertedMedia && renderInvertedMediaContent(hasCustomAppendix), !isInvertedMedia && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderInvertibleMediaContent(hasCustomAppendix), hasText && !hasAnimatedEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: textContentClass,
      dir: "auto"
    }, renderMessageText(), isTranslationPending && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "translation-animation"
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-loading"
    }, renderMessageText(true))), hasFactCheck && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FactCheck__WEBPACK_IMPORTED_MODULE_61__["default"], {
      factCheck: factCheck,
      isToggleDisabled: isInSelectMode
    }), metaPosition === 'in-text' && renderReactionsAndMeta()), renderWebPage()), invoice && !invoice.extendedMedia && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Invoice__WEBPACK_IMPORTED_MODULE_65__["default"], {
      message: message,
      shouldAffectAppendix: hasCustomAppendix && !hasReactions,
      isInSelectMode: isInSelectMode,
      isSelected: isSelected,
      theme: theme,
      forcedWidth: contentWidth
    }), location && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Location__WEBPACK_IMPORTED_MODULE_67__["default"], {
      message: message,
      isInSelectMode: isInSelectMode,
      isSelected: isSelected,
      theme: theme,
      peer: sender
    }));
  }
  function renderInvertedMediaContent(hasCustomAppendix) {
    const textContentClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('text-content', 'clearfix');
    const footerClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('text-content', 'clearfix', metaPosition === 'in-text' && 'with-meta', outgoingStatus && 'with-outgoing-icon');
    const hasMediaAfterText = isAlbum || !isAlbum && photo || !isAlbum && video && !isRoundVideo;
    const hasContentAfterText = hasMediaAfterText || !hasAnimatedEmoji && hasFactCheck;
    const isMetaInText = metaPosition === 'in-text';
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderWebPage(), hasText && !hasAnimatedEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: textContentClass,
      dir: "auto"
    }, renderMessageText(), isTranslationPending && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "translation-animation"
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-loading"
    }, renderMessageText(true))), !hasContentAfterText && isMetaInText && renderReactionsAndMeta()), hasContentAfterText && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderInvertibleMediaContent(hasCustomAppendix), !hasAnimatedEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: footerClass,
      dir: "auto"
    }, hasFactCheck && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FactCheck__WEBPACK_IMPORTED_MODULE_61__["default"], {
      factCheck: factCheck,
      isToggleDisabled: isInSelectMode
    }), isMetaInText && renderReactionsAndMeta())));
  }
  function renderWebPage() {
    return webPage && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_WebPage__WEBPACK_IMPORTED_MODULE_81__["default"], {
      message: message,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      canAutoPlay: canAutoPlayMedia,
      asForwarded: asForwarded,
      isDownloading: isDownloading,
      isProtected: isProtected,
      theme: theme,
      story: webPageStory,
      isConnected: isConnected,
      backgroundEmojiId: sender?.color?.backgroundEmojiId,
      shouldWarnAboutSvg: shouldWarnAboutSvg,
      autoLoadFileMaxSizeMb: autoLoadFileMaxSizeMb,
      onAudioPlay: handleAudioPlay,
      onMediaClick: handleMediaClick,
      onCancelMediaTransfer: handleCancelUpload
    });
  }
  function renderInvertibleMediaContent(hasCustomAppendix) {
    const content = /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isAlbum && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Album__WEBPACK_IMPORTED_MODULE_55__["default"], {
      album: album,
      albumLayout: albumLayout,
      observeIntersection: observeIntersectionForLoading,
      isOwn: isOwn,
      isProtected: isProtected,
      hasCustomAppendix: hasCustomAppendix,
      onMediaClick: handleAlbumMediaClick
    }), !isAlbum && photo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Photo__WEBPACK_IMPORTED_MODULE_73__["default"], {
      messageText: text?.text,
      photo: photo,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      uploadProgress: uploadProgress,
      shouldAffectAppendix: hasCustomAppendix,
      isDownloading: isDownloading,
      isProtected: isProtected,
      asForwarded: asForwarded,
      theme: theme,
      forcedWidth: contentWidth,
      onClick: handlePhotoMediaClick,
      onCancelUpload: handleCancelUpload
    }), !isAlbum && video && !isRoundVideo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Video__WEBPACK_IMPORTED_MODULE_80__["default"], {
      video: video,
      isOwn: isOwn,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      forcedWidth: contentWidth,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      canAutoPlay: canAutoPlayMedia,
      uploadProgress: uploadProgress,
      isDownloading: isDownloading,
      isProtected: isProtected,
      asForwarded: asForwarded,
      onClick: handleVideoMediaClick,
      onCancelUpload: handleCancelUpload
    }));
    if (paidMedia) {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PaidMediaOverlay__WEBPACK_IMPORTED_MODULE_72__["default"], {
        chatId: chatId,
        messageId: messageId,
        paidMedia: paidMedia,
        isOutgoing: isOwn
      }, content);
    }
    return content;
  }
  function renderSenderName() {
    const media = photo || video || location || paidMedia;
    const shouldRender = !(isCustomShape && !viaBotId) && (withSenderName && (!media || hasTopicChip) || asForwarded || viaBotId || forceSenderName) && !isInDocumentGroupNotFirst && !(hasMessageReply && isCustomShape);
    if (!shouldRender) {
      return undefined;
    }
    let senderTitle;
    let senderColor;
    if (senderPeer && !(isCustomShape && viaBotId)) {
      senderTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getSenderTitle)(lang, senderPeer);
    } else if (forwardInfo?.hiddenUserName) {
      senderTitle = forwardInfo.hiddenUserName;
    } else if (storyData && originSender) {
      senderTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getSenderTitle)(lang, originSender);
    }
    const senderEmojiStatus = senderPeer && 'emojiStatus' in senderPeer && senderPeer.emojiStatus;
    const senderIsPremium = senderPeer && 'isPremium' in senderPeer && senderPeer.isPremium;
    const shouldRenderForwardAvatar = asForwarded && senderPeer;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-title",
      dir: "ltr"
    }, senderTitle || asForwarded ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('message-title-name', forwardInfo?.hiddenUserName ? 'sender-hidden' : 'interactive', senderColor),
      onClick: handleSenderClick,
      dir: "ltr"
    }, asForwarded && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
      name: forwardInfo?.hiddenUserName ? 'forward' : 'share-filled'
    }), storyData && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
      name: "play-story"
    }), shouldRenderForwardAvatar && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_42__["default"], {
      className: "forward-avatar",
      peer: senderPeer,
      size: "micro"
    }), senderTitle ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_16__["default"])(senderTitle) : asForwarded ? NBSP : undefined, !asForwarded && senderEmojiStatus && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_43__["default"], {
      documentId: senderEmojiStatus.documentId,
      loopLimit: _config__WEBPACK_IMPORTED_MODULE_4__.EMOJI_STATUS_LOOP_LIMIT,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying
    }), !asForwarded && !senderEmojiStatus && senderIsPremium && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_50__["default"], null), senderPeer?.fakeType && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_FakeIcon__WEBPACK_IMPORTED_MODULE_48__["default"], {
      fakeType: senderPeer.fakeType
    })) : !botSender ? NBSP : undefined, botSender && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "via"
    }, lang('ViaBot')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "interactive",
      onClick: handleViaBotClick
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_16__["default"])(`@${botSender.usernames[0].username}`))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "title-spacer"
    }), forwardInfo?.isLinkedChannelPost ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, lang('DiscussChannel')) : message.forwardInfo?.postAuthorTitle && isGroup && asForwarded ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, message.forwardInfo?.postAuthorTitle) : message.postAuthorTitle && isGroup && !asForwarded ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, message.postAuthorTitle) : senderAdminMember && !asForwarded && !viaBotId ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, senderAdminMember.customTitle || lang(senderAdminMember.isOwner ? 'GroupInfo.LabelOwner' : 'GroupInfo.LabelAdmin')) : undefined, canShowSenderBoosts && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "sender-boosts",
      "aria-hidden": true
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
      name: senderBoosts > 1 ? 'boosts' : 'boost'
    }), senderBoosts > 1 ? senderBoosts : undefined));
  }
  const forwardAuthor = isGroup && asForwarded ? message.postAuthorTitle : undefined;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageHtmlId)(message.id),
    className: containerClassName,
    "data-message-id": messageId,
    onCopy: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_12__["default"] : undefined,
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu,
    onDoubleClick: handleDoubleClick,
    onMouseEnter: isInDocumentGroupNotLast ? handleDocumentGroupMouseEnter : undefined,
    onMouseMove: withQuickReactionButton ? handleMouseMove : undefined,
    onMouseLeave: withQuickReactionButton || isInDocumentGroupNotLast ? handleMouseLeave : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: bottomMarkerRef,
    className: "bottom-marker",
    "data-message-id": messageId,
    "data-last-message-id": album ? album.messages[album.messages.length - 1].id : undefined,
    "data-album-main-id": album ? album.mainMessage.id : undefined,
    "data-has-unread-mention": message.hasUnreadMention || undefined,
    "data-has-unread-reaction": hasUnreadReaction || undefined,
    "data-is-pinned": isPinned || undefined,
    "data-should-update-views": message.viewsCount !== undefined
  }), !isInDocumentGroup && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-select-control"
  }, isSelected && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
    name: "select"
  })), isLastInDocumentGroup && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('message-select-control group-select', isGroupSelected && 'is-selected'),
    onClick: handleDocumentGroupSelectAll
  }, isGroupSelected && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
    name: "select"
  })), withAvatar && renderAvatar(), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('message-content-wrapper', contentClassName.includes('text') && 'can-select-text')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: contentClassName,
    style: style,
    dir: "auto"
  }, asForwarded && !isInDocumentGroupNotFirst && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderSenderName(), forwardAuthor && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "admin-title",
    dir: "auto"
  }, forwardAuthor)), renderContent(), !isInDocumentGroupNotLast && metaPosition === 'standalone' && !isStoryMention && renderReactionsAndMeta(), canShowActionButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('message-action-buttons', isLoadingComments && 'message-action-buttons-shown')
  }, canForward && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_54__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('lng_context_forward_msg'),
    onClick: isLastInDocumentGroup ? handleGroupForward : handleForward
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
    name: "share-filled"
  })), canFocus && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_54__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: "Focus message",
    onClick: isPinnedList ? handleFocus : handleFocusForwarded
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_49__["default"], {
    name: "arrow-right"
  }))), withCommentButton && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CommentButton__WEBPACK_IMPORTED_MODULE_58__["default"], {
    threadInfo: repliesThreadInfo,
    disabled: noComments,
    isLoading: isLoadingComments,
    isCustomShape: isCustomShape
  }), withAppendix && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageAppendix__WEBPACK_IMPORTED_MODULE_68__["default"], {
    isOwn: isOwn
  }), withQuickReactionButton && quickReactionPosition === 'in-content' && renderQuickReactionButton()), message.inlineButtons && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_InlineButtons__WEBPACK_IMPORTED_MODULE_64__["default"], {
    message: message,
    onClick: clickBotInlineButton
  }), reactionsPosition === 'outside' && !isStoryMention && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_reactions_Reactions__WEBPACK_IMPORTED_MODULE_75__["default"], {
    message: reactionMessage,
    isOutside: true,
    isCurrentUserPremium: isPremium,
    maxWidth: reactionsMaxWidth,
    observeIntersection: observeIntersectionForPlaying,
    noRecentReactors: isChannel,
    tags: tags,
    getIsMessageListReady: getIsMessageListReady
  })), contextMenuPosition && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_60__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuPosition,
    targetHref: contextMenuTarget?.matches('a[href]') ? contextMenuTarget.href : undefined,
    message: message,
    album: album,
    messageListType: messageListType,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    repliesThreadInfo: repliesThreadInfo,
    noReplies: noReplies,
    detectedLanguage: detectedLanguage
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, ownProps) => {
  const {
    focusedMessage,
    forwardMessages,
    activeReactions,
    activeEmojiInteractions,
    loadingThread
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global);
  const {
    message,
    album,
    withSenderName,
    withAvatar,
    threadId,
    messageListType,
    isLastInDocumentGroup,
    isFirstInGroup
  } = ownProps;
  const {
    id,
    chatId,
    viaBotId,
    isOutgoing,
    forwardInfo,
    transcriptionId,
    isPinned,
    viaBusinessBotId,
    effectId
  } = message;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatWithSelf)(global, chatId);
  const isRepliesChat = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatWithRepliesBot)(chatId);
  const isAnonymousForwards = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isAnonymousForwardsChat)(chatId);
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat);
  const chatFullInfo = !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatFullInfo)(global, chatId) : undefined;
  const webPageStoryData = message.content.webPage?.story;
  const webPageStory = webPageStoryData ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStory)(global, webPageStoryData.peerId, webPageStoryData.id) : undefined;
  const isForwarding = forwardMessages.messageIds && forwardMessages.messageIds.includes(id);
  const forceSenderName = !isChatWithSelf && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isAnonymousOwnMessage)(message);
  const canShowSender = withSenderName || withAvatar || forceSenderName;
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectSender)(global, message);
  const originSender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectForwardedSender)(global, message);
  const botSender = viaBotId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, viaBotId) : undefined;
  const senderAdminMember = sender?.id && isGroup ? chatFullInfo?.adminMembersById?.[sender?.id] : undefined;
  const isThreadTop = message.id === threadId;
  const {
    replyToMsgId,
    replyToPeerId,
    replyFrom
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_6__.getMessageReplyInfo)(message) || {};
  const {
    peerId: storyReplyPeerId,
    storyId: storyReplyId
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_6__.getStoryReplyInfo)(message) || {};
  const shouldHideReply = replyToMsgId && replyToMsgId === threadId;
  const replyMessage = replyToMsgId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, replyToPeerId || chatId, replyToMsgId) : undefined;
  const forwardHeader = forwardInfo || replyFrom;
  const replyMessageSender = replyMessage ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectReplySender)(global, replyMessage) : forwardHeader && !isRepliesChat && !isAnonymousForwards ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectSenderFromHeader)(global, forwardHeader) : undefined;
  const replyMessageForwardSender = replyMessage && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectForwardedSender)(global, replyMessage);
  const replyMessageChat = replyToPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, replyToPeerId) : undefined;
  const isReplyPrivate = !isRepliesChat && !isAnonymousForwards && replyMessageChat && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatPublic)(replyMessageChat) && (replyMessageChat.isNotJoined || replyMessageChat.isRestricted);
  const isReplyToTopicStart = replyMessage?.content.action?.type === 'topicCreate';
  const replyStory = storyReplyId && storyReplyPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStory)(global, storyReplyPeerId, storyReplyId) : undefined;
  const storySender = storyReplyPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeer)(global, storyReplyPeerId) : undefined;
  const uploadProgress = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUploadProgress)(global, message);
  const isFocused = messageListType === 'thread' && (album ? album.messages.some(m => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMessageFocused)(global, m, threadId)) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMessageFocused)(global, message, threadId));
  const {
    direction: focusDirection,
    noHighlight: noFocusHighlight,
    isResizingContainer,
    quote: focusedQuote,
    scrollTargetPosition
  } = isFocused && focusedMessage || {};
  const {
    query: highlight
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentTextSearch)(global) || {};
  const singleEmoji = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSingleRegularEmoji)(message);
  const animatedEmoji = singleEmoji && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectAnimatedEmoji)(global, singleEmoji) ? singleEmoji : undefined;
  const animatedCustomEmoji = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSingleCustomEmoji)(message);
  let isSelected;
  if (album?.messages) {
    isSelected = album.messages.every(_ref3 => {
      let {
        id: messageId
      } = _ref3;
      return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMessageSelected)(global, messageId);
    });
  } else {
    isSelected = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMessageSelected)(global, id);
  }
  const {
    canReply
  } = messageListType === 'thread' && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectAllowedMessageActions)(global, message, threadId) || {};
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectActiveDownloads)(global);
  const downloadableMedia = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageDownloadableMedia)(message);
  const isDownloading = downloadableMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, downloadableMedia);
  const repliesThreadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectThreadInfo)(global, chatId, album?.commentsMessage?.id || id);
  const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;
  const documentGroupFirstMessageId = isInDocumentGroup ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectMessageIdsByGroupId)(global, chatId, message.groupedId)[0] : undefined;
  const reactionMessage = isInDocumentGroup ? isLastInDocumentGroup ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, chatId, documentGroupFirstMessageId) : undefined : message;
  const hasUnreadReaction = chat?.unreadReactions?.includes(message.id);
  const hasTopicChip = threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && chat?.isForum && isFirstInGroup;
  const messageTopic = hasTopicChip ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTopicFromMessage)(global, message) || chat?.topics?.[_config__WEBPACK_IMPORTED_MODULE_4__.GENERAL_TOPIC_ID] : undefined;
  const chatTranslations = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatTranslations)(global, chatId);
  const requestedTranslationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectRequestedMessageTranslationLanguage)(global, chatId, message.id);
  const requestedChatTranslationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectRequestedChatTranslationLanguage)(global, chatId);
  const areTranslationsEnabled = _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_13__.IS_TRANSLATION_SUPPORTED && global.settings.byKey.canTranslate && !requestedChatTranslationLanguage; // Stop separate language detection if chat translation is requested

  const isConnected = global.connectionState === 'connectionStateReady';
  const hasActiveReactions = Boolean(reactionMessage && activeReactions[(0,_util_messageKey__WEBPACK_IMPORTED_MODULE_11__.getMessageKey)(reactionMessage)]?.length);
  const isPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserPremium)(global);
  const senderBoosts = sender && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatWithSelf)(global, sender.id) ? chatFullInfo?.boostsApplied ?? message.senderBoosts : message.senderBoosts;
  const chatLevel = chat?.boostLevel || 0;
  const transcribeMinLevel = global.appConfig?.groupTranscribeLevelMin;
  const canTranscribeVoice = isPremium || Boolean(transcribeMinLevel && chatLevel >= transcribeMinLevel);
  const viaBusinessBot = viaBusinessBotId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, viaBusinessBotId) : undefined;
  const effect = effectId ? global.availableEffectById[effectId] : undefined;
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTheme)(global),
    forceSenderName,
    sender,
    canShowSender,
    originSender,
    botSender,
    shouldHideReply: shouldHideReply || isReplyToTopicStart,
    isThreadTop,
    replyMessage,
    replyMessageSender,
    replyMessageForwardSender,
    replyMessageChat,
    replyStory,
    isReplyPrivate,
    storySender,
    isInDocumentGroup,
    isProtected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMessageProtected)(global, message),
    isChatProtected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatProtected)(global, chatId),
    isFocused,
    isForwarding,
    reactionMessage,
    isChatWithSelf,
    isRepliesChat,
    isAnonymousForwards,
    isChannel,
    isGroup,
    canReply,
    highlight,
    animatedEmoji,
    animatedCustomEmoji,
    isInSelectMode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsInSelectMode)(global),
    isSelected,
    isGroupSelected: Boolean(message.groupedId) && !message.isInAlbum && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsDocumentGroupSelected)(global, chatId, message.groupedId),
    threadId,
    isDownloading,
    isPinnedList: messageListType === 'pinned',
    isPinned,
    canAutoLoadMedia: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAutoLoadMedia)(global, message),
    canAutoPlayMedia: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAutoPlayMedia)(global, message),
    autoLoadFileMaxSizeMb: global.settings.byKey.autoLoadFileMaxSizeMb,
    shouldLoopStickers: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectShouldLoopStickers)(global),
    repliesThreadInfo,
    availableReactions: global.reactions.availableReactions,
    defaultReaction: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageLocal)(message) || messageListType === 'scheduled' ? undefined : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectDefaultReaction)(global, chatId),
    hasActiveReactions,
    activeEmojiInteractions,
    hasUnreadReaction,
    isTranscribing: transcriptionId !== undefined && global.transcriptions[transcriptionId]?.isPending,
    transcribedText: transcriptionId !== undefined ? global.transcriptions[transcriptionId]?.text : undefined,
    isPremium,
    senderAdminMember,
    messageTopic,
    hasTopicChip,
    chatTranslations,
    areTranslationsEnabled,
    shouldDetectChatLanguage: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectShouldDetectChatLanguage)(global, chatId),
    requestedTranslationLanguage,
    requestedChatTranslationLanguage,
    hasLinkedChat: Boolean(chatFullInfo?.linkedChatId),
    withAnimatedEffects: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPerformanceSettingsValue)(global, 'stickerEffects'),
    webPageStory,
    isConnected,
    isLoadingComments: repliesThreadInfo?.isCommentsInfo && loadingThread?.loadingChatId === repliesThreadInfo?.originChannelId && loadingThread?.loadingMessageId === repliesThreadInfo?.originMessageId,
    shouldWarnAboutSvg: global.settings.byKey.shouldWarnAboutSvg,
    ...(isOutgoing && {
      outgoingStatus: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectOutgoingStatus)(global, message, messageListType === 'scheduled')
    }),
    ...(typeof uploadProgress === 'number' && {
      uploadProgress
    }),
    ...(isFocused && {
      focusDirection,
      noFocusHighlight,
      isResizingContainer,
      focusedQuote,
      scrollTargetPosition
    }),
    senderBoosts,
    tags: global.savedReactionTags?.byKey,
    canTranscribeVoice,
    viaBusinessBot,
    effect
  };
})(Message)));

/***/ }),

/***/ "./src/components/middle/message/MessageAppendix.tsx":
/*!***********************************************************!*\
  !*** ./src/components/middle/message/MessageAppendix.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");

function MessageAppendix(_ref) {
  let {
    isOwn
  } = _ref;
  const path = isOwn ? 'M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z' : 'M3 17h6V0c-.193 2.84-.876 5.767-2.05 8.782-.904 2.325-2.446 4.485-4.625 6.48A1 1 0 003 17z';
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    width: "9",
    height: "20",
    className: "svg-appendix"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("defs", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("filter", {
    x: "-50%",
    y: "-14.7%",
    width: "200%",
    height: "141.2%",
    filterUnits: "objectBoundingBox",
    id: "messageAppendix"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feOffset", {
    dy: "1",
    in: "SourceAlpha",
    result: "shadowOffsetOuter1"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feGaussianBlur", {
    stdDeviation: "1",
    in: "shadowOffsetOuter1",
    result: "shadowBlurOuter1"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feColorMatrix", {
    values: "0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0",
    in: "shadowBlurOuter1"
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("g", {
    fill: "none",
    "fill-rule": "evenodd"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: path,
    fill: "#000",
    filter: "url(#messageAppendix)"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: path,
    fill: isOwn ? '#EEFFDE' : 'FFF',
    className: "corner"
  })));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageAppendix);

/***/ }),

/***/ "./src/components/middle/message/MessageMeta.tsx":
/*!*******************************************************!*\
  !*** ./src/components/middle/message/MessageMeta.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/MessageOutgoingStatus */ "./src/components/common/MessageOutgoingStatus.tsx");
/* harmony import */ var _MessageMeta_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./MessageMeta.scss */ "./src/components/middle/message/MessageMeta.scss");












const MessageMeta = _ref => {
  let {
    message,
    outgoingStatus,
    signature,
    withReactionOffset,
    repliesThreadInfo,
    renderQuickReactionButton,
    noReplies,
    isTranslated,
    isPinned,
    withFullDate,
    effectEmoji,
    onClick,
    onTranslationClick,
    onEffectClick,
    onOpenThread
  } = _ref;
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [isActivated, markActivated] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_6__["default"])();
  function handleImportedClick(e) {
    e.stopPropagation();
    showNotification({
      message: lang('ImportedInfo')
    });
  }
  function handleOpenThread(e) {
    e.stopPropagation();
    onOpenThread();
  }
  const title = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isActivated) return undefined;
    const createDateTime = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.date * 1000, lang.code, undefined, lang.timeFormat);
    const editDateTime = message.isEdited && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.editDate * 1000, lang.code, undefined, lang.timeFormat);
    const forwardedDateTime = message.forwardInfo && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)((message.forwardInfo.savedDate || message.forwardInfo.date) * 1000, lang.code, undefined, lang.timeFormat);
    let text = createDateTime;
    if (editDateTime) {
      text += '\n';
      text += lang('lng_edited_date').replace('{date}', editDateTime);
    }
    if (forwardedDateTime) {
      text += '\n';
      text += lang('lng_forwarded_date').replace('{date}', forwardedDateTime);
    }
    return text;
    // We need to listen to timeformat change
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [isActivated, lang, message, lang.timeFormat]);
  const date = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const time = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatTime)(lang, message.date * 1000);
    if (!withFullDate) {
      return time;
    }
    return (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatPastTimeShort)(lang, (message.forwardInfo?.date || message.date) * 1000, true);
  }, [lang, message.date, message.forwardInfo?.date, withFullDate]);
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('MessageMeta', withReactionOffset && 'reactions-offset', message.forwardInfo?.isImported && 'is-imported');
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: fullClassName,
    dir: lang.isRtl ? 'rtl' : 'ltr',
    onClick: onClick,
    "data-ignore-on-paste": true
  }, effectEmoji && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-effect-icon",
    onClick: onEffectClick
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(effectEmoji)), isTranslated && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "language",
    className: "message-translated",
    onClick: onTranslationClick
  }), Boolean(message.viewsCount) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-views"
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(message.viewsCount)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "channelviews"
  })), !noReplies && Boolean(repliesThreadInfo?.messagesCount) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    onClick: handleOpenThread,
    className: "message-replies-wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-replies"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__["default"], {
    text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(repliesThreadInfo.messagesCount)
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "reply-filled"
  })), isPinned && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "pinned-message",
    className: "message-pinned"
  }), signature && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-signature"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(signature)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-time",
    title: title,
    onMouseEnter: markActivated
  }, message.forwardInfo?.isImported && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-imported",
    onClick: handleImportedClick
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.forwardInfo.date * 1000, lang.code, true)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-imported",
    onClick: handleImportedClick
  }, lang('ImportedMessage'))), message.isEdited && `${lang('EditedMessage')} `, date), outgoingStatus && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_10__["default"], {
    status: outgoingStatus
  }), renderQuickReactionButton && renderQuickReactionButton());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageMeta));

/***/ }),

/***/ "./src/components/middle/message/MessagePhoneCall.tsx":
/*!************************************************************!*\
  !*** ./src/components/middle/message/MessagePhoneCall.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./MessagePhoneCall.module.scss */ "./src/components/middle/message/MessagePhoneCall.module.scss");









const MessagePhoneCall = _ref => {
  let {
    phoneCall,
    message,
    chatId
  } = _ref;
  const {
    requestMasterAndRequestCall
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    isOutgoing,
    isVideo,
    reason,
    duration
  } = phoneCall;
  const isMissed = reason === 'missed';
  const isCancelled = reason === 'busy' || duration === undefined;
  const handleCall = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    requestMasterAndRequestCall({
      isVideo,
      userId: chatId
    });
  });
  const reasonText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isVideo) {
      if (isMissed) return isOutgoing ? 'CallMessageVideoOutgoingMissed' : 'CallMessageVideoIncomingMissed';
      if (isCancelled) return 'CallMessageVideoIncomingDeclined';
      return isOutgoing ? 'CallMessageVideoOutgoing' : 'CallMessageVideoIncoming';
    } else {
      if (isMissed) return isOutgoing ? 'CallMessageOutgoingMissed' : 'CallMessageIncomingMissed';
      if (isCancelled) return 'CallMessageIncomingDeclined';
      return isOutgoing ? 'CallMessageOutgoing' : 'CallMessageIncoming';
    }
  }, [isCancelled, isMissed, isOutgoing, isVideo]);
  const formattedDuration = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return phoneCall.duration ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatTimeDuration)(lang, phoneCall.duration) : undefined;
  }, [lang, phoneCall.duration]);
  const timeFormatted = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatTime)(lang, message.date * 1000);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].root
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    size: "smaller",
    color: "translucent",
    round: true,
    ripple: true,
    onClick: handleCall,
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].button,
    disabled: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.ARE_CALLS_SUPPORTED,
    ariaLabel: lang(isOutgoing ? 'CallAgain' : 'CallBack')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('icon', isVideo ? 'icon-video-outlined' : 'icon-phone')
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].info
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].reason
  }, lang(reasonText)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].meta
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('icon', 'icon-arrow-right', _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].arrow, isMissed && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].missed, isCancelled && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].canceled, !isOutgoing && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].incoming)
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].duration
  }, formattedDuration ? lang('CallMessageWithDuration', [timeFormatted, formattedDuration]) : timeFormatted))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessagePhoneCall));

/***/ }),

/***/ "./src/components/middle/message/PaidMediaOverlay.tsx":
/*!************************************************************!*\
  !*** ./src/components/middle/message/PaidMediaOverlay.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/replaceWithTeact */ "./src/util/replaceWithTeact.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./PaidMediaOverlay.module.scss */ "./src/components/middle/message/PaidMediaOverlay.module.scss");












const PaidMediaOverlay = _ref => {
  let {
    paidMedia,
    chatId,
    messageId,
    isOutgoing,
    children
  } = _ref;
  const {
    openInvoice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isClickable = !paidMedia.isBought;
  const buttonText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const value = lang('UnlockPaidContent', paidMedia.starsAmount);
    return (0,_util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_5__.replaceWithTeact)(value, _config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].star,
      type: "gold",
      size: "adaptive"
    }));
  }, [lang, paidMedia]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(e => {
    openInvoice({
      type: 'message',
      chatId,
      messageId
    });
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    onClick: isClickable ? handleClick : undefined
  }, children, isClickable && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].buyButton,
    color: "dark",
    size: "tiny",
    fluid: true,
    pill: true
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].buttonText
  }, buttonText)), paidMedia.isBought && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('message-paid-media-status', _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].boughtStatus)
  }, isOutgoing ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_4__.formatCurrency)(paidMedia.starsAmount, _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE) : lang('Chat.PaidMedia.Purchased')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PaidMediaOverlay));

/***/ }),

/***/ "./src/components/middle/message/Poll.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/message/Poll.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AvatarList__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AvatarList */ "./src/components/common/AvatarList.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/CheckboxGroup */ "./src/components/ui/CheckboxGroup.tsx");
/* harmony import */ var _ui_Notification__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Notification */ "./src/components/ui/Notification.tsx");
/* harmony import */ var _ui_RadioGroup__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/RadioGroup */ "./src/components/ui/RadioGroup.tsx");
/* harmony import */ var _PollOption__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./PollOption */ "./src/components/middle/message/PollOption.tsx");
/* harmony import */ var _Poll_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Poll.scss */ "./src/components/middle/message/Poll.scss");














const SOLUTION_CONTAINER_ID = '#middle-column-portals';
const SOLUTION_DURATION = 5000;
const TIMER_RADIUS = 6;
const TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;
const TIMER_UPDATE_INTERVAL = 1000;
const NBSP = '\u00A0';
const Poll = _ref => {
  let {
    message,
    poll,
    recentVoterIds,
    observeIntersectionForLoading,
    observeIntersectionForPlaying,
    onSendVote
  } = _ref;
  const {
    loadMessage,
    openPollResults,
    requestConfetti
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    id: messageId,
    chatId
  } = message;
  const {
    summary,
    results
  } = poll;
  const [isSubmitting, setIsSubmitting] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [chosenOptions, setChosenOptions] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [isSolutionShown, setIsSolutionShown] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [wasSubmitted, setWasSubmitted] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [closePeriod, setClosePeriod] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!summary.closed && summary.closeDate && summary.closeDate > 0 ? Math.min(summary.closeDate - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)(), summary.closePeriod) : 0);
  // eslint-disable-next-line no-null/no-null
  const countdownRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const timerCircleRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    results: voteResults,
    totalVoters
  } = results;
  const hasVoted = voteResults && voteResults.some(r => r.isChosen);
  const canVote = !summary.closed && !hasVoted;
  const canViewResult = !canVote && summary.isPublic && Number(results.totalVoters) > 0;
  const isMultiple = canVote && summary.multipleChoice;
  const maxVotersCount = voteResults ? Math.max(...voteResults.map(r => r.votersCount)) : totalVoters;
  const correctResults = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return voteResults?.filter(r => r.isCorrect).map(r => r.option) || [];
  }, [voteResults]);
  const answers = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => summary.answers.map(a => ({
    label: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__.renderTextWithEntities)({
      text: a.text.text,
      entities: a.text.entities,
      observeIntersectionForLoading,
      observeIntersectionForPlaying
    }),
    value: a.option,
    hidden: Boolean(summary.quiz && summary.closePeriod && closePeriod <= 0)
  })), [closePeriod, observeIntersectionForLoading, observeIntersectionForPlaying, summary.answers, summary.closePeriod, summary.quiz]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const chosen = poll.results.results?.find(result => result.isChosen);
    if (isSubmitting && chosen) {
      if (chosen.isCorrect) {
        requestConfetti({});
      }
      setIsSubmitting(false);
    }
  }, [isSubmitting, poll.results.results, requestConfetti]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (closePeriod > 0) {
      setTimeout(() => setClosePeriod(closePeriod - 1), TIMER_UPDATE_INTERVAL);
    }
    if (!timerCircleRef.current) return;
    if (closePeriod <= 5) {
      countdownRef.current.classList.add('hurry-up');
    }
    const strokeDashOffset = (summary.closePeriod - closePeriod) / summary.closePeriod * TIMER_CIRCUMFERENCE;
    timerCircleRef.current.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);
  }, [closePeriod, summary.closePeriod]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (summary.quiz && (closePeriod <= 0 || hasVoted && !summary.closed)) {
      loadMessage({
        chatId,
        messageId
      });
    }
  }, [chatId, closePeriod, hasVoted, loadMessage, messageId, summary.closed, summary.quiz]);

  // If the client time is not synchronized, the poll must be updated after the closePeriod time has expired.
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let timer;
    if (summary.quiz && !summary.closed && summary.closePeriod && summary.closePeriod > 0) {
      timer = window.setTimeout(() => {
        loadMessage({
          chatId,
          messageId
        });
      }, summary.closePeriod * 1000);
    }
    return () => {
      if (timer) {
        window.clearTimeout(timer);
      }
    };
  }, [canVote, chatId, loadMessage, messageId, summary.closePeriod, summary.closed, summary.quiz]);
  const recentVoters = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // No need for expensive global updates on chats or users, so we avoid them
    const chatsById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chats.byId;
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    return recentVoterIds ? recentVoterIds.reduce((result, id) => {
      const chat = chatsById[id];
      const user = usersById[id];
      if (user) {
        result.push(user);
      } else if (chat) {
        result.push(chat);
      }
      return result;
    }, []) : [];
  }, [recentVoterIds]);
  const handleRadioChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(option => {
    setChosenOptions([option]);
    setIsSubmitting(true);
    setWasSubmitted(true);
    onSendVote([option]);
  });
  const handleCheckboxChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(options => {
    setChosenOptions(options);
  });
  const handleVoteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    setIsSubmitting(true);
    setWasSubmitted(true);
    onSendVote(chosenOptions);
  });
  const handleViewResultsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openPollResults({
      chatId,
      messageId
    });
  });
  const handleSolutionShow = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    setIsSolutionShown(true);
  });
  const handleSolutionHide = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    setIsSolutionShown(false);
    setWasSubmitted(false);
  });

  // Show the solution to quiz if the answer was incorrect
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (wasSubmitted && hasVoted && summary.quiz && results.results && poll.results.solution) {
      const correctResult = results.results.find(r => r.isChosen && r.isCorrect);
      if (!correctResult) {
        setIsSolutionShown(true);
      }
    }
  }, [hasVoted, wasSubmitted, results.results, summary.quiz, poll.results.solution]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  function renderResultOption(answer) {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PollOption__WEBPACK_IMPORTED_MODULE_12__["default"], {
      key: answer.option,
      shouldAnimate: wasSubmitted || !canVote,
      answer: answer,
      voteResults: voteResults,
      totalVoters: totalVoters,
      maxVotersCount: maxVotersCount,
      correctResults: correctResults
    });
  }
  function renderRecentVoters() {
    return recentVoters.length > 0 && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "poll-recent-voters"
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AvatarList__WEBPACK_IMPORTED_MODULE_7__["default"], {
      size: "micro",
      peers: recentVoters
    }));
  }
  function renderSolution() {
    return isSolutionShown && poll.results.solution && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Notification__WEBPACK_IMPORTED_MODULE_10__["default"], {
      message: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__.renderTextWithEntities)({
        text: poll.results.solution,
        entities: poll.results.solutionEntities
      }),
      duration: SOLUTION_DURATION,
      onDismiss: handleSolutionHide,
      containerId: SOLUTION_CONTAINER_ID
    });
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Poll",
    dir: lang.isRtl ? 'auto' : 'ltr'
  }, renderSolution(), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-question"
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__.renderTextWithEntities)({
    text: summary.question.text,
    entities: summary.question.entities,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-type"
  }, lang(getPollTypeString(summary)), renderRecentVoters(), closePeriod > 0 && canVote && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: countdownRef,
    className: "poll-countdown"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatMediaDuration)(closePeriod)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    width: "16px",
    height: "16px"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
    ref: timerCircleRef,
    cx: "8",
    cy: "8",
    r: TIMER_RADIUS,
    className: "poll-countdown-progress",
    transform: "rotate(-90, 8, 8)",
    "stroke-dasharray": TIMER_CIRCUMFERENCE,
    "stroke-dashoffset": "0"
  }))), summary.quiz && poll.results.solution && !canVote && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    round: true,
    size: "tiny",
    color: "translucent",
    className: "poll-quiz-help",
    disabled: isSolutionShown,
    onClick: handleSolutionShow,
    ariaLabel: "Show Solution"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-lamp"
  }))), canVote && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-answers",
    onClick: stopPropagation
  }, isMultiple ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_9__["default"], {
    options: answers,
    onChange: handleCheckboxChange,
    disabled: message.isScheduled || isSubmitting,
    loadingOptions: isSubmitting ? chosenOptions : undefined,
    round: true
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RadioGroup__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: `poll-${messageId}`,
    options: answers,
    onChange: handleRadioChange,
    disabled: message.isScheduled || isSubmitting,
    loadingOption: isSubmitting ? chosenOptions[0] : undefined
  })), !canVote && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-results"
  }, summary.answers.map(renderResultOption)), !canViewResult && !isMultiple && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-voters-count"
  }, getReadableVotersCount(lang, summary.quiz, results.totalVoters)), isMultiple && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isText: true,
    disabled: chosenOptions.length === 0,
    size: "tiny",
    onClick: handleVoteClick
  }, lang('PollSubmitVotes')), canViewResult && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isText: true,
    size: "tiny",
    onClick: handleViewResultsClick
  }, lang('PollViewResults')));
};
function getPollTypeString(summary) {
  // When we just created the poll, some properties don't exist.
  if (typeof summary.isPublic === 'undefined') {
    return NBSP;
  }
  if (summary.closed) {
    return 'FinalResults';
  }
  if (summary.quiz) {
    return summary.isPublic ? 'QuizPoll' : 'AnonymousQuizPoll';
  }
  return summary.isPublic ? 'PublicPoll' : 'AnonymousPoll';
}
function getReadableVotersCount(lang, isQuiz, count) {
  if (!count) {
    return lang(isQuiz ? 'Chat.Quiz.TotalVotesEmpty' : 'Chat.Poll.TotalVotesResultEmpty');
  }
  return lang(isQuiz ? 'Answer' : 'Vote', count, 'i');
}
function stopPropagation(e) {
  e.stopPropagation();
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    poll
  } = _ref2;
  const {
    recentVoterIds
  } = poll.results;
  const {
    users: {
      byId: usersById
    }
  } = global;
  if (!recentVoterIds || recentVoterIds.length === 0) {
    return {};
  }
  return {
    recentVoterIds,
    usersById
  };
})(Poll)));

/***/ }),

/***/ "./src/components/middle/message/PollOption.tsx":
/*!******************************************************!*\
  !*** ./src/components/middle/message/PollOption.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _PollOption_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./PollOption.scss */ "./src/components/middle/message/PollOption.scss");




const PollOption = _ref => {
  let {
    answer,
    voteResults,
    totalVoters,
    maxVotersCount,
    correctResults,
    shouldAnimate
  } = _ref;
  const result = voteResults && voteResults.find(r => r.option === answer.option);
  const correctAnswer = correctResults.length === 0 || correctResults.indexOf(answer.option) !== -1;
  const showIcon = correctResults.length > 0 && correctAnswer || result?.isChosen;
  const answerPercent = result ? getPercentage(result.votersCount, totalVoters || 0) : 0;
  const [finalPercent, setFinalPercent] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(shouldAnimate ? 0 : answerPercent);
  const lineWidth = result ? getPercentage(result.votersCount, maxVotersCount || 0) : 0;
  const isAnimationDoesNotStart = finalPercent !== answerPercent;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldAnimate) {
      setFinalPercent(answerPercent);
    }
  }, [shouldAnimate, answerPercent]);
  if (!voteResults || !result) {
    return undefined;
  }
  const lineStyle = `width: ${lineWidth}%; transform:scaleX(${isAnimationDoesNotStart ? 0 : 1})`;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "PollOption",
    dir: "ltr"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `poll-option-share ${answerPercent === '100' ? 'limit-width' : ''}`
  }, answerPercent, "%", showIcon && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('poll-option-chosen', !correctAnswer && 'wrong', shouldAnimate && 'animate')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('icon', correctAnswer ? 'icon-check' : 'icon-close')
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-right"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-text",
    dir: "auto"
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)({
    text: answer.text.text,
    entities: answer.text.entities
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('poll-option-answer', showIcon && !correctAnswer && 'wrong')
  }, shouldAnimate && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "poll-line",
    style: !isAnimationDoesNotStart ? 'stroke-dasharray: 100% 200%; stroke-dashoffset: -44' : ''
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M4.47 5.33v13.6a9 9 0 009 9h13"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-line",
    style: lineStyle
  }))));
};
function getPercentage(value, total) {
  return total > 0 ? (value / total * 100).toFixed() : 0;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollOption);

/***/ }),

/***/ "./src/components/middle/message/SponsoredMessage.tsx":
/*!************************************************************!*\
  !*** ./src/components/middle/message/SponsoredMessage.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/AboutAdsModal.async */ "./src/components/common/AboutAdsModal.async.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _MessageAppendix__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./MessageAppendix */ "./src/components/middle/message/MessageAppendix.tsx");
/* harmony import */ var _SponsoredMessageContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./SponsoredMessageContextMenuContainer.async */ "./src/components/middle/message/SponsoredMessageContextMenuContainer.async.tsx");
/* harmony import */ var _SponsoredMessage_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./SponsoredMessage.scss */ "./src/components/middle/message/SponsoredMessage.scss");





















const INTERSECTION_DEBOUNCE_MS = 200;
const SponsoredMessage = _ref => {
  let {
    chatId,
    peer,
    message,
    containerRef
  } = _ref;
  const {
    viewSponsoredMessage,
    openUrl,
    hideSponsoredMessages,
    clickSponsoredMessage,
    reportSponsoredMessage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const contentRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const shouldObserve = Boolean(message);
  const {
    observe: observeIntersection
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__.useIntersectionObserver)({
    rootRef: containerRef,
    debounceMs: INTERSECTION_DEBOUNCE_MS,
    threshold: 1
  });
  const {
    isContextMenuOpen,
    contextMenuPosition,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__["default"])(ref, undefined, true, _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_ANDROID);
  const [isAboutAdsModalOpen, openAboutAdsModal, closeAboutAdsModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(false);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const withAvatar = Boolean(message?.isAvatarShown && peer);
  const isBotApp = Boolean(message?.botApp);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return shouldObserve ? observeIntersection(contentRef.current, target => {
      if (target.isIntersecting) {
        viewSponsoredMessage({
          chatId
        });
      }
    }) : undefined;
  }, [chatId, shouldObserve, observeIntersection, viewSponsoredMessage]);
  const handleMouseDown = e => {
    (0,_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_6__.preventMessageInputBlur)(e);
    handleBeforeContextMenu(e);
  };
  const handleReportSponsoredMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    reportSponsoredMessage({
      chatId,
      randomId: message.randomId
    });
  });
  const handleHideSponsoredMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    hideSponsoredMessages();
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!message) return;
    clickSponsoredMessage({
      chatId
    });
    openUrl({
      url: message.url,
      shouldSkipModal: true
    });
  });
  if (!message) {
    return undefined;
  }
  function renderContent() {
    if (!message) return undefined;
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-title message-peer",
      dir: "auto"
    }, message.title), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-content with-meta",
      dir: "auto",
      ref: contentRef
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "text-content-inner",
      dir: "auto"
    }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__.renderTextWithEntities)({
      text: message.text.text,
      entities: message.text.entities
    }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
      className: "SponsoredMessage__button",
      size: "tiny",
      color: "translucent",
      isRectangular: true,
      onClick: handleClick
    }, message.buttonText));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    key: "sponsored-message",
    className: "SponsoredMessage Message open"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-content has-shadow has-solid-background has-appendix",
    dir: "auto",
    onMouseDown: handleMouseDown,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_16__["default"], {
    peerColor: message.peerColor,
    className: "content-inner",
    dir: "auto"
  }, message.photo && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "large",
    photo: message.photo,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('channel-avatar', lang.isRtl && 'is-rtl')
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-title message-type"
  }, message.isRecommended ? lang('Message.RecommendedLabel') : lang('SponsoredMessage'), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    onClick: openAboutAdsModal,
    className: "ad-about"
  }, lang('SponsoredMessageAdWhatIsThis'))), renderContent()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageAppendix__WEBPACK_IMPORTED_MODULE_18__["default"], null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-action-buttons"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('Close'),
    onClick: handleHideSponsoredMessage
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
    name: "close"
  })), message.canReport && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('More'),
    onClick: handleContextMenu,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
    name: "more"
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageAppendix__WEBPACK_IMPORTED_MODULE_18__["default"], null), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('Close'),
    onClick: handleCloseSponsoredMessage
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-close",
    "aria-hidden": true
  }))), contextMenuPosition && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SponsoredMessageContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_19__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuPosition,
    message: message,
    onAboutAds: openAboutAdsModal,
    onReportAd: handleReportSponsoredMessage,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isOpen: isAboutAdsModalOpen,
    isRevenueSharing: message.canReport,
    onClose: closeAboutAdsModal
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId
  } = _ref2;
  const message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectSponsoredMessage)(global, chatId);
  return {
    message
  };
})(SponsoredMessage)));

/***/ }),

/***/ "./src/components/middle/message/SponsoredMessageContextMenuContainer.async.tsx":
/*!**************************************************************************************!*\
  !*** ./src/components/middle/message/SponsoredMessageContextMenuContainer.async.tsx ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SponsoredMessageContextMenuContainerAsync = props => {
  const {
    isOpen
  } = props;
  const SponsoredMessageContextMenuContainer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SponsoredMessageContextMenuContainer', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return SponsoredMessageContextMenuContainer ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SponsoredMessageContextMenuContainer, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SponsoredMessageContextMenuContainerAsync);

/***/ }),

/***/ "./src/components/middle/message/Sticker.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/message/Sticker.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hooks/useOverlayPosition */ "./src/components/middle/message/hooks/useOverlayPosition.ts");
/* harmony import */ var _common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/AnimatedSticker */ "./src/components/common/AnimatedSticker.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Portal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Portal */ "./src/components/ui/Portal.ts");
/* harmony import */ var _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./Sticker.module.scss */ "./src/components/middle/message/Sticker.module.scss");



















// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L42
const EFFECT_SIZE_MULTIPLIER = 1 + 0.245 * 2;
const Sticker = _ref => {
  let {
    message,
    observeIntersection,
    observeIntersectionForPlaying,
    shouldLoop,
    shouldPlayEffect,
    withEffect,
    onStopEffect
  } = _ref;
  const {
    showNotification,
    openStickerSet
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__["default"])();

  // eslint-disable-next-line no-null/no-null
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);

  // eslint-disable-next-line no-null/no-null
  const effectRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const sticker = message.content.sticker;
  const {
    stickerSetInfo,
    isVideo,
    hasEffect
  } = sticker;
  const isMirrored = !message.isOutgoing;
  const mediaHash = sticker.isPreloadedGlobally ? undefined : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStickerMediaHash)(sticker, isVideo && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_WEBM_SUPPORTED ? 'pictogram' : 'inline');
  const canLoad = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__.useIsIntersecting)(ref, observeIntersection);
  const canPlay = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__.useIsIntersecting)(ref, observeIntersectionForPlaying);
  const mediaHashEffect = `sticker${sticker.id}?size=f`;
  const effectBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(mediaHashEffect, !canLoad || !hasEffect || !withEffect, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
  const [isPlayingEffect, startPlayingEffect, stopPlayingEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const handleEffectEnded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    stopPlayingEffect();
    onStopEffect?.();
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasEffect && withEffect && canPlay && shouldPlayEffect) {
      startPlayingEffect();
    }
  }, [hasEffect, canPlay, shouldPlayEffect, startPlayingEffect, withEffect]);
  const shouldRenderEffect = hasEffect && withEffect && effectBlobUrl && isPlayingEffect;
  (0,_hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_13__["default"])({
    anchorRef: ref,
    overlayRef: effectRef,
    isMirrored,
    isDisabled: !shouldRenderEffect
  });
  const openModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openStickerSet({
      stickerSetInfo: sticker.stickerSetInfo
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (hasEffect) {
      if (isPlayingEffect || !withEffect) {
        showNotification({
          message: lang('PremiumStickerTooltip'),
          action: {
            action: 'openStickerSet',
            payload: {
              stickerSetInfo: sticker.stickerSetInfo
            }
          },
          actionText: lang('ViewAction')
        });
        return;
      } else if (withEffect) {
        startPlayingEffect();
        return;
      }
    }
    openModal();
  });
  const isMemojiSticker = ('isMissing' in stickerSetInfo);
  const {
    width,
    height
  } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.getStickerDimensions)(sticker, isMobile);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('media-inner', _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].root, isMemojiSticker && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].inactive, hasEffect && isMirrored && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].mirrored);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: className,
    style: `width: ${width}px; height: ${height}px;`,
    onClick: !isMemojiSticker ? handleClick : undefined
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_15__["default"], {
    containerRef: ref,
    sticker: sticker,
    fullMediaHash: mediaHash,
    fullMediaClassName: "full-media",
    size: width,
    shouldLoop: shouldLoop,
    noLoad: !canLoad,
    noPlay: !canPlay,
    withSharedAnimation: true
  }), shouldRenderEffect && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Portal__WEBPACK_IMPORTED_MODULE_16__["default"], null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
    ref: effectRef,
    key: mediaHashEffect,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].effect, isMirrored && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].mirrored),
    tgsUrl: effectBlobUrl,
    size: width * EFFECT_SIZE_MULTIPLIER,
    play: true,
    isLowPriority: true,
    noLoop: true,
    onEnded: handleEffectEnded
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Sticker);

/***/ }),

/***/ "./src/components/middle/message/Story.tsx":
/*!*************************************************!*\
  !*** ./src/components/middle/message/Story.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _BaseStory__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./BaseStory */ "./src/components/middle/message/BaseStory.tsx");




function Story(_ref) {
  let {
    message,
    story,
    isProtected,
    isConnected
  } = _ref;
  const {
    storyData
  } = message.content;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_BaseStory__WEBPACK_IMPORTED_MODULE_3__["default"], {
    story: story || storyData,
    isProtected: isProtected,
    isConnected: isConnected
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    message
  } = _ref2;
  const {
    id,
    peerId
  } = message.content.storyData;
  return {
    story: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeerStory)(global, peerId, id),
    isConnected: global.connectionState === 'connectionStateReady'
  };
})(Story)));

/***/ }),

/***/ "./src/components/middle/message/StoryMention.tsx":
/*!********************************************************!*\
  !*** ./src/components/middle/message/StoryMention.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");










function StoryMention(_ref) {
  let {
    message,
    story,
    peer,
    isUnread,
    targetUser
  } = _ref;
  const {
    openStoryViewer
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    storyData
  } = message.content;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isSingleStory: true
    });
  });
  const isDeleted = story && 'isDeleted' in story;
  const isLoaded = story && 'content' in story;
  const video = isLoaded ? story.content.video : undefined;
  const imageHash = isLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story, 'pictogram') : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__["default"])(imageHash);
  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_6__["default"])(storyData.peerId, storyData.id, story);
  function getTitle() {
    if (peer && 'isSelf' in peer && peer.isSelf) {
      return isDeleted ? lang('ExpiredStoryMentioned', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(targetUser)) : lang('StoryYouMentionedTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(targetUser));
    }
    return isDeleted ? lang('ExpiredStoryMention') : lang('StoryMentionedTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getSenderTitle)(lang, peer));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('action-message-story-mention', isUnread && 'is-unread', isLoaded && 'with-preview'),
    tabIndex: 0,
    role: "button",
    onClick: isLoaded ? handleClick : undefined
  }, isLoaded && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "story-media-wrapper"
  }, thumbUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbUrl,
    alt: "",
    className: "story-media"
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "story-title"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(getTitle(), ['emoji', 'simple_markdown'])));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    message
  } = _ref2;
  const {
    id,
    peerId
  } = message.content.storyData;
  const lastReadId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeerStories)(global, peerId)?.lastReadId;
  return {
    story: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeerStory)(global, peerId, id),
    peer: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, peerId),
    targetUser: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, message.chatId),
    isUnread: Boolean(lastReadId && lastReadId < id)
  };
})(StoryMention)));

/***/ }),

/***/ "./src/components/middle/message/helpers/buildContentClassName.ts":
/*!************************************************************************!*\
  !*** ./src/components/middle/message/helpers/buildContentClassName.ts ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildContentClassName: () => (/* binding */ buildContentClassName)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./getSingularPaidMedia */ "./src/components/middle/message/helpers/getSingularPaidMedia.ts");



function buildContentClassName(message, album) {
  let {
    hasSubheader,
    isCustomShape,
    isLastInGroup,
    asForwarded,
    hasThread,
    forceSenderName,
    hasCommentCounter,
    hasActionButton,
    hasReactions,
    isGeoLiveActive,
    withVoiceTranscription,
    peerColorClass,
    hasOutsideReactions
  } = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  const {
    paidMedia
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message);
  const {
    photo: paidMediaPhoto,
    video: paidMediaVideo
  } = (0,_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_2__["default"])(paidMedia);
  const {
    photo = paidMediaPhoto,
    video = paidMediaVideo,
    audio,
    voice,
    document,
    poll,
    webPage,
    contact,
    location,
    invoice,
    storyData,
    giveaway,
    giveawayResults
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message);
  const text = album?.hasMultipleCaptions ? undefined : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(album?.captionMessage || message).text;
  const hasFactCheck = Boolean(message.factCheck?.text);
  const isRoundVideo = video?.mediaType === 'video' && video.isRound;
  const isInvertedMedia = message.isInvertedMedia;
  const isInvertibleMedia = photo || video && !isRoundVideo || album || webPage;
  const classNames = [_config__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_CONTENT_CLASS_NAME];
  const isMedia = storyData || photo || video || location || invoice?.extendedMedia || paidMedia;
  const hasText = text || location?.mediaType === 'venue' || isGeoLiveActive || hasFactCheck;
  const isMediaWithNoText = isMedia && !hasText;
  const isViaBot = Boolean(message.viaBotId);
  const hasFooter = (() => {
    if (isInvertedMedia && isInvertibleMedia) {
      if (hasReactions && !hasOutsideReactions) return true;
      if (hasFactCheck) return true;
      if (webPage && hasText) return true;
      return false;
    }
    return hasText;
  })();
  if (peerColorClass) {
    classNames.push(peerColorClass);
  }
  if (!isMedia && message.emojiOnlyCount) {
    classNames.push('emoji-only');
    if (message.emojiOnlyCount <= _config__WEBPACK_IMPORTED_MODULE_0__.EMOJI_SIZES) {
      classNames.push(`emoji-only-${message.emojiOnlyCount}`);
    }
  } else if (hasText) {
    classNames.push('text');
  } else {
    classNames.push('no-text');
  }
  if (hasActionButton) {
    classNames.push('has-action-button');
  }
  if (isCustomShape) {
    classNames.push('custom-shape');
    if (isRoundVideo) {
      classNames.push('round');
    }
    if (hasCommentCounter) {
      classNames.push('has-comment-counter');
    }
  }
  if (isMedia) {
    classNames.push('media');
  } else if (audio) {
    classNames.push('audio');
  } else if (voice) {
    classNames.push('voice');
    if (withVoiceTranscription) {
      classNames.push('with-voice-transcription');
    }
  } else if (document) {
    classNames.push('document');
  } else if (contact) {
    classNames.push('contact');
  } else if (poll) {
    classNames.push('poll');
  } else if (giveaway || giveawayResults) {
    classNames.push('giveaway');
  } else if (webPage) {
    classNames.push('web-page');
    if (webPage.photo || webPage.video) {
      classNames.push('media');
    }
    if (webPage.document) {
      classNames.push('document');
    }
  }
  if (invoice && !invoice.extendedMedia) {
    classNames.push('invoice');
  }
  if (storyData) {
    classNames.push('story');
  }
  if (asForwarded) {
    classNames.push('is-forwarded');
  }
  if (hasSubheader) {
    classNames.push('has-subheader');
  }
  if (hasThread) {
    classNames.push('has-replies');
  }
  if (hasReactions) {
    classNames.push('has-reactions');
  }
  if (hasOutsideReactions) {
    classNames.push('has-outside-reactions');
  }
  if (isViaBot) {
    classNames.push('is-via-bot');
  }
  if (forceSenderName) {
    classNames.push('force-sender-name');
  }
  if (!isCustomShape) {
    classNames.push('has-shadow');
    if (isMedia && hasThread) {
      classNames.push('has-background');
    }
    if (hasSubheader || asForwarded || isViaBot || !isMediaWithNoText || forceSenderName || hasFactCheck) {
      classNames.push('has-solid-background');
    }
    if (hasFactCheck) {
      classNames.push('has-fact-check');
    }
    if (isLastInGroup && (photo || !isMediaWithNoText || location && asForwarded)) {
      classNames.push('has-appendix');
    }
  }
  if (isInvertibleMedia && isInvertedMedia) {
    classNames.push('is-inverted-media');
  }
  if (hasFooter) {
    classNames.push('has-footer');
  } else {
    classNames.push('no-footer');
  }
  return classNames.join(' ');
}

/***/ }),

/***/ "./src/components/middle/message/helpers/calculateAlbumLayout.ts":
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/helpers/calculateAlbumLayout.ts ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AlbumRectPart: () => (/* binding */ AlbumRectPart),
/* harmony export */   calculateAlbumLayout: () => (/* binding */ calculateAlbumLayout)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/math */ "./src/util/math.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _mediaDimensions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* eslint-disable no-bitwise */
// Based on
// https://github.com/telegramdesktop/tdesktop/blob/dev/Telegram/SourceFiles/ui/grouped_layout.cpp
// https://github.com/overtake/TelegramSwift/blob/master/Telegram-Mac/GroupedLayout.swift#L83





const AlbumRectPart = {
  None: 0,
  Top: 1,
  Right: 2,
  Bottom: 4,
  Left: 8
};
function getRatios(messages, isSingleMessage, isMobile) {
  const isOutgoing = messages[0].isOutgoing;
  const allMedia = (isSingleMessage ? messages[0].content.paidMedia.extendedMedia.map(media => 'mediaType' in media ? media : media.photo || media.video) : messages.map(message => (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getMessageContent)(message).photo || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getMessageContent)(message).video)).filter(Boolean);
  return allMedia.map(media => {
    const dimensions = (0,_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.calculateMediaDimensions)({
      media,
      isOwn: isOutgoing,
      isMobile
    });
    return dimensions.width / dimensions.height;
  });
}
function getProportions(ratios) {
  return ratios.map(ratio => ratio > 1.2 ? 'w' : ratio < 0.8 ? 'n' : 'q').join('');
}
function getAverageRatio(ratios) {
  return ratios.reduce((result, ratio) => ratio + result, 1) / ratios.length;
}
function accumulate(list, initValue) {
  return list.reduce((accumulator, item) => accumulator + item, initValue);
}
function cropRatios(ratios, averageRatio) {
  return ratios.map(ratio => {
    return averageRatio > 1.1 ? (0,_util_math__WEBPACK_IMPORTED_MODULE_1__.clamp)(ratio, 1, 2.75) : (0,_util_math__WEBPACK_IMPORTED_MODULE_1__.clamp)(ratio, 0.6667, 1);
  });
}
function calculateContainerSize(layout) {
  const styles = {
    width: 0,
    height: 0
  };
  layout.forEach(_ref => {
    let {
      dimensions,
      sides
    } = _ref;
    if (sides & AlbumRectPart.Right) {
      styles.width = dimensions.width + dimensions.x;
    }
    if (sides & AlbumRectPart.Bottom) {
      styles.height = dimensions.height + dimensions.y;
    }
  });
  return styles;
}
function calculateAlbumLayout(isOwn, asForwarded, noAvatars, album, isMobile) {
  const spacing = 2;
  const ratios = getRatios(album.messages, album.isPaidMedia, isMobile);
  const proportions = getProportions(ratios);
  const averageRatio = getAverageRatio(ratios);
  const albumCount = ratios.length;
  const forceCalc = ratios.some(ratio => ratio > 2);
  const maxWidth = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.getAvailableWidth)(isOwn, asForwarded, false, noAvatars, isMobile) - (asForwarded ? 2.5 : 0) * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
  const maxHeight = maxWidth;
  let layout;
  const params = {
    ratios,
    proportions,
    averageRatio,
    maxWidth,
    minWidth: 100,
    maxHeight,
    spacing
  };
  if (albumCount >= 5 || forceCalc) {
    layout = layoutWithComplexLayouter(params);
  } else if (albumCount === 2) {
    layout = layoutTwo(params);
  } else if (albumCount === 3) {
    layout = layoutThree(params);
  } else {
    layout = layoutFour(params);
  }
  return {
    layout,
    containerStyle: calculateContainerSize(layout)
  };
}
function layoutWithComplexLayouter(_ref2) {
  let {
    ratios: originalRatios,
    averageRatio,
    maxWidth,
    minWidth,
    spacing,
    maxHeight = 4 * maxWidth / 3
  } = _ref2;
  const ratios = cropRatios(originalRatios, averageRatio);
  const count = originalRatios.length;
  const result = new Array(count);
  const attempts = [];
  const multiHeight = (offset, attemptCount) => {
    const attemptRatios = ratios.slice(offset, offset + attemptCount);
    const sum = accumulate(attemptRatios, 0);
    return (maxWidth - (attemptCount - 1) * spacing) / sum;
  };
  const pushAttempt = lineCounts => {
    const heights = [];
    let offset = 0;
    lineCounts.forEach(currentCount => {
      heights.push(multiHeight(offset, currentCount));
      offset += currentCount;
    });
    attempts.push({
      lineCounts,
      heights
    });
  };
  for (let first = 1; first !== count; ++first) {
    const second = count - first;
    if (first <= 3 && second <= 3) {
      pushAttempt([first, second]);
    }
  }
  for (let first = 1; first !== count - 1; ++first) {
    for (let second = 1; second !== count - first; ++second) {
      const third = count - first - second;
      if (first <= 3 && second <= (averageRatio < 0.85 ? 4 : 3) && third <= 3) {
        pushAttempt([first, second, third]);
      }
    }
  }
  for (let first = 1; first !== count - 1; ++first) {
    for (let second = 1; second !== count - first; ++second) {
      for (let third = 1; third !== count - first - second; ++third) {
        const fourth = count - first - second - third;
        if (first <= 3 && second <= 3 && third <= 3 && fourth <= 4) {
          pushAttempt([first, second, third, fourth]);
        }
      }
    }
  }
  let optimalAttempt;
  let optimalDiff = 0;
  for (let i = 0; i < attempts.length; i++) {
    const {
      heights,
      lineCounts
    } = attempts[i];
    const lineCount = lineCounts.length;
    const totalHeight = accumulate(heights, 0) + spacing * (lineCount - 1);
    const minLineHeight = Math.min(...heights);
    const bad1 = minLineHeight < minWidth ? 1.5 : 1;
    const bad2 = (() => {
      for (let line = 1; line !== lineCount; ++line) {
        if (lineCounts[line - 1] > lineCounts[line]) {
          return 1.5;
        }
      }
      return 1;
    })();
    const diff = Math.abs(totalHeight - maxHeight) * bad1 * bad2;
    if (!optimalAttempt || diff < optimalDiff) {
      optimalAttempt = attempts[i];
      optimalDiff = diff;
    }
  }
  const optimalCounts = optimalAttempt.lineCounts;
  const optimalHeights = optimalAttempt.heights;
  const rowCount = optimalCounts.length;
  let index = 0;
  let y = 0;
  for (let row = 0; row !== rowCount; ++row) {
    const colCount = optimalCounts[row];
    const lineHeight = optimalHeights[row];
    const height = Math.round(lineHeight);
    let x = 0;
    for (let col = 0; col !== colCount; ++col) {
      const sides = AlbumRectPart.None | (row === 0 ? AlbumRectPart.Top : AlbumRectPart.None) | (row === rowCount - 1 ? AlbumRectPart.Bottom : AlbumRectPart.None) | (col === 0 ? AlbumRectPart.Left : AlbumRectPart.None) | (col === colCount - 1 ? AlbumRectPart.Right : AlbumRectPart.None);
      const ratio = ratios[index];
      const width = col === colCount - 1 ? maxWidth - x : Math.round(ratio * lineHeight);
      result[index] = {
        dimensions: {
          x,
          y,
          width,
          height
        },
        sides
      };
      x += width + spacing;
      ++index;
    }
    y += height + spacing;
  }
  return result;
}
function layoutTwo(params) {
  const {
    ratios,
    proportions,
    averageRatio
  } = params;
  return proportions === 'ww' && averageRatio > 1.4 && ratios[1] - ratios[0] < 0.2 ? layoutTwoTopBottom(params) : proportions === 'ww' || proportions === 'qq' ? layoutTwoLeftRightEqual(params) : layoutTwoLeftRight(params);
}
function layoutTwoTopBottom(params) {
  const {
    ratios,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const height = Math.round(Math.min(maxWidth / ratios[0], Math.min(maxWidth / ratios[1], (maxHeight - spacing) / 2)));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: maxWidth,
      height
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: height + spacing,
      width: maxWidth,
      height
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutTwoLeftRightEqual(params) {
  const {
    ratios,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const width = (maxWidth - spacing) / 2;
  const height = Math.round(Math.min(width / ratios[0], Math.min(width / ratios[1], maxHeight)));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: width + spacing,
      y: 0,
      width,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutTwoLeftRight(params) {
  const {
    ratios,
    minWidth,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const minimalWidth = Math.round(1.5 * minWidth);
  const secondWidth = Math.min(Math.round(Math.max(0.4 * (maxWidth - spacing), (maxWidth - spacing) / ratios[0] / (1 / ratios[0] + 1 / ratios[1]))), maxWidth - spacing - minimalWidth);
  const firstWidth = maxWidth - secondWidth - spacing;
  const height = Math.min(maxHeight, Math.round(Math.min(firstWidth / ratios[0], secondWidth / ratios[1])));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: firstWidth,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: firstWidth + spacing,
      y: 0,
      width: secondWidth,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutThree(params) {
  const {
    proportions
  } = params;
  return proportions[0] === 'n' ? layoutThreeLeftAndOther(params) : layoutThreeTopAndOther(params);
}
function layoutThreeLeftAndOther(params) {
  const {
    maxHeight,
    spacing,
    ratios,
    maxWidth,
    minWidth
  } = params;
  const firstHeight = maxHeight;
  const thirdHeight = Math.round(Math.min((maxHeight - spacing) / 2, ratios[1] * (maxWidth - spacing) / (ratios[2] + ratios[1])));
  const secondHeight = firstHeight - thirdHeight - spacing;
  const rightWidth = Math.max(minWidth, Math.round(Math.min((maxWidth - spacing) / 2, Math.min(thirdHeight * ratios[2], secondHeight * ratios[1]))));
  const leftWidth = Math.min(Math.round(firstHeight * ratios[0]), maxWidth - spacing - rightWidth);
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: leftWidth,
      height: firstHeight
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: leftWidth + spacing,
      y: 0,
      width: rightWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: leftWidth + spacing,
      y: secondHeight + spacing,
      width: rightWidth,
      height: thirdHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutThreeTopAndOther(params) {
  const {
    maxWidth,
    ratios,
    maxHeight,
    spacing
  } = params;
  const firstWidth = maxWidth;
  const firstHeight = Math.round(Math.min(firstWidth / ratios[0], 0.66 * (maxHeight - spacing)));
  const secondWidth = (maxWidth - spacing) / 2;
  const secondHeight = Math.min(maxHeight - firstHeight - spacing, Math.round(Math.min(secondWidth / ratios[1], secondWidth / ratios[2])));
  const thirdWidth = firstWidth - secondWidth - spacing;
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: firstWidth,
      height: firstHeight
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: firstHeight + spacing,
      width: secondWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Left
  }, {
    dimensions: {
      x: secondWidth + spacing,
      y: firstHeight + spacing,
      width: thirdWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutFour(params) {
  const {
    proportions
  } = params;
  return proportions[0] === 'w' ? layoutFourTopAndOther(params) : layoutFourLeftAndOther(params);
}
function layoutFourTopAndOther(_ref3) {
  let {
    maxWidth,
    ratios,
    spacing,
    maxHeight,
    minWidth
  } = _ref3;
  const w = maxWidth;
  const h0 = Math.round(Math.min(w / ratios[0], 0.66 * (maxHeight - spacing)));
  const h = Math.round((maxWidth - 2 * spacing) / (ratios[1] + ratios[2] + ratios[3]));
  const w0 = Math.max(minWidth, Math.round(Math.min(0.4 * (maxWidth - 2 * spacing), h * ratios[1])));
  const w2 = Math.round(Math.max(Math.max(minWidth, 0.33 * (maxWidth - 2 * spacing)), h * ratios[3]));
  const w1 = w - w0 - w2 - 2 * spacing;
  const h1 = Math.min(maxHeight - h0 - spacing, h);
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: w,
      height: h0
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: h0 + spacing,
      width: w0,
      height: h1
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Left
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + spacing,
      width: w1,
      height: h1
    },
    sides: AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: w0 + spacing + w1 + spacing,
      y: h0 + spacing,
      width: w2,
      height: h1
    },
    sides: AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutFourLeftAndOther(_ref4) {
  let {
    maxHeight,
    ratios,
    maxWidth,
    spacing,
    minWidth
  } = _ref4;
  const h = maxHeight;
  const w0 = Math.round(Math.min(h * ratios[0], 0.6 * (maxWidth - spacing)));
  const w = Math.round((maxHeight - 2 * spacing) / (1 / ratios[1] + 1 / ratios[2] + 1 / ratios[3]));
  const h0 = Math.round(w / ratios[1]);
  const h1 = Math.round(w / ratios[2]);
  const h2 = h - h0 - h1 - 2 * spacing;
  const w1 = Math.max(minWidth, Math.min(maxWidth - w0 - spacing, w));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: w0,
      height: h
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: w0 + spacing,
      y: 0,
      width: w1,
      height: h0
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + spacing,
      width: w1,
      height: h1
    },
    sides: AlbumRectPart.Right
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + h1 + 2 * spacing,
      width: w1,
      height: h2
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}

/***/ }),

/***/ "./src/components/middle/message/helpers/getSingularPaidMedia.ts":
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/helpers/getSingularPaidMedia.ts ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getSingularPaidMedia)
/* harmony export */ });
function getSingularPaidMedia(media) {
  if (!media || media.extendedMedia.length !== 1) {
    return {
      photo: undefined,
      video: undefined
    };
  }
  const singularMedia = media.extendedMedia[0];
  const isPreview = ('mediaType' in singularMedia);
  const photo = isPreview ? !singularMedia.duration ? singularMedia : undefined : singularMedia.photo;
  const video = isPreview ? singularMedia.duration ? singularMedia : undefined : singularMedia.video;
  return {
    photo,
    video
  };
}

/***/ }),

/***/ "./src/components/middle/message/hocs/withSelectControl.tsx":
/*!******************************************************************!*\
  !*** ./src/components/middle/message/hocs/withSelectControl.tsx ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ withSelectControl)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");





function withSelectControl(WrappedComponent) {
  // eslint-disable-next-line @typescript-eslint/comma-dangle
  const ComponentWithSelectControl = props => {
    const {
      isInSelectMode,
      isSelected,
      dimensions,
      clickArg
    } = props;
    const {
      toggleMessageSelection
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    const handleMessageSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
      e.stopPropagation();
      toggleMessageSelection({
        messageId: clickArg,
        withShift: e?.shiftKey
      });
    });
    const newProps = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
      const {
        dimensions: dims,
        onClick
      } = props;
      return {
        ...props,
        isInSelectMode,
        isSelected,
        dimensions: {
          ...dims,
          x: 0,
          y: 0
        },
        onClick: isInSelectMode ? undefined : onClick
      };
    }, [props, isInSelectMode, isSelected]);
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('album-item-select-wrapper', isSelected && 'is-selected'),
      style: dimensions ? `left: ${dimensions.x}px; top: ${dimensions.y}px;` : '',
      onClick: isInSelectMode ? handleMessageSelect : undefined
    }, isInSelectMode && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-select-control"
    }, isSelected && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
      className: "icon icon-select"
    })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(WrappedComponent, newProps));
  };
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, ownProps) => {
    const {
      clickArg
    } = ownProps;
    return {
      isInSelectMode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsInSelectMode)(global),
      isSelected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsMessageSelected)(global, clickArg)
    };
  })(ComponentWithSelectControl));
}

/***/ }),

/***/ "./src/components/middle/message/hooks/useDetectChatLanguage.ts":
/*!**********************************************************************!*\
  !*** ./src/components/middle/message/hooks/useDetectChatLanguage.ts ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useDetectChatLanguage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_primitives_LimitedMap__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/primitives/LimitedMap */ "./src/util/primitives/LimitedMap.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/schedulers */ "./src/util/schedulers.ts");





// https://github.com/DrKLO/Telegram/blob/dfd74f809e97d1ecad9672fc7388cb0223a95dfc/TMessagesProj/src/main/java/org/telegram/messenger/TranslateController.java#L35
const MIN_MESSAGES_CHECKED = 8;
const MIN_TRANSLATABLE_RATIO = 0.3;
const MIN_DETECTABLE_RATIO = 0.6;
const THROTTLE_DELAY = 1000;
const MESSAGES_LIMIT = 150;
const CHAT_STATS = new Map();
function useDetectChatLanguage(message, detectedLanguage, isDisabled, getIsReady) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || getIsReady && !getIsReady()) return;
    const isTranslatable = Boolean(message.content.text?.text.length);
    processMessageMetadata(message.chatId, message.id, isTranslatable, detectedLanguage);
  }, [message, detectedLanguage, isDisabled, getIsReady]);
}
const throttledMakeChatDecision = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(makeChatDecision, THROTTLE_DELAY);
function processMessageMetadata(chatId, id, isTranslatable, detectedLanguage) {
  const chatStats = CHAT_STATS.get(chatId) || new _util_primitives_LimitedMap__WEBPACK_IMPORTED_MODULE_2__["default"](MESSAGES_LIMIT);
  const previousMetadata = chatStats.get(id);
  if (previousMetadata && previousMetadata.detectedLanguage === detectedLanguage && previousMetadata.isTranslatable === isTranslatable) {
    return;
  }
  chatStats.set(id, {
    id,
    isTranslatable,
    detectedLanguage
  });
  CHAT_STATS.set(chatId, chatStats);
  throttledMakeChatDecision(chatId);
}
function makeChatDecision(chatId) {
  const {
    updateChatDetectedLanguage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const chatStats = CHAT_STATS.get(chatId);
  if (!chatStats) {
    return;
  }
  const messagesChecked = chatStats.size;
  if (messagesChecked < MIN_MESSAGES_CHECKED) {
    return;
  }
  let translatableCount = 0;
  let detectableCount = 0;
  const languageOccurrences = new Map();
  for (const metadata of chatStats.values()) {
    if (metadata.isTranslatable) {
      translatableCount++;
    }
    if (metadata.detectedLanguage) {
      detectableCount++;
    }
    const language = metadata.detectedLanguage;
    if (language) {
      const occurrences = languageOccurrences.get(language) || 0;
      languageOccurrences.set(language, occurrences + 1);
    }
  }
  const translatableRatio = translatableCount / messagesChecked;
  const detectableRatio = detectableCount / messagesChecked;
  if (translatableRatio < MIN_TRANSLATABLE_RATIO || detectableRatio < MIN_DETECTABLE_RATIO) {
    return;
  }
  const mostFrequentLanguage = Array.from(languageOccurrences.entries()).sort((_ref, _ref2) => {
    let [, a] = _ref;
    let [, b] = _ref2;
    return b - a;
  })[0][0];
  updateChatDetectedLanguage({
    chatId,
    detectedLanguage: mostFrequentLanguage
  });
}

/***/ }),

/***/ "./src/components/middle/message/hooks/useInnerHandlers.ts":
/*!*****************************************************************!*\
  !*** ./src/components/middle/message/hooks/useInnerHandlers.ts ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useInnerHandlers)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers_replies__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");





function useInnerHandlers(lang, selectMessage, message, chatId, threadId, isInDocumentGroup, asForwarded, isScheduled, album, avatarPeer, senderPeer, botSender, messageTopic, isTranslatingChat, story, isReplyPrivate, isRepliesChat) {
  const {
    openChat,
    showNotification,
    focusMessage,
    openMediaViewer,
    openAudioPlayer,
    markMessagesRead,
    cancelUploadMedia,
    sendPollVote,
    openForwardMenu,
    openChatLanguageModal,
    openThread,
    openStoryViewer,
    searchChatMediaMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)();
  const {
    id: messageId,
    forwardInfo,
    groupedId,
    content: {
      paidMedia
    }
  } = message;
  const {
    replyToMsgId,
    replyToPeerId,
    replyToTopId,
    isQuote,
    quoteText
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_3__.getMessageReplyInfo)(message) || {};
  const handleAvatarClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!avatarPeer) {
      return;
    }
    openChat({
      id: avatarPeer.id
    });
  });
  const handleSenderClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!senderPeer) {
      showNotification({
        message: lang('HidAccount')
      });
      return;
    }
    if (asForwarded && forwardInfo?.channelPostId) {
      focusMessage({
        chatId: senderPeer.id,
        messageId: forwardInfo.channelPostId
      });
    } else {
      openChat({
        id: senderPeer.id
      });
    }
  });
  const handleViaBotClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!botSender) {
      return;
    }
    openChat({
      id: botSender.id
    });
  });
  const handleReplyClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!replyToMsgId || isReplyPrivate) {
      showNotification({
        message: isQuote ? lang('QuotePrivate') : lang('ReplyPrivate')
      });
      return;
    }
    focusMessage({
      chatId: replyToPeerId || chatId,
      threadId: isRepliesChat ? replyToTopId : threadId,
      // Open comments from Replies bot, otherwise, keep current thread
      messageId: replyToMsgId,
      replyMessageId: replyToPeerId ? undefined : messageId,
      noForumTopicPanel: !replyToPeerId,
      // Open topic panel for cross-chat replies
      ...(isQuote && {
        quote: quoteText?.text
      })
    });
  });
  const handleMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openMediaViewer({
      chatId,
      threadId,
      messageId,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledInline : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Inline
    });
  });
  const openMediaViewerWithPhotoOrVideo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(withDynamicLoading => {
    if (paidMedia && !paidMedia.isBought) return;
    if (paidMedia) return; // TODO: Implement MV and remove this line
    if (withDynamicLoading) {
      searchChatMediaMessages({
        chatId,
        threadId,
        currentMediaMessageId: messageId
      });
    }
    openMediaViewer({
      chatId,
      threadId,
      messageId,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledInline : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Inline,
      withDynamicLoading
    });
  });
  const handlePhotoMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    const withDynamicLoading = !isScheduled;
    openMediaViewerWithPhotoOrVideo(withDynamicLoading);
  });
  const handleVideoMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    const isGif = message.content?.video?.isGif;
    const withDynamicLoading = !isGif && !isScheduled;
    openMediaViewerWithPhotoOrVideo(withDynamicLoading);
  });
  const handleAudioPlay = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openAudioPlayer({
      chatId,
      messageId
    });
  });
  const handleAlbumMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])((albumMessageId, albumIndex) => {
    if (paidMedia && !paidMedia.isBought) return;
    searchChatMediaMessages({
      chatId,
      threadId,
      currentMediaMessageId: messageId
    });
    openMediaViewer({
      chatId,
      threadId,
      messageId: albumMessageId,
      mediaIndex: albumIndex,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledAlbum : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Album,
      withDynamicLoading: !paidMedia
    });
  });
  const handleReadMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    markMessagesRead({
      messageIds: [messageId]
    });
  });
  const handleCancelUpload = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    cancelUploadMedia({
      chatId,
      messageId
    });
  });
  const handleVoteSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(options => {
    sendPollVote({
      chatId,
      messageId,
      options
    });
  });
  const handleGroupForward = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openForwardMenu({
      fromChatId: chatId,
      groupedId
    });
  });
  const handleForward = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (album && album.messages) {
      const messageIds = album.messages.map(_ref => {
        let {
          id
        } = _ref;
        return id;
      });
      openForwardMenu({
        fromChatId: chatId,
        messageIds
      });
    } else {
      openForwardMenu({
        fromChatId: chatId,
        messageIds: [messageId]
      });
    }
  });
  const handleFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    focusMessage({
      chatId,
      threadId: _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID,
      messageId
    });
  });
  const handleFocusForwarded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (isInDocumentGroup) {
      focusMessage({
        chatId: forwardInfo.fromChatId,
        groupedId,
        groupedChatId: chatId,
        messageId: forwardInfo.fromMessageId
      });
      return;
    }
    if (replyToPeerId && replyToTopId) {
      focusMessage({
        chatId: replyToPeerId,
        threadId: replyToTopId,
        messageId: forwardInfo.fromMessageId
      });
    } else {
      focusMessage({
        chatId: forwardInfo.fromChatId,
        messageId: forwardInfo.fromMessageId
      });
    }
  });
  const selectWithGroupedId = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
    e.stopPropagation();
    selectMessage(e, groupedId);
  });
  const handleTranslationClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
    e.stopPropagation();
    openChatLanguageModal({
      chatId,
      messageId: !isTranslatingChat ? messageId : undefined
    });
  });
  const handleOpenThread = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openThread({
      chatId: message.chatId,
      threadId: message.id
    });
  });
  const handleTopicChipClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!messageTopic) return;
    focusMessage({
      chatId: replyToPeerId || chatId,
      threadId: messageTopic.id,
      messageId
    });
  });
  const handleStoryClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!story) return;
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSingleStory: true
    });
  });
  return {
    handleAvatarClick,
    handleSenderClick,
    handleViaBotClick,
    handleReplyClick,
    handleMediaClick,
    handleAudioPlay,
    handleAlbumMediaClick,
    handlePhotoMediaClick,
    handleVideoMediaClick,
    handleMetaClick: selectWithGroupedId,
    handleTranslationClick,
    handleOpenThread,
    handleReadMedia,
    handleCancelUpload,
    handleVoteSend,
    handleGroupForward,
    handleForward,
    handleFocus,
    handleFocusForwarded,
    handleDocumentGroupSelectAll: selectWithGroupedId,
    handleTopicChipClick,
    handleStoryClick
  };
}

/***/ }),

/***/ "./src/components/middle/message/hooks/useOuterHandlers.ts":
/*!*****************************************************************!*\
  !*** ./src/components/middle/message/hooks/useOuterHandlers.ts ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useOuterHandlers)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");











const ANDROID_KEYBOARD_HIDE_DELAY_MS = 350;
const SWIPE_ANIMATION_DURATION = 150;
const QUICK_REACTION_DOUBLE_TAP_DELAY = 200;
const QUICK_REACTION_AREA_WIDTH = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.REM;
const QUICK_REACTION_AREA_HEIGHT = Number(_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.REM);
const GROUP_MESSAGE_HOVER_ATTRIBUTE = 'data-is-document-group-hover';
function useOuterHandlers(selectMessage, containerRef, messageId, isInSelectMode, canReply, isProtected, onContextMenu, handleBeforeContextMenu, chatId, isContextMenuShown, quickReactionRef, shouldHandleMouseLeave, getIsMessageListReady) {
  const {
    updateDraftReplyInfo,
    sendDefaultReaction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isQuickReactionVisible, markQuickReactionVisible, unmarkQuickReactionVisible] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isSwiped, markSwiped, unmarkSwiped] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const doubleTapTimeoutRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  function handleMouseDown(e) {
    (0,_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_8__.preventMessageInputBlur)(e);
    handleBeforeContextMenu(e);
  }
  const handleMouseMove = (0,_hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    const quickReactionContainer = quickReactionRef.current;
    if (!quickReactionContainer) return;
    const {
      clientX,
      clientY
    } = e;
    const {
      x: quickReactionX,
      width: quickReactionWidth,
      y: quickReactionY,
      height: quickReactionHeight
    } = quickReactionContainer.getBoundingClientRect();
    const x = quickReactionX + quickReactionWidth / 2;
    const y = quickReactionY + quickReactionHeight / 2;
    const isVisibleX = Math.abs(x - clientX) < QUICK_REACTION_AREA_WIDTH;
    const isVisibleY = Math.abs(y - clientY) < QUICK_REACTION_AREA_HEIGHT;
    if (isVisibleX && isVisibleY) {
      markQuickReactionVisible();
    } else {
      unmarkQuickReactionVisible();
    }
  }, [quickReactionRef], _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure);
  function handleSendQuickReaction(e) {
    e.stopPropagation();
    sendDefaultReaction({
      chatId,
      messageId
    });
  }
  function handleTap(e) {
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_ANDROID) {
      const target = e.target;
      if (!target.classList.contains('text-content') && !target.classList.contains('Message')) {
        return;
      }
      if (_util_windowSize__WEBPACK_IMPORTED_MODULE_6__["default"].getIsKeyboardVisible()) {
        setTimeout(() => {
          onContextMenu(e);
        }, ANDROID_KEYBOARD_HIDE_DELAY_MS);
      } else {
        onContextMenu(e);
      }
    }
  }
  function handleDoubleTap() {
    sendDefaultReaction({
      chatId,
      messageId
    });
  }
  function handleClick(e) {
    if (isInSelectMode) {
      selectMessage(e);
      return;
    }
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) return;
    if (doubleTapTimeoutRef.current) {
      clearInterval(doubleTapTimeoutRef.current);
      doubleTapTimeoutRef.current = undefined;
      handleDoubleTap();
      return;
    }
    doubleTapTimeoutRef.current = setTimeout(() => {
      doubleTapTimeoutRef.current = undefined;
      handleTap(e);
    }, QUICK_REACTION_DOUBLE_TAP_DELAY);
  }
  function handleContextMenu(e) {
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_ANDROID) {
      if (e.target.matches('a[href]') || isContextMenuShown) {
        return;
      }
      e.preventDefault();
      selectMessage();
    } else {
      onContextMenu(e);
    }
  }
  function handleContainerDoubleClick() {
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV || !canReply) return;
    updateDraftReplyInfo({
      replyToMsgId: messageId,
      replyToPeerId: undefined,
      quoteText: undefined
    });
  }
  function stopPropagation(e) {
    e.stopPropagation();
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV || isInSelectMode || !canReply || isContextMenuShown || !getIsMessageListReady()) {
      return undefined;
    }
    let startedAt;
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_3__.captureEvents)(containerRef.current, {
      selectorToPreventScroll: '.MessageList',
      excludedClosestSelector: '.no-word-wrap',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_3__.SwipeDirection.Left) {
          if (!startedAt) {
            startedAt = Date.now();
          }
          markSwiped();
          return true;
        }
        return false;
      },
      onRelease: () => {
        if (!startedAt || !canReply) {
          return;
        }
        updateDraftReplyInfo({
          replyToMsgId: messageId
        });
        setTimeout(unmarkSwiped, Math.max(0, SWIPE_ANIMATION_DURATION - (Date.now() - startedAt)));
        startedAt = undefined;
      }
    });
  }, [containerRef, isInSelectMode, messageId, markSwiped, unmarkSwiped, canReply, isContextMenuShown, getIsMessageListReady]);
  function handleMouseLeave(e) {
    // Because `mousemove` event is throttled, we need to also throttle `mouseleave` event,
    // so the order of events is preserved
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(unmarkQuickReactionVisible);
    if (shouldHandleMouseLeave) handleDocumentGroupMouseLeave(e);
  }
  return {
    handleMouseDown: !isInSelectMode ? handleMouseDown : undefined,
    handleClick,
    handleContextMenu: !isInSelectMode ? handleContextMenu : isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_4__["default"] : undefined,
    handleDoubleClick: !isInSelectMode ? handleContainerDoubleClick : undefined,
    handleContentDoubleClick: !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? stopPropagation : undefined,
    handleMouseMove,
    handleSendQuickReaction,
    handleMouseLeave,
    isSwiped,
    isQuickReactionVisible,
    handleDocumentGroupMouseEnter
  };
}
function handleDocumentGroupMouseEnter(e) {
  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);
  if (lastGroupElement) {
    lastGroupElement.setAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE, '');
  }
}
function handleDocumentGroupMouseLeave(e) {
  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);
  if (lastGroupElement) {
    lastGroupElement.removeAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE);
  }
}
function getLastElementInDocumentGroup(element) {
  let current = element;
  do {
    current = current.nextElementSibling;
  } while (current && !current.classList.contains('last-in-document-group'));
  return current;
}

/***/ }),

/***/ "./src/components/middle/message/reactions/ReactionButton.tsx":
/*!********************************************************************!*\
  !*** ./src/components/middle/message/reactions/ReactionButton.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_AvatarList__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../common/AvatarList */ "./src/components/common/AvatarList.tsx");
/* harmony import */ var _common_reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/reactions/ReactionAnimatedEmoji */ "./src/components/common/reactions/ReactionAnimatedEmoji.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ReactionButton.module.scss */ "./src/components/middle/message/reactions/ReactionButton.module.scss");











const REACTION_SIZE = 1.25 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const ReactionButton = _ref => {
  let {
    reaction,
    containerId,
    isOwnMessage,
    recentReactors,
    className,
    chosenClassName,
    shouldDelayInit,
    observeIntersection,
    onClick
  } = _ref;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    onClick?.(reaction.reaction);
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, isOwnMessage && _ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].own, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.isReactionChosen)(reaction) && _ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].chosen, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.isReactionChosen)(reaction) && chosenClassName, className),
    size: "tiny",
    onClick: handleClick
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: _ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].animatedEmoji,
    containerId: containerId,
    reaction: reaction.reaction,
    size: REACTION_SIZE,
    observeIntersection: observeIntersection,
    shouldDelayInit: shouldDelayInit
  }), recentReactors?.length ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AvatarList__WEBPACK_IMPORTED_MODULE_7__["default"], {
    size: "mini",
    peers: recentReactors
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_6__["default"], {
    text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(reaction.count),
    className: _ReactionButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].counter
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ReactionButton));

/***/ }),

/***/ "./src/components/middle/message/reactions/ReactionPicker.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/middle/message/reactions/ReactionPicker.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReactionPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ReactionPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReactionPicker', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ReactionPicker ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReactionPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactionPickerAsync);

/***/ }),

/***/ "./src/components/middle/message/reactions/Reactions.tsx":
/*!***************************************************************!*\
  !*** ./src/components/middle/message/reactions/Reactions.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ReactionButton__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ReactionButton */ "./src/components/middle/message/reactions/ReactionButton.tsx");
/* harmony import */ var _SavedTagButton__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./SavedTagButton */ "./src/components/middle/message/reactions/SavedTagButton.tsx");
/* harmony import */ var _Reactions_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Reactions.scss */ "./src/components/middle/message/reactions/Reactions.scss");












const MAX_RECENT_AVATARS = 3;
const Reactions = _ref => {
  let {
    message,
    isOutside,
    maxWidth,
    metaChildren,
    observeIntersection,
    noRecentReactors,
    isCurrentUserPremium,
    tags,
    getIsMessageListReady
  } = _ref;
  const {
    toggleReaction,
    setLocalTextSearchTag,
    searchTextMessagesLocal,
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    results,
    areTags,
    recentReactions
  } = message.reactions;
  const totalCount = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => results.reduce((acc, reaction) => acc + reaction.count, 0), [results]);
  const isMessageListReady = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_6__["default"])(getIsMessageListReady);
  const recentReactorsByReactionKey = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return recentReactions?.reduce((acc, recentReaction) => {
      const {
        reaction,
        peerId
      } = recentReaction;
      const key = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getReactionKey)(reaction);
      const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, peerId);
      if (!peer) return acc;
      const peers = acc[key] || [];
      peers.push(peer);
      acc[key] = peers;
      return acc;
    }, {});
  }, [recentReactions]);
  const props = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const messageKey = (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageKey)(message);
    return results.map(reaction => {
      const reactionKey = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getReactionKey)(reaction.reaction);
      const recentReactors = recentReactorsByReactionKey?.[reactionKey];
      const shouldHideRecentReactors = totalCount > MAX_RECENT_AVATARS || noRecentReactors;
      const tag = areTags ? tags?.[reactionKey] : undefined;
      return {
        reaction,
        reactionKey,
        messageKey,
        recentReactors: !shouldHideRecentReactors ? recentReactors : undefined,
        isChosen: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isReactionChosen)(reaction),
        tag
      };
    });
  }, [message, noRecentReactors, recentReactorsByReactionKey, results, areTags, tags, totalCount]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(reaction => {
    if (areTags) {
      if (!isCurrentUserPremium) {
        openPremiumModal({
          initialSection: 'saved_tags'
        });
        return;
      }
      setLocalTextSearchTag({
        tag: reaction
      });
      searchTextMessagesLocal();
      return;
    }
    toggleReaction({
      chatId: message.chatId,
      messageId: message.id,
      reaction
    });
  });
  const handleRemoveReaction = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(reaction => {
    toggleReaction({
      chatId: message.chatId,
      messageId: message.id,
      reaction
    });
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('Reactions', isOutside && 'is-outside'),
    style: maxWidth ? `max-width: ${maxWidth}px` : undefined,
    dir: lang.isRtl ? 'rtl' : 'ltr'
  }, props.map(_ref2 => {
    let {
      reaction,
      recentReactors,
      messageKey,
      reactionKey,
      isChosen,
      tag
    } = _ref2;
    return areTags ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SavedTagButton__WEBPACK_IMPORTED_MODULE_10__["default"], {
      key: reactionKey,
      className: "message-reaction",
      chosenClassName: "chosen",
      containerId: messageKey,
      isOwnMessage: message.isOutgoing,
      isChosen: isChosen,
      reaction: reaction.reaction,
      tag: tag,
      withContextMenu: isCurrentUserPremium,
      onClick: handleClick,
      onRemove: handleRemoveReaction,
      observeIntersection: observeIntersection,
      shouldDelayInit: !isMessageListReady
    }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ReactionButton__WEBPACK_IMPORTED_MODULE_9__["default"], {
      key: reactionKey,
      className: "message-reaction",
      chosenClassName: "chosen",
      containerId: messageKey,
      isOwnMessage: message.isOutgoing,
      recentReactors: recentReactors,
      reaction: reaction,
      onClick: handleClick,
      observeIntersection: observeIntersection,
      shouldDelayInit: !isMessageListReady
    });
  }), metaChildren);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Reactions));

/***/ }),

/***/ "./src/components/modals/ModalContainer.tsx":
/*!**************************************************!*\
  !*** ./src/components/modals/ModalContainer.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./attachBotInstall/AttachBotInstallModal.async */ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx");
/* harmony import */ var _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./boost/BoostModal.async */ "./src/components/modals/boost/BoostModal.async.tsx");
/* harmony import */ var _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./chatlist/ChatlistModal.async */ "./src/components/modals/chatlist/ChatlistModal.async.tsx");
/* harmony import */ var _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./collectible/CollectibleInfoModal.async */ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx");
/* harmony import */ var _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./giftcode/GiftCodeModal.async */ "./src/components/modals/giftcode/GiftCodeModal.async.tsx");
/* harmony import */ var _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./inviteViaLink/InviteViaLinkModal.async */ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx");
/* harmony import */ var _map_MapModal_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./map/MapModal.async */ "./src/components/modals/map/MapModal.async.tsx");
/* harmony import */ var _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./oneTimeMedia/OneTimeMediaModal.async */ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx");
/* harmony import */ var _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./reportAd/ReportAdModal.async */ "./src/components/modals/reportAd/ReportAdModal.async.tsx");
/* harmony import */ var _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./stars/StarsBalanceModal.async */ "./src/components/modals/stars/StarsBalanceModal.async.tsx");
/* harmony import */ var _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./stars/StarsPaymentModal.async */ "./src/components/modals/stars/StarsPaymentModal.async.tsx");
/* harmony import */ var _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./urlAuth/UrlAuthModal.async */ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx");
/* harmony import */ var _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./webApp/WebAppModal.async */ "./src/components/modals/webApp/WebAppModal.async.tsx");


















// `Pick` used only to provide tab completion

const MODALS = {
  giftCodeModal: _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_8__["default"],
  boostModal: _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_5__["default"],
  chatlistModal: _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_6__["default"],
  urlAuth: _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_15__["default"],
  oneTimeMediaModal: _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_11__["default"],
  inviteViaLinkModal: _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_9__["default"],
  requestedAttachBotInstall: _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_4__["default"],
  reportAdModal: _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_12__["default"],
  webApp: _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_16__["default"],
  collectibleInfoModal: _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_7__["default"],
  mapModal: _map_MapModal_async__WEBPACK_IMPORTED_MODULE_10__["default"],
  isStarPaymentModalOpen: _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_14__["default"],
  starsBalanceModal: _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_13__["default"]
};
const MODAL_KEYS = Object.keys(MODALS);
const MODAL_ENTRIES = Object.entries(MODALS);
const ModalContainer = modalProps => {
  return MODAL_ENTRIES.map(_ref => {
    let [key, ModalComponent] = _ref;
    return (
      /*#__PURE__*/
      // @ts-ignore -- TS does not preserve tuple types in `map` callbacks
      _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ModalComponent, {
        key: key,
        modal: modalProps[key]
      })
    );
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global), MODAL_KEYS))(ModalContainer)));

/***/ }),

/***/ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx":
/*!********************************************************************************!*\
  !*** ./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AttachBotInstallModalAsync = props => {
  const {
    modal
  } = props;
  const AttachBotInstallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AttachBotInstallModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return AttachBotInstallModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AttachBotInstallModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotInstallModalAsync);

/***/ }),

/***/ "./src/components/modals/boost/BoostModal.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/modals/boost/BoostModal.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const BoostModalAsync = props => {
  const {
    modal
  } = props;
  const BoostModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'BoostModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return BoostModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(BoostModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BoostModalAsync);

/***/ }),

/***/ "./src/components/modals/chatlist/ChatlistModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/chatlist/ChatlistModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatlistModalAsync = props => {
  const {
    modal
  } = props;
  const ChatlistModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatlistModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ChatlistModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatlistModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatlistModalAsync);

/***/ }),

/***/ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/collectible/CollectibleInfoModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CollectibleInfoModalAsync = props => {
  const {
    modal
  } = props;
  const CollectibleInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CollectibleInfoModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return CollectibleInfoModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CollectibleInfoModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CollectibleInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/giftcode/GiftCodeModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/giftcode/GiftCodeModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftCodeModalAsync = props => {
  const {
    modal
  } = props;
  const GiftCodeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GiftCodeModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return GiftCodeModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftCodeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftCodeModalAsync);

/***/ }),

/***/ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const InviteViaLinkModalAsync = props => {
  const {
    modal
  } = props;
  const InviteViaLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'InviteViaLinkModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return InviteViaLinkModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(InviteViaLinkModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InviteViaLinkModalAsync);

/***/ }),

/***/ "./src/components/modals/map/MapModal.async.tsx":
/*!******************************************************!*\
  !*** ./src/components/modals/map/MapModal.async.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MapModalAsync = props => {
  const {
    modal
  } = props;
  const MapModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MapModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return MapModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MapModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MapModalAsync);

/***/ }),

/***/ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx":
/*!************************************************************************!*\
  !*** ./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const OneTimeMediaModalAsync = props => {
  const {
    modal
  } = props;
  const OneTimeMediaModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'OneTimeMediaModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return OneTimeMediaModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(OneTimeMediaModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (OneTimeMediaModalAsync);

/***/ }),

/***/ "./src/components/modals/reportAd/ReportAdModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/reportAd/ReportAdModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReportAdModalAsync = props => {
  const {
    modal
  } = props;
  const ReportAdModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReportAdModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ReportAdModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReportAdModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReportAdModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsBalanceModalAsync = props => {
  const {
    modal
  } = props;
  const StarsBalanceModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StarsBalanceModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StarsBalanceModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsBalanceModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsBalanceModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/StarsPaymentModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsPaymentModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarPaymentModalAsync = props => {
  const {
    modal
  } = props;
  const StarPaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StarPaymentModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StarPaymentModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarPaymentModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarPaymentModalAsync);

/***/ }),

/***/ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/modals/urlAuth/UrlAuthModal.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const UrlAuthModalAsync = props => {
  const {
    modal
  } = props;
  const UrlAuthModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'UrlAuthModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return UrlAuthModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(UrlAuthModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrlAuthModalAsync);

/***/ }),

/***/ "./src/components/modals/webApp/WebAppModal.async.tsx":
/*!************************************************************!*\
  !*** ./src/components/modals/webApp/WebAppModal.async.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const WebAppModalAsync = props => {
  const {
    modal
  } = props;
  const WebAppModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'WebAppModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return WebAppModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(WebAppModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WebAppModalAsync);

/***/ }),

/***/ "./src/components/payment/PaymentModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/payment/PaymentModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PaymentModalAsync = props => {
  const {
    isOpen
  } = props;
  const PaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PaymentModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PaymentModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PaymentModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PaymentModalAsync);

/***/ }),

/***/ "./src/components/payment/ReceiptModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/payment/ReceiptModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReceiptModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReceiptModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReceiptModal', !isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return ReceiptModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReceiptModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReceiptModalAsync);

/***/ }),

/***/ "./src/components/right/AddChatMembers.tsx":
/*!*************************************************!*\
  !*** ./src/components/right/AddChatMembers.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_Picker__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/Picker */ "./src/components/common/Picker.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _AddChatMembers_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./AddChatMembers.scss */ "./src/components/right/AddChatMembers.scss");














const AddChatMembers = _ref => {
  let {
    isChannel,
    members,
    onNextStep,
    currentUserId,
    localContactIds,
    isLoading,
    searchQuery,
    isSearching,
    localUserIds,
    globalUserIds,
    onClose,
    isActive
  } = _ref;
  const {
    setUserSearchQuery
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [selectedMemberIds, setSelectedMemberIds] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const prevSelectedMemberIds = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_9__["default"])(selectedMemberIds);
  const noPickerScrollRestore = prevSelectedMemberIds === selectedMemberIds;
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_7__["default"])({
    isActive,
    onBack: onClose
  });
  const memberIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return members ? members.map(member => member.userId) : [];
  }, [members]);
  const handleFilterChange = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(query => {
    setUserSearchQuery({
      query
    });
  }, [setUserSearchQuery]);
  const displayedIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // No need for expensive global updates on users, so we avoid them
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const filteredContactIds = localContactIds ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.filterUsersByName)(localContactIds, usersById, searchQuery) : [];
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__["default"])((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...filteredContactIds, ...(localUserIds || []), ...(globalUserIds || [])]).filter(userId => {
      const user = usersById[userId];

      // The user can be added to the chat if the following conditions are met:
      // the user has not yet been added to the current chat
      // AND it is not the current user,
      // AND (it is not found (user from global search) OR it is not a bot OR it is a bot,
      // but the current chat is not a channel AND the appropriate permission is set).
      return !memberIds.includes(userId) && userId !== currentUserId && (!user || !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserBot)(user) || !isChannel && user.canBeInvitedToGroup);
    }));
  }, [localContactIds, searchQuery, localUserIds, globalUserIds, currentUserId, memberIds, isChannel]);
  const handleNextStep = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (selectedMemberIds.length) {
      setUserSearchQuery({
        query: ''
      });
      onNextStep(selectedMemberIds);
    }
  }, [selectedMemberIds, setUserSearchQuery, onNextStep]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AddChatMembers"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AddChatMembers-inner"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Picker__WEBPACK_IMPORTED_MODULE_10__["default"], {
    itemIds: displayedIds,
    selectedIds: selectedMemberIds,
    filterValue: searchQuery,
    filterPlaceholder: lang('lng_channel_add_users'),
    searchInputId: "new-members-picker-search",
    isLoading: isSearching,
    onSelectedIdsChange: setSelectedMemberIds,
    onFilterChange: handleFilterChange,
    isSearchable: true,
    noScrollRestore: noPickerScrollRestore
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isShown: Boolean(selectedMemberIds.length),
    disabled: isLoading,
    ariaLabel: lang('lng_channel_add_users'),
    onClick: handleNextStep
  }, isLoading ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_12__["default"], {
    color: "white"
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-arrow-right"
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId
  } = _ref2;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const {
    userIds: localContactIds
  } = global.contactList || {};
  const {
    newChatMembersProgress
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    currentUserId
  } = global;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const {
    query: searchQuery,
    fetchingStatus,
    globalUserIds,
    localUserIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global).userSearch;
  return {
    isChannel,
    members: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId)?.members,
    currentUserId,
    localContactIds,
    searchQuery,
    isSearching: fetchingStatus,
    isLoading: newChatMembersProgress === _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Loading,
    globalUserIds,
    localUserIds
  };
})(AddChatMembers)));

/***/ }),

/***/ "./src/components/right/CreateTopic.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/right/CreateTopic.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const CreateTopicAsync = props => {
  const CreateTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CreateTopic');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return CreateTopic ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CreateTopic, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CreateTopicAsync);

/***/ }),

/***/ "./src/components/right/EditTopic.async.tsx":
/*!**************************************************!*\
  !*** ./src/components/right/EditTopic.async.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const EditTopicAsync = props => {
  const EditTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EditTopic');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return EditTopic ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EditTopic, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EditTopicAsync);

/***/ }),

/***/ "./src/components/right/GifSearch.async.tsx":
/*!**************************************************!*\
  !*** ./src/components/right/GifSearch.async.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const GifSearchAsync = () => {
  const GifSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GifSearch');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return GifSearch ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GifSearch, null) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GifSearchAsync);

/***/ }),

/***/ "./src/components/right/PollResults.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/right/PollResults.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const PollResultsAsync = () => {
  const PollResults = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PollResults');
  return PollResults ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PollResults, null) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollResultsAsync);

/***/ }),

/***/ "./src/components/right/Profile.tsx":
/*!******************************************!*\
  !*** ./src/components/right/Profile.tsx ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../left/search/helpers/getSenderName */ "./src/components/left/search/helpers/getSenderName.ts");
/* harmony import */ var _hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/polling/usePeerStoriesPolling */ "./src/hooks/polling/usePeerStoriesPolling.ts");
/* harmony import */ var _hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useCacheBuster */ "./src/hooks/useCacheBuster.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _hooks_useProfileState__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./hooks/useProfileState */ "./src/components/right/hooks/useProfileState.ts");
/* harmony import */ var _hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./hooks/useProfileViewportIds */ "./src/components/right/hooks/useProfileViewportIds.ts");
/* harmony import */ var _hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./hooks/useTransitionFixes */ "./src/components/right/hooks/useTransitionFixes.ts");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_Media__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../common/Media */ "./src/components/common/Media.tsx");
/* harmony import */ var _common_NothingFound__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../common/NothingFound */ "./src/components/common/NothingFound.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../common/profile/ChatExtra */ "./src/components/common/profile/ChatExtra.tsx");
/* harmony import */ var _common_ProfileInfo__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../common/ProfileInfo */ "./src/components/common/ProfileInfo.tsx");
/* harmony import */ var _common_WebLink__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../common/WebLink */ "./src/components/common/WebLink.tsx");
/* harmony import */ var _left_main_ChatList__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../left/main/ChatList */ "./src/components/left/main/ChatList.tsx");
/* harmony import */ var _story_MediaStory__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../story/MediaStory */ "./src/components/story/MediaStory.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _DeleteMemberModal__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./DeleteMemberModal */ "./src/components/right/DeleteMemberModal.tsx");
/* harmony import */ var _Profile_scss__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./Profile.scss */ "./src/components/right/Profile.scss");











































const TABS = [{
  type: 'media',
  title: 'SharedMediaTab2'
}, {
  type: 'documents',
  title: 'SharedFilesTab2'
}, {
  type: 'links',
  title: 'SharedLinksTab2'
}, {
  type: 'audio',
  title: 'SharedMusicTab2'
}];
const HIDDEN_RENDER_DELAY = 1000;
const INTERSECTION_THROTTLE = 500;
const Profile = _ref => {
  let {
    chatId,
    threadId,
    profileState,
    onProfileStateChange,
    theme,
    isChannel,
    resolvedUserId,
    currentUserId,
    messagesById,
    foundIds,
    storyIds,
    pinnedStoryIds,
    archiveStoryIds,
    storyByIds,
    mediaSearchType,
    hasCommonChatsTab,
    hasStoriesTab,
    hasMembersTab,
    areMembersHidden,
    canAddMembers,
    canDeleteMembers,
    commonChatIds,
    members,
    adminMembersById,
    usersById,
    userStatusesById,
    chatsById,
    isRightColumnShown,
    isRestricted,
    activeDownloads,
    isChatProtected,
    nextProfileTab,
    shouldWarnAboutSvg,
    similarChannels,
    isCurrentUserPremium,
    limitSimilarChannels,
    isTopicInfo,
    isSavedDialog,
    forceScrollProfileTab
  } = _ref;
  const {
    setSharedMediaSearchType,
    loadMoreMembers,
    loadCommonChats,
    openChat,
    searchSharedMediaMessages,
    openMediaViewer,
    openAudioPlayer,
    focusMessage,
    loadProfilePhotos,
    setNewChatMembersDialogState,
    loadPeerProfileStories,
    loadStoriesArchive,
    openPremiumModal,
    loadChannelRecommendations
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();

  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  // eslint-disable-next-line no-null/no-null
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const [deletingUserId, setDeletingUserId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const profileId = isSavedDialog ? String(threadId) : resolvedUserId || chatId;
  const isSavedMessages = profileId === currentUserId && !isSavedDialog;
  const tabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => [...(isSavedMessages && !isSavedDialog ? [{
    type: 'dialogs',
    title: 'SavedDialogsTab'
  }] : []), ...(hasStoriesTab ? [{
    type: 'stories',
    title: 'ProfileStories'
  }] : []), ...(hasStoriesTab && isSavedMessages ? [{
    type: 'storiesArchive',
    title: 'ProfileStoriesArchive'
  }] : []), ...(hasMembersTab ? [{
    type: 'members',
    title: isChannel ? 'ChannelSubscribers' : 'GroupMembers'
  }] : []), ...TABS,
  // TODO The filter for voice messages currently does not work
  // in forum topics. Return it when it's fixed on the server side.
  ...(!isTopicInfo ? [{
    type: 'voice',
    title: 'SharedVoiceTab2'
  }] : []), ...(hasCommonChatsTab ? [{
    type: 'commonChats',
    title: 'SharedGroupsTab2'
  }] : []), ...(isChannel && similarChannels?.length ? [{
    type: 'similarChannels',
    title: 'SimilarChannelsTab'
  }] : [])], [hasCommonChatsTab, hasMembersTab, hasStoriesTab, isChannel, isTopicInfo, similarChannels, isSavedMessages, isSavedDialog]);
  const initialTab = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!nextProfileTab) {
      return 0;
    }
    const index = tabs.findIndex(_ref2 => {
      let {
        type
      } = _ref2;
      return type === nextProfileTab;
    });
    return index === -1 ? 0 : index;
  }, [nextProfileTab, tabs]);
  const [activeTab, setActiveTab] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!nextProfileTab) return;
    const index = tabs.findIndex(_ref3 => {
      let {
        type
      } = _ref3;
      return type === nextProfileTab;
    });
    if (index === -1) return;
    setActiveTab(index);
  }, [nextProfileTab, tabs]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isChannel && !similarChannels) {
      loadChannelRecommendations({
        chatId
      });
    }
  }, [chatId, isChannel, similarChannels]);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab].type;
  const handleLoadPeerStories = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(_ref4 => {
    let {
      offsetId
    } = _ref4;
    loadPeerProfileStories({
      peerId: chatId,
      offsetId
    });
  }, [chatId]);
  const handleLoadStoriesArchive = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(_ref5 => {
    let {
      offsetId
    } = _ref5;
    loadStoriesArchive({
      peerId: currentUserId,
      offsetId
    });
  }, [currentUserId]);
  const [resultType, viewportIds, getMore, noProfileInfo] = (0,_hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_21__["default"])(loadMoreMembers, loadCommonChats, searchSharedMediaMessages, handleLoadPeerStories, handleLoadStoriesArchive, tabType, mediaSearchType, members, commonChatIds, usersById, userStatusesById, chatsById, messagesById, foundIds, threadId, storyIds, pinnedStoryIds, archiveStoryIds, similarChannels);
  const isFirstTab = isSavedMessages && resultType === 'dialogs' || hasStoriesTab && resultType === 'stories' || resultType === 'members' || !hasMembersTab && resultType === 'media';
  const activeKey = tabs.findIndex(_ref6 => {
    let {
      type
    } = _ref6;
    return type === resultType;
  });
  (0,_hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_13__["default"])(resultType === 'members' ? viewportIds : undefined);
  const {
    handleScroll
  } = (0,_hooks_useProfileState__WEBPACK_IMPORTED_MODULE_20__["default"])(containerRef, resultType, profileState, onProfileStateChange, forceScrollProfileTab);
  const {
    applyTransitionFix,
    releaseTransitionFix
  } = (0,_hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_22__["default"])(containerRef);
  const [cacheBuster, resetCacheBuster] = (0,_hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const {
    observe: observeIntersectionForMedia
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleTransitionStop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    releaseTransitionFix();
    resetCacheBuster();
  });
  const handleNewMemberDialogOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    setNewChatMembersDialogState({
      newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_3__.NewChatMembersProgress.InProgress
    });
  });

  // Update search type when switching tabs or forum topics
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setSharedMediaSearchType({
      mediaType: tabType
    });
  }, [setSharedMediaSearchType, tabType, threadId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadProfilePhotos({
      profileId
    });
  }, [profileId]);
  const handleSelectMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(messageId => {
    openMediaViewer({
      chatId: profileId,
      threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      messageId,
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.MediaViewerOrigin.SharedMedia
    });
  });
  const handlePlayAudio = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(messageId => {
    openAudioPlayer({
      chatId: profileId,
      messageId
    });
  });
  const handleMemberClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(id => {
    openChat({
      id
    });
  });
  const handleMessageFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(message => {
    focusMessage({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  const handleDeleteMembersModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    setDeletingUserId(undefined);
  });
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_15__["default"])(_ref7 => {
    let [prevHasMemberTabs] = _ref7;
    if (prevHasMemberTabs === undefined || activeTab === 0 || prevHasMemberTabs === hasMembersTab) {
      return;
    }
    const newActiveTab = activeTab + (hasMembersTab ? 1 : -1);
    setActiveTab(Math.min(newActiveTab, tabs.length - 1));
  }, [hasMembersTab, activeTab, tabs]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!transitionRef.current || !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.Profile',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.SwipeDirection.Left) {
          setActiveTab(Math.min(renderingActiveTab + 1, tabs.length - 1));
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.SwipeDirection.Right) {
          setActiveTab(Math.max(0, renderingActiveTab - 1));
          return true;
        }
        return false;
      }
    });
  }, [renderingActiveTab, tabs.length]);
  let renderingDelay;
  // @optimization Used to unparallelize rendering of message list and profile media
  if (isFirstTab) {
    renderingDelay = !isRightColumnShown ? HIDDEN_RENDER_DELAY : 0;
    // @optimization Used to delay first render of secondary tabs while animating
  } else if (!viewportIds) {
    renderingDelay = _config__WEBPACK_IMPORTED_MODULE_4__.SLIDE_TRANSITION_DURATION;
  }
  const canRenderContent = (0,_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_19__["default"])([chatId, threadId, resultType, renderingActiveTab], renderingDelay);
  function getMemberContextAction(memberId) {
    const chatIdToCRMEidMap = JSON.parse(localStorage.getItem('crmMapper') || '{}');
    const memberEid = chatIdToCRMEidMap[memberId]?.eid;
    const handleAddToCRM = () => {
      const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), memberId);
      const message = {
        type: 'addUserToCRM',
        user: JSON.stringify(user)
      };
      window.parent.postMessage(message, '*');
    };
    const handleOpenInCRM = () => {
      const message = {
        type: 'openInCRM',
        eid: memberEid
      };
      window.parent.postMessage(message, '*');
    };
    const actionAddToCRM = {
      title: 'Add To CRM',
      icon: 'add-user',
      handler: handleAddToCRM
    };
    const actionOpenInCRM = {
      title: 'Open In CRM',
      icon: 'link-badge',
      handler: handleOpenInCRM
    };
    return memberId === currentUserId || !canDeleteMembers ? [...(memberEid ? [actionOpenInCRM] : [actionAddToCRM])] : [...(memberEid ? [actionOpenInCRM] : [actionAddToCRM]), {
      title: lang('lng_context_remove_from_group'),
      icon: 'stop',
      handler: () => {
        setDeletingUserId(memberId);
      }
    }];
  }
  function renderContent() {
    if (resultType === 'dialogs') {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_left_main_ChatList__WEBPACK_IMPORTED_MODULE_32__["default"], {
        className: "saved-dialogs",
        folderType: "saved",
        isActive: true
      });
    }
    if (!viewportIds || !canRenderContent || !messagesById) {
      const noSpinner = isFirstTab && !canRenderContent;
      const forceRenderHiddenMembers = Boolean(resultType === 'members' && areMembersHidden);
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, !noSpinner && !forceRenderHiddenMembers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_38__["default"], null), forceRenderHiddenMembers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_NothingFound__WEBPACK_IMPORTED_MODULE_27__["default"], {
        text: "You have no access to group members list."
      }));
    }
    if (!viewportIds.length) {
      let text;
      switch (resultType) {
        case 'members':
          text = areMembersHidden ? 'You have no access to group members list.' : 'No members found';
          break;
        case 'commonChats':
          text = lang('NoGroupsInCommon');
          break;
        case 'documents':
          text = lang('lng_media_file_empty');
          break;
        case 'links':
          text = lang('lng_media_link_empty');
          break;
        case 'audio':
          text = lang('lng_media_song_empty');
          break;
        case 'voice':
          text = lang('lng_media_audio_empty');
          break;
        case 'stories':
          text = lang('StoryList.SavedEmptyState.Title');
          break;
        case 'storiesArchive':
          text = lang('StoryList.ArchivedEmptyState.Title');
          break;
        default:
          text = lang('SharedMedia.EmptyTitle');
      }
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_NothingFound__WEBPACK_IMPORTED_MODULE_27__["default"], {
        text: text
      }));
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: `content ${resultType}-list`,
      dir: lang.isRtl && resultType === 'media' ? 'rtl' : undefined,
      teactFastList: true
    }, resultType === 'media' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Media__WEBPACK_IMPORTED_MODULE_26__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      observeIntersection: observeIntersectionForMedia,
      onClick: handleSelectMedia
    })) : resultType === 'stories' || resultType === 'storiesArchive' ? viewportIds.map((id, i) => storyByIds?.[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_MediaStory__WEBPACK_IMPORTED_MODULE_33__["default"], {
      teactOrderKey: i,
      key: `${resultType}_${id}`,
      story: storyByIds[id],
      isArchive: resultType === 'storiesArchive'
    })) : resultType === 'documents' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_24__["default"], {
      key: id,
      document: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageDocument)(messagesById[id]),
      withDate: true,
      smaller: true,
      className: "scroll-item",
      isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageDocument)(messagesById[id])),
      observeIntersection: observeIntersectionForMedia,
      onDateClick: handleMessageFocus,
      message: messagesById[id],
      shouldWarnAboutSvg: shouldWarnAboutSvg
    })) : resultType === 'links' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_WebLink__WEBPACK_IMPORTED_MODULE_31__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      observeIntersection: observeIntersectionForMedia,
      onMessageClick: handleMessageFocus
    })) : resultType === 'audio' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_23__["default"], {
      key: id,
      theme: theme,
      message: messagesById[id],
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
      date: messagesById[id].date,
      className: "scroll-item",
      onPlay: handlePlayAudio,
      onDateClick: handleMessageFocus,
      canDownload: !isChatProtected && !messagesById[id].isProtected,
      isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, messagesById[id].content.audio)
    })) : resultType === 'voice' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_23__["default"], {
      key: id,
      theme: theme,
      message: messagesById[id],
      senderTitle: (0,_left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_12__.getSenderName)(lang, messagesById[id], chatsById, usersById),
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
      date: messagesById[id].date,
      className: "scroll-item",
      onPlay: handlePlayAudio,
      onDateClick: handleMessageFocus,
      canDownload: !isChatProtected && !messagesById[id].isProtected,
      isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, messagesById[id].content.voice)
    })) : resultType === 'members' ? viewportIds.map((id, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_37__["default"], {
      key: id,
      teactOrderKey: i,
      className: "chat-item-clickable contact-list-item scroll-item small-icon"
      // eslint-disable-next-line react/jsx-no-bind
      ,
      onClick: () => handleMemberClick(id),
      contextActions: getMemberContextAction(id)
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_28__["default"], {
      userId: id,
      adminMember: adminMembersById?.[id],
      forceShowSelf: true,
      withStory: true
    }))) : resultType === 'commonChats' ? viewportIds.map((id, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_37__["default"], {
      key: id,
      teactOrderKey: i,
      className: "chat-item-clickable scroll-item small-icon"
      // eslint-disable-next-line react/jsx-no-bind
      ,
      onClick: () => openChat({
        id
      })
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_25__["default"], {
      chatId: id
    }))) : resultType === 'similarChannels' ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      key: resultType
    }, viewportIds.map((channelId, i) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_37__["default"], {
      key: channelId,
      teactOrderKey: i,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('chat-item-clickable search-result', !isCurrentUserPremium && i === similarChannels.length - 1 && 'blured')
      // eslint-disable-next-line react/jsx-no-bind
      ,
      onClick: () => openChat({
        id: channelId
      })
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_25__["default"], {
      avatarSize: "large",
      chatId: channelId,
      withFullInfo: true
    }))), !isCurrentUserPremium && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
      className: "show-more-channels",
      size: "smaller",
      onClick: () => openPremiumModal()
    }, lang('UnlockSimilar'), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
      className: "icon icon-unlock-badge"
    })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "more-similar"
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('MoreSimilarText', limitSimilarChannels), ['simple_markdown'])))) : undefined);
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_36__["default"], {
    ref: containerRef,
    className: "Profile custom-scroll",
    itemSelector: `.shared-media-transition > .Transition_slide-active.${resultType}-list > .scroll-item`,
    items: canRenderContent ? viewportIds : undefined,
    cacheBuster: cacheBuster,
    sensitiveArea: _config__WEBPACK_IMPORTED_MODULE_4__.PROFILE_SENSITIVE_AREA,
    preloadBackwards: canRenderContent ? resultType === 'members' ? _config__WEBPACK_IMPORTED_MODULE_4__.MEMBERS_SLICE : _config__WEBPACK_IMPORTED_MODULE_4__.SHARED_MEDIA_SLICE : 0
    // To prevent scroll jumps caused by reordering member list
    ,
    noScrollRestoreOnTop: true,
    noFastList: true,
    onLoadMore: getMore,
    onScroll: handleScroll
  }, !noProfileInfo && !isSavedMessages && renderProfileInfo(profileId, isRightColumnShown && canRenderContent, isSavedDialog), !isRestricted && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "shared-media"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_40__["default"], {
    ref: transitionRef,
    name: lang.isRtl ? 'slideOptimizedRtl' : 'slideOptimized',
    activeKey: activeKey,
    renderCount: tabs.length,
    shouldRestoreHeight: true,
    className: "shared-media-transition",
    onStart: applyTransitionFix,
    onStop: handleTransitionStop
  }, renderContent()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_39__["default"], {
    big: true,
    activeTab: renderingActiveTab,
    tabs: tabs,
    onSwitchTab: setActiveTab
  })), canAddMembers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_35__["default"], {
    isShown: resultType === 'members',
    onClick: handleNewMemberDialogOpen,
    ariaLabel: lang('lng_channel_add_users')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "icon icon-add-user-filled"
  })), canDeleteMembers && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DeleteMemberModal__WEBPACK_IMPORTED_MODULE_41__["default"], {
    isOpen: Boolean(deletingUserId),
    userId: deletingUserId,
    onClose: handleDeleteMembersModalClose
  }));
};
function renderProfileInfo(profileId, isReady, isSavedDialog) {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "profile-info"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_ProfileInfo__WEBPACK_IMPORTED_MODULE_30__["default"], {
    userId: profileId,
    canPlayVideo: isReady
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_29__["default"], {
    chatOrUserId: profileId,
    isSavedDialog: isSavedDialog
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref8) => {
  let {
    chatId,
    threadId,
    isMobile
  } = _ref8;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const chatFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessages)(global, chatId);
  const {
    currentType: mediaSearchType,
    resultsByType
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentSharedMediaSearch)(global) || {};
  const {
    foundIds
  } = resultsByType && mediaSearchType && resultsByType[mediaSearchType] || {};
  const isTopicInfo = Boolean(chat?.isForum && threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const {
    byId: usersById,
    statusesById: userStatusesById
  } = global.users;
  const {
    byId: chatsById
  } = global.chats;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const isGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat);
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const hasMembersTab = !isTopicInfo && !isSavedDialog && (isGroup || isChannel && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatAdmin)(chat));
  const members = chatFullInfo?.members;
  const adminMembersById = chatFullInfo?.adminMembersById;
  const areMembersHidden = hasMembersTab && chat && (chat.isForbidden || chatFullInfo && !chatFullInfo.canViewMembers);
  const canAddMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'inviteUsers') || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserRightBanned)(chat, 'inviteUsers') || chat.isCreator);
  const canDeleteMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'banUsers') || chat.isCreator);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectActiveDownloads)(global);
  const {
    similarChannelIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectSimilarChannelIds)(global, chatId) || {};
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserPremium)(global);
  let hasCommonChatsTab;
  let resolvedUserId;
  let user;
  if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId)) {
    resolvedUserId = chatId;
    user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, resolvedUserId);
    hasCommonChatsTab = user && !user.isSelf && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user) && !isSavedDialog;
  }
  const peer = user || chat;
  const peerFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerFullInfo)(global, chatId);
  const hasStoriesTab = peer && (user?.isSelf || !peer.areStoriesHidden && peerFullInfo?.hasPinnedStories) && !isSavedDialog;
  const peerStories = hasStoriesTab ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerStories)(global, peer.id) : undefined;
  const storyIds = peerStories?.profileIds;
  const pinnedStoryIds = peerStories?.pinnedIds;
  const storyByIds = peerStories?.byId;
  const archiveStoryIds = peerStories?.archiveIds;
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global),
    isChannel,
    resolvedUserId,
    messagesById,
    foundIds,
    mediaSearchType,
    hasCommonChatsTab,
    hasStoriesTab,
    hasMembersTab,
    areMembersHidden,
    canAddMembers,
    canDeleteMembers,
    currentUserId: global.currentUserId,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isRestricted: chat?.isRestricted,
    activeDownloads,
    usersById,
    userStatusesById,
    chatsById,
    storyIds,
    pinnedStoryIds,
    archiveStoryIds,
    storyByIds,
    isChatProtected: chat?.isProtected,
    nextProfileTab: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global).nextProfileTab,
    forceScrollProfileTab: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global).forceScrollProfileTab,
    shouldWarnAboutSvg: global.settings.byKey.shouldWarnAboutSvg,
    similarChannels: similarChannelIds,
    isCurrentUserPremium,
    isTopicInfo,
    isSavedDialog,
    limitSimilarChannels: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_7__.selectPremiumLimit)(global, 'recommendedChannels'),
    ...(hasMembersTab && members && {
      members,
      adminMembersById
    }),
    ...(hasCommonChatsTab && user && {
      commonChatIds: user.commonChats?.ids
    })
  };
})(Profile)));

/***/ }),

/***/ "./src/components/right/RightColumn.tsx":
/*!**********************************************!*\
  !*** ./src/components/right/RightColumn.tsx ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _AddChatMembers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./AddChatMembers */ "./src/components/right/AddChatMembers.tsx");
/* harmony import */ var _CreateTopic_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./CreateTopic.async */ "./src/components/right/CreateTopic.async.tsx");
/* harmony import */ var _EditTopic_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./EditTopic.async */ "./src/components/right/EditTopic.async.tsx");
/* harmony import */ var _GifSearch_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./GifSearch.async */ "./src/components/right/GifSearch.async.tsx");
/* harmony import */ var _management_Management_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./management/Management.async */ "./src/components/right/management/Management.async.tsx");
/* harmony import */ var _PollResults_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./PollResults.async */ "./src/components/right/PollResults.async.tsx");
/* harmony import */ var _Profile__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./Profile */ "./src/components/right/Profile.tsx");
/* harmony import */ var _RightHeader__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./RightHeader */ "./src/components/right/RightHeader.tsx");
/* harmony import */ var _RightSearch_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./RightSearch.async */ "./src/components/right/RightSearch.async.tsx");
/* harmony import */ var _statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./statistics/BoostStatistics */ "./src/components/right/statistics/BoostStatistics.tsx");
/* harmony import */ var _statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./statistics/MessageStatistics.async */ "./src/components/right/statistics/MessageStatistics.async.tsx");
/* harmony import */ var _statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./statistics/Statistics.async */ "./src/components/right/statistics/Statistics.async.tsx");
/* harmony import */ var _statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./statistics/StoryStatistics.async */ "./src/components/right/statistics/StoryStatistics.async.tsx");
/* harmony import */ var _StickerSearch_async__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./StickerSearch.async */ "./src/components/right/StickerSearch.async.tsx");
/* harmony import */ var _RightColumn_scss__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./RightColumn.scss */ "./src/components/right/RightColumn.scss");




























const ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
const MAIN_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent).length / 2;
const MANAGEMENT_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens).length / 2;
function blurSearchInput() {
  const searchInput = document.querySelector('.RightHeader .SearchInput input');
  if (searchInput) {
    searchInput.blur();
  }
}
const RightColumn = _ref => {
  let {
    contentKey,
    chatId,
    threadId,
    isMobile,
    isChatSelected,
    shouldSkipHistoryAnimations,
    nextManagementScreen,
    nextProfileTab,
    shouldCloseRightColumn,
    isSavedMessages,
    isSavedDialog
  } = _ref;
  const {
    toggleChatInfo,
    toggleManagement,
    closeLocalTextSearch,
    setStickerSearchQuery,
    setGifSearchQuery,
    closePollResults,
    addChatMembers,
    setNewChatMembersDialogState,
    setEditingExportedInvite,
    toggleStatistics,
    toggleMessageStatistics,
    toggleStoryStatistics,
    setOpenedInviteInfo,
    requestNextManagementScreen,
    resetNextProfileTab,
    closeCreateTopicPanel,
    closeEditTopicPanel,
    closeBoostStatistics,
    setShouldCloseRightColumn
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const [profileState, setProfileState] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
  const [managementScreen, setManagementScreen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
  const [selectedChatMemberId, setSelectedChatMemberId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isPromotedByCurrentUser, setIsPromotedByCurrentUser] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const isScrolledDown = profileState !== _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile;
  const isOpen = contentKey !== undefined;
  const isProfile = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo;
  const isSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Search;
  const isManagement = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management;
  const isStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics;
  const isMessageStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics;
  const isStoryStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics;
  const isBoostStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics;
  const isStickerSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch;
  const isGifSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch;
  const isPollResults = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults;
  const isAddingChatMembers = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers;
  const isCreatingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic;
  const isEditingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic;
  const isOverlaying = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_3__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN;
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isOpen);
  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(contentKey, true, !isChatSelected) ?? -1;
  const close = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(function () {
    let shouldScrollUp = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
    switch (contentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        setNewChatMembersDialogState({
          newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Closed
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        if (isScrolledDown && shouldScrollUp && !isSavedMessages) {
          setProfileState(_types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
          break;
        }
        toggleChatInfo({
          force: false
        }, {
          forceSyncOnIOs: true
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        {
          switch (managementScreen) {
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial:
              toggleManagement();
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatPrivacyType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Discussion:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelSubscribers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupMembers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Reactions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.JoinRequests:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelRemovedUsers:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissionsCreate:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRemovedUsers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions);
              setSelectedChatMemberId(undefined);
              setIsPromotedByCurrentUser(undefined);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatNewAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupAddAdmins:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRecentActions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.EditInvite:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.InviteInfo:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites);
              setOpenedInviteInfo({
                chatId: chatId,
                invite: undefined
              });
              setEditingExportedInvite({
                chatId: chatId,
                invite: undefined
              });
              break;
          }
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        toggleMessageStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        toggleStoryStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        toggleStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        closeBoostStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Search:
        {
          blurSearchInput();
          closeLocalTextSearch();
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        blurSearchInput();
        setStickerSearchQuery({
          query: undefined
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        {
          blurSearchInput();
          setGifSearchQuery({
            query: undefined
          });
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        closePollResults();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        closeCreateTopicPanel();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        closeEditTopicPanel();
        break;
    }
  });
  const handleSelectChatMember = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])((memberId, isPromoted) => {
    setSelectedChatMemberId(memberId);
    setIsPromotedByCurrentUser(isPromoted);
  });
  const handleAppendingChatMembers = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(memberIds => {
    addChatMembers({
      chatId: chatId,
      memberIds
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isOpen && chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(close) : undefined, [isOpen, close, chatId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isOpen);
    }, ANIMATION_DURATION);
  }, [isOpen]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (nextManagementScreen) {
      setManagementScreen(nextManagementScreen);
      requestNextManagementScreen(undefined);
    }
  }, [nextManagementScreen]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!nextProfileTab) return;
    resetNextProfileTab();
  }, [nextProfileTab]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldCloseRightColumn) {
      close();
      setShouldCloseRightColumn({
        value: undefined
      });
    }
  }, [shouldCloseRightColumn]);

  // Close Right Column when it transforms into overlayed state on screen resize
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && isOverlaying) {
      close();
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [isOverlaying]);

  // We need to clear profile state and management screen state, when changing chats
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_10__["default"])(_ref2 => {
    let [prevChatId, prevThreadId] = _ref2;
    if (prevChatId !== chatId || prevThreadId !== threadId) {
      setProfileState(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
      setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
    }
  }, [chatId, threadId, isSavedDialog, isSavedMessages]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isActive: isChatSelected && (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic),
    onBack: () => close(false)
  });
  function renderContent(isActive) {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AddChatMembers__WEBPACK_IMPORTED_MODULE_13__["default"], {
          key: `add_chat_members_${chatId}`,
          chatId: chatId,
          isActive: isOpen && isActive,
          onNextStep: handleAppendingChatMembers,
          onClose: close
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Profile__WEBPACK_IMPORTED_MODULE_19__["default"], {
          key: `profile_${chatId}_${threadId}`,
          chatId: chatId,
          threadId: threadId,
          profileState: profileState,
          isMobile: isMobile,
          onProfileStateChange: setProfileState
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Search:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RightSearch_async__WEBPACK_IMPORTED_MODULE_21__["default"], {
          key: `right_search_${chatId}`,
          chatId: chatId,
          threadId: threadId,
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_management_Management_async__WEBPACK_IMPORTED_MODULE_17__["default"], {
          key: `management_${chatId}_${managementScreen}`,
          chatId: chatId,
          currentScreen: managementScreen,
          isPromotedByCurrentUser: isPromotedByCurrentUser,
          selectedChatMemberId: selectedChatMemberId,
          isActive: isOpen && isActive,
          onScreenSelect: setManagementScreen,
          onChatMemberSelect: handleSelectChatMember,
          onClose: close
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_24__["default"], {
          chatId: chatId
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_22__["default"], null);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_23__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_25__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StickerSearch_async__WEBPACK_IMPORTED_MODULE_26__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_GifSearch_async__WEBPACK_IMPORTED_MODULE_16__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PollResults_async__WEBPACK_IMPORTED_MODULE_18__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CreateTopic_async__WEBPACK_IMPORTED_MODULE_14__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EditTopic_async__WEBPACK_IMPORTED_MODULE_15__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
    }
    return undefined; // Unreachable
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "RightColumn-wrapper",
    className: !isChatSelected ? 'is-hidden' : undefined
  }, isOverlaying && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "overlay-backdrop",
    onClick: close
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "RightColumn"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RightHeader__WEBPACK_IMPORTED_MODULE_20__["default"], {
    chatId: chatId,
    threadId: threadId,
    isColumnOpen: isOpen,
    isProfile: isProfile,
    isSearch: isSearch,
    isManagement: isManagement,
    isStatistics: isStatistics,
    isBoostStatistics: isBoostStatistics,
    isMessageStatistics: isMessageStatistics,
    isStoryStatistics: isStoryStatistics,
    isStickerSearch: isStickerSearch,
    isGifSearch: isGifSearch,
    isPollResults: isPollResults,
    isCreatingTopic: isCreatingTopic,
    isEditingTopic: isEditingTopic,
    isAddingChatMembers: isAddingChatMembers,
    profileState: profileState,
    managementScreen: managementScreen,
    onClose: close,
    onScreenSelect: setManagementScreen
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: shouldSkipTransition || shouldSkipHistoryAnimations ? 'none' : 'zoomFade',
    renderCount: MAIN_SCREENS_COUNT + MANAGEMENT_SCREENS_COUNT,
    activeKey: isManagement ? MAIN_SCREENS_COUNT + managementScreen : renderingContentKey,
    shouldCleanup: true,
    cleanupExceptionKey: renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics || renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics ? _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics : undefined
  }, renderContent)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref3) => {
  let {
    isMobile
  } = _ref3;
  const {
    chatId,
    threadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global) || {};
  const areActiveChatsLoaded = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectAreActiveChatsLoaded)(global);
  const {
    management,
    shouldSkipHistoryAnimations,
    nextProfileTab,
    shouldCloseRightColumn
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const nextManagementScreen = chatId ? management.byChatId[chatId]?.nextScreen : undefined;
  const isSavedMessages = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsChatWithSelf)(global, chatId) : undefined;
  const isSavedDialog = chatId ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getIsSavedDialog)(chatId, threadId, global.currentUserId) : undefined;
  return {
    contentKey: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectRightColumnContentKey)(global, isMobile),
    chatId,
    threadId,
    isChatSelected: Boolean(chatId && areActiveChatsLoaded),
    shouldSkipHistoryAnimations,
    nextManagementScreen,
    nextProfileTab,
    shouldCloseRightColumn,
    isSavedMessages,
    isSavedDialog
  };
})(RightColumn)));

/***/ }),

/***/ "./src/components/right/RightHeader.tsx":
/*!**********************************************!*\
  !*** ./src/components/right/RightHeader.tsx ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _RightHeader_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./RightHeader.scss */ "./src/components/right/RightHeader.scss");























const COLUMN_ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_END_DELAY;
const runDebouncedForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_9__.debounce)(cb => cb(), 200, false);
var HeaderContent = /*#__PURE__*/function (HeaderContent) {
  HeaderContent[HeaderContent["Profile"] = 0] = "Profile";
  HeaderContent[HeaderContent["MemberList"] = 1] = "MemberList";
  HeaderContent[HeaderContent["SharedMedia"] = 2] = "SharedMedia";
  HeaderContent[HeaderContent["StoryList"] = 3] = "StoryList";
  HeaderContent[HeaderContent["Search"] = 4] = "Search";
  HeaderContent[HeaderContent["Statistics"] = 5] = "Statistics";
  HeaderContent[HeaderContent["MessageStatistics"] = 6] = "MessageStatistics";
  HeaderContent[HeaderContent["StoryStatistics"] = 7] = "StoryStatistics";
  HeaderContent[HeaderContent["BoostStatistics"] = 8] = "BoostStatistics";
  HeaderContent[HeaderContent["Management"] = 9] = "Management";
  HeaderContent[HeaderContent["ManageInitial"] = 10] = "ManageInitial";
  HeaderContent[HeaderContent["ManageChannelSubscribers"] = 11] = "ManageChannelSubscribers";
  HeaderContent[HeaderContent["ManageChatAdministrators"] = 12] = "ManageChatAdministrators";
  HeaderContent[HeaderContent["ManageChatPrivacyType"] = 13] = "ManageChatPrivacyType";
  HeaderContent[HeaderContent["ManageDiscussion"] = 14] = "ManageDiscussion";
  HeaderContent[HeaderContent["ManageGroupPermissions"] = 15] = "ManageGroupPermissions";
  HeaderContent[HeaderContent["ManageGroupRemovedUsers"] = 16] = "ManageGroupRemovedUsers";
  HeaderContent[HeaderContent["ManageChannelRemovedUsers"] = 17] = "ManageChannelRemovedUsers";
  HeaderContent[HeaderContent["ManageGroupUserPermissionsCreate"] = 18] = "ManageGroupUserPermissionsCreate";
  HeaderContent[HeaderContent["ManageGroupUserPermissions"] = 19] = "ManageGroupUserPermissions";
  HeaderContent[HeaderContent["ManageGroupRecentActions"] = 20] = "ManageGroupRecentActions";
  HeaderContent[HeaderContent["ManageGroupAdminRights"] = 21] = "ManageGroupAdminRights";
  HeaderContent[HeaderContent["ManageGroupNewAdminRights"] = 22] = "ManageGroupNewAdminRights";
  HeaderContent[HeaderContent["ManageGroupMembers"] = 23] = "ManageGroupMembers";
  HeaderContent[HeaderContent["ManageGroupAddAdmins"] = 24] = "ManageGroupAddAdmins";
  HeaderContent[HeaderContent["StickerSearch"] = 25] = "StickerSearch";
  HeaderContent[HeaderContent["GifSearch"] = 26] = "GifSearch";
  HeaderContent[HeaderContent["PollResults"] = 27] = "PollResults";
  HeaderContent[HeaderContent["AddingMembers"] = 28] = "AddingMembers";
  HeaderContent[HeaderContent["ManageInvites"] = 29] = "ManageInvites";
  HeaderContent[HeaderContent["ManageEditInvite"] = 30] = "ManageEditInvite";
  HeaderContent[HeaderContent["ManageReactions"] = 31] = "ManageReactions";
  HeaderContent[HeaderContent["ManageInviteInfo"] = 32] = "ManageInviteInfo";
  HeaderContent[HeaderContent["ManageJoinRequests"] = 33] = "ManageJoinRequests";
  HeaderContent[HeaderContent["CreateTopic"] = 34] = "CreateTopic";
  HeaderContent[HeaderContent["EditTopic"] = 35] = "EditTopic";
  HeaderContent[HeaderContent["SavedDialogs"] = 36] = "SavedDialogs";
  return HeaderContent;
}(HeaderContent || {});
const RightHeader = _ref => {
  let {
    chatId,
    threadId,
    isColumnOpen,
    isProfile,
    isSearch,
    isManagement,
    isStatistics,
    isMessageStatistics,
    isStoryStatistics,
    isBoostStatistics,
    isStickerSearch,
    isGifSearch,
    isPollResults,
    isCreatingTopic,
    isEditingTopic,
    isAddingChatMembers,
    profileState,
    managementScreen,
    canAddContact,
    userId,
    isSelf,
    canManage,
    isChannel,
    messageSearchQuery,
    stickerSearchQuery,
    gifSearchQuery,
    isEditingInvite,
    canViewStatistics,
    currentInviteInfo,
    shouldSkipHistoryAnimations,
    isBot,
    isInsideTopic,
    canEditTopic,
    isSavedMessages,
    onClose,
    onScreenSelect,
    canEditBot
  } = _ref;
  const {
    setLocalTextSearchQuery,
    setStickerSearchQuery,
    setGifSearchQuery,
    searchTextMessagesLocal,
    toggleManagement,
    openHistoryCalendar,
    openAddContactDialog,
    toggleStatistics,
    setEditingExportedInvite,
    deleteExportedChatInvite,
    openEditTopicPanel
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isDeleteDialogOpen, openDeleteDialog, closeDeleteDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const foldersChatCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_14__.useFolderManagerForChatsCount)();
  const handleEditInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    setEditingExportedInvite({
      chatId: chatId,
      invite: currentInviteInfo
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite);
  });
  const handleDeleteInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    deleteExportedChatInvite({
      chatId: chatId,
      link: currentInviteInfo.link
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites);
    closeDeleteDialog();
  });
  const handleMessageSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(query => {
    setLocalTextSearchQuery({
      query
    });
    if (query.length) {
      runDebouncedForSearch(searchTextMessagesLocal);
    }
  });
  const handleStickerSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(query => {
    setStickerSearchQuery({
      query
    });
  });
  const handleGifSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(query => {
    setGifSearchQuery({
      query
    });
  });
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    openAddContactDialog({
      userId
    });
  });
  const toggleEditTopic = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    if (!chatId || !threadId) return;
    openEditTopicPanel({
      chatId,
      topicId: Number(threadId)
    });
  });
  const handleToggleManagement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    toggleManagement();
  });
  const handleToggleStatistics = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    toggleStatistics();
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    onClose(!isSavedMessages);
  });
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isColumnOpen);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isColumnOpen);
    }, COLUMN_ANIMATION_DURATION);
  }, [isColumnOpen]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const contentKey = isProfile ? profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.Profile ? HeaderContent.Profile : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SharedMedia ? HeaderContent.SharedMedia : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.MemberList ? HeaderContent.MemberList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.StoryList ? HeaderContent.StoryList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SavedDialogs ? HeaderContent.SavedDialogs : -1 // Never reached
  : isSearch ? HeaderContent.Search : isPollResults ? HeaderContent.PollResults : isStickerSearch ? HeaderContent.StickerSearch : isGifSearch ? HeaderContent.GifSearch : isAddingChatMembers ? HeaderContent.AddingMembers : isManagement ? managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Initial ? HeaderContent.ManageInitial : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatPrivacyType ? HeaderContent.ManageChatPrivacyType : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Discussion ? HeaderContent.ManageDiscussion : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelSubscribers ? HeaderContent.ManageChannelSubscribers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupPermissions ? HeaderContent.ManageGroupPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdministrators ? HeaderContent.ManageChatAdministrators : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRemovedUsers ? HeaderContent.ManageGroupRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelRemovedUsers ? HeaderContent.ManageChannelRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissionsCreate ? HeaderContent.ManageGroupUserPermissionsCreate : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissions ? HeaderContent.ManageGroupUserPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRecentActions ? HeaderContent.ManageGroupRecentActions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdminRights ? HeaderContent.ManageGroupAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatNewAdminRights ? HeaderContent.ManageGroupNewAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupMembers ? HeaderContent.ManageGroupMembers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites ? HeaderContent.ManageInvites : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite ? HeaderContent.ManageEditInvite : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupAddAdmins ? HeaderContent.ManageGroupAddAdmins : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Reactions ? HeaderContent.ManageReactions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.InviteInfo ? HeaderContent.ManageInviteInfo : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.JoinRequests ? HeaderContent.ManageJoinRequests : undefined // Never reached
  : isStatistics ? HeaderContent.Statistics : isMessageStatistics ? HeaderContent.MessageStatistics : isStoryStatistics ? HeaderContent.StoryStatistics : isBoostStatistics ? HeaderContent.BoostStatistics : isCreatingTopic ? HeaderContent.CreateTopic : isEditingTopic ? HeaderContent.EditTopic : undefined; // When column is closed

  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__["default"])(contentKey, true) ?? -1;
  function getHeaderTitle() {
    if (isSavedMessages) {
      return lang('SavedMessages');
    }
    if (isInsideTopic) {
      return lang('AccDescrTopic');
    }
    if (isChannel) {
      return lang('Channel.TitleInfo');
    }
    if (userId) {
      return lang(isBot ? 'lng_info_bot_title' : 'lng_info_user_title');
    }
    return lang('GroupInfo.Title');
  }
  function renderHeaderContent() {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case HeaderContent.PollResults:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('PollResults'));
      case HeaderContent.Search:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_20__["default"], {
          parentContainerClassName: "RightSearch",
          value: messageSearchQuery,
          onChange: handleMessageSearchQueryChange
        }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          size: "smaller",
          color: "translucent"
          // eslint-disable-next-line react/jsx-no-bind
          ,
          onClick: () => openHistoryCalendar({
            selectedAt: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.getDayStartAt)(Date.now())
          }),
          ariaLabel: "Search messages by date"
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-calendar"
        })));
      case HeaderContent.AddingMembers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang(isChannel ? 'ChannelAddSubscribers' : 'GroupAddMembers'));
      case HeaderContent.ManageInitial:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Edit'));
      case HeaderContent.ManageChatPrivacyType:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang(isChannel ? 'ChannelTypeHeader' : 'GroupTypeHeader'));
      case HeaderContent.ManageDiscussion:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Discussion'));
      case HeaderContent.ManageChatAdministrators:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ChannelAdministrators'));
      case HeaderContent.ManageGroupRecentActions:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Group.Info.AdminLog'));
      case HeaderContent.ManageGroupAdminRights:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('EditAdminRights'));
      case HeaderContent.ManageGroupNewAdminRights:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('SetAsAdmin'));
      case HeaderContent.ManageGroupPermissions:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ChannelPermissions'));
      case HeaderContent.ManageGroupRemovedUsers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('BlockedUsers'));
      case HeaderContent.ManageChannelRemovedUsers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ChannelBlockedUsers'));
      case HeaderContent.ManageGroupUserPermissionsCreate:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ChannelAddException'));
      case HeaderContent.ManageGroupUserPermissions:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('UserRestrictions'));
      case HeaderContent.ManageInvites:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('lng_group_invite_title'));
      case HeaderContent.ManageEditInvite:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, isEditingInvite ? lang('EditLink') : lang('NewLink'));
      case HeaderContent.ManageInviteInfo:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('InviteLink')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("section", {
          className: "tools"
        }, currentInviteInfo && !currentInviteInfo.isRevoked && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('Edit'),
          onClick: handleEditInviteClick
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-edit"
        })), currentInviteInfo && currentInviteInfo.isRevoked && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "danger",
          size: "smaller",
          ariaLabel: lang('Delete'),
          onClick: openDeleteDialog
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-delete"
        })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_19__["default"], {
          isOpen: isDeleteDialogOpen,
          onClose: closeDeleteDialog,
          title: lang('DeleteLink'),
          text: lang('DeleteLinkHelp'),
          confirmIsDestructive: true,
          confirmLabel: lang('Delete'),
          confirmHandler: handleDeleteInviteClick
        }))));
      case HeaderContent.ManageJoinRequests:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, isChannel ? lang('SubscribeRequests') : lang('MemberRequests'));
      case HeaderContent.ManageGroupAddAdmins:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Channel.Management.AddModerator'));
      case HeaderContent.StickerSearch:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_20__["default"], {
          value: stickerSearchQuery,
          placeholder: lang('SearchStickersHint'),
          autoFocusSearch: true,
          onChange: handleStickerSearchQueryChange
        });
      case HeaderContent.GifSearch:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_20__["default"], {
          value: gifSearchQuery,
          placeholder: lang('SearchGifsTitle'),
          autoFocusSearch: true,
          onChange: handleGifSearchQueryChange
        });
      case HeaderContent.Statistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang(isChannel ? 'ChannelStats.Title' : 'GroupStats.Title'));
      case HeaderContent.MessageStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Stats.MessageTitle'));
      case HeaderContent.StoryStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Stats.StoryTitle'));
      case HeaderContent.BoostStatistics:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Boosts'));
      case HeaderContent.SharedMedia:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('SharedMedia'));
      case HeaderContent.ManageChannelSubscribers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ChannelSubscribers'));
      case HeaderContent.MemberList:
      case HeaderContent.ManageGroupMembers:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('GroupMembers'));
      case HeaderContent.StoryList:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang(isSelf ? 'Settings.MyStories' : 'PeerInfo.PaneStories'));
      case HeaderContent.SavedDialogs:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "header"
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('SavedMessagesTab')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "subtitle"
        }, lang('Chats', foldersChatCount[_config__WEBPACK_IMPORTED_MODULE_4__.SAVED_FOLDER_ID])));
      case HeaderContent.ManageReactions:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('Reactions'));
      case HeaderContent.CreateTopic:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('NewTopic'));
      case HeaderContent.EditTopic:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('EditTopic'));
      default:
        return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, getHeaderTitle()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("section", {
          className: "tools"
        }, canAddContact && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('AddContact'),
          onClick: handleAddContact
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-add-user",
          "aria-hidden": true
        })), canManage && !isInsideTopic && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('Edit'),
          onClick: handleToggleManagement
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-edit"
        })), canEditBot && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('Edit'),
          onClick: handleToggleManagement
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_17__["default"], {
          name: "edit"
        })), canEditTopic && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('EditTopic'),
          onClick: toggleEditTopic
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-edit"
        })), canViewStatistics && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: lang('Statistics'),
          onClick: handleToggleStatistics
        }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
          className: "icon icon-stats"
        }))));
    }
  }
  const isBackButton = isMobile || !isSavedMessages && (contentKey === HeaderContent.SharedMedia || contentKey === HeaderContent.MemberList || contentKey === HeaderContent.StoryList || contentKey === HeaderContent.AddingMembers || contentKey === HeaderContent.MessageStatistics || contentKey === HeaderContent.StoryStatistics || isManagement);
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('animated-close-icon', isBackButton && 'state-back', (shouldSkipTransition || shouldSkipHistoryAnimations) && 'no-transition');

  // eslint-disable-next-line no-null/no-null
  const headerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_12__["default"])(headerRef);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "RightHeader",
    ref: headerRef
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
    className: "close-button",
    round: true,
    color: "translucent",
    size: "smaller",
    onClick: handleClose,
    ariaLabel: isBackButton ? lang('Common.Back') : lang('Common.Close')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: buttonClassName
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
    name: shouldSkipTransition || shouldSkipHistoryAnimations ? 'none' : 'slideFade',
    activeKey: renderingContentKey
  }, renderHeaderContent()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    chatId,
    isProfile,
    isManagement,
    threadId
  } = _ref2;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const {
    query: messageSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentTextSearch)(global) || {};
  const {
    query: stickerSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentStickerSearch)(global) || {};
  const {
    query: gifSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentGifSearch)(global) || {};
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId) : undefined;
  const user = isProfile && chatId && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isInsideTopic = chat?.isForum && Boolean(threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const topic = isInsideTopic ? chat.topics?.[threadId] : undefined;
  const canEditTopic = isInsideTopic && topic && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanManageTopic)(chat, topic);
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user);
  const isSavedMessages = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatWithSelf)(global, chatId) : undefined;
  const canEditBot = isBot && user?.canEditBot;
  const canAddContact = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanAddContact)(user);
  const canManage = Boolean(!isManagement && isProfile && chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanManage)(global, chatId));
  const isEditingInvite = Boolean(chatId && tabState.management.byChatId[chatId]?.editingInvite);
  const canViewStatistics = !isInsideTopic && chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId)?.canViewStatistics : undefined;
  const currentInviteInfo = chatId ? tabState.management.byChatId[chatId]?.inviteInfo?.invite : undefined;
  return {
    canManage,
    canAddContact,
    canViewStatistics,
    isChannel,
    isBot,
    isInsideTopic,
    canEditTopic,
    userId: user?.id,
    isSelf: user?.isSelf,
    messageSearchQuery,
    stickerSearchQuery,
    gifSearchQuery,
    isEditingInvite,
    currentInviteInfo,
    isSavedMessages,
    shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,
    canEditBot
  };
})(RightHeader));

/***/ }),

/***/ "./src/components/right/RightSearch.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/right/RightSearch.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const RightSearchAsync = props => {
  const RightSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'RightSearch');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return RightSearch ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(RightSearch, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RightSearchAsync);

/***/ }),

/***/ "./src/components/right/StickerSearch.async.tsx":
/*!******************************************************!*\
  !*** ./src/components/right/StickerSearch.async.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const StickerSearchAsync = () => {
  const StickerSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StickerSearch');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StickerSearch ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StickerSearch, null) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSearchAsync);

/***/ }),

/***/ "./src/components/right/hooks/useProfileState.ts":
/*!*******************************************************!*\
  !*** ./src/components/right/hooks/useProfileState.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileState)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");






const TRANSITION_DURATION = 300;
const PROGRAMMATIC_SCROLL_TIMEOUT_MS = 350;
const runThrottledForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(cb => cb(), 250, false);
let isScrollingProgrammatically = false;
function useProfileState(containerRef, tabType, profileState, onProfileStateChange) {
  let forceScrollProfileTab = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
  // Scroll to tabs if needed
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(_ref => {
    let [prevTabType] = _ref;
    if (prevTabType && prevTabType !== tabType || tabType && forceScrollProfileTab) {
      const container = containerRef.current;
      const tabsEl = container.querySelector('.TabList');
      if (container.scrollTop < tabsEl.offsetTop) {
        onProfileStateChange(getStateFromTabType(tabType));
        isScrollingProgrammatically = true;
        (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])(container, tabsEl, 'start', undefined, undefined, undefined, TRANSITION_DURATION);
        setTimeout(() => {
          isScrollingProgrammatically = false;
        }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
      }
    }
  }, [tabType, onProfileStateChange, containerRef, forceScrollProfileTab]);

  // Scroll to top
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(_ref2 => {
    let [prevProfileState] = _ref2;
    if (profileState !== _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile || profileState === prevProfileState) {
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl || tabListEl.offsetTop > container.scrollTop) {
      return;
    }
    isScrollingProgrammatically = true;
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])(container, container.firstElementChild, 'start', undefined, container.offsetHeight * 2);
    setTimeout(() => {
      isScrollingProgrammatically = false;
    }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
  }, [profileState, containerRef]);
  const determineProfileState = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl) {
      return;
    }
    let state = _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile;
    if (container.scrollTop >= tabListEl.offsetTop) {
      state = getStateFromTabType(tabType);
    }
    onProfileStateChange(state);
  });

  // Determine profile state when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    determineProfileState();
  }, [determineProfileState, tabType]);

  // Determine profile state when scrolling
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    runThrottledForScroll(determineProfileState);
  });
  return {
    handleScroll
  };
}
function getStateFromTabType(tabType) {
  switch (tabType) {
    case 'members':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.MemberList;
    case 'stories':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.StoryList;
    case 'dialogs':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SavedDialogs;
    default:
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SharedMedia;
  }
}

/***/ }),

/***/ "./src/components/right/hooks/useProfileViewportIds.ts":
/*!*************************************************************!*\
  !*** ./src/components/right/hooks/useProfileViewportIds.ts ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileViewportIds)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");






function useProfileViewportIds(loadMoreMembers, loadCommonChats, searchMessages, loadStories, loadStoriesArchive, tabType, mediaSearchType, groupChatMembers, commonChatIds, usersById, userStatusesById, chatsById, chatMessages, foundIds, threadId, storyIds, pinnedStoryIds, archiveStoryIds, similarChannels) {
  const resultType = tabType === 'members' || !mediaSearchType ? tabType : mediaSearchType;
  const memberIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!groupChatMembers || !usersById || !userStatusesById) {
      return undefined;
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.sortUserIds)(groupChatMembers.map(_ref => {
      let {
        userId
      } = _ref;
      return userId;
    }), usersById, userStatusesById);
  }, [groupChatMembers, usersById, userStatusesById]);
  const chatIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!commonChatIds || !chatsById) {
      return undefined;
    }
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__["default"])(commonChatIds, true);
  }, [chatsById, commonChatIds]);
  const [memberViewportIds, getMoreMembers, noProfileInfoForMembers] = useInfiniteScrollForLoadableItems(loadMoreMembers, memberIds);
  const [mediaViewportIds, getMoreMedia, noProfileInfoForMedia] = useInfiniteScrollForSharedMedia('media', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [documentViewportIds, getMoreDocuments, noProfileInfoForDocuments] = useInfiniteScrollForSharedMedia('documents', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [linkViewportIds, getMoreLinks, noProfileInfoForLinks] = useInfiniteScrollForSharedMedia('links', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [audioViewportIds, getMoreAudio, noProfileInfoForAudio] = useInfiniteScrollForSharedMedia('audio', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [voiceViewportIds, getMoreVoices, noProfileInfoForVoices] = useInfiniteScrollForSharedMedia('voice', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [commonChatViewportIds, getMoreCommonChats, noProfileInfoForCommonChats] = useInfiniteScrollForLoadableItems(loadCommonChats, chatIds);
  const sortedStoryIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!storyIds?.length) return storyIds;
    const pinnedStoryIdsSet = new Set(pinnedStoryIds);
    return storyIds.slice().sort((a, b) => {
      const aIsPinned = pinnedStoryIdsSet.has(a);
      const bIsPinned = pinnedStoryIdsSet.has(b);
      if (aIsPinned && !bIsPinned) return -1;
      if (!aIsPinned && bIsPinned) return 1;
      return b - a;
    });
  }, [storyIds, pinnedStoryIds]);
  const [storyViewportIds, getMoreStories, noProfileInfoForStories] = useInfiniteScrollForLoadableItems(loadStories, sortedStoryIds);
  const [archiveStoryViewportIds, getMoreStoriesArchive, noProfileInfoForStoriesArchive] = useInfiniteScrollForLoadableItems(loadStoriesArchive, archiveStoryIds);
  let viewportIds;
  let getMore;
  let noProfileInfo = false;
  switch (resultType) {
    case 'members':
      viewportIds = memberViewportIds;
      getMore = getMoreMembers;
      noProfileInfo = noProfileInfoForMembers;
      break;
    case 'commonChats':
      viewportIds = commonChatViewportIds;
      getMore = getMoreCommonChats;
      noProfileInfo = noProfileInfoForCommonChats;
      break;
    case 'media':
      viewportIds = mediaViewportIds;
      getMore = getMoreMedia;
      noProfileInfo = noProfileInfoForMedia;
      break;
    case 'documents':
      viewportIds = documentViewportIds;
      getMore = getMoreDocuments;
      noProfileInfo = noProfileInfoForDocuments;
      break;
    case 'links':
      viewportIds = linkViewportIds;
      getMore = getMoreLinks;
      noProfileInfo = noProfileInfoForLinks;
      break;
    case 'audio':
      viewportIds = audioViewportIds;
      getMore = getMoreAudio;
      noProfileInfo = noProfileInfoForAudio;
      break;
    case 'voice':
      viewportIds = voiceViewportIds;
      getMore = getMoreVoices;
      noProfileInfo = noProfileInfoForVoices;
      break;
    case 'stories':
      viewportIds = storyViewportIds;
      getMore = getMoreStories;
      noProfileInfo = noProfileInfoForStories;
      break;
    case 'storiesArchive':
      viewportIds = archiveStoryViewportIds;
      getMore = getMoreStoriesArchive;
      noProfileInfo = noProfileInfoForStoriesArchive;
      break;
    case 'similarChannels':
      viewportIds = similarChannels;
      break;
    case 'dialogs':
      noProfileInfo = true;
      break;
  }
  return [resultType, viewportIds, getMore, noProfileInfo];
}
function useInfiniteScrollForLoadableItems(handleLoadMore, itemIds) {
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, itemIds, undefined, _config__WEBPACK_IMPORTED_MODULE_1__.MEMBERS_SLICE);
  const isOnTop = !viewportIds || !itemIds || viewportIds[0] === itemIds[0];
  return [viewportIds, getMore, !isOnTop];
}
function useInfiniteScrollForSharedMedia(forSharedMediaType, currentResultType, handleLoadMore, chatMessages, foundIds, threadId) {
  const messageIdsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    messageIdsRef.current = undefined;
  }, [threadId]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (currentResultType === forSharedMediaType && chatMessages && foundIds) {
      messageIdsRef.current = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageContentIds)(chatMessages, foundIds, forSharedMediaType);
    }
  }, [chatMessages, foundIds, currentResultType, forSharedMediaType]);
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, messageIdsRef.current, undefined, forSharedMediaType === 'media' ? _config__WEBPACK_IMPORTED_MODULE_1__.SHARED_MEDIA_SLICE : _config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_SEARCH_SLICE);
  const isOnTop = !viewportIds || !messageIdsRef.current || viewportIds[0] === messageIdsRef.current[0];
  return [viewportIds, getMore, !isOnTop];
}

/***/ }),

/***/ "./src/components/right/hooks/useTransitionFixes.ts":
/*!**********************************************************!*\
  !*** ./src/components/right/hooks/useTransitionFixes.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTransitionFixes)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");



function useTransitionFixes(containerRef) {
  let transitionElSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.Transition.shared-media-transition';
  // Set `min-height` for shared media container to prevent jumping when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function setMinHeight() {
      const container = containerRef.current;
      const transitionEl = container.querySelector(transitionElSelector);
      const tabsEl = container.querySelector('.TabList');
      if (transitionEl && tabsEl) {
        const newHeight = container.offsetHeight - tabsEl.offsetHeight;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
          transitionEl.style.minHeight = `${newHeight}px`;
        });
      }
    }
    setMinHeight();
    window.addEventListener('resize', setMinHeight, false);
    return () => {
      window.removeEventListener('resize', setMinHeight, false);
    };
  }, [containerRef, transitionElSelector]);

  // Workaround for scrollable content flickering during animation.
  const applyTransitionFix = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    // This callback is called from `Transition.onStart` which is "mutate" phase
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMeasure)(() => {
      const container = containerRef.current;
      if (container.style.overflowY === 'hidden') return;
      const scrollBarWidth = container.offsetWidth - container.clientWidth;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        container.style.overflowY = 'hidden';
        container.style.paddingRight = `${scrollBarWidth}px`;
      });
    });
  });
  const releaseTransitionFix = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    const container = containerRef.current;
    container.style.overflowY = 'scroll';
    container.style.paddingRight = '0';
  });
  return {
    applyTransitionFix,
    releaseTransitionFix
  };
}

/***/ }),

/***/ "./src/components/right/management/Management.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/right/management/Management.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const ManagementAsync = props => {
  const Management = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Management');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return Management ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Management, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ManagementAsync);

/***/ }),

/***/ "./src/components/right/statistics/BoostStatistics.tsx":
/*!*************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/helpers/boostInfo */ "./src/components/common/helpers/boostInfo.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_LinkField__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/LinkField */ "./src/components/common/LinkField.tsx");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _StatisticsOverview__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./StatisticsOverview */ "./src/components/right/statistics/StatisticsOverview.tsx");
/* harmony import */ var _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./BoostStatistics.module.scss */ "./src/components/right/statistics/BoostStatistics.module.scss");
/* harmony import */ var _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../assets/premium/GiftBlueRound.svg */ "./src/assets/premium/GiftBlueRound.svg");
/* harmony import */ var _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../assets/premium/GiftGreenRound.svg */ "./src/assets/premium/GiftGreenRound.svg");
/* harmony import */ var _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../assets/premium/GiftRedRound.svg */ "./src/assets/premium/GiftRedRound.svg");


























const GIVEAWAY_IMG_LIST = {
  3: _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_24__,
  6: _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_23__,
  12: _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_25__
};
const BoostStatistics = _ref => {
  let {
    boostStatistics,
    isGiveawayAvailable,
    chatId,
    giveawayBoostsPerPremium,
    isChannel
  } = _ref;
  const {
    openChat,
    loadMoreBoosters,
    closeBoostStatistics,
    openGiveawayModal,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  // eslint-disable-next-line no-null/no-null
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const isLoaded = boostStatistics?.boostStatus;
  const status = isLoaded ? boostStatistics.boostStatus : undefined;
  const isGiftListEqual = boostStatistics && boostStatistics?.boosts?.count === boostStatistics?.giftedBoosts?.count;
  const shouldDisplayGiftList = !isGiftListEqual && boostStatistics?.giftedBoosts && boostStatistics?.giftedBoosts?.list?.length > 0;
  const {
    currentLevel,
    hasNextLevel,
    boosts,
    levelProgress,
    remainingBoosts
  } = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) {
      return {
        currentLevel: 0,
        hasNextLevel: false,
        boosts: 0,
        levelProgress: 0,
        remainingBoosts: 0,
        prepaidGiveaways: []
      };
    }
    return (0,_common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_9__.getBoostProgressInfo)(status);
  }, [status]);
  const statsOverview = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) return undefined;
    return {
      level: currentLevel,
      boosts,
      premiumSubscribers: status.premiumSubscribers,
      remainingBoosts,
      prepaidGiveaways: status.prepaidGiveaways
    };
  }, [status, boosts, currentLevel, remainingBoosts]);
  const tabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (shouldDisplayGiftList) {
      return [{
        type: 'boostList',
        title: lang('BoostingBoostsCount', boostStatistics?.boosts?.count, 'i')
      }, {
        type: 'giftedBoostList',
        title: lang('BoostingGiftsCount', boostStatistics?.giftedBoosts?.count, 'i')
      }];
    }
    return [];
  }, [shouldDisplayGiftList, lang, boostStatistics?.boosts?.count, boostStatistics?.giftedBoosts?.count]);
  const initialTab = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return boostStatistics?.boosts && boostStatistics.boosts?.list.length > 0 ? 1 : 0;
  }, [boostStatistics]);
  const [activeTab, setActiveTab] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab]?.type;
  const activeKey = tabs.findIndex(_ref2 => {
    let {
      type
    } = _ref2;
    return type === tabType;
  });
  const boostersToLoadCount = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!boostStatistics) return undefined;
    const list = shouldDisplayGiftList ? tabType === 'boostList' ? boostStatistics.boosts : boostStatistics.giftedBoosts : boostStatistics.boosts;
    if (!list?.count) return undefined;
    const loadedBoostsCount = list.list.reduce((total, boost) => {
      return total + (boost.multiplier || 1);
    }, 0);
    const totalCount = list.count;
    const toLoadCount = totalCount - loadedBoostsCount;
    return toLoadCount > 0 ? toLoadCount : undefined;
  }, [shouldDisplayGiftList, boostStatistics, tabType]);
  const renderBoostIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(multiplier => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].quantity
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeButtonColor)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "boost",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeIcon
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeValue
  }, multiplier))));
  const renderBoostTypeIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(boost => {
    if (!boost.isFromGiveaway && !boost.isGift) {
      return undefined;
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].quantity
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadge, !boost.isFromGiveaway && _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeWarning, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeButton)
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
      name: "gift",
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeIcon
    }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeValue
    }, lang(boost.isFromGiveaway ? 'BoostingGiveaway' : 'BoostingGift'))));
  });
  const handleBoosterClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(userId => {
    if (!userId) {
      showNotification({
        message: lang('BoostingRecipientWillBeSelected')
      });
      return;
    }
    openChat({
      id: userId
    });
    closeBoostStatistics();
  });
  const renderBoostList = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(boost => {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: "chat-item-clickable"
      // eslint-disable-next-line react/jsx-no-bind
      ,
      onClick: () => handleBoosterClick(boost.userId)
    }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_15__["default"], {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].user,
      userId: boost.userId,
      customPeer: !boost.userId ? _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_7__.CUSTOM_PEER_TO_BE_DISTRIBUTED : undefined,
      status: lang('BoostExpireOn', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateAtTime)(lang, boost.expires * 1000)),
      noEmojiStatus: true,
      forceShowSelf: true,
      noFake: true,
      noVerified: true,
      iconElement: boost.multiplier ? renderBoostIcon(boost.multiplier) : undefined,
      rightElement: renderBoostTypeIcon(boost)
    }));
  });
  const handleGiveawayClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    e.preventDefault();
    openGiveawayModal({
      chatId
    });
  });
  const handleLoadMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    e.preventDefault();
    loadMoreBoosters({
      isGifts: tabType === 'giftedBoostList'
    });
  });
  const launchPrepaidGiveawayHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(prepaidGiveaway => {
    openGiveawayModal({
      chatId,
      prepaidGiveaway
    });
  });
  function renderContent() {
    let listToRender;
    if (tabType === 'boostList') {
      listToRender = boostStatistics?.boosts?.list;
    } else if (tabType === 'giftedBoostList') {
      listToRender = boostStatistics?.giftedBoosts?.list;
    }
    if (listToRender && !listToRender?.length) {
      return undefined;
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
    }, listToRender?.map(boost => renderBoostList(boost)));
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].root, 'custom-scroll')
  }, !isLoaded && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_17__["default"], null), isLoaded && statsOverview && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_14__["default"], {
    leftText: lang('BoostsLevel', currentLevel),
    rightText: hasNextLevel ? lang('BoostsLevel', currentLevel + 1) : undefined,
    progress: levelProgress,
    floatingBadgeText: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_8__.formatInteger)(boosts),
    floatingBadgeIcon: "boost"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatisticsOverview__WEBPACK_IMPORTED_MODULE_21__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].stats,
    statistics: statsOverview,
    type: "boost"
  })), statsOverview.prepaidGiveaways && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h4", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].sectionHeader,
    dir: lang.isRtl ? 'rtl' : undefined
  }, lang('BoostingPreparedGiveaways')), statsOverview?.prepaidGiveaways?.map(prepaidGiveaway => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    key: prepaidGiveaway.id,
    className: "chat-item-clickable"
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClick: () => launchPrepaidGiveawayHandler(prepaidGiveaway)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].status, 'status-clickable')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: GIVEAWAY_IMG_LIST[prepaidGiveaway.months],
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].giveawayIcon,
    alt: lang('Giveaway')
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].info
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", null, lang('BoostingTelegramPremiumCountPlural', prepaidGiveaway.quantity)), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].month
  }, lang('PrepaidGiveawayMonths', prepaidGiveaway.months))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].quantity
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeButton)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "boost",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeIcon
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].floatingBadgeValue,
    dir: lang.isRtl ? 'rtl' : undefined
  }, prepaidGiveaway.quantity * (giveawayBoostsPerPremium ?? _config__WEBPACK_IMPORTED_MODULE_2__.GIVEAWAY_BOOST_PER_PREMIUM))))))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "text-muted hint",
    key: "links-hint"
  }, lang('BoostingSelectPaidGiveaway'))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, shouldDisplayGiftList ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].boostSection, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].content)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_20__["default"], {
    ref: transitionRef,
    name: lang.isRtl ? 'slideOptimizedRtl' : 'slideOptimized',
    activeKey: activeKey,
    renderCount: tabs.length,
    shouldRestoreHeight: true
  }, renderContent()), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_19__["default"], {
    big: true,
    activeTab: renderingActiveTab,
    tabs: tabs,
    onSwitchTab: setActiveTab
  })) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h4", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].sectionHeader,
    dir: lang.isRtl ? 'rtl' : undefined
  }, lang('BoostingBoostsCount', boostStatistics?.boosts?.count)), !boostStatistics?.boosts?.list?.length && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].noResults
  }, lang(isChannel ? 'NoBoostersHint' : 'NoBoostersGroupHint')), boostStatistics?.boosts?.list?.map(boost => renderBoostList(boost))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
  }, Boolean(boostersToLoadCount) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    key: "load-more",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].showMore,
    disabled: boostStatistics?.isLoadingBoosters,
    onClick: handleLoadMore
  }, boostStatistics?.isLoadingBoosters ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_18__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].loadMoreSpinner
  }) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "down",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].down
  }), lang('ShowVotes', boostersToLoadCount, 'i')))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_LinkField__WEBPACK_IMPORTED_MODULE_13__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section,
    link: status.boostUrl,
    withShare: true,
    title: lang('LinkForBoosting')
  }), isGiveawayAvailable && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].section
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    key: "load-more",
    icon: "gift",
    onClick: handleGiveawayClick,
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].giveawayButton
  }, lang('BoostingGetBoostsViaGifts')), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "text-muted hint",
    key: "links-hint"
  }, lang(isChannel ? 'BoostingGetMoreBoosts' : 'BoostingGetMoreBoostsGroup')))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const boostStatistics = tabState.boostStatistics;
  const isGiveawayAvailable = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsGiveawayGiftsPurchaseAvailable)(global);
  const chatId = boostStatistics && boostStatistics.chatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const giveawayBoostsPerPremium = global.appConfig?.giveawayBoostsPerPremium;
  return {
    boostStatistics,
    isGiveawayAvailable,
    chatId: chatId,
    giveawayBoostsPerPremium,
    isChannel
  };
})(BoostStatistics)));

/***/ }),

/***/ "./src/components/right/statistics/MessageStatistics.async.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/MessageStatistics.async.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const MessageStatisticsAsync = props => {
  const MessageStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MessageStatistics');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return MessageStatistics ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageStatistics, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageStatisticsAsync);

/***/ }),

/***/ "./src/components/right/statistics/Statistics.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/right/statistics/Statistics.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const StatisticsAsync = props => {
  const Statistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Statistics');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return Statistics ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Statistics, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatisticsAsync);

/***/ }),

/***/ "./src/components/right/statistics/StoryStatistics.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/right/statistics/StoryStatistics.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const StoryStatisticsAsync = props => {
  const StoryStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StoryStatistics');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return StoryStatistics ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StoryStatistics, props) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StoryStatisticsAsync);

/***/ }),

/***/ "./src/components/story/MediaStory.tsx":
/*!*********************************************!*\
  !*** ./src/components/story/MediaStory.tsx ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../middle/helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMenuPosition__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useMenuPosition */ "./src/hooks/useMenuPosition.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./mediaArea/MediaAreaOverlay */ "./src/components/story/mediaArea/MediaAreaOverlay.tsx");
/* harmony import */ var _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./MediaStory.module.scss */ "./src/components/story/MediaStory.module.scss");


















function MediaStory(_ref) {
  let {
    story,
    isProtected,
    isArchive,
    isPinned,
    canPin
  } = _ref;
  const {
    openStoryViewer,
    loadPeerSkippedStories,
    toggleStoryInProfile,
    toggleStoryPinnedToTop,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => containerRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => document.body);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => document.querySelector('#portals .story-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => ({
    withPortal: true,
    isDense: true
  }));
  const peerId = story && story.peerId;
  const isFullyLoaded = story && 'content' in story;
  const isOwn = isFullyLoaded && story.isOut;
  const isDeleted = story && 'isDeleted' in story;
  const video = isFullyLoaded ? story.content.video : undefined;
  const duration = video && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatMediaDuration)(video.duration);
  const imageHash = isFullyLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story) : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(imageHash);
  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (story && !(isFullyLoaded || isDeleted)) {
      loadPeerSkippedStories({
        peerId: story.peerId
      });
    }
  }, [isDeleted, isFullyLoaded, story]);
  const {
    isContextMenuOpen,
    contextMenuPosition,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__["default"])(containerRef, !isOwn);
  const {
    positionX,
    positionY,
    transformOriginX,
    transformOriginY,
    style: menuStyle
  } = (0,_hooks_useMenuPosition__WEBPACK_IMPORTED_MODULE_11__["default"])(contextMenuPosition, getTriggerElement, getRootElement, getMenuElement, getLayout);
  const handleClick = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isPrivate: true,
      isArchive
    });
  }, [isArchive, story.id, story.peerId]);
  const handleMouseDown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__.preventMessageInputBlurWithBubbling)(e);
    handleBeforeContextMenu(e);
  });
  const handleUnarchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: true
    });
    showNotification({
      message: lang('Story.ToastSavedToProfileText')
    });
    handleContextMenuClose();
  });
  const handleArchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: false
    });
    showNotification({
      message: lang('Story.ToastRemovedFromProfileText')
    });
    handleContextMenuClose();
  });
  const handleTogglePinned = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    toggleStoryPinnedToTop({
      peerId,
      storyId: story.id
    });
    handleContextMenuClose();
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].root, 'scroll-item'),
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu
  }, isDeleted && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].expiredIcon,
    name: "story-expired"
  }), lang('ExpiredStory')), isPinned && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].pinnedIcon),
    name: "pin-badge"
  }), isFullyLoaded && Boolean(story.views?.viewsCount) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].viewsCount)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "eye"
  }), story.views.viewsCount), duration && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].duration)
  }, duration), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].wrapper
  }, thumbUrl && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbUrl,
    alt: "",
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].media,
    draggable: false
  }), isFullyLoaded && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_16__["default"], {
    story: story
  }), isProtected && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  })), contextMenuPosition !== undefined && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_14__["default"], {
    isOpen: isContextMenuOpen,
    transformOriginX: transformOriginX,
    transformOriginY: transformOriginY,
    positionX: positionX,
    positionY: positionY,
    style: menuStyle,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].contextMenu, 'story-context-menu'),
    autoClose: true,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    withPortal: true
  }, isArchive && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
    icon: "archive",
    onClick: handleUnarchiveClick
  }, lang('StoryList.SaveToProfile')), !isArchive && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
    icon: "archive",
    onClick: handleArchiveClick
  }, lang('Story.Context.RemoveFromProfile')), !isArchive && !isPinned && canPin && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
    icon: "pin",
    onClick: handleTogglePinned
  }, lang('StoryList.ItemAction.Pin')), !isArchive && isPinned && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
    icon: "unpin",
    onClick: handleTogglePinned
  }, lang('StoryList.ItemAction.Unpin'))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, _ref2) => {
  let {
    story
  } = _ref2;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, story.peerId);
  const isProtected = chat?.isProtected;
  const {
    maxPinnedStoriesCount
  } = global.appConfig || {};
  const isOwn = 'isOut' in story && story.isOut;
  const pinnedStories = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPinnedStories)(global, story.peerId);
  const isPinned = pinnedStories?.some(pinnedStory => pinnedStory.id === story.id);
  const canPinMore = isOwn && (!maxPinnedStoriesCount || (pinnedStories?.length || 0) < maxPinnedStoriesCount);
  return {
    isProtected,
    isPinned,
    canPin: canPinMore
  };
})(MediaStory)));

/***/ }),

/***/ "./src/components/story/StoryViewer.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/story/StoryViewer.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StoryViewerAsync = _ref => {
  let {
    isOpen
  } = _ref;
  const StoryViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StoryViewer', !isOpen);
  return StoryViewer ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StoryViewer, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StoryViewerAsync));

/***/ }),

/***/ "./src/global/actions/all.ts":
/*!***********************************!*\
  !*** ./src/global/actions/all.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_initial__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api/initial */ "./src/global/actions/api/initial.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _api_symbols__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./api/symbols */ "./src/global/actions/api/symbols.ts");
/* harmony import */ var _api_globalSearch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./api/globalSearch */ "./src/global/actions/api/globalSearch.ts");
/* harmony import */ var _api_localSearch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./api/localSearch */ "./src/global/actions/api/localSearch.ts");
/* harmony import */ var _api_management__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./api/management */ "./src/global/actions/api/management.ts");
/* harmony import */ var _api_sync__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./api/sync */ "./src/global/actions/api/sync.ts");
/* harmony import */ var _api_accounts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./api/accounts */ "./src/global/actions/api/accounts.ts");
/* harmony import */ var _api_users__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./api/users */ "./src/global/actions/api/users.ts");
/* harmony import */ var _api_bots__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./api/bots */ "./src/global/actions/api/bots.ts");
/* harmony import */ var _api_settings__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./api/settings */ "./src/global/actions/api/settings.ts");
/* harmony import */ var _api_twoFaSettings__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./api/twoFaSettings */ "./src/global/actions/api/twoFaSettings.ts");
/* harmony import */ var _api_payments__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./api/payments */ "./src/global/actions/api/payments.ts");
/* harmony import */ var _api_reactions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./api/reactions */ "./src/global/actions/api/reactions.ts");
/* harmony import */ var _api_statistics__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./api/statistics */ "./src/global/actions/api/statistics.ts");
/* harmony import */ var _api_stories__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./api/stories */ "./src/global/actions/api/stories.ts");
/* harmony import */ var _ui_initial__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui/initial */ "./src/global/actions/ui/initial.ts");
/* harmony import */ var _ui_chats__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ui/chats */ "./src/global/actions/ui/chats.ts");
/* harmony import */ var _ui_messages__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./ui/messages */ "./src/global/actions/ui/messages.ts");
/* harmony import */ var _ui_globalSearch__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ui/globalSearch */ "./src/global/actions/ui/globalSearch.ts");
/* harmony import */ var _ui_localSearch__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ui/localSearch */ "./src/global/actions/ui/localSearch.ts");
/* harmony import */ var _ui_stickerSearch__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./ui/stickerSearch */ "./src/global/actions/ui/stickerSearch.ts");
/* harmony import */ var _ui_users__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ui/users */ "./src/global/actions/ui/users.ts");
/* harmony import */ var _ui_settings__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ui/settings */ "./src/global/actions/ui/settings.ts");
/* harmony import */ var _ui_misc__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ui/misc */ "./src/global/actions/ui/misc.ts");
/* harmony import */ var _ui_payments__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./ui/payments */ "./src/global/actions/ui/payments.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ui/calls */ "./src/global/actions/ui/calls.ts");
/* harmony import */ var _ui_mediaViewer__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./ui/mediaViewer */ "./src/global/actions/ui/mediaViewer.ts");
/* harmony import */ var _ui_passcode__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ui/passcode */ "./src/global/actions/ui/passcode.ts");
/* harmony import */ var _ui_reactions__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ui/reactions */ "./src/global/actions/ui/reactions.ts");
/* harmony import */ var _ui_stories__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ui/stories */ "./src/global/actions/ui/stories.ts");
/* harmony import */ var _apiUpdaters_initial__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./apiUpdaters/initial */ "./src/global/actions/apiUpdaters/initial.ts");
/* harmony import */ var _apiUpdaters_chats__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./apiUpdaters/chats */ "./src/global/actions/apiUpdaters/chats.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");
/* harmony import */ var _apiUpdaters_users__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./apiUpdaters/users */ "./src/global/actions/apiUpdaters/users.ts");
/* harmony import */ var _apiUpdaters_symbols__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./apiUpdaters/symbols */ "./src/global/actions/apiUpdaters/symbols.ts");
/* harmony import */ var _apiUpdaters_misc__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./apiUpdaters/misc */ "./src/global/actions/apiUpdaters/misc.ts");
/* harmony import */ var _apiUpdaters_settings__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./apiUpdaters/settings */ "./src/global/actions/apiUpdaters/settings.ts");
/* harmony import */ var _apiUpdaters_twoFaSettings__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./apiUpdaters/twoFaSettings */ "./src/global/actions/apiUpdaters/twoFaSettings.ts");
/* harmony import */ var _apiUpdaters_calls__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./apiUpdaters/calls */ "./src/global/actions/apiUpdaters/calls.ts");
/* harmony import */ var _apiUpdaters_payments__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./apiUpdaters/payments */ "./src/global/actions/apiUpdaters/payments.ts");











































/***/ }),

/***/ "./src/global/actions/api/accounts.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/accounts.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('reportPeer', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('reportPeer', {
    peer: chat,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('reportProfilePhoto', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    photo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  if (!chat || !photo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('reportProfilePhoto', {
    peer: chat,
    photo,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      byHash: result.authorizations,
      orderedHashes: Object.keys(result.authorizations),
      ttlDays: result.ttlDays
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('terminateAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('terminateAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeSessions.byHash;
  global = {
    ...global,
    activeSessions: {
      byHash: newSessions,
      orderedHashes: global.activeSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('terminateAllAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('terminateAllAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const currentSessionHash = global.activeSessions.orderedHashes.find(hash => global.activeSessions.byHash[hash].isCurrent);
  if (!currentSessionHash) {
    return;
  }
  const currentSession = global.activeSessions.byHash[currentSessionHash];
  global = {
    ...global,
    activeSessions: {
      byHash: {
        [currentSessionHash]: currentSession
      },
      orderedHashes: [currentSessionHash]
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('changeSessionSettings', async (global, actions, payload) => {
  const {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('changeSessionSettings', {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      byHash: {
        ...global.activeSessions.byHash,
        [hash]: {
          ...global.activeSessions.byHash[hash],
          ...(areCallsEnabled !== undefined ? {
            areCallsEnabled
          } : undefined),
          ...(areSecretChatsEnabled !== undefined ? {
            areSecretChatsEnabled
          } : undefined),
          ...(isConfirmed && {
            isUnconfirmed: undefined
          })
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('changeSessionTtl', async (global, actions, payload) => {
  const {
    days
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('changeSessionTtl', {
    days
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      ttlDays: days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchWebAuthorizations');
  if (!result) {
    return;
  }
  const {
    users,
    webAuthorizations
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_1__.buildCollectionByKey)(users, 'id'));
  global = {
    ...global,
    activeWebSessions: {
      byHash: webAuthorizations,
      orderedHashes: Object.keys(webAuthorizations)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('terminateWebAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('terminateWebAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeWebSessions.byHash;
  global = {
    ...global,
    activeWebSessions: {
      byHash: newSessions,
      orderedHashes: global.activeWebSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('terminateAllWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('terminateAllWebAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = {
    ...global,
    activeWebSessions: {
      byHash: {},
      orderedHashes: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/bots.ts":
/*!****************************************!*\
  !*** ./src/global/actions/api/bots.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_PopupManager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/PopupManager */ "./src/util/PopupManager.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_bots__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../reducers/bots */ "./src/global/reducers/bots.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");


















const GAMEE_URL = 'https://prizes.gamee.com/';
const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runDebouncedForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_8__.debounce)(cb => cb(), 500, false);
let botFatherId;
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('clickBotInlineButton', (global, actions, payload) => {
  const {
    messageId,
    button,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  switch (button.type) {
    case 'command':
      actions.sendBotCommand({
        command: button.text,
        tabId
      });
      break;
    case 'url':
      {
        const {
          url
        } = button;
        actions.openUrl({
          url,
          tabId
        });
        break;
      }
    case 'callback':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        void answerCallbackButton(global, actions, chat, messageId, button.data, undefined, tabId);
        break;
      }
    case 'requestPoll':
      actions.openPollModal({
        isQuiz: button.isQuiz,
        tabId
      });
      break;
    case 'requestPhone':
      {
        const user = global.currentUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, global.currentUserId) : undefined;
        if (!user) {
          return;
        }
        actions.showDialog({
          data: {
            phoneNumber: user.phoneNumber,
            firstName: user.firstName || '',
            lastName: user.lastName || '',
            userId: user.id
          },
          tabId
        });
        break;
      }
    case 'receipt':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        const {
          receiptMessageId
        } = button;
        actions.getReceipt({
          chatId: chat.id,
          messageId: receiptMessageId,
          tabId
        });
        break;
      }
    case 'buy':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        actions.openInvoice({
          type: 'message',
          chatId: chat.id,
          messageId,
          tabId
        });
        break;
      }
    case 'game':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        void answerCallbackButton(global, actions, chat, messageId, undefined, true, tabId);
        break;
      }
    case 'switchBotInline':
      {
        const {
          query,
          isSamePeer
        } = button;
        actions.switchBotInline({
          query,
          isSamePeer,
          messageId,
          tabId
        });
        break;
      }
    case 'userProfile':
      {
        const {
          userId
        } = button;
        actions.openChatWithInfo({
          id: userId,
          tabId
        });
        break;
      }
    case 'simpleWebView':
      {
        const {
          url
        } = button;
        const {
          chatId
        } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
        if (!chatId) {
          return;
        }
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, messageId);
        if (!message?.senderId) return;
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_10__.extractCurrentThemeParams)();
        actions.requestSimpleWebView({
          url,
          botId: message?.senderId,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'webView':
      {
        const {
          url
        } = button;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chat.id, messageId);
        if (!message) {
          return;
        }
        const botId = message.viaBotId || message.senderId;
        if (!botId) {
          return;
        }
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_10__.extractCurrentThemeParams)();
        actions.requestWebView({
          url,
          botId,
          peerId: chat.id,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'urlAuth':
      {
        const {
          url
        } = button;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
        if (!chat) {
          return;
        }
        actions.requestBotUrlAuth({
          chatId: chat.id,
          messageId,
          buttonId: button.buttonId,
          url,
          tabId
        });
        break;
      }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('sendBotCommand', (global, actions, payload) => {
  const {
    command,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
  if (!chat || !currentMessageList) {
    return;
  }
  const {
    threadId
  } = currentMessageList;
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatLastMessageId)(global, chat.id);
  void sendBotCommand(chat, command, (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectDraft)(global, chat.id, threadId)?.replyInfo, (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSendAs)(global, chat.id), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('restartBot', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    currentUserId
  } = global;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  const bot = currentUserId && (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectBot)(global, chatId);
  if (!currentUserId || !chat || !bot) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatLastMessageId)(global, chat.id);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('unblockUser', {
    user: bot
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.removeBlockedUser)(global, bot.id);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  void sendBotCommand(chat, '/start', undefined, (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSendAs)(global, chatId), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('loadTopInlineBots', async global => {
  const {
    lastRequestedAt
  } = global.topInlineBots;
  if (lastRequestedAt && (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)() - lastRequestedAt < TOP_PEERS_REQUEST_COOLDOWN) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchTopInlineBots');
  if (!result) {
    return;
  }
  const {
    ids,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(users, 'id'));
  global = {
    ...global,
    topInlineBots: {
      ...global.topInlineBots,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('queryInlineBot', async (global, actions, payload) => {
  const {
    chatId,
    username,
    query,
    offset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (inlineBotData === false) {
    return;
  }
  if (inlineBotData === undefined) {
    const {
      user: inlineBot,
      chat
    } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchInlineBot', {
      username
    })) || {};
    global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
    if (!inlineBot || !chat) {
      global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotSettings)(global, username, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
      return;
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addUsers)(global, {
      [inlineBot.id]: inlineBot
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addChats)(global, {
      [chat.id]: chat
    });
    inlineBotData = {
      id: inlineBot.id,
      query: '',
      offset: '',
      switchPm: undefined,
      canLoadMore: true,
      results: [],
      cacheTime: 0
    };
    global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  }
  if (query === inlineBotData.query && !inlineBotData.canLoadMore) {
    return;
  }
  void runDebouncedForSearch(() => {
    searchInlineBot(global, {
      username,
      inlineBotData: inlineBotData,
      chatId,
      query,
      offset
    }, tabId);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('switchBotInline', (global, actions, payload) => {
  const {
    query,
    isSamePeer,
    messageId,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  let {
    botId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return undefined;
  }
  if (!botId && messageId) {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chat.id, messageId);
    if (!message) {
      return undefined;
    }
    botId = message.viaBotId || message.senderId;
  }
  if (!botId) {
    return undefined;
  }
  const botSender = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!botSender) {
    return undefined;
  }
  actions.openChatWithDraft({
    text: {
      text: `@${botSender.usernames[0].username} ${query}`
    },
    chatId: isSamePeer ? chat.id : undefined,
    filter,
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('sendInlineBotResult', (global, actions, payload) => {
  const {
    id,
    queryId,
    isSilent,
    scheduledAt,
    messageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!id) {
    return;
  }
  const {
    chatId,
    threadId
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  const draftReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('sendInlineBotResult', {
    chat,
    resultId: id,
    queryId,
    replyInfo,
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSendAs)(global, chatId),
    isSilent,
    scheduleDate: scheduledAt
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('resetInlineBot', (global, actions, payload) => {
  const {
    username,
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (!inlineBotData) {
    return;
  }
  if (!force && Date.now() < inlineBotData.cacheTime) return;
  inlineBotData = {
    id: inlineBotData.id,
    query: '',
    offset: '',
    switchPm: undefined,
    canLoadMore: true,
    results: [],
    cacheTime: 0
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('resetAllInlineBots', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const inlineBots = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).inlineBots.byUsername;
  Object.keys(inlineBots).forEach(username => {
    actions.resetInlineBot({
      username,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('startBot', async (global, actions, payload) => {
  const {
    botId,
    param
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('unblockUser', {
      user: bot
    });
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('startBot', {
    bot,
    startParam: param
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('sharePhoneWithBot', async (global, actions, payload) => {
  const {
    botId
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('unblockUser', {
      user: bot
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, botId);
  const currentUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, global.currentUserId);
  if (!chat) return;
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatLastMessageId)(global, chat.id);
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('sendMessage', {
    chat,
    contact: {
      mediaType: 'contact',
      firstName: currentUser.firstName || '',
      lastName: currentUser.lastName || '',
      phoneNumber: currentUser.phoneNumber || '',
      userId: currentUser.id
    },
    lastMessageId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestSimpleWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    theme,
    buttonText,
    isFromSideMenu,
    isFromSwitchWebView,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestSimpleWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    return;
  }
  const webViewUrl = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('requestSimpleWebView', {
    url,
    bot,
    theme,
    startParam,
    isFromSideMenu,
    isFromSwitchWebView
  });
  if (!webViewUrl) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    webApp: {
      url: webViewUrl,
      botId,
      buttonText
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    peerId,
    theme,
    isSilent,
    buttonText,
    isFromBotMenu,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectPeer)(global, peerId);
  if (!peer) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    return;
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = currentMessageList || {};
  const draftReplyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectDraft)(global, chatId, threadId)?.replyInfo : undefined;
  const replyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo) : undefined;
  const sendAs = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSendAs)(global, chatId) : undefined;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('requestWebView', {
    url,
    bot,
    peer,
    theme,
    isSilent,
    replyInfo,
    isFromBotMenu,
    startParam,
    sendAs
  });
  if (!result) {
    return;
  }
  const {
    url: webViewUrl,
    queryId
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    webApp: {
      url: webViewUrl,
      botId,
      queryId,
      replyInfo,
      buttonText
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestAppWebView', async (global, actions, payload) => {
  const {
    botId,
    appName,
    startApp,
    theme,
    isWriteAllowed,
    isFromConfirm,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) return;

  // Native clients require to install attach bots before using their named mini apps
  const isAttachBotInstalled = Boolean(global.attachMenu.bots[bot.id]);
  if (bot.isAttachBot && !isFromConfirm && !isAttachBotInstalled) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('loadAttachBot', {
      bot
    });
    if (result) {
      const attachBot = result.bot;
      global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
      (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
      const shouldAskForTos = attachBot.isDisclaimerNeeded || attachBot.isForAttachMenu || attachBot.isForSideMenu;
      if (shouldAskForTos) {
        global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
          requestedAttachBotInstall: {
            bot: attachBot,
            onConfirm: {
              action: 'requestAppWebView',
              payload: {
                ...payload,
                isFromConfirm: true
              }
            }
          }
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        return;
      }
    }
  }
  const botApp = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchBotApp', {
    bot,
    appName
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  if (!botApp) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__.oldTranslate)('lng_username_app_not_found'),
      tabId
    });
    return;
  }
  if (botApp.isInactive && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        shouldRequestWriteAccess: botApp.shouldRequestWriteAccess,
        type: 'botApp',
        onConfirm: {
          action: 'requestAppWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    return;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  const url = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('requestAppWebView', {
    peer: peer || bot,
    app: botApp,
    startParam: startApp,
    isWriteAllowed,
    theme
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  if (!url) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    webApp: {
      url,
      botId,
      buttonText: ''
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('prolongWebView', async (global, actions, payload) => {
  const {
    botId,
    peerId,
    isSilent,
    replyInfo,
    queryId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, peerId);
  if (!peer) return;
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSendAs)(global, peerId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('prolongWebView', {
    bot,
    peer,
    isSilent,
    replyInfo,
    queryId,
    sendAs
  });
  if (!result) {
    actions.closeWebApp({
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('sendWebViewData', (global, actions, payload) => {
  const {
    bot,
    data,
    buttonText
  } = payload;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('sendWebViewData', {
    bot,
    data,
    buttonText
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('closeWebApp', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    webApp: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('setWebAppPaymentSlug', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  if (!tabState.webApp?.url) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    webApp: {
      ...tabState.webApp,
      slug: payload.slug
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('cancelBotTrustRequest', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('markBotTrusted', (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    trustedBotIds
  } = global;
  const newTrustedBotIds = new Set(trustedBotIds);
  newTrustedBotIds.add(botId);
  global = {
    ...global,
    trustedBotIds: Array.from(newTrustedBotIds)
  };
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  if (tabState.botTrustRequest?.onConfirm) {
    const {
      action,
      payload: callbackPayload
    } = tabState.botTrustRequest.onConfirm;
    // @ts-ignore
    actions[action]({
      ...callbackPayload,
      isWriteAllowed
    });
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('loadAttachBots', async global => {
  await loadAttachBots(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_7__["default"])({
    action: 'loadAttachBots',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_2__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('toggleAttachBot', async (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    isEnabled
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, botId);
  if (!bot) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('toggleAttachBot', {
    bot,
    isWriteAllowed,
    isEnabled
  });
});
async function loadAttachBots(global, hash) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('loadAttachBots', {
    hash
  });
  if (!result) {
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
  global = {
    ...global,
    attachMenu: {
      hash: result.hash,
      bots: result.bots
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  return result;
}
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('callAttachBot', (global, actions, payload) => {
  const {
    bot,
    startParam,
    isFromConfirm,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const isFromSideMenu = 'isFromSideMenu' in payload && payload.isFromSideMenu;
  const isFromBotMenu = !bot;
  const shouldDisplayDisclaimer = !isFromBotMenu && !global.attachMenu.bots[bot.id] || bot?.isInactive || bot?.isDisclaimerNeeded;
  if (!isFromConfirm && shouldDisplayDisclaimer) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      requestedAttachBotInstall: {
        bot,
        onConfirm: {
          action: 'callAttachBot',
          payload: {
            ...payload,
            isFromConfirm: true
          }
        }
      }
    }, tabId);
  }
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_10__.extractCurrentThemeParams)();
  if (isFromSideMenu) {
    actions.requestSimpleWebView({
      botId: bot.id,
      buttonText: '',
      isFromSideMenu: true,
      startParam,
      theme,
      tabId
    });
  }
  if ('chatId' in payload) {
    const {
      chatId,
      threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
      url
    } = payload;
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
    actions.requestWebView({
      url,
      peerId: chatId,
      botId: isFromBotMenu ? chatId : bot.id,
      theme,
      buttonText: '',
      isFromBotMenu,
      startParam,
      tabId
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('confirmAttachBotInstall', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    requestedAttachBotInstall
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  const {
    bot,
    onConfirm
  } = requestedAttachBotInstall;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  const botUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, bot.id);
  if (!botUser) return;
  actions.markBotTrusted({
    botId: bot.id,
    isWriteAllowed,
    tabId
  });
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('toggleAttachBot', {
    bot: botUser,
    isWriteAllowed,
    isEnabled: true
  });
  if (onConfirm) {
    const {
      action,
      payload: actionPayload
    } = onConfirm;
    // @ts-ignore
    actions[action](actionPayload);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('cancelAttachBotInstall', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestAttachBotInChat', (global, actions, payload) => {
  const {
    bot,
    filter,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const currentChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId)?.chatId;
  const supportedFilters = bot.attachMenuPeerTypes?.filter(type => type !== 'self' && filter.includes(type));
  if (!supportedFilters?.length) {
    actions.callAttachBot({
      chatId: currentChatId || bot.id,
      bot,
      startParam,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    requestedAttachBotInChat: {
      bot,
      filter: supportedFilters,
      startParam
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('cancelAttachBotInChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    requestedAttachBotInChat: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestBotUrlAuth', async (global, actions, payload) => {
  const {
    chatId,
    buttonId,
    messageId,
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('requestBotUrlAuth', {
    chat,
    buttonId,
    messageId
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    urlAuth: {
      url,
      button: {
        buttonId,
        messageId,
        chatId: chat.id
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('acceptBotUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.button) return;
  const {
    button,
    url
  } = tabState.urlAuth;
  const {
    chatId,
    messageId,
    buttonId
  } = button;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('acceptBotUrlAuth', {
    chat,
    messageId,
    buttonId,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('requestLinkUrlAuth', async (global, actions, payload) => {
  const {
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('requestLinkUrlAuth', {
    url
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    urlAuth: {
      url
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('acceptLinkUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.url) return;
  const {
    url
  } = tabState.urlAuth;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('acceptLinkUrlAuth', {
    url,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('closeUrlAuthModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    urlAuth: undefined
  }, tabId);
});
function handleUrlAuthResult(global, actions, url, result) {
  for (var _len = arguments.length, _ref = new Array(_len > 4 ? _len - 4 : 0), _key = 4; _key < _len; _key++) {
    _ref[_key - 4] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()] = _ref;
  if (result.type === 'request') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
    const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
    if (!tabState.urlAuth) return;
    const {
      domain,
      bot,
      shouldRequestWriteAccess
    } = result;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      urlAuth: {
        ...tabState.urlAuth,
        request: {
          domain,
          botId: bot.id,
          shouldRequestWriteAccess
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    return;
  }
  const siteUrl = result.type === 'accepted' ? result.url : url;
  window.open(siteUrl, '_blank', 'noopener');
  actions.closeUrlAuthModal({
    tabId
  });
}
async function searchInlineBot(global, _ref3) {
  let {
    username,
    inlineBotData,
    chatId,
    query,
    offset
  } = _ref3;
  for (var _len2 = arguments.length, _ref2 = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
    _ref2[_key2 - 2] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()] = _ref2;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectUser)(global, inlineBotData.id);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  if (!bot || !chat) {
    return;
  }
  const shouldReplaceSettings = inlineBotData.query !== query;
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotsIsLoading)(global, true, tabId);
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotSettings)(global, username, {
    ...inlineBotData,
    query,
    ...(shouldReplaceSettings && {
      offset: undefined,
      results: []
    })
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('fetchInlineBotResults', {
    bot,
    chat,
    query,
    offset: shouldReplaceSettings ? undefined : offset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  const newInlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotsIsLoading)(global, false, tabId);
  if (!result || !newInlineBotData || query !== newInlineBotData.query) {
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    return;
  }
  const currentIds = new Set((newInlineBotData.results || []).map(data => data.id));
  const newResults = result.results.filter(data => !currentIds.has(data.id));
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_14__.replaceInlineBotSettings)(global, username, {
    ...newInlineBotData,
    help: result.help,
    cacheTime: Date.now() + result.cacheTime * 1000,
    ...(newResults.length && {
      isGallery: result.isGallery
    }),
    ...(result.switchPm && {
      switchPm: result.switchPm
    }),
    ...(result.switchWebview && {
      switchWebview: result.switchWebview
    }),
    canLoadMore: result.results.length > 0 && Boolean(result.nextOffset),
    results: newInlineBotData.offset === '' || newInlineBotData.offset === result.nextOffset ? result.results : (newInlineBotData.results || []).concat(newResults),
    offset: newResults.length ? result.nextOffset : ''
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
}
async function sendBotCommand(chat, command, replyInfo, sendAs, lastMessageId) {
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('sendMessage', {
    chat,
    replyInfo,
    text: command,
    sendAs,
    lastMessageId
  });
}
let gameePopups;
async function answerCallbackButton(global, actions, chat, messageId, data) {
  let isGame = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
  for (var _len3 = arguments.length, _ref4 = new Array(_len3 > 6 ? _len3 - 6 : 0), _key3 = 6; _key3 < _len3; _key3++) {
    _ref4[_key3 - 6] = arguments[_key3];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()] = _ref4;
  const {
    showDialog,
    showNotification,
    openUrl,
    openGame
  } = actions;
  if (isGame) {
    if (!gameePopups) {
      gameePopups = new _util_PopupManager__WEBPACK_IMPORTED_MODULE_6__["default"]('popup,width=800,height=600', () => {
        showNotification({
          message: 'Allow browser to open popup window',
          tabId
        });
      });
    }
    gameePopups.preOpenIfNeeded();
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('answerCallbackButton', {
    chatId: chat.id,
    accessHash: chat.accessHash,
    messageId,
    data,
    isGame
  });
  if (!result) {
    return;
  }
  const {
    message,
    alert: isError,
    url
  } = result;
  if (isError) {
    showDialog({
      data: {
        message: message || 'Error'
      },
      tabId
    });
  } else if (message) {
    showNotification({
      message,
      tabId
    });
  } else if (url) {
    if (isGame) {
      // Workaround for Gamee embedding bug
      if (url.includes(GAMEE_URL)) {
        gameePopups.open(url);
      } else {
        gameePopups.cancelPreOpen();
        openGame({
          url,
          chatId: chat.id,
          messageId,
          tabId
        });
      }
    } else {
      openUrl({
        url,
        tabId
      });
    }
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('setBotInfo', async (global, actions, payload) => {
  const {
    bot,
    name,
    description: about,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  let {
    langCode
  } = payload;
  if (!langCode) langCode = global.settings.byKey.language;
  const {
    currentUserId
  } = global;
  if (!currentUserId || !bot) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  if (name || about) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_11__.callApi)('setBotInfo', {
      bot,
      langCode,
      name,
      about
    });
    if (result) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateUser)(global, bot.id, {
        firstName: name
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateUserFullInfo)(global, bot.id, {
        bio: about
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('startBotFatherConversation', async (global, actions, payload) => {
  const {
    param,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!botFatherId) {
    const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_17__.fetchChatByUsername)(global, _config__WEBPACK_IMPORTED_MODULE_2__.BOT_FATHER_USERNAME);
    if (!chat) {
      return;
    }
    botFatherId = chat.id;
  }
  if (param) {
    actions.startBot({
      botId: botFatherId,
      param
    });
  }
  actions.openChat({
    id: botFatherId,
    tabId
  });
});

/***/ }),

/***/ "./src/global/actions/api/globalSearch.ts":
/*!************************************************!*\
  !*** ./src/global/actions/api/globalSearch.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_chats__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers/chats */ "./src/global/helpers/chats.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).globalSearch;
  if (query && !chatId) {
    void searchThrottled(async () => {
      const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchChats', {
        query
      });
      global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
      const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentGlobalSearchQuery)(global, tabId);
      if (!result || !currentSearchQuery || query !== currentSearchQuery) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearchFetchingStatus)(global, {
          chats: false
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
        return;
      }
      const {
        accountResultIds,
        globalResultIds,
        users,
        chats
      } = result;
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(chats, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(users, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearchFetchingStatus)(global, {
        chats: false
      }, tabId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearch)(global, {
        localResults: {
          peerIds: accountResultIds
        },
        globalResults: {
          ...(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).globalSearch.globalResults,
          peerIds: globalResultIds
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setGlobalSearchDate', (global, actions, payload) => {
  const {
    date,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const maxDate = date ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.timestampPlusDay)(date) : date;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearch)(global, {
    date,
    query: '',
    resultsByType: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).globalSearch.resultsByType,
      text: {
        totalCount: undefined,
        foundIds: [],
        nextOffsetId: 0
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).globalSearch;
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId) : undefined;
  searchMessagesGlobal(global, '', 'text', undefined, chat, maxDate, date, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchMessagesGlobal', (global, actions, payload) => {
  const {
    type,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    query,
    resultsByType,
    chatId,
    date
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).globalSearch;
  const maxDate = date ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.timestampPlusDay)(date) : date;
  const nextOffsetId = resultsByType?.[type]?.nextOffsetId;
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId) : undefined;
  searchMessagesGlobal(global, query, type, nextOffsetId, chat, maxDate, date, tabId);
});
async function searchMessagesGlobal(global) {
  let query = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
  let type = arguments.length > 2 ? arguments[2] : undefined;
  let offsetRate = arguments.length > 3 ? arguments[3] : undefined;
  let chat = arguments.length > 4 ? arguments[4] : undefined;
  let maxDate = arguments.length > 5 ? arguments[5] : undefined;
  let minDate = arguments.length > 6 ? arguments[6] : undefined;
  for (var _len = arguments.length, _ref = new Array(_len > 7 ? _len - 7 : 0), _key = 7; _key < _len; _key++) {
    _ref[_key - 7] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()] = _ref;
  let result;
  let messageLink;
  if (chat) {
    const localResultRequest = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesLocal', {
      chat,
      query,
      type,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_SEARCH_SLICE,
      offsetId: offsetRate,
      minDate,
      maxDate
    });
    const topicsRequest = chat.isForum ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchTopics', {
      chat,
      query,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_TOPIC_SEARCH_SLICE
    }) : undefined;
    const [localResult, topics] = await Promise.all([localResultRequest, topicsRequest]);
    if (localResult) {
      const {
        messages,
        users,
        totalCount,
        nextOffsetId
      } = localResult;
      const {
        topics: localTopics,
        count
      } = topics || {};
      result = {
        topics: localTopics,
        totalTopicsCount: count,
        messages,
        users,
        chats: [],
        totalCount,
        nextRate: nextOffsetId
      };
    }
  } else {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesGlobal', {
      query,
      offsetRate,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_SEARCH_SLICE,
      type,
      maxDate,
      minDate
    });
    if ((0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__.isDeepLink)(query)) {
      const link = (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__.tryParseDeepLink)(query);
      if (link?.type === 'publicMessageLink') {
        messageLink = await getMessageByPublicLink(global, link);
      } else if (link?.type === 'privateMessageLink') {
        messageLink = await getMessageByPrivateLink(global, link);
      }
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentGlobalSearchQuery)(global, tabId);
  if (!result || query !== '' && query !== currentSearchQuery) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearchFetchingStatus)(global, {
      messages: false
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    return;
  }
  if (messageLink) {
    result.totalCount = result.messages.unshift(messageLink);
  }
  const {
    messages,
    users,
    chats,
    totalCount,
    nextRate
  } = result;
  if (chats.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(chats, 'id'));
  }
  if (users.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(users, 'id'));
  }
  if (messages.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addMessages)(global, messages);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearchResults)(global, messages, totalCount, type, nextRate, tabId);
  if (result.topics) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateTopics)(global, chat.id, result.totalTopicsCount, result.topics);
  }
  const sortedTopics = result.topics?.map(_ref2 => {
    let {
      id
    } = _ref2;
    return id;
  }).sort((a, b) => b - a);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateGlobalSearch)(global, {
    foundTopicIds: sortedTopics
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
}
async function getMessageByPublicLink(global, link) {
  const {
    username,
    messageId
  } = link;
  const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatByUsername)(global, username);
  if (localChat) {
    return getChatGroupOrChannelMessage(global, localChat, messageId);
  }
  const {
    chat
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('getChatByUsername', username)) ?? {};
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
function getMessageByPrivateLink(global, link) {
  const {
    channelId,
    messageId
  } = link;
  const internalChannelId = (0,_helpers_chats__WEBPACK_IMPORTED_MODULE_7__.toChannelId)(channelId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, internalChannelId);
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
async function getChatGroupOrChannelMessage(global, chat, messageId) {
  if (!(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_7__.isChatGroup)(chat) && !(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_7__.isChatChannel)(chat)) {
    return undefined;
  }
  const localMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, chat.id, messageId);
  if (localMessage) {
    return localMessage;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  return result === 'MESSAGE_DELETED' ? undefined : result?.message;
}

/***/ }),

/***/ "./src/global/actions/api/localSearch.ts":
/*!***********************************************!*\
  !*** ./src/global/actions/api/localSearch.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");









const MEDIA_PRELOAD_OFFSET = 9;
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('searchTextMessagesLocal', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) return;
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = realChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, realChatId) : undefined;
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentTextSearch)(global, tabId);
  if (!chat || !threadId || !currentSearch) {
    return;
  }
  const {
    query,
    results,
    savedTag
  } = currentSearch;
  const offsetId = results?.nextOffsetId;
  if (!query && !savedTag) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('searchMessagesLocal', {
    chat,
    type: 'text',
    query,
    threadId,
    limit: _config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_SEARCH_SLICE,
    offsetId,
    isSavedDialog,
    savedTag
  });
  if (!result) {
    return;
  }
  const {
    chats,
    users,
    messages,
    totalCount,
    nextOffsetId
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentTextSearch)(global, tabId);
  const hasTagChanged = !(0,_helpers__WEBPACK_IMPORTED_MODULE_5__.isSameReaction)(savedTag, currentSearch?.savedTag);
  if (!currentSearch || query !== currentSearch.query || hasTagChanged) {
    return;
  }
  const resultChatId = isSavedDialog ? currentUserId : chat.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChatMessagesById)(global, resultChatId, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLocalTextSearchResults)(global, resultChatId, threadId, newFoundIds, totalCount, nextOffsetId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('searchSharedMediaMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, realChatId);
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!chat || !currentSearch) {
    return;
  }
  const {
    currentType: type,
    resultsByType
  } = currentSearch;
  const currentResults = type && resultsByType && resultsByType[type];
  const offsetId = currentResults?.nextOffsetId;
  if (!type) {
    return;
  }
  void searchSharedMedia(global, chat, threadId, type, offsetId, undefined, isSavedDialog, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('searchChatMediaMessages', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    currentMediaMessageId,
    limit,
    direction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if (!chatId || !threadId || !currentMediaMessageId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, realChatId);
  if (!chat) {
    return;
  }
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentChatMediaSearch)(global, tabId);
  if (!currentSearch) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.initializeChatMediaSearchResults)(global, chatId, threadId, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentChatMediaSearch)(global, tabId);
    if (!currentSearch) {
      return;
    }
  }
  void searchChatMedia(global, chat, threadId, currentMediaMessageId, currentSearch, direction, isSavedDialog, limit, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('searchMessagesByDate', async (global, actions, payload) => {
  const {
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const messageId = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('findFirstMessageIdAfterDate', {
    chat,
    timestamp
  });
  if (!messageId) {
    return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId,
    tabId
  });
});
async function searchSharedMedia(global, chat, threadId, type, offsetId) {
  let isBudgetPreload = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
  let isSavedDialog = arguments.length > 6 ? arguments[6] : undefined;
  for (var _len = arguments.length, _ref = new Array(_len > 7 ? _len - 7 : 0), _key = 7; _key < _len; _key++) {
    _ref[_key - 7] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref;
  const resultChatId = isSavedDialog ? global.currentUserId : chat.id;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('searchMessagesLocal', {
    chat,
    type,
    limit: _config__WEBPACK_IMPORTED_MODULE_1__.SHARED_MEDIA_SLICE * 2,
    threadId,
    offsetId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    chats,
    users,
    messages,
    totalCount,
    nextOffsetId
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!currentSearch) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChatMessagesById)(global, resultChatId, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateSharedMediaSearchResults)(global, resultChatId, threadId, type, newFoundIds, totalCount, nextOffsetId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  if (!isBudgetPreload) {
    void searchSharedMedia(global, chat, threadId, type, nextOffsetId, true, isSavedDialog, tabId);
  }
}
function selectCurrentChatMediaSearchSegment(params, currentMediaMessageId) {
  if ((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.isInsideSortedArrayRange)(currentMediaMessageId, params.currentSegment.foundIds)) {
    return params.currentSegment;
  }
  const index = params.segments.findIndex(segment => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.isInsideSortedArrayRange)(currentMediaMessageId, segment.foundIds));
  if (index === -1) {
    if (params.currentSegment && params.currentSegment.foundIds.length) {
      params.segments.push(params.currentSegment);
    }
    return undefined;
  }
  const result = params.segments.splice(index, 1)[0];
  params.segments.push(params.currentSegment);
  return result;
}
function calcChatMediaSearchAddOffset(direction, limit) {
  if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Backwards) return 0;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Forwards) return -(limit + 1);
  return -(Math.round(limit / 2) + 1);
}
function calcChatMediaSearchOffsetId(direction, currentMessageId, segment) {
  if (!segment) return currentMessageId;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Backwards) return segment.foundIds[0];
  if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Forwards) return segment.foundIds[segment.foundIds.length - 1];
  return currentMessageId;
}
function calcLoadMoreDirection(currentMessageId, currentSegment) {
  if (!currentSegment) return _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Around;
  const currentSegmentFoundIdsCount = currentSegment.foundIds.length;
  const idIndexInSegment = currentSegment.foundIds.indexOf(currentMessageId);
  if (idIndexInSegment === -1) return _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Around;
  if (currentSegment.loadingState.areAllItemsLoadedBackwards && currentSegment.loadingState.areAllItemsLoadedForwards) {
    return undefined;
  }
  const halfMediaCount = Math.floor(currentSegmentFoundIdsCount / 2);
  const preloadOffset = MEDIA_PRELOAD_OFFSET > halfMediaCount ? 0 : MEDIA_PRELOAD_OFFSET;
  const lastMediaIndex = currentSegmentFoundIdsCount - 1;
  if (idIndexInSegment <= preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedBackwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Backwards;
  }
  if (idIndexInSegment >= lastMediaIndex - preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedForwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Forwards;
  }
  return undefined;
}
function calcLoadingState(direction, limit, newFoundIdsCount, currentSegment) {
  let areAllItemsLoadedForwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedForwards);
  let areAllItemsLoadedBackwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedBackwards);
  if (newFoundIdsCount < limit) {
    if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Forwards) {
      areAllItemsLoadedForwards = true;
    } else if (direction === _types__WEBPACK_IMPORTED_MODULE_0__.LoadMoreDirection.Backwards) {
      areAllItemsLoadedBackwards = true;
    }
  }
  return {
    areAllItemsLoadedForwards,
    areAllItemsLoadedBackwards
  };
}
async function searchChatMedia(global, chat, threadId, currentMediaMessageId, chatMediaSearchParams, direction, isSavedDialog) {
  let limit = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : _config__WEBPACK_IMPORTED_MODULE_1__.CHAT_MEDIA_SLICE;
  for (var _len2 = arguments.length, _ref2 = new Array(_len2 > 8 ? _len2 - 8 : 0), _key2 = 8; _key2 < _len2; _key2++) {
    _ref2[_key2 - 8] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref2;
  const {
    isSynced
  } = global;
  if (!isSynced || chatMediaSearchParams.isLoading) {
    return;
  }
  let currentSegment = selectCurrentChatMediaSearchSegment(chatMediaSearchParams, currentMediaMessageId);
  if (direction === undefined) {
    direction = calcLoadMoreDirection(currentMediaMessageId, currentSegment);
  }
  if (direction === undefined) {
    return;
  }
  const offsetId = calcChatMediaSearchOffsetId(direction, currentMediaMessageId, currentSegment);
  const addOffset = calcChatMediaSearchAddOffset(direction, limit);
  const resultChatId = isSavedDialog ? global.currentUserId : chat.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.setChatMediaSearchLoading)(global, resultChatId, threadId, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('searchMessagesLocal', {
    chat,
    type: 'media',
    limit,
    threadId,
    offsetId,
    isSavedDialog,
    addOffset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  const {
    chats,
    users,
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChatMessagesById)(global, resultChatId, byId);
  const loadingState = calcLoadingState(direction, limit, newFoundIds.length, currentSegment);
  const filteredIds = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.getChatMediaMessageIds)(byId, newFoundIds, false);
  currentSegment = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.mergeWithChatMediaSearchSegment)(filteredIds, loadingState, currentSegment);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatMediaSearchResults)(global, resultChatId, threadId, currentSegment, chatMediaSearchParams, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
}

/***/ }),

/***/ "./src/global/actions/api/management.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/api/management.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");










(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('checkPublicLink', async (global, actions, payload) => {
  const {
    username,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }

  // No need to check the username if already in progress
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).management.progress === _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const {
    result,
    error
  } = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('checkChatUsername', {
    username
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, result === true ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    isUsernameAvailable: result === true,
    checkedUsername: username,
    error
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  if (result === undefined) {
    actions.openLimitReachedModal({
      limit: 'channelsPublic',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('updatePublicLink', async (global, actions, payload) => {
  const {
    username,
    shouldDisableUsernames,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_9__.ensureIsSuperGroup)(global, actions, chatId, tabId);
  if (!chat) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('setChatUsername', {
    chat,
    username
  });
  if (shouldDisableUsernames) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('deactivateAllUsernames', {
      chat
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, result ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chat.id, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined,
    error: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('updatePrivateLink', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global, tabId) || {};
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!chatId || !chat) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('updatePrivateLink', {
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('setEditingExportedInvite', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    editingInvite: invite
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('setOpenedInviteInfo', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const update = invite ? {
    inviteInfo: {
      invite
    }
  } : {
    inviteInfo: undefined
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadExportedChatInvites', async (global, actions, payload) => {
  const {
    chatId,
    adminId,
    isRevoked,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchExportedChatInvites', {
    peer,
    admin,
    isRevoked,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const {
    invites,
    users
  } = result;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  const update = isRevoked ? {
    revokedInvites: invites
  } : {
    invites
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('editExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('editExportedChatInvite', {
    peer,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  const {
    oldInvite,
    newInvite,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const {
    management
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const invites = (management.byChatId[chatId].invites || []).filter(current => current.link !== oldInvite.link);
  const revokedInvites = [...(management.byChatId[chatId].revokedInvites || [])];
  if (newInvite.isRevoked) {
    revokedInvites.unshift(newInvite);
  } else {
    invites.push(newInvite);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    invites,
    revokedInvites
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('exportChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('exportChatInvite', {
    peer,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const invites = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).management.byChatId[chatId].invites || [];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    invites: [...invites, result]
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('deleteExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('deleteExportedChatInvite', {
    peer,
    link
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const managementState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).management.byChatId[chatId];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    invites: managementState?.invites?.filter(invite => invite.link !== link),
    revokedInvites: managementState?.revokedInvites?.filter(invite => invite.link !== link)
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('deleteRevokedExportedChatInvites', async (global, actions, payload) => {
  const {
    chatId,
    adminId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('deleteRevokedExportedChatInvites', {
    peer,
    admin
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    revokedInvites: []
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadChatInviteImporters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit
  });
  if (!result) {
    return;
  }
  const {
    importers,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      importers
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, users);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadChatInviteRequesters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      requesters: importers
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, users);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    offsetDate = 0,
    offsetUserId,
    limit = 0
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchChatInviteImporters', {
    peer,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
    joinRequests: importers
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, users);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('hideChatJoinRequest', async (global, actions, payload) => {
  const {
    chatId,
    userId,
    isApproved
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, userId);
  if (!peer || !user) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('hideChatJoinRequest', {
    peer,
    user,
    isApproved
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
    joinRequests: targetChat.joinRequests?.filter(importer => importer.userId !== userId)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('hideAllChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    isApproved,
    link
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('hideAllChatJoinRequests', {
    peer,
    isApproved,
    link
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
    joinRequests: []
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, chatId, {
    recentRequesterIds: [],
    requestsPending: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('hideChatReportPanel', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('hideChatReportPanel', chat);
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
    settings: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('uploadContactProfilePhoto', async (global, actions, payload) => {
  const {
    userId,
    file,
    isSuggest,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, userId);
  if (!user) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('uploadContactProfilePhoto', {
    user,
    file,
    isSuggest
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const {
    id,
    accessHash
  } = user;
  const newUser = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!newUser) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  actions.loadProfilePhotos({
    profileId: userId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  if (file && !isSuggest) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('UserInfo.SetCustomPhoto.SuccessPhotoText', (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.getUserFirstOrLastName)(user)),
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('resetManagementError', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateManagement)(global, chatId, {
    error: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/api/messages.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/messages.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_ensureProtocol__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/ensureProtocol */ "./src/util/ensureProtocol.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");



















const AUTOLOGIN_TOKEN_KEY = 'autologin_token';
const uploadProgressCallbacks = new Map();
const runDebouncedForMarkRead = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_10__.debounce)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadViewportMessages', (global, actions, payload) => {
  const {
    direction = _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around,
    isBudgetPreload = false,
    shouldForceRender = false,
    onLoaded,
    onError,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  let {
    chatId,
    threadId
  } = payload || {};
  if (!chatId || !threadId) {
    const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
    if (!currentMessageList) {
      onError?.();
      return;
    }
    chatId = currentMessageList.chatId;
    threadId = currentMessageList.threadId;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  // TODO Revise if `chat.isRestricted` check is needed
  if (!chat || chat.isRestricted) {
    onError?.();
    return;
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(global, chatId, threadId, tabId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectListedIds)(global, chatId, threadId);
  if (!viewportIds || !viewportIds.length || direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around) {
    const offsetId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectFocusedMessageId)(global, chatId, tabId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectRealLastReadId)(global, chatId, threadId);
    const isOutlying = Boolean(offsetId && listedIds && !listedIds.includes(offsetId));
    const historyIds = (isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds) || [];
    const {
      newViewportIds,
      areSomeLocal,
      areAllLocal
    } = getViewportSlice(historyIds, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around);
    if (areSomeLocal) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
    if (!areAllLocal) {
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_10__.onTickEnd)(() => {
        void loadViewportMessages(global, chat, threadId, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around, isOutlying, isBudgetPreload, onLoaded, tabId);
      });
    } else {
      onLoaded?.();
    }
  } else {
    const offsetId = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards ? viewportIds[0] : viewportIds[viewportIds.length - 1];

    // Prevent requests with local offsets
    if ((0,_util_messageKey__WEBPACK_IMPORTED_MODULE_8__.isLocalMessageId)(offsetId)) return;

    // Prevent unnecessary requests in threads
    if (offsetId === threadId && direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return;
    const isOutlying = Boolean(listedIds && !listedIds.includes(offsetId));
    const historyIds = isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds;
    const {
      newViewportIds,
      areSomeLocal,
      areAllLocal
    } = getViewportSlice(historyIds, offsetId, direction);
    if (areSomeLocal) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
    (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_10__.onTickEnd)(() => {
      void loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded, tabId);
    });
    if (isBudgetPreload) {
      return;
    }
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global, {
    forceOnHeavyAnimation: shouldForceRender
  });
});
async function loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded) {
  for (var _len = arguments.length, _ref = new Array(_len > 10 ? _len - 10 : 0), _key = 10; _key < _len; _key++) {
    _ref[_key - 10] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()] = _ref;
  if (!areAllLocal) {
    await loadViewportMessages(global, chat, threadId, offsetId, direction, isOutlying, isBudgetPreload, onLoaded, tabId);
  }
  if (!isBudgetPreload) {
    actions.loadViewportMessages({
      chatId: chat.id,
      threadId,
      direction,
      isBudgetPreload: true,
      onLoaded,
      tabId
    });
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadMessage', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    replyOriginForId,
    threadUpdate
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const message = await loadMessage(global, chat, messageId, replyOriginForId);
  if (message && threadUpdate) {
    const {
      lastMessageId,
      isDeleting
    } = threadUpdate;
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateThreadUnreadFromForwardedMessage)(global, message, chatId, lastMessageId, isDeleting);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendMessage', (global, actions, payload) => {
  const {
    messageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!messageList && !isStoryReply) {
    return undefined;
  }
  let {
    chatId,
    threadId,
    type
  } = messageList || {};
  if (isStoryReply) {
    chatId = storyPeerId;
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
    type = 'thread';
  }
  payload = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.omit)(payload, ['tabId']);
  if (type === 'scheduled' && !payload.scheduledAt) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
      contentToBeScheduled: payload
    }, tabId);
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  const isForwarding = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages?.messageIds?.length;
  const draftReplyInfo = !isForwarding && !isStoryReply ? draft?.replyInfo : undefined;
  const storyReplyInfo = isStoryReply ? {
    type: 'story',
    peerId: storyPeerId,
    storyId: storyId
  } : undefined;
  const messageReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  const replyInfo = storyReplyInfo || messageReplyInfo;
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, chatId);
  const params = {
    ...payload,
    chat,
    replyInfo,
    noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectNoWebPage)(global, chatId, threadId),
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSendAs)(global, chatId),
    lastMessageId
  };
  if (!isStoryReply) {
    actions.clearWebPagePreview({
      tabId
    });
  }
  const isSingle = !payload.attachments || payload.attachments.length <= 1;
  const isGrouped = !isSingle && payload.shouldGroupMessages;
  if (isSingle) {
    const {
      attachments,
      ...restParams
    } = params;
    sendMessage(global, {
      ...restParams,
      attachment: attachments ? attachments[0] : undefined,
      wasDrafted: Boolean(draft)
    });
  } else if (isGrouped) {
    const {
      text,
      entities,
      attachments,
      ...commonParams
    } = params;
    const byType = splitAttachmentsByType(attachments);
    byType.forEach((group, groupIndex) => {
      const groupedAttachments = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.split)(group, _config__WEBPACK_IMPORTED_MODULE_2__.MAX_MEDIA_FILES_FOR_ALBUM);
      for (let i = 0; i < groupedAttachments.length; i++) {
        const [firstAttachment, ...restAttachments] = groupedAttachments[i];
        const groupedId = `${Date.now()}${groupIndex}${i}`;
        const isFirst = i === 0 && groupIndex === 0;
        sendMessage(global, {
          ...commonParams,
          text: isFirst ? text : undefined,
          entities: isFirst ? entities : undefined,
          attachment: firstAttachment,
          groupedId: restAttachments.length > 0 ? groupedId : undefined,
          wasDrafted: Boolean(draft)
        });
        restAttachments.forEach(attachment => {
          sendMessage(global, {
            ...commonParams,
            attachment,
            groupedId
          });
        });
      }
    });
  } else {
    const {
      text,
      entities,
      attachments,
      replyInfo: replyToForFirstMessage,
      ...commonParams
    } = params;
    if (text) {
      sendMessage(global, {
        ...commonParams,
        text,
        entities,
        replyInfo: replyToForFirstMessage,
        wasDrafted: Boolean(draft)
      });
    }
    attachments?.forEach(attachment => {
      sendMessage(global, {
        ...commonParams,
        attachment
      });
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendInviteMessages', async (global, actions, payload) => {
  const {
    chatId,
    userIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatFullInfo)(global, chatId);
  if (!chatFullInfo?.inviteLink) {
    return undefined;
  }
  const userFullNames = [];
  await Promise.all(userIds.map(userId => {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, userId);
    if (!chat) {
      return undefined;
    }
    const userFullName = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getUserFullName)((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, userId));
    if (userFullName) {
      userFullNames.push(userFullName);
    }
    return sendMessage(global, {
      chat,
      text: chatFullInfo.inviteLink
    });
  }));
  return actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('Conversation.ShareLinkTooltip.Chat.One', userFullNames.join(', ')),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('editMessage', (global, actions, payload) => {
  const {
    messageList,
    text,
    entities,
    attachments,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  if (!messageList) {
    return;
  }
  let currentMessageKey;
  const progressCallback = attachments ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  } : undefined;
  const {
    chatId,
    threadId,
    type: messageListType
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectEditingMessage)(global, chatId, threadId, messageListType);
  if (!chat || !message) {
    return;
  }
  actions.setEditingId({
    messageId: undefined,
    tabId
  });
  (async () => {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('editMessage', {
      chat,
      message,
      attachment: attachments ? attachments[0] : undefined,
      text,
      entities,
      noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectNoWebPage)(global, chatId, threadId)
    }, progressCallback);
    if (progressCallback && currentMessageKey) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
      uploadProgressCallbacks.delete(currentMessageKey);
    }
  })();
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('cancelUploadMedia', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const progressCallback = message && uploadProgressCallbacks.get((0,_util_messageKey__WEBPACK_IMPORTED_MODULE_8__.getMessageKey)(message));
  if (progressCallback) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.cancelApiProgress)(progressCallback);
  }
  if ((0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isMessageLocal)(message)) {
    actions.apiUpdate({
      '@type': 'deleteMessages',
      ids: [messageId],
      chatId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('saveDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    text
  } = payload;
  if (!text) {
    return;
  }
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  const newDraft = {
    text,
    replyInfo: currentDraft?.replyInfo,
    effectId: currentDraft?.effectId
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('clearDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    isLocalOnly,
    shouldKeepReply
  } = payload;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  if (!currentDraft) {
    return;
  }
  const currentReplyInfo = currentDraft.replyInfo;
  const newDraft = shouldKeepReply && currentReplyInfo ? {
    replyInfo: currentReplyInfo
  } : undefined;
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)(),
    ...update
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  const updatedReplyInfo = {
    type: 'message',
    ...currentDraft?.replyInfo,
    ...update
  };
  if (!updatedReplyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo: updatedReplyInfo
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('resetDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  const newDraft = !currentDraft?.text ? undefined : {
    ...currentDraft,
    replyInfo: undefined
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: Boolean(newDraft)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('saveEffectInDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    effectId
  } = payload;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId);
  const newDraft = {
    ...currentDraft,
    effectId
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
async function saveDraft(_ref2) {
  let {
    global,
    chatId,
    threadId,
    draft,
    isLocalOnly,
    noLocalTimeUpdate
  } = _ref2;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, chatId);
  if (!chat || user && (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isDeletedUser)(user)) return;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectMessageReplyInfo)(global, chatId, threadId, draft?.replyInfo);
  const newDraft = draft ? {
    ...draft,
    replyInfo,
    date: Math.floor(Date.now() / 1000),
    isLocal: true
  } : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  if (!noLocalTimeUpdate) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
      draftDate: newDraft?.date
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  if (isLocalOnly) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('saveDraft', {
    chat,
    draft: newDraft
  });
  if (result && newDraft) {
    newDraft.isLocal = false;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
    draftDate: newDraft?.date
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleMessageWebPage', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    noWebPage
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, 'noWebPage', noWebPage);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('pinMessage', (global, actions, payload) => {
  const {
    messageId,
    isUnpin,
    isOneSide,
    isSilent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('pinMessage', {
    chat,
    messageId,
    isUnpin,
    isOneSide,
    isSilent
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('unpinAllMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('unpinAllMessages', {
    chat,
    threadId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPinnedIds)(global, chatId, threadId);
  pinnedIds?.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, id, {
      isPinned: false
    });
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'pinnedIds', []);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('deleteMessages', (global, actions, payload) => {
  const {
    messageIds,
    shouldDeleteForAll,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const messageIdsToDelete = messageIds.filter(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
    return message && !(0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isMessageLocal)(message);
  });

  // Only local messages
  if (!messageIdsToDelete.length && messageIds.length) {
    (0,_apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_18__.deleteMessages)(global, (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isChatChannel)(chat) ? chatId : undefined, messageIds, actions);
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('deleteMessages', {
    chat,
    messageIds: messageIdsToDelete,
    shouldDeleteForAll
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectEditingId)(global, chatId, threadId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('deleteScheduledMessages', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('deleteScheduledMessages', {
    chat,
    messageIds
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectEditingScheduledId)(global, chatId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('deleteHistory', async (global, actions, payload) => {
  const {
    chatId,
    shouldDeleteForAll,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('deleteHistory', {
    chat,
    shouldDeleteForAll
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.chatId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }

  // Delete chat from folders
  const folders = global.chatFolders.byId;
  Object.values(folders).forEach(folder => {
    if (folder.includedChatIds.includes(chatId) || folder.pinnedChatIds?.includes(chatId)) {
      const newIncludedChatIds = folder.includedChatIds.filter(id => id !== chatId);
      const newPinnedChatIds = folder.pinnedChatIds?.filter(id => id !== chatId);
      const updatedFolder = {
        ...folder,
        includedChatIds: newIncludedChatIds,
        pinnedChatIds: newPinnedChatIds
      };
      (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('editChatFolder', {
        id: folder.id,
        folderUpdate: updatedFolder
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('deleteSavedHistory', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('deleteSavedHistory', {
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.threadId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('reportMessages', async (global, actions, payload) => {
  const {
    messageIds,
    reason,
    description,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('reportMessages', {
    peer: chat,
    messageIds,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendMessageAction', async (global, actions, payload) => {
  const {
    action,
    chatId,
    threadId
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithSelf)(global, chatId)) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, chatId);
  if (user && ((0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isUserBot)(user) || (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isDeletedUser)(user))) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendMessageAction', {
    peer: chat,
    threadId,
    action
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('markMessageListRead', (global, actions, payload) => {
  const {
    maxId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return undefined;
  }
  runDebouncedForMarkRead(() => {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('markMessageListRead', {
      chat,
      threadId,
      maxId
    });
  });
  if (chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) {
    global = {
      ...global,
      serviceNotifications: global.serviceNotifications.map(notification => {
        return notification.isUnread && notification.id <= maxId ? {
          ...notification,
          isUnread: false
        } : notification;
      })
    };
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(global, chatId, threadId, tabId);
  const minId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectFirstUnreadId)(global, chatId, threadId);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !chat.isForum) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    return global;
  }
  if (!viewportIds || !minId || !chat.unreadCount) {
    return global;
  }
  const readCount = countSortedIds(viewportIds, minId, maxId);
  if (!readCount) {
    return global;
  }
  if (chat.isForum && chat.topics?.[threadId]) {
    const topic = chat.topics[threadId];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    const newTopicUnreadCount = Math.max(0, topic.unreadCount - readCount);
    if (newTopicUnreadCount === 0) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
        unreadCount: Math.max(0, chat.unreadCount - 1)
      });
    }
    return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateTopic)(global, chatId, Number(threadId), {
      unreadCount: newTopicUnreadCount
    });
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
    lastReadInboxMessageId: maxId,
    unreadCount: Math.max(0, chat.unreadCount - readCount)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('markMessagesRead', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)(),
    shouldFetchUnreadReactions
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('markMessagesRead', {
    chat,
    messageIds
  }).then(() => {
    if (shouldFetchUnreadReactions) {
      actions.fetchUnreadReactions({
        chatId: chat.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadWebPagePreview', async (global, actions, payload) => {
  const {
    text,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const webPagePreview = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchWebPagePreview', {
    text
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    webPagePreview
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('clearWebPagePreview', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).webPagePreview) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    webPagePreview: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    options
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendPollVote', {
      chat,
      messageId,
      options
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('cancelPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendPollVote', {
      chat,
      messageId,
      options: []
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closePoll', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const poll = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, messageId)?.content.poll;
  if (chat && poll) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('closePoll', {
      chat,
      messageId,
      poll
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadPollOptionResults', async (global, actions, payload) => {
  const {
    chat,
    messageId,
    option,
    offset,
    limit,
    shouldResetVoters,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('loadPollOptionResults', {
    chat,
    messageId,
    option,
    offset,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.chats, 'id'));
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  const {
    pollResults
  } = tabState;
  const {
    voters
  } = tabState.pollResults;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    pollResults: {
      ...pollResults,
      voters: {
        ...voters,
        [option]: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)([...(!shouldResetVoters && voters?.[option] ? voters[option] : []), ...result.votes.map(vote => vote.peerId)])
      },
      offsets: {
        ...(pollResults.offsets ? pollResults.offsets : {}),
        [option]: result.nextOffset || ''
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadExtendedMedia', (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchExtendedMedia', {
      chat,
      ids
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('forwardMessages', (global, actions, payload) => {
  const {
    isSilent,
    scheduledAt,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const {
    fromChatId,
    messageIds,
    toChatId,
    withMyScore,
    noAuthors,
    noCaptions,
    toThreadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsCurrentUserPremium)(global);
  const isToMainThread = toThreadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, toChatId) : undefined;
  const messages = fromChatId && messageIds ? messageIds.sort((a, b) => a - b).map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, fromChatId, id)).filter(Boolean) : undefined;
  if (!fromChat || !toChat || !messages || toThreadId && !isToMainThread && !toChat.isForum) {
    return;
  }
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSendAs)(global, toChatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, toChatId, toThreadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, toChat.id);
  const [realMessages, serviceMessages] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.partition)(messages, m => !(0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isServiceNotificationMessage)(m));
  if (realMessages.length) {
    (async () => {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_10__.rafPromise)(); // Wait one frame for any previous `sendMessage` to be processed
      (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('forwardMessages', {
        fromChat,
        toChat,
        toThreadId,
        messages: realMessages,
        isSilent,
        scheduledAt,
        sendAs,
        withMyScore,
        noAuthors,
        noCaptions,
        isCurrentUserPremium,
        wasDrafted: Boolean(draft),
        lastMessageId
      });
    })();
  }
  serviceMessages.forEach(message => {
    const {
      text,
      entities
    } = message.content.text || {};
    const {
      sticker,
      poll
    } = message.content;
    const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectMessageReplyInfo)(global, toChat.id, toThreadId);
    void sendMessage(global, {
      chat: toChat,
      replyInfo,
      text,
      entities,
      sticker,
      poll,
      isSilent,
      scheduledAt,
      sendAs,
      lastMessageId
    });
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadScheduledHistory', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchScheduledHistory', {
    chat
  });
  if (!result) {
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateScheduledMessages)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
  if (chat?.isForum) {
    const scheduledPerThread = {};
    messages.forEach(message => {
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
      const scheduledInThread = scheduledPerThread[threadId] || [];
      scheduledInThread.push(message.id);
      scheduledPerThread[threadId] = scheduledInThread;
    });
    Object.entries(scheduledPerThread).forEach(_ref3 => {
      let [threadId, scheduledIds] = _ref3;
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chat.id, Number(threadId), 'scheduledIds', scheduledIds);
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendScheduledMessages', (global, actions, payload) => {
  const {
    chatId,
    id
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendScheduledMessages', {
    chat,
    ids: [id]
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('rescheduleMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    scheduledAt
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const message = chat && (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledMessage)(global, chat.id, messageId);
  if (!chat || !message) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('rescheduleMessage', {
    chat,
    message,
    scheduledAt
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('transcribeAudio', async (global, actions, payload) => {
  const {
    messageId,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: ''
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('transcribeAudio', {
    chat,
    messageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: result,
    isTranscriptionError: !result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadCustomEmojis', async (global, actions, payload) => {
  const {
    ids,
    ignoreCache
  } = payload;
  const newCustomEmojiIds = ignoreCache ? ids : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)(ids.filter(documentId => !global.customEmojis.byId[documentId]));
  const customEmoji = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchCustomEmoji', {
    documentId: newCustomEmojiIds
  });
  if (!customEmoji) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(customEmoji, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
async function loadViewportMessages(global, chat, threadId, offsetId, direction) {
  let isOutlying = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
  let isBudgetPreload = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : false;
  let onLoaded = arguments.length > 7 ? arguments[7] : undefined;
  for (var _len2 = arguments.length, _ref4 = new Array(_len2 > 8 ? _len2 - 8 : 0), _key2 = 8; _key2 < _len2; _key2++) {
    _ref4[_key2 - 8] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()] = _ref4;
  const chatId = chat.id;
  let addOffset;
  let sliceSize = _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      if (offsetId) {
        addOffset = -1;
        sliceSize += 1;
      } else {
        addOffset = undefined;
      }
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
      addOffset = -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1);
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      addOffset = -(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE + 1);
      if (offsetId) {
        sliceSize += 1;
      }
      break;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchMessages', {
    chat: (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, realChatId),
    offsetId,
    addOffset,
    limit: sliceSize,
    threadId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    messages,
    users,
    chats,
    count
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  const localMessages = chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(_ref5 => {
    let {
      isDeleted
    } = _ref5;
    return !isDeleted;
  }).map(_ref6 => {
    let {
      message
    } = _ref6;
    return message;
  }) : [];
  const allMessages = [].concat(messages, localMessages);
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(allMessages, 'id');
  const ids = Object.keys(byId).map(Number);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !(0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    const threadFirstMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectFirstMessageId)(global, chatId, threadId);
    if ((!ids[0] || threadFirstMessageId === ids[0]) && threadFirstMessageId !== threadId) {
      ids.unshift(Number(threadId));
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChatMessagesById)(global, chatId, byId);
  global = isOutlying ? (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateOutlyingLists)(global, chatId, threadId, ids) : (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateListedIds)(global, chatId, threadId, ids);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(chats, 'id'));
  let listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectListedIds)(global, chatId, threadId);
  const outlyingList = offsetId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : undefined;
  if (isOutlying && listedIds && outlyingList) {
    if (!outlyingList.length || (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.areSortedArraysIntersecting)(listedIds, outlyingList)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateListedIds)(global, chatId, threadId, outlyingList);
      listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectListedIds)(global, chatId, threadId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.removeOutlyingList)(global, chatId, threadId, outlyingList);
      isOutlying = false;
    }
  }
  if (!isBudgetPreload) {
    const historyIds = isOutlying && outlyingList ? outlyingList : listedIds;
    if (historyIds) {
      const {
        newViewportIds
      } = getViewportSlice(historyIds, offsetId, direction);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
  }
  if (count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateThreadInfo)(global, chat.id, threadId, {
      messagesCount: count
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  onLoaded?.();
}
async function loadMessage(global, chat, messageId, replyOriginForId) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  if (!result) {
    return undefined;
  }
  if (result === _api_types__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_DELETED) {
    if (replyOriginForId) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chat.id, replyOriginForId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chat.id, replyOriginForId, {
        ...replyMessage,
        replyInfo: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chat.id, messageId, result.message);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  return result.message;
}
function findClosestIndex(sourceIds, offsetId) {
  if (offsetId < sourceIds[0]) {
    return 0;
  }
  if (offsetId > sourceIds[sourceIds.length - 1]) {
    return sourceIds.length - 1;
  }
  return sourceIds.findIndex((id, i) => id === offsetId || id < offsetId && sourceIds[i + 1] > offsetId);
}
function getViewportSlice(sourceIds, offsetId, direction) {
  const {
    length
  } = sourceIds;
  const index = offsetId ? findClosestIndex(sourceIds, offsetId) : -1;
  const isBackwards = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards;
  const isAround = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  const indexForDirection = isBackwards ? index : index + 1 || length;
  const sliceSize = isAround ? Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) : _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  const from = indexForDirection - sliceSize;
  const to = indexForDirection + sliceSize - 1;
  const newViewportIds = sourceIds.slice(Math.max(0, from), to + 1);
  let areSomeLocal;
  let areAllLocal;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      areSomeLocal = indexForDirection >= 0;
      areAllLocal = from >= 0;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      areSomeLocal = indexForDirection < length;
      areAllLocal = to <= length - 1;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
    default:
      areSomeLocal = newViewportIds.length > 0;
      areAllLocal = newViewportIds.length === _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
      break;
  }
  return {
    newViewportIds,
    areSomeLocal,
    areAllLocal
  };
}
async function sendMessage(global, params) {
  let currentMessageKey;
  const progressCallback = params.attachment ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  } : undefined;

  // @optimization
  if (params.replyInfo || _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_IOS) {
    await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_10__.rafPromise)();
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendMessage', params, progressCallback);
  if (progressCallback && currentMessageKey) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    uploadProgressCallbacks.delete(currentMessageKey);
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadPinnedMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchPinnedMessages', {
    chat,
    threadId
  });
  if (!result) {
    return;
  }
  const {
    messages,
    chats,
    users
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.safeReplacePinnedIds)(global, chat.id, threadId, ids);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadSeenBy', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchSeenBy', {
    chat,
    messageId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, messageId, {
    seenByDates: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('saveDefaultSendAs', (global, actions, payload) => {
  const {
    chatId,
    sendAsId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const sendAsChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, sendAsId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, sendAsId);
  if (!chat || !sendAsChat) {
    return undefined;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('saveDefaultSendAs', {
    sendAs: sendAsChat,
    chat
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatFullInfo)(global, chatId, {
    sendAsId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadSendAs', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchSendAs', {
    chat
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
      sendAsPeerIds: []
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chatId, {
    sendAsPeerIds: result.sendAs
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadSponsoredMessages', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchSponsoredMessages', {
    chat
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateSponsoredMessage)(global, chatId, result.messages[0]);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('viewSponsoredMessage', (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSponsoredMessage)(global, chatId);
  if (!chat || !message) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('viewSponsoredMessage', {
    chat,
    random: message.randomId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('clickSponsoredMessage', (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSponsoredMessage)(global, chatId);
  if (!chat || !message) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('clickSponsoredMessage', {
    chat,
    random: message.randomId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('reportSponsoredMessage', async (global, actions, payload) => {
  const {
    chatId,
    randomId,
    option = '',
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('reportSponsoredMessage', {
    chat,
    randomId,
    option
  });
  if (!result) return;
  if (result.type === 'premiumRequired') {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    return;
  }
  if (result.type === 'reported' || result.type === 'hidden') {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)(result.type === 'reported' ? 'AdReported' : 'AdHidden'),
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.deleteSponsoredMessage)(global, chatId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).reportAdModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
      reportAdModal: {
        chatId,
        randomId,
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('hideSponsoredMessages', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsCurrentUserPremium)(global);
  if (!isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('toggleSponsoredMessages', {
    enabled: false
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUserFullInfo)(global, global.currentUserId, {
    areAdsEnabled: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('AdHidden'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('fetchUnreadMentions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  await fetchUnreadMentions(global, chatId, offsetId);
});
async function fetchUnreadMentions(global, chatId, offsetId) {
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchUnreadMentions', {
    chat,
    offsetId
  });
  if (!result) return;
  const {
    messages,
    chats,
    users
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUnreadMentions)(global, chatId, chat, ids);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('markMentionsRead', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.removeUnreadMentions)(global, chat.id, chat, messageIds, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('focusNextMention', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  let chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!chat) return;
  if (!chat.unreadMentions) {
    await fetchUnreadMentions(global, chat.id);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    const previousChatId = chat.id;
    chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
    if (!chat?.unreadMentions || previousChatId !== chat.id) return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadMentions[0],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('readAllMentions', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('readAllMentions', {
    chat
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChat)(global, chat.id, {
    unreadMentionsCount: undefined,
    unreadMentions: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openUrl', (global, actions, payload) => {
  const {
    url,
    shouldSkipModal,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const urlWithProtocol = (0,_util_ensureProtocol__WEBPACK_IMPORTED_MODULE_5__.ensureProtocol)(url);
  if ((0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__.isDeepLink)(urlWithProtocol)) {
    actions.closeStoryViewer({
      tabId
    });
    actions.closePaymentModal({
      tabId
    });
    actions.openTelegramLink({
      url,
      tabId
    });
    return;
  }
  const {
    appConfig,
    config
  } = global;
  if (appConfig) {
    const parsedUrl = new URL(urlWithProtocol);
    if (config?.autologinToken && appConfig.autologinDomains.includes(parsedUrl.hostname)) {
      parsedUrl.searchParams.set(AUTOLOGIN_TOKEN_KEY, config.autologinToken);
      window.open(parsedUrl.href, '_blank', 'noopener');
      return;
    }
    if (appConfig.urlAuthDomains.includes(parsedUrl.hostname)) {
      actions.closeStoryViewer({
        tabId
      });
      actions.requestLinkUrlAuth({
        url,
        tabId
      });
      return;
    }
  }
  const shouldDisplayModal = !urlWithProtocol.match(_config__WEBPACK_IMPORTED_MODULE_2__.RE_TELEGRAM_LINK) && !shouldSkipModal;
  if (shouldDisplayModal) {
    actions.toggleSafeLinkModal({
      url: urlWithProtocol,
      tabId
    });
  } else {
    window.open(urlWithProtocol, '_blank', 'noopener');
  }
});
async function checkIfVoiceMessagesAllowed(global, user, chatId) {
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUserFullInfo)(global, chatId);
  if (!fullInfo) {
    const {
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchFullUser', {
      id: chatId,
      accessHash
    });
    fullInfo = result?.fullInfo;
  }
  return Boolean(!fullInfo?.noVoiceMessages);
}
function moveReplyToNewDraft(global, threadId, replyInfo, toChatId) {
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, toChatId, threadId);
  if (!replyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo
  };
  saveDraft({
    global,
    chatId: toChatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openChatOrTopicWithReplyInDraft', (global, actions, payload) => {
  const {
    chatId: toChatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages,
      isModalShown: false
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  const currentThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId)?.threadId;
  if (!currentChat || !currentThreadId) return;
  const threadId = topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const currentChatId = currentChat.id;
  const currentReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, currentChatId, currentThreadId)?.replyInfo;
  if (!currentReplyInfo) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectReplyCanBeSentToChat)(global, toChatId, currentChatId, currentReplyInfo)) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  if (!currentReplyInfo.replyToPeerId && toChatId === currentChat.id) return;
  const getPeerId = () => {
    if (!currentReplyInfo?.replyToPeerId) return currentChatId;
    return currentReplyInfo.replyToPeerId === toChatId ? undefined : currentReplyInfo.replyToPeerId;
  };
  const replyToPeerId = getPeerId();
  const newReply = {
    ...currentReplyInfo,
    replyToPeerId,
    type: 'message'
  };
  moveReplyToNewDraft(global, threadId, newReply, toChatId);
  actions.openThread({
    chatId: toChatId,
    threadId,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
  actions.clearDraft({
    chatId: currentChatId,
    threadId: currentThreadId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setForwardChatOrTopic', async (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, chatId);
  const isSelectForwardsContainVoiceMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectForwardsContainVoiceMessages)(global, tabId);
  if (isSelectForwardsContainVoiceMessages && user && !(await checkIfVoiceMessagesAllowed(global, user, chatId))) {
    actions.showDialog({
      data: {
        message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('VoiceMessagesRestrictedByPrivacy', (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getUserFullName)(user))
      },
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectForwardsCanBeSentToChat)(global, chatId, tabId)) {
    actions.showAllowedMessageTypesNotification({
      chatId,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages,
      toChatId: chatId,
      toThreadId: topicId,
      isModalShown: false
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  actions.openThread({
    chatId,
    threadId: topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('forwardToSavedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages,
      toChatId: global.currentUserId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  actions.exitMessageSelectMode({
    tabId
  });
  actions.forwardMessages({
    isSilent: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('forwardStory', (global, actions, payload) => {
  const {
    toChatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const {
    fromChatId,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, toChatId) : undefined;
  const story = fromChatId && storyId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPeerStory)(global, fromChatId, storyId) : undefined;
  if (!fromChat || !toChat || !story || 'isDeleted' in story) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, toChatId);
  const {
    text,
    entities
  } = story.content.text || {};
  void sendMessage(global, {
    chat: toChat,
    text,
    entities,
    story,
    lastMessageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestMessageTranslation', (global, actions, payload) => {
  const {
    chatId,
    id,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTranslationLanguage)(global),
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateRequestedMessageTranslation)(global, chatId, id, toLanguageCode, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceSettings)(global, {
    translationLanguage: toLanguageCode
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showOriginalMessage', (global, actions, payload) => {
  const {
    chatId,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.removeRequestedMessageTranslation)(global, chatId, id, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('markMessagesTranslationPending', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectLanguageCode)(global)
  } = payload;
  messageIds.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateMessageTranslation)(global, chatId, id, toLanguageCode, {
      isPending: true
    });
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('translateMessages', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectLanguageCode)(global)
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return undefined;
  actions.markMessagesTranslationPending({
    chatId,
    messageIds,
    toLanguageCode
  });
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('translateText', {
    chat,
    messageIds,
    toLanguageCode
  });
  return global;
});

// https://github.com/telegramdesktop/tdesktop/blob/11906297d82b6ff57b277da5251d2e6eb3d8b6d0/Telegram/SourceFiles/api/api_views.cpp#L22
const SEND_VIEWS_TIMEOUT = 1000;
let viewsIncrementTimeout;
let idsToIncrementViews = {};
function incrementViews() {
  if (viewsIncrementTimeout) {
    clearTimeout(viewsIncrementTimeout);
    viewsIncrementTimeout = undefined;
  }

  // eslint-disable-next-line eslint-multitab-tt/no-getactions-in-actions
  const {
    loadMessageViews
  } = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getActions)();
  Object.entries(idsToIncrementViews).forEach(_ref7 => {
    let [chatId, ids] = _ref7;
    loadMessageViews({
      chatId,
      ids: Array.from(ids),
      shouldIncrement: true
    });
  });
  idsToIncrementViews = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('scheduleForViewsIncrement', (global, actions, payload) => {
  const {
    ids,
    chatId
  } = payload;
  if (!viewsIncrementTimeout) {
    setTimeout(incrementViews, SEND_VIEWS_TIMEOUT);
  }
  if (!idsToIncrementViews[chatId]) {
    idsToIncrementViews[chatId] = new Set();
  }
  ids.forEach(id => {
    idsToIncrementViews[chatId].add(id);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadMessageViews', async (global, actions, payload) => {
  const {
    chatId,
    ids,
    shouldIncrement
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchMessageViews', {
    chat,
    ids,
    shouldIncrement
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.chats, 'id'));
  result.viewsInfo.forEach(update => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, update.id, {
      viewsCount: update.views,
      forwardsCount: update.forwards
    });
    if (update.threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateThreadInfo)(global, chatId, update.id, update.threadInfo);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadFactChecks', async (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchFactChecks', {
    chat,
    ids
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  result.forEach((factCheck, i) => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, ids[i], {
      factCheck
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadOutboxReadDate', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  try {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchOutboxReadDate', {
      chat,
      messageId
    });
    if (result?.date) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, messageId, {
        readDate: result.date
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }
  } catch (error) {
    const {
      message
    } = error;
    if (message === 'USER_PRIVACY_RESTRICTED' || message === 'YOUR_PRIVACY_RESTRICTED') {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUser)(global, chatId);
      if (!user) return;
      const userStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectUserStatus)(global, chatId);
      if (!userStatus) return;
      const updateStatus = message === 'USER_PRIVACY_RESTRICTED' ? {
        isReadDateRestricted: true
      } : {
        isReadDateRestrictedByMe: true
      };
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceUserStatuses)(global, {
        [chatId]: {
          ...userStatus,
          ...updateStatus
        }
      });
      // Need to reset `readDate` to `undefined` after click on "Show my Read Time" button
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChatMessage)(global, chatId, messageId, {
        readDate: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('loadQuickReplies', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('fetchQuickReplies');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateQuickReplyMessages)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(result.messages, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateQuickReplies)(global, result.quickReplies);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('sendQuickReply', (global, actions, payload) => {
  const {
    chatId,
    quickReplyId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return global;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('sendQuickReply', {
    chat,
    shortcutId: quickReplyId
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('copyMessageLink', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    shouldIncludeThread,
    shouldIncludeGrouped,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('ErrorOccurred'),
      tabId
    });
    return;
  }
  const showErrorOccurredNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('ErrorOccurred'),
    tabId
  });
  if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isChatChannel)(chat) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_13__.isChatSuperGroup)(chat)) {
    showErrorOccurredNotification();
    return;
  }
  const showLinkCopiedNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('LinkCopied'),
    tabId
  });
  const callApiExportMessageLinkPromise = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_12__.callApi)('exportMessageLink', {
    chat,
    id: messageId,
    shouldIncludeThread,
    shouldIncludeGrouped
  });
  await (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboardFromPromise)(callApiExportMessageLinkPromise, showLinkCopiedNotification, showErrorOccurredNotification);
});
function countSortedIds(ids, from, to) {
  // If ids are outside viewport, we cannot get correct count
  if (ids.length === 0 || from < ids[0] || to > ids[ids.length - 1]) return undefined;
  let count = 0;
  for (let i = 0, l = ids.length; i < l; i++) {
    if (ids[i] >= from && ids[i] <= to) {
      count++;
    }
    if (ids[i] >= to) {
      break;
    }
  }
  return count;
}
function splitAttachmentsByType(attachments) {
  return attachments.reduce((acc, attachment, index, arr) => {
    if (index === 0) {
      acc.push([attachment]);
      return acc;
    }
    const type = getAttachmentType(attachment);
    const previousType = getAttachmentType(arr[index - 1]);
    if (type === previousType) {
      acc[acc.length - 1].push(attachment);
    } else {
      acc.push([attachment]);
    }
    return acc;
  }, []);
}
function getAttachmentType(attachment) {
  const {
    shouldSendAsFile,
    mimeType
  } = attachment;
  if (shouldSendAsFile) return 'file';
  if (mimeType === _config__WEBPACK_IMPORTED_MODULE_2__.GIF_MIME_TYPE) return 'gif';
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_IMAGE_CONTENT_TYPES.has(mimeType) || _config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) return 'media';
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_AUDIO_CONTENT_TYPES.has(mimeType)) return 'audio';
  if (attachment.voice) return 'voice';
  return 'file';
}

/***/ }),

/***/ "./src/global/actions/api/payments.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/payments.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_payments_stripe__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/payments/stripe */ "./src/util/payments/stripe.ts");
/* harmony import */ var _util_requestQuery__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/requestQuery */ "./src/util/requestQuery.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const LOCAL_BOOST_COOLDOWN = 86400; // 24 hours

(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validateRequestedInfo', (global, actions, payload) => {
  const {
    requestInfo,
    saveInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentInputInvoice)(global, tabId);
  if (!inputInvoice) {
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  validateRequestedInfo(global, requestInputInvoice, requestInfo, saveInfo, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openInvoice', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    ...inputInvoice
  } = payload;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  const result = await getPaymentForm(global, requestInputInvoice, tabId);
  if (!result) {
    return;
  }
  const {
    form,
    invoice
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setInvoiceInfo)(global, invoice, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    inputInvoice: payload,
    isPaymentModalOpen: form.type === 'regular',
    isExtendedMedia: payload.isExtendedMedia,
    status: undefined
  }, tabId);
  if (form.type === 'stars') {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      isStarPaymentModalOpen: true
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
async function getPaymentForm(global, inputInvoice) {
  for (var _len = arguments.length, _ref = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
    _ref[_key - 2] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref;
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_7__.extractCurrentThemeParams)();
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPaymentForm', inputInvoice, theme);
  if (!result) {
    return undefined;
  }
  const {
    form,
    invoice,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentForm)(global, form, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  return {
    form,
    invoice
  };
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('getReceipt', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!messageId || !chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getReceipt', chat, messageId);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setReceipt)(global, result.receipt, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('getStarsReceipt', (global, actions, payload) => {
  const {
    transaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateReceiptFromStarsTransaction)(global, transaction, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearPaymentError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      error: undefined
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearReceipt', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      receipt: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendCredentialsInfo', (global, actions, payload) => {
  const {
    credentials,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const {
    nativeProvider
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment;
  const {
    data
  } = credentials;
  if (nativeProvider === 'stripe') {
    const publishableKey = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublishableKey)(global, tabId);
    if (!publishableKey) {
      return;
    }
    void sendStripeCredentials(global, data, publishableKey, tabId);
  } else if (nativeProvider === 'smartglocal') {
    const publicToken = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublicToken)(global, tabId);
    if (!publicToken) {
      return;
    }
    void sendSmartGlocalCredentials(global, data, publicToken, tabId);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendPaymentForm', async (global, actions, payload) => {
  const {
    shippingOptionId,
    saveCredentials,
    savedCredentialId,
    tipAmount,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentInputInvoice)(global, tabId);
  const formId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentFormId)(global, tabId);
  const requestInfoId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentRequestId)(global, tabId);
  const {
    nativeProvider,
    temporaryPassword
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment;
  if (!inputInvoice || !formId) {
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'pending'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const credentials = {
    save: saveCredentials,
    data: nativeProvider === 'stripe' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectStripeCredentials)(global, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSmartGlocalCredentials)(global, tabId)
  };
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId,
    credentials,
    requestedInfoId: requestInfoId,
    shippingOptionId,
    savedCredentialId,
    temporaryPassword: temporaryPassword?.value,
    tipAmount
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'paid'
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeInvoice)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'updatePaymentStateCompleted',
    inputInvoice
  });
  if (inputInvoice.type === 'stars') {
    actions.requestConfetti({
      withStars: true,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarPaymentForm', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const starsPayment = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).isStarPaymentModalOpen;
  if (!starsPayment) return;
  const inputInvoice = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentInputInvoice)(global, tabId);
  const formId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentFormId)(global, tabId);
  if (!inputInvoice || !formId) {
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendStarPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'paid'
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeInvoice)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'updatePaymentStateCompleted',
    inputInvoice
  });
  actions.loadStarStatus();
});
async function sendStripeCredentials(global, data, publishableKey) {
  for (var _len2 = arguments.length, _ref2 = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {
    _ref2[_key2 - 3] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref2;
  const query = (0,_util_requestQuery__WEBPACK_IMPORTED_MODULE_6__.buildQueryString)({
    'card[number]': data.cardNumber,
    'card[exp_month]': data.expiryMonth,
    'card[exp_year]': data.expiryYear,
    'card[cvc]': data.cvv,
    'card[address_zip]': data.zip,
    'card[address_country]': data.country
  });
  const response = await fetch(`https://api.stripe.com/v1/tokens${query}`, {
    method: 'POST',
    credentials: 'same-origin',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Bearer ${publishableKey}`
    }
  });
  const result = await response.json();
  if (result.error) {
    const error = (0,_util_payments_stripe__WEBPACK_IMPORTED_MODULE_5__.getStripeError)(result.error);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setStripeCardInfo)(global, {
    type: result.type,
    id: result.id
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
async function sendSmartGlocalCredentials(global, data, publicToken) {
  for (var _len3 = arguments.length, _ref3 = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {
    _ref3[_key3 - 3] = arguments[_key3];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref3;
  const params = {
    card: {
      number: data.cardNumber.replace(/\D+/g, ''),
      expiration_month: data.expiryMonth,
      expiration_year: data.expiryYear,
      security_code: data.cvv.replace(/\D+/g, '')
    }
  };
  const tokenizeUrl = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment.nativeParams?.tokenizeUrl;
  let url;
  if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG_PAYMENT_SMART_GLOCAL) {
    url = 'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card';
  } else {
    url = 'https://tgb.smart-glocal.com/cds/v1/tokenize/card';
  }
  if (tokenizeUrl?.startsWith('https://') && tokenizeUrl.endsWith('.smart-glocal.com/cds/v1/tokenize/card')) {
    url = tokenizeUrl;
  }
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
      'X-PUBLIC-TOKEN': publicToken
    },
    body: JSON.stringify(params)
  });
  const result = await response.json();
  if (result.status !== 'ok') {
    // TODO после получения документации сделать аналог getStripeError(result.error);
    const error = {
      description: 'payment error'
    };
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type: 'card',
    token: result.data.token
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setSmartGlocalCardInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    type,
    token
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type,
    token
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setPaymentStep', (global, actions, payload) => {
  const {
    step,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, step ?? _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closePremiumModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.premiumModal) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: tabState.premiumModal.promo,
      // Cache promo
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openPremiumModal', async (global, actions, payload) => {
  const {
    initialSection,
    fromUserId,
    isSuccess,
    isGift,
    monthsAmount,
    toUserId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  actions.loadPremiumStickers();
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPremiumPromo');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: result.promo,
      initialSection,
      isOpen: true,
      fromUserId,
      toUserId,
      isGift,
      monthsAmount,
      isSuccess
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.closeReactionPicker({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiveawayModal', async (global, actions, payload) => {
  const {
    chatId,
    prepaidGiveaway,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {
    chat
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const isOpen = Boolean(chatId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giveawayModal: {
      chatId,
      gifts: result,
      isOpen,
      prepaidGiveaway
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closeGiveawayModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giveawayModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openPremiumGiftingModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftingModal: {
      isOpen: true
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closePremiumGiftingModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftingModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiftPremiumModal', async (global, actions, payload) => {
  const {
    forUserIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPremiumPromo');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  const gifts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {});
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftPremiumModal: {
      isOpen: true,
      forUserIds,
      gifts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closeGiftPremiumModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftPremiumModal: {
      isOpen: false
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validatePaymentPassword', async (global, actions, payload) => {
  const {
    password,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchTemporaryPaymentPassword', password);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        message: 'Unknown Error',
        field: 'password'
      }
    }, tabId);
  } else if ('error' in result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        message: result.error,
        field: 'password'
      }
    }, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      temporaryPassword: result,
      step: _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
async function validateRequestedInfo(global, inputInvoice, requestInfo, shouldSave) {
  for (var _len4 = arguments.length, _ref4 = new Array(_len4 > 4 ? _len4 - 4 : 0), _key4 = 4; _key4 < _len4; _key4++) {
    _ref4[_key4 - 4] = arguments[_key4];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()] = _ref4;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('validateRequestedInfo', {
    inputInvoice,
    requestInfo,
    shouldSave
  });
  if (!result) {
    return;
  }
  const {
    id,
    shippingOptions
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setRequestInfoId)(global, id, tabId);
  if (shippingOptions?.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateShippingOptions)(global, shippingOptions, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Shipping, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostModal', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat || !((0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatChannel)(chat) || (0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatSuperGroup)(chat))) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  });
  if (!result) {
    actions.closeBoostModal({
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId,
      boostStatus: result
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const myBoosts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchMyBoosts');
  if (!myBoosts) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostModal) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(myBoosts.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(myBoosts.users, 'id'));
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      ...tabState.boostModal,
      myBoosts: myBoosts.boosts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostStatistics', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const [boostListResult, boostListGiftResult, boostStatusResult] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    isGifts: true
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  })]);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!boostListResult || !boostListGiftResult || !boostStatusResult) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostStatistics: undefined
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  const totalBoostUserList = [...boostListResult.users, ...boostListGiftResult.users];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(totalBoostUserList, 'id'));
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId,
      boostStatus: boostStatusResult,
      nextOffset: boostListResult.nextOffset,
      boosts: {
        count: boostListResult.count,
        list: boostListResult.boostList
      },
      giftedBoosts: {
        count: boostListGiftResult?.count,
        list: boostListGiftResult?.boostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadMoreBoosters', async (global, actions, payload) => {
  const {
    isGifts,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, tabState.boostStatistics.chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      isLoadingBoosters: true
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    offset: tabState.boostStatistics.nextOffset,
    isGifts
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const updatedBoostList = (isGifts ? tabState.boostStatistics.giftedBoosts?.list || [] : tabState.boostStatistics.boosts?.list || []).concat(result.boostList);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      nextOffset: result.nextOffset,
      isLoadingBoosters: false,
      [isGifts ? 'giftedBoosts' : 'boosts']: {
        count: result.count,
        list: updatedBoostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyBoost', async (global, actions, payload) => {
  const {
    chatId,
    slots,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const oldChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatFullInfo)(global, chatId);
  const oldBoostsApplied = oldChatFullInfo?.boostsApplied || 0;
  const appliedBoostsCount = slots.length;
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldStatus = tabState.boostModal?.boostStatus;
  if (oldStatus) {
    const boostsPerLevel = oldStatus.nextLevelBoosts ? oldStatus.nextLevelBoosts - oldStatus.currentLevelBoosts : 1;
    const newBoosts = oldStatus.boosts + appliedBoostsCount;
    const isLevelUp = oldStatus.nextLevelBoosts && newBoosts >= oldStatus.nextLevelBoosts;
    const newCurrentLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts : oldStatus.currentLevelBoosts;
    const newNextLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts + boostsPerLevel : oldStatus.nextLevelBoosts;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        boostStatus: {
          ...oldStatus,
          level: isLevelUp ? oldStatus.level + 1 : oldStatus.level,
          currentLevelBoosts: newCurrentLevelBoosts,
          nextLevelBoosts: newNextLevelBoosts,
          hasMyBoost: true,
          boosts: newBoosts
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldMyBoosts = tabState.boostModal?.myBoosts;
  if (oldMyBoosts) {
    const unixNow = Math.floor(Date.now() / 1000);
    const newMyBoosts = oldMyBoosts.map(boost => {
      if (slots.includes(boost.slot)) {
        return {
          ...boost,
          chatId,
          date: unixNow,
          cooldownUntil: unixNow + LOCAL_BOOST_COOLDOWN // Will be refetched below
        };
      }
      return boost;
    });
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: newMyBoosts
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyBoost', {
    slots,
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    // Rollback local changes
    const boostModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).boostModal;
    if (boostModal) {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
        boostModal: {
          ...boostModal,
          boostStatus: oldStatus,
          myBoosts: oldMyBoosts
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    }
    return;
  }
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.chats, 'id'));
  if (oldChatFullInfo) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateChatFullInfo)(global, chatId, {
      boostsApplied: oldBoostsApplied + slots.length
    });
  }
  if (tabState.boostModal) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: result.boosts
      }
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('checkGiftCode', async (global, actions, payload) => {
  const {
    slug,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('checkGiftCode', {
    slug
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_4__.oldTranslate('lng_gift_link_expired'),
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftCodeModal: {
      slug,
      info: result.code,
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyGiftCode', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyGiftCode', {
    slug
  });
  if (!result) {
    return;
  }
  actions.requestConfetti({
    withStars: true,
    tabId
  });
  actions.closeGiftCodeModal({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('launchPrepaidGiveaway', async (global, actions, payload) => {
  const {
    chatId,
    giveawayId,
    paymentPurpose,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const additionalChannels = paymentPurpose?.additionalChannelIds?.map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, id)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('launchPrepaidGiveaway', {
    chat,
    giveawayId,
    paymentPurpose: {
      type: 'giveaway',
      chat,
      areWinnersVisible: paymentPurpose?.areWinnersVisible,
      additionalChannels,
      countries: paymentPurpose?.countries,
      prizeDescription: paymentPurpose.prizeDescription,
      untilDate: paymentPurpose.untilDate,
      currency: paymentPurpose.currency,
      amount: paymentPurpose.amount
    }
  });
  if (!result) {
    return;
  }
  actions.openBoostStatistics({
    chatId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadStarStatus', async global => {
  const currentStatus = global.stars;
  const needsTopupOptions = !currentStatus?.topupOptions;
  const [status, topupOptions] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsStatus'), needsTopupOptions ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsTopupOptions') : undefined]);
  if (!status || needsTopupOptions && !topupOptions) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(status.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(status.users, 'id'));
  global = {
    ...global,
    stars: {
      ...currentStatus,
      balance: status.balance,
      topupOptions: topupOptions || currentStatus.topupOptions,
      history: {
        all: undefined,
        inbound: undefined,
        outbound: undefined
      }
    }
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.appendStarsTransactions)(global, 'all', status.history, status.nextOffset);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadStarsTransactions', async (global, actions, payload) => {
  const {
    type
  } = payload;
  const history = global.stars?.history[type];
  const offset = history?.nextOffset;
  if (history && !offset) return; // Already loaded all

  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsTransactions', {
    isInbound: type === 'inbound' || undefined,
    isOutbound: type === 'outbound' || undefined,
    offset: offset || ''
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsBalance)(global, result.balance);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.appendStarsTransactions)(global, type, result.history, result.nextOffset);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/reactions.ts":
/*!*********************************************!*\
  !*** ./src/global/actions/api/reactions.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");














const INTERACTION_RANDOM_OFFSET = 40;
let interactionLocalId = 0;
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableReactions');
  if (!result) {
    return;
  }

  // Preload animations
  result.forEach(availableReaction => {
    if (availableReaction.aroundAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.fetch(`sticker${availableReaction.aroundAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.centerIcon) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.fetch(`sticker${availableReaction.centerIcon.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.appearAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.fetch(`sticker${availableReaction.appearAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.selectAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.fetch((0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getDocumentMediaHash)(availableReaction.selectAnimation, 'full'), _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      availableReactions: result
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__["default"])({
    action: 'loadAvailableReactions',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_1__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableEffects', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableEffects');
  if (!result) {
    return;
  }
  const {
    effects,
    emojis,
    stickers
  } = result;
  const reactions = [];
  const effectById = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(effects, 'id');
  for (const effect of effects) {
    if (effect.effectAnimationId) {
      const reaction = {
        emoticon: effect.emoticon
      };
      reactions.push(reaction);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    availableEffectById: effectById,
    stickers: {
      ...global.stickers,
      effect: {
        stickers,
        emojis
      }
    },
    reactions: {
      ...global.reactions,
      effectReactions: reactions
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('interactWithAnimatedEmoji', (global, actions, payload) => {
  const {
    emoji,
    x,
    y,
    startSize,
    isReversed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const activeEmojiInteraction = {
    id: interactionLocalId++,
    animatedEffect: emoji,
    x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x) + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    y: y + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    startSize,
    isReversed
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: [...((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions || []), activeEmojiInteraction]
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendEmojiInteraction', (global, actions, payload) => {
  const {
    messageId,
    chatId,
    emoji,
    interactions
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || !emoji || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendEmojiInteraction', {
    chat,
    messageId,
    emoticon: emoji,
    timestamps: interactions
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendDefaultReaction', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const reaction = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectDefaultReaction)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!reaction || !message || (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isMessageLocal)(message)) return;
  actions.toggleReaction({
    chatId,
    messageId,
    reaction,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('toggleReaction', async (global, actions, payload) => {
  const {
    chatId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  let message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const isInSaved = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId);
  const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;
  const documentGroupFirstMessageId = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMessageIdsByGroupId)(global, chatId, message.groupedId)[0] : undefined;
  message = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, documentGroupFirstMessageId) || message : message;
  messageId = message?.id || messageId;
  const userReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getUserReactions)(message);
  const hasReaction = userReactions.some(userReaction => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction));
  const newUserReactions = hasReaction ? userReactions.filter(userReaction => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction)) : [...userReactions, reaction];
  const limit = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMaxUserReactions)(global);
  const reactions = newUserReactions.slice(-limit);
  const messageKey = (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageKey)(message);
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) {
    if (hasReaction) {
      actions.stopActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    } else {
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    }
  }
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, reactions);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  try {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendReaction', {
      chat,
      messageId,
      reactions,
      shouldAddToRecent
    });
    if (isInSaved) {
      actions.loadSavedReactionTags();
    }
  } catch (error) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, userReactions);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('startActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  if (currentActiveReactions.some(active => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction))) {
    return undefined;
  }
  const newActiveReactions = currentActiveReactions.concat(reaction);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: {
      ...tabState.activeReactions,
      [containerId]: newActiveReactions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  // Remove all reactions if reaction is not specified
  const newMessageActiveReactions = reaction ? currentActiveReactions.filter(active => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction)) : [];
  const newActiveReactions = newMessageActiveReactions.length ? {
    ...tabState.activeReactions,
    [containerId]: newMessageActiveReactions
  } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.omit)(tabState.activeReactions, [containerId]);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: newActiveReactions
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('setDefaultReaction', async (global, actions, payload) => {
  const {
    reaction
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('setDefaultReaction', {
    reaction
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (!global.config) {
    actions.loadConfig(); // Refetch new config, if it is somehow not loaded
    return;
  }
  global = {
    ...global,
    config: {
      ...global.config,
      defaultReaction: reaction
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveEmojiInteraction', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions?.filter(active => active.id !== id)
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadReactors', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    reaction
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const offset = message.reactors?.nextOffset;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactionsList', {
    reaction,
    chat,
    messageId,
    offset
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChatMessage)(global, chatId, messageId, {
    reactors: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadMessageReactions', (global, actions, payload) => {
  const {
    ids,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || global.connectionState !== 'connectionStateReady') {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactions', {
    ids,
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendWatchingEmojiInteraction', (global, actions, payload) => {
  const {
    chatId,
    emoticon,
    x,
    y,
    startSize,
    isReversed,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!chat || !tabState.activeEmojiInteractions?.some(interaction => interaction.id === id) || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return undefined;
  }
  if (global.connectionState === 'connectionStateReady') {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendWatchingEmojiInteraction', {
      chat,
      emoticon
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: tabState.activeEmojiInteractions.map(activeEmojiInteraction => {
      if (activeEmojiInteraction.id === id) {
        return {
          ...activeEmojiInteraction,
          x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x),
          y,
          startSize,
          isReversed
        };
      }
      return activeEmojiInteraction;
    })
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('fetchUnreadReactions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchUnreadReactions', {
    chat,
    offsetId,
    addOffset: offsetId ? -1 : undefined
  });

  // Server side bug, when server returns unread reactions count > 0 for deleted messages
  if (!result || !result.messages.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: 0
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    return;
  }
  const {
    messages,
    chats,
    users
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(chats, 'id'));
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
    unreadReactions: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.unique)([...(chat.unreadReactions || []), ...ids]).sort((a, b) => b - a)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('animateUnreadReaction', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat) return undefined;
  if (!chat.unreadReactionsCount) {
    return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
      unreadReactions: []
    });
  }
  const unreadReactionsCount = Math.max(chat.unreadReactionsCount - messageIds.length, 0);
  const unreadReactions = (chat.unreadReactions || []).filter(id => !messageIds.includes(id));
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
    unreadReactions,
    unreadReactionsCount
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    shouldFetchUnreadReactions: true,
    tabId
  });
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  messageIds.forEach(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chat.id, id);
    if (!message) return;
    const {
      reaction,
      isOwn,
      isUnread
    } = message.reactions?.recentReactions?.[0] ?? {};
    if (reaction && isUnread && !isOwn) {
      const messageKey = (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageKey)(message);
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
      });
    }
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('focusNextReaction', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat?.unreadReactions) {
    if (chat?.unreadReactionsCount) {
      return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChat)(global, chat.id, {
        unreadReactionsCount: 0
      });
    }
    return undefined;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadReactions[0],
    tabId,
    scrollTargetPosition: 'end'
  });
  actions.markMessagesRead({
    messageIds: [chat.unreadReactions[0]],
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('readAllReactions', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('readAllReactions', {
    chat
  });
  return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
    unreadReactionsCount: undefined,
    unreadReactions: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadTopReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchTopReactions', {
    hash: global.reactions.hash.topReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      topReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        topReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchRecentReactions', {
    hash: global.reactions.hash.recentReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        recentReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('clearRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('clearRecentReactions');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadDefaultTagReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchDefaultTagReactions', {
    hash: global.reactions.hash.defaultTags
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      defaultTags: result.reactions,
      hash: {
        ...global.reactions.hash,
        defaultTags: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadSavedReactionTags', async global => {
  const {
    hash
  } = global.savedReactionTags || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchSavedReactionTags', {
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByCallback)(result.tags, tag => [(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(tag.reaction), tag]);
  global = {
    ...global,
    savedReactionTags: {
      hash: result.hash,
      byKey: tagsByKey
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('editSavedReactionTag', async (global, actions, payload) => {
  const {
    reaction,
    title
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('updateSavedReactionTag', {
    reaction,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = global.savedReactionTags?.byKey;
  if (!tagsByKey) return;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(reaction);
  const tag = tagsByKey[key];
  const newTag = {
    ...tag,
    title
  };
  global = {
    ...global,
    savedReactionTags: {
      ...global.savedReactionTags,
      byKey: {
        ...tagsByKey,
        [key]: newTag
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/statistics.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/api/statistics.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadStatistics', async (global, actions, payload) => {
  const {
    chatId,
    isGroup,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)(isGroup ? 'fetchGroupStatistics' : 'fetchChannelStatistics', {
    chat,
    dcId: fullInfo.statisticsDcId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const {
    stats,
    users
  } = result;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStatistics)(global, chatId, stats, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadMessageStatistics', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchMessageStatistics', {
    chat,
    messageId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const {
    viewsCount,
    forwardsCount,
    reactions
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessages)(global, chatId)[messageId] || {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactions?.results ? reactions?.results.reduce((acc, reaction) => acc + reaction.count, 0) : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateMessageStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.loadMessagePublicForwards({
    chatId,
    messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadMessagePublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).statistics.currentMessage || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const publicForwards = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchMessagePublicForwards', {
    chat,
    messageId,
    dcId,
    offset: stats.nextOffset
  });
  const {
    forwards,
    nextOffset,
    count
  } = publicForwards || {};

  // Api returns the last element from the previous page as the first element
  const shouldOmitFirstElement = stats.publicForwardsData?.length && forwards?.length && (0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_0__.areDeepEqual)(stats.publicForwardsData[stats.publicForwardsData.length - 1], forwards[0]);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateMessageStatistics)(global, {
    ...stats,
    publicForwards: count || forwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(shouldOmitFirstElement ? forwards.slice(1) : forwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadStatisticsAsyncGraph', async (global, actions, payload) => {
  const {
    chatId,
    token,
    name,
    isPercentage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStatisticsAsyncGraph', {
    token,
    dcId,
    isPercentage
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStatisticsGraph)(global, chatId, name, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadStoryStatistics', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStoryStatistics', {
    chat,
    storyId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerStory)(global, chatId, storyId);
  const {
    forwardsCount = 0,
    viewsCount = 0,
    reactionsCount = 0
  } = story && 'views' in story && story.views ? story.views : {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactionsCount;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStoryStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.loadStoryPublicForwards({
    chatId,
    storyId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('loadStoryPublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).statistics.currentStory || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const {
    publicForwards,
    users,
    chats,
    count,
    nextOffset
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStoryPublicForwards', {
    chat,
    storyId,
    dcId,
    offset: stats.nextOffset
  })) || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  if (chats) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(chats, 'id'));
  }
  if (users) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStoryStatistics)(global, {
    ...stats,
    publicForwards: count || publicForwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(publicForwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/stories.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/api/stories.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");










const INFINITE_LOOP_MARKER = 100;
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAllStories', async global => {
  let i = 0;
  while (global.stories.hasNext) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    const {
      stateHash,
      hasNext
    } = global.stories;
    if (stateHash && !hasNext) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchAllStories', {
      isFirstRequest: !stateHash,
      stateHash
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global.stories.stateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNext = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAllHiddenStories', async global => {
  let i = 0;
  while (global.stories.hasNextInArchive) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllHiddenStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    const {
      archiveStateHash,
      hasNextInArchive
    } = global.stories;
    if (archiveStateHash && !hasNextInArchive) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchAllStories', {
      isFirstRequest: !archiveStateHash,
      stateHash: archiveStateHash,
      isHidden: true
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global.stories.archiveStateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNextInArchive = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPeerSkippedStories', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const skippedStoryIds = Object.values(peerStories.byId).reduce((acc, story) => {
    if (!('content' in story)) {
      acc.push(story.id);
    }
    return acc;
  }, []);
  if (skippedStoryIds.length === 0) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: skippedStoryIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('viewStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!peer || !story || !('content' in story)) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateLastViewedStoryForPeer)(global, peerId, storyId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTime)();
  if (story.expireDate < serverTime && story.isInProfile) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('viewStory', {
      peer,
      storyId
    });
  }
  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;
  if (!isUnread) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('markStoryRead', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateLastReadStoryForPeer)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('deleteStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('deleteStory', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.removePeerStory)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStoryInProfile', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isInProfile
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  const currentIsPinned = story && 'content' in story ? story.isInProfile : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStory)(global, peerId, storyId, {
    isInProfile
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerProfileStory)(global, peerId, storyId, isInProfile);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('toggleStoryInProfile', {
    peer,
    storyId,
    isInProfile
  });
  if (!result?.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStory)(global, peerId, storyId, {
      isInProfile: currentIsPinned
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerProfileStory)(global, peerId, storyId, currentIsPinned);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStoryPinnedToTop', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const oldPinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPinnedStories)(global, peerId)?.map(s => s.id) || [];
  const isRemoving = oldPinnedIds.includes(storyId);
  const newPinnedIds = isRemoving ? oldPinnedIds.filter(id => id !== storyId) : [...oldPinnedIds, storyId];
  global = {
    ...(0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)(),
    stories: {
      ...(0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)().stories,
      byPeerId: {
        ...(0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)().stories.byPeerId,
        [peerId]: {
          ...peerStories,
          pinnedIds: newPinnedIds.sort((a, b) => b - a)
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('toggleStoryPinnedToTop', {
    peer,
    storyIds: newPinnedIds
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      stories: {
        ...global.stories,
        byPeerId: {
          ...global.stories.byPeerId,
          [peerId]: {
            ...peerStories,
            pinnedIds: oldPinnedIds
          }
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPeerStories', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchPeerStories', {
    peer
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStoriesForPeer)(global, peerId, result.stories);
  if (result.lastReadStoryId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateLastReadStoryForPeer)(global, peerId, result.lastReadStoryId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPeerProfileStories', async (global, actions, payload) => {
  const {
    peerId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isFullyLoaded) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchPeerProfileStories', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (Object.values(result.stories).length === 0) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStoriesFullyLoaded)(global, peerId, true);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStoriesArchive', async (global, actions, payload) => {
  const {
    peerId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isArchiveFullyLoaded) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchStoriesArchive', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (Object.values(result.stories).length === 0) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStoriesFullyLoaded)(global, peerId, true, true);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStoriesForPeer)(global, peerId, result.stories, undefined, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPeerStoriesByIds', async (global, actions, payload) => {
  const {
    peerId,
    storyIds
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: storyIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addStoriesForPeer)(global, peerId, result.stories);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStoryViews', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchStoriesViews', {
    peer,
    storyIds: [storyId]
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStoryViews)(global, peerId, storyId, result.views);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStoryViewList', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    query,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStoryViewsLoading)(global, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchStoryViewList', {
    peer,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    limit,
    query
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStoryViewsLoading)(global, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStoryViews)(global, storyId, result.views, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('reportStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    reason,
    description,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('reportStory', {
    peer,
    storyId,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('editStoryPrivacy', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    privacy
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const allowedIds = [...privacy.allowUserIds, ...privacy.allowChatIds];
  const blockedIds = [...privacy.blockUserIds, ...privacy.blockChatIds];
  const inputPrivacy = (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.buildApiInputPrivacyRules)(global, {
    visibility: privacy.visibility,
    isUnspecified: privacy.isUnspecified,
    allowedIds,
    blockedIds
  });
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('editStoryPrivacy', {
    peer,
    id: storyId,
    privacy: inputPrivacy
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStoriesHidden', async (global, actions, payload) => {
  const {
    peerId,
    isHidden
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('toggleStoriesHidden', {
    peer,
    isHidden
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStoriesHidden)(global, peerId, isHidden);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStoriesMaxIds', async (global, actions, payload) => {
  const {
    peerIds
  } = payload;
  const peers = peerIds.map(peerId => (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId)).filter(Boolean);
  if (!peers.length) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchStoriesMaxIds', {
    peers
  });
  if (!result) return;
  const peerIdsToLoad = [];
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  result.forEach((maxId, i) => {
    const peer = peers[i];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeer)(global, peer.id, {
      maxStoryId: maxId,
      hasStories: maxId !== 0
    });
    if (maxId !== 0) {
      peerIdsToLoad.push(peer.id);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  peerIdsToLoad?.forEach(peerId => actions.loadPeerStories({
    peerId
  }));
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('sendStoryReaction', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    containerId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!story || !('content' in story)) return;
  const previousReaction = story.sentReaction;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateSentStoryReaction)(global, peerId, storyId, reaction);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  if (reaction) {
    actions.startActiveReaction({
      containerId,
      reaction,
      tabId
    });
  } else {
    actions.stopActiveReaction({
      containerId,
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('sendStoryReaction', {
    peer,
    storyId,
    reaction,
    shouldAddToRecent
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateSentStoryReaction)(global, peerId, storyId, previousReaction);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('activateStealthMode', (global, actions, payload) => {
  const {
    isForPast = true,
    isForFuture = true
  } = payload || {};
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('activateStealthMode', {
    isForPast: isForPast || true,
    isForFuture: isForFuture || true
  });
});

/***/ }),

/***/ "./src/global/actions/api/symbols.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/api/symbols.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_searchWords__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/searchWords */ "./src/util/searchWords.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_limits__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../selectors/limits */ "./src/global/selectors/limits.ts");













const ADDED_SETS_THROTTLE = 200;
const ADDED_SETS_THROTTLE_CHUNK = 10;
const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickerSets', async (global, actions) => {
  const [addedStickers, addedCustomEmojis] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickerSets', {
    hash: global.stickers.added.hash
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCustomEmojiSets', {
    hash: global.customEmojis.added.hash
  })]);
  if (!addedCustomEmojis || !addedStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'added', addedStickers.hash, addedStickers.sets);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiSets)(global, addedCustomEmojis.hash, addedCustomEmojis.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  actions.loadCustomEmojis({
    ids: global.recentCustomEmojis
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAddedStickers', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    added: {
      setIds: addedSetIds = []
    },
    setsById: cached
  } = global.stickers;
  const {
    added: {
      setIds: customEmojiSetIds = []
    }
  } = global.customEmojis;
  const setIdsToLoad = [...addedSetIds, ...customEmojiSetIds];
  if (!setIdsToLoad.length) {
    return;
  }
  for (let i = 0; i < setIdsToLoad.length; i++) {
    const id = setIdsToLoad[i];
    if (cached[id]?.stickers) {
      continue; // Already loaded
    }
    actions.loadStickers({
      stickerSetInfo: {
        id,
        accessHash: cached[id].accessHash
      },
      tabId
    });
    if (i % ADDED_SETS_THROTTLE_CHUNK === 0 && i > 0) {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.pause)(ADDED_SETS_THROTTLE);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentStickers', global => {
  const {
    hash
  } = global.stickers.recent || {};
  void loadRecentStickers(global, hash);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFavoriteStickers', async global => {
  const {
    hash
  } = global.stickers.favorite || {};
  const favoriteStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFavoriteStickers', {
    hash
  });
  if (!favoriteStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      favorite: favoriteStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumStickers', async global => {
  const {
    hash
  } = global.stickers.premium || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '⭐️⭐️',
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      premium: {
        hash: result.hash,
        stickers: result.stickers
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGreetingStickers', async global => {
  const {
    hash
  } = global.stickers.greeting || {};
  const greeting = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '👋⭐️',
    hash
  });
  if (!greeting) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      greeting: {
        hash: greeting.hash,
        stickers: greeting.stickers.filter(sticker => sticker.emoji === '👋')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedStickers', async global => {
  const {
    hash
  } = global.stickers.featured || {};
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedStickers', {
    hash
  });
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'featured', featuredStickers.hash, featuredStickers.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumGifts', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchPremiumGifts');
  if (!stickerSet) {
    return;
  }
  const {
    set,
    stickers
  } = stickerSet;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    premiumGifts: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultTopicIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultTopicIcons');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultTopicIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultStatusIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultStatusEmojis');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultStatusIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickers', (global, actions, payload) => {
  const {
    stickerSetInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const cachedSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (cachedSet && cachedSet.count === cachedSet?.stickers?.length) return; // Already fully loaded
  void loadStickers(global, actions, stickerSetInfo, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAnimatedEmojis', async global => {
  const [emojis, effects] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojis'), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojiEffects')]);
  if (!emojis || !effects) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceAnimatedEmojis)(global, {
    ...emojis.set,
    stickers: emojis.stickers
  });
  global = {
    ...global,
    animatedEmojiEffects: {
      ...effects.set,
      stickers: effects.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadBirthdayNumbersStickers', async global => {
  const emojis = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
    stickerSetInfo: {
      shortName: _config__WEBPACK_IMPORTED_MODULE_0__.BIRTHDAY_NUMBERS_SET
    }
  });
  if (!emojis) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    birthdayNumbers: {
      ...emojis.set,
      stickers: emojis.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGenericEmojiEffects', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchGenericEmojiEffects');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  global = {
    ...global,
    genericEmojiEffects: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadSavedGifs', async global => {
  const {
    hash
  } = global.gifs.saved;
  const savedGifs = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchSavedGifs', {
    hash
  });
  if (!savedGifs) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: savedGifs
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('saveGif', async (global, actions, payload) => {
  const {
    gif,
    shouldUnsave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const length = global.gifs.saved.gifs?.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'savedGifs');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'savedGifs');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (!shouldUnsave && length && length >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifs', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('saveGif', {
    gif,
    shouldUnsave
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const gifs = global.gifs.saved.gifs?.filter(_ref => {
    let {
      id
    } = _ref;
    return id !== gif.id;
  }) || [];
  const newGifs = shouldUnsave ? gifs : [gif, ...gifs];
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: {
        ...global.gifs.saved,
        gifs: newGifs
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('faveSticker', (global, actions, payload) => {
  const {
    sticker,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const current = global.stickers.favorite.stickers.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'stickersFaved');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'stickersFaved');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (current >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickers', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  if (sticker) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('unfaveSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  if (sticker) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();

    // Remove sticker preemptively to get instant feedback when user removes sticker
    // from favorites while in Sticker Picker
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        favorite: {
          ...global.stickers.favorite,
          stickers: global.stickers.favorite.stickers.filter(_ref2 => {
            let {
              id
            } = _ref2;
            return id !== sticker.id;
          })
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker,
      unfave: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('removeRecentSticker', async (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('removeRecentSticker', {
    sticker
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  loadRecentStickers(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearRecentStickers', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('clearRecentStickers');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        stickers: []
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStickerSet', (global, actions, payload) => {
  const {
    stickerSetId
  } = payload;
  const stickerSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetId);
  if (!stickerSet) {
    return;
  }
  const {
    accessHash,
    installedDate,
    isArchived
  } = stickerSet;
  const isInstalled = !isArchived && Boolean(installedDate);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)(!isInstalled ? 'installStickerSet' : 'uninstallStickerSet', {
    stickerSetId,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadEmojiKeywords', async (global, actions, payload) => {
  const {
    language
  } = payload;
  let currentEmojiKeywords = global.emojiKeywords[language];
  if (currentEmojiKeywords?.isLoading) {
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        ...currentEmojiKeywords,
        isLoading: true
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const emojiKeywords = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchEmojiKeywords', {
    language,
    fromVersion: currentEmojiKeywords ? currentEmojiKeywords.version : 0
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  currentEmojiKeywords = global.emojiKeywords[language];
  if (!emojiKeywords) {
    global = {
      ...global,
      emojiKeywords: {
        ...global.emojiKeywords,
        [language]: {
          ...currentEmojiKeywords,
          isLoading: false
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        isLoading: false,
        version: emojiKeywords.version,
        keywords: {
          ...currentEmojiKeywords?.keywords,
          ...emojiKeywords.keywords
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function loadRecentStickers(global, hash) {
  const recentStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentStickers', {
    hash
  });
  if (!recentStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: recentStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
async function loadStickers(global, actions, stickerSetInfo) {
  for (var _len = arguments.length, _ref3 = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {
    _ref3[_key - 3] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()] = _ref3;
  let stickerSet;
  try {
    stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
      stickerSetInfo
    });
  } catch (error) {
    if (error.message === 'STICKERSET_INVALID') {
      actions.showNotification({
        message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate)('StickerPack.ErrorNotFound'),
        tabId
      });
      if ('shortName' in stickerSetInfo && (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).openedStickerSetShortName === stickerSetInfo.shortName) {
        global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
          openedStickerSetShortName: undefined
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
      }
      return;
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!stickerSet) {
    // TODO handle this case when sticker cache is implemented
    return;
  }
  const {
    set,
    stickers,
    packs
  } = stickerSet;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, set.id, {
    ...set,
    stickers,
    packs
  });
  const currentEmoji = global.stickers.forEmoji.emoji;
  if (currentEmoji && packs[currentEmoji]) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.rebuildStickersForEmoji)(global);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (query) {
    void searchThrottled(async () => {
      const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchStickers', {
        query
      });
      if (!result) {
        return;
      }
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        setsById,
        added
      } = global.stickers;
      const resultIds = result.sets.map(_ref4 => {
        let {
          id
        } = _ref4;
        return id;
      });
      if (added.setIds) {
        added.setIds.forEach(id => {
          if (!resultIds.includes(id)) {
            const {
              title
            } = setsById[id] || {};
            if (title && (0,_util_searchWords__WEBPACK_IMPORTED_MODULE_5__["default"])(title, query)) {
              resultIds.unshift(id);
            }
          }
        });
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'search', result.hash, result.sets);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSearch)(global, result.hash, resultIds, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, undefined, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('searchMoreGifs', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    query,
    offset
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).gifSearch;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, offset, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickersForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    hash
  } = global.stickers.forEmoji;
  void searchThrottled(async () => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        forEmoji: {
          ...global.stickers.forEmoji,
          emoji
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
      emoji,
      hash
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    if (!result || global.stickers.forEmoji.emoji !== emoji) {
      return;
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickersForEmoji)(global, emoji, result.stickers, result.hash);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearStickersForEmoji', global => {
  return {
    ...global,
    stickers: {
      ...global.stickers,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadCustomEmojiForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiForEmoji)(global, emoji);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearCustomEmojiForEmoji', global => {
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedEmojiStickers', async global => {
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedEmojiStickers');
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      featuredIds: featuredStickers.sets.map(_ref5 => {
        let {
          id
        } = _ref5;
        return id;
      }),
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets.flatMap(set => set.stickers || []), 'id')
      }
    },
    stickers: {
      ...global.stickers,
      setsById: {
        ...global.stickers.setsById,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openStickerSet', async (global, actions, payload) => {
  const {
    stickerSetInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo)) {
    await loadStickers(global, actions, stickerSetInfo, tabId);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const set = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (!set?.shortName) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    openedStickerSetShortName: set.shortName
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentEmojiStatuses', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentEmojiStatuses');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateRecentStatusCustomEmojis)(global, result.hash, result.emojiStatuses);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function searchGifs(global, query, botUsername, offset) {
  for (var _len2 = arguments.length, _ref6 = new Array(_len2 > 4 ? _len2 - 4 : 0), _key2 = 4; _key2 < _len2; _key2++) {
    _ref6[_key2 - 4] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()] = _ref6;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchGifs', {
    query,
    offset,
    username: botUsername
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateGifSearch)(global, !offset, result.gifs, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}

/***/ }),

/***/ "./src/global/actions/api/sync.ts":
/*!****************************************!*\
  !*** ./src/global/actions/api/sync.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const RELEASE_STATUS_TIMEOUT = 15000; // 15 sec;

let releaseStatusTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('sync', (global, actions) => {
  if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
    // eslint-disable-next-line no-console
    console.log('>>> START SYNC');
  }
  if (releaseStatusTimeout) {
    clearTimeout(releaseStatusTimeout);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    isSyncing: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);

  // Workaround for `isSyncing = true` sometimes getting stuck for some reason
  releaseStatusTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      isSyncing: false
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    releaseStatusTimeout = undefined;
  }, RELEASE_STATUS_TIMEOUT);
  const {
    loadAllChats,
    preloadTopChatMessages,
    loadAllStories,
    loadAllHiddenStories
  } = actions;
  (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_3__.init)();
  loadAllChats({
    listType: 'active',
    shouldReplace: true,
    onReplace: async () => {
      await loadAndReplaceMessages(global, actions);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      global = {
        ...global,
        isSyncing: false,
        isSynced: true,
        isFetchingDifference: false
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
      if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
        // eslint-disable-next-line no-console
        console.log('>>> FINISH SYNC');
      }
      loadAllChats({
        listType: 'archived',
        shouldReplace: true
      });
      loadAllChats({
        listType: 'saved',
        shouldReplace: true
      });
      preloadTopChatMessages();
      loadAllStories();
      loadAllHiddenStories();
    }
  });
});
async function loadAndReplaceMessages(global, actions) {
  let areMessagesLoaded = false;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  let wasReset = false;

  // Memoize drafts
  const draftChatIds = Object.keys(global.messages.byChatId);
  /* eslint-disable @typescript-eslint/indent */
  const draftsByChatId = draftChatIds.reduce((acc, chatId) => {
    acc[chatId] = Object.keys(global.messages.byChatId[chatId].threadsById).reduce((acc2, threadId) => {
      acc2[Number(threadId)] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.omitUndefined)({
        draft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectDraft)(global, chatId, Number(threadId)),
        editingId: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingId)(global, chatId, Number(threadId)),
        editingDraft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingDraft)(global, chatId, Number(threadId))
      });
      return acc2;
    }, {});
    return acc;
  }, {});
  /* eslint-enable @typescript-eslint/indent */

  // Memoize last messages
  const lastMessages = Object.entries(global.chats.lastMessageIds.all || {}).map(_ref => {
    let [chatId, messageId] = _ref;
    return (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, chatId, Number(messageId));
  }).filter(Boolean);
  const savedLastMessages = Object.values(global.chats.lastMessageIds.saved || {}).map(messageId => (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, global.currentUserId, Number(messageId))).filter(Boolean);
  for (const {
    id: tabId
  } of Object.values(global.byTabId)) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    const {
      chatId: currentChatId,
      threadId: currentThreadId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
    const activeThreadId = currentThreadId || _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID;
    const threadInfo = currentChatId && currentThreadId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadInfo)(global, currentChatId, currentThreadId) : undefined;
    const currentChat = currentChatId ? global.chats.byId[currentChatId] : undefined;
    if (currentChatId && currentChat) {
      const [result, resultDiscussion] = await Promise.all([loadTopMessages(global, currentChatId, activeThreadId), activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID && !(0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(currentChat.id, activeThreadId, global.currentUserId) ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchDiscussionMessage', {
        chat: currentChat,
        messageId: Number(activeThreadId)
      }) : undefined]);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        chatId: newCurrentChatId
      } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
      if (result && newCurrentChatId === currentChatId) {
        const currentChatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessages)(global, currentChatId);
        const localMessages = currentChatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(_ref2 => {
          let {
            isDeleted
          } = _ref2;
          return !isDeleted;
        }).map(_ref3 => {
          let {
            message
          } = _ref3;
          return message;
        }) : [];
        const topicLastMessages = currentChat.isForum && currentChat.topics ? Object.values(currentChat.topics).map(_ref4 => {
          let {
            lastMessageId
          } = _ref4;
          return currentChatMessages[lastMessageId];
        }).filter(Boolean) : [];
        const resultMessageIds = result.messages.map(_ref5 => {
          let {
            id
          } = _ref5;
          return id;
        });
        const messagesThreadInfos = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(global.messages.byChatId[currentChatId].threadsById, resultMessageIds);
        const isDiscussionStartLoaded = !result.messages.length || result.messages.some(_ref6 => {
          let {
            id
          } = _ref6;
          return id === resultDiscussion?.firstMessageId;
        });
        const threadStartMessages = isDiscussionStartLoaded && resultDiscussion?.topMessages || [];
        const allMessages = threadStartMessages.concat(result.messages, localMessages);
        const allMessagesWithTopicLastMessages = allMessages.concat(topicLastMessages);
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(allMessagesWithTopicLastMessages, 'id');
        const listedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(allMessages.map(_ref7 => {
          let {
            id
          } = _ref7;
          return id;
        }));
        if (!wasReset) {
          global = {
            ...global,
            messages: {
              ...global.messages,
              byChatId: {}
            }
          };
          // eslint-disable-next-line @typescript-eslint/no-loop-func
          Object.values(global.byTabId).forEach(_ref8 => {
            let {
              id: otherTabId
            } = _ref8;
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
              tabThreads: {}
            }, otherTabId);
          });
          wasReset = true;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChatMessagesById)(global, currentChatId, byId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateListedIds)(global, currentChatId, activeThreadId, listedIds);

        // eslint-disable-next-line @typescript-eslint/no-loop-func
        Object.entries(messagesThreadInfos).forEach(_ref9 => {
          let [id, thread] = _ref9;
          if (!thread?.threadInfo) return;
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, id, thread.threadInfo);
        });
        if (threadInfo && !threadInfo.isCommentsInfo && activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, activeThreadId, {
            ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(threadInfo, ['fromChannelId', 'fromMessageId'])
          });
        }
        // eslint-disable-next-line @typescript-eslint/no-loop-func
        Object.values(global.byTabId).forEach(_ref10 => {
          let {
            id: otherTabId
          } = _ref10;
          const {
            chatId: otherChatId,
            threadId: otherThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, otherTabId) || {};
          if (otherChatId === currentChatId && otherThreadId === activeThreadId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.safeReplaceViewportIds)(global, currentChatId, activeThreadId, listedIds, otherTabId);
          }
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.chats, 'id'));
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
        areMessagesLoaded = true;
      }
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    if (currentChat?.isForum) {
      actions.loadTopics({
        chatId: currentChatId,
        force: true
      });
      if (currentThreadId && currentThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
        actions.loadTopicById({
          chatId: currentChatId,
          topicId: Number(currentThreadId),
          shouldCloseChatOnError: true
        });
      }
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!areMessagesLoaded) {
    global = {
      ...global,
      messages: {
        ...global.messages,
        byChatId: {}
      }
    };
    // eslint-disable-next-line @typescript-eslint/no-loop-func
    Object.values(global.byTabId).forEach(_ref11 => {
      let {
        id: otherTabId
      } = _ref11;
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
        tabThreads: {}
      }, otherTabId);
    });
  }

  // Restore drafts
  // eslint-disable-next-line @typescript-eslint/no-loop-func
  Object.keys(draftsByChatId).forEach(chatId => {
    const threads = draftsByChatId[chatId];
    Object.keys(threads).forEach(threadId => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThread)(global, chatId, Number(threadId), draftsByChatId[chatId][Number(threadId)]);
    });
  });

  // Restore last messages
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, lastMessages);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, savedLastMessages);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  Object.values(global.byTabId).forEach(_ref12 => {
    let {
      id: tabId
    } = _ref12;
    const {
      chatId: audioChatId,
      messageId: audioMessageId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).audioPlayer;
    if (audioChatId && audioMessageId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, audioChatId, audioMessageId)) {
      actions.closeAudioPlayer({
        tabId
      });
    }
  });
}
function loadTopMessages(global, chatId, threadId) {
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, realChatId);
  return (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchMessages', {
    chat,
    threadId,
    offsetId: !isSavedDialog ? chat.lastReadInboxMessageId : undefined,
    addOffset: -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1),
    limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE,
    isSavedDialog
  });
}
let previousGlobal;
// RAF can be unreliable when device goes into sleep mode, so sync logic is handled outside any component
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  const {
    connectionState,
    authState,
    isSynced
  } = global;
  const {
    isMasterTab
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global);
  if (!isMasterTab || isSynced || previousGlobal?.connectionState === connectionState && previousGlobal?.authState === authState) {
    previousGlobal = global;
    return;
  }
  if (connectionState === 'connectionStateReady' && authState === 'authorizationStateReady') {
    // eslint-disable-next-line eslint-multitab-tt/no-getactions-in-actions
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.getActions)().sync();
  }
  previousGlobal = global;
});

/***/ }),

/***/ "./src/global/actions/api/twoFaSettings.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/api/twoFaSettings.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");



(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('loadPasswordInfo', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('getPasswordInfo');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.replaceSettings)(global, {
    hasPassword: result.hasPassword
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    hint: result.hint
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('checkPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: true,
    error: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('checkPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('clearPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: true,
    error: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('clearPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('updatePassword', async (global, actions, payload) => {
  const {
    currentPassword,
    password,
    hint,
    email,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: true,
    error: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('updatePassword', currentPassword, password, hint, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('updateRecoveryEmail', async (global, actions, payload) => {
  const {
    currentPassword,
    email,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: true,
    error: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('updateRecoveryEmail', currentPassword, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    isLoading: false,
    waitingEmailCodeLength: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('provideTwoFaEmailCode', (global, actions, payload) => {
  const {
    code
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_0__.callApi)('provideRecoveryEmailCode', code);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('clearTwoFaError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateTwoFaSettings)(global, {
    error: undefined
  });
});

/***/ }),

/***/ "./src/global/actions/api/users.ts":
/*!*****************************************!*\
  !*** ./src/global/actions/api/users.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runThrottledForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadFullUser', async (global, actions, payload) => {
  const {
    userId,
    withPhotos
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!result?.user) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUserFullInfo)(global, userId);
  const {
    user: newUser,
    fullInfo: newFullInfo
  } = result;
  const hasChangedAvatarHash = user.avatarHash !== newUser.avatarHash;
  const hasChangedProfilePhoto = fullInfo?.profilePhoto?.id !== newFullInfo?.profilePhoto?.id;
  const hasChangedFallbackPhoto = fullInfo?.fallbackPhoto?.id !== newFullInfo?.fallbackPhoto?.id;
  const hasChangedPersonalPhoto = fullInfo?.personalPhoto?.id !== newFullInfo?.personalPhoto?.id;
  const hasChangedPhoto = hasChangedAvatarHash || hasChangedProfilePhoto || hasChangedFallbackPhoto || hasChangedPersonalPhoto;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, userId, result.user);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUserFullInfo)(global, userId, result.fullInfo);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  if (withPhotos || user.photos?.length && hasChangedPhoto) {
    actions.loadProfilePhotos({
      profileId: userId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadUser', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchUsers', {
    users: [user]
  });
  if (!result) {
    return;
  }
  const {
    users,
    userStatusesById
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...userStatusesById
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadTopUsers', async global => {
  const {
    topPeers: {
      lastRequestedAt
    }
  } = global;
  if (!(!lastRequestedAt || (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)() - lastRequestedAt > TOP_PEERS_REQUEST_COOLDOWN)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchTopUsers');
  if (!result) {
    return;
  }
  const {
    ids,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = {
    ...global,
    topPeers: {
      ...global.topPeers,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadContactList', async global => {
  const contactList = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchContactList');
  if (!contactList) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(contactList.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(contactList.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, contactList.userStatusesById);

  // Sort contact list by Last Name (or First Name), with latin names being placed first
  const getCompareString = user => user.lastName || user.firstName || '';
  const collator = new Intl.Collator('en-US');
  const sortedUsers = contactList.users.sort((a, b) => collator.compare(getCompareString(a), getCompareString(b))).filter(user => !user.isSelf);
  global = {
    ...global,
    contactList: {
      userIds: sortedUsers.map(user => user.id)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadCurrentUser', () => {
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCurrentUser');
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadCommonChats', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
  const user = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, chatId) : undefined;
  if (!user || (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserBot)(user) || user.commonChats?.isFullyLoaded) {
    return;
  }
  const maxId = user.commonChats?.maxId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCommonChats', user.id, user.accessHash, maxId);
  if (!result) {
    return;
  }
  const {
    chats,
    chatIds,
    isFullyLoaded
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  if (chats.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(chats, 'id'));
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, user.id, {
    commonChats: {
      maxId: chatIds.length ? chatIds[chatIds.length - 1] : '0',
      ids: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.unique)((user.commonChats?.ids || []).concat(chatIds)),
      isFullyLoaded
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('updateContact', async (global, actions, payload) => {
  const {
    userId,
    isMuted = false,
    firstName,
    lastName,
    shouldSharePhoneNumber,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  actions.updateChatMutedState({
    chatId: userId,
    isMuted
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  let result;
  if (!user.isContact && user.phoneNumber) {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('importContact', {
      phone: user.phoneNumber,
      firstName,
      lastName
    });
  } else {
    const {
      id,
      accessHash
    } = user;
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('updateContact', {
      id,
      accessHash,
      phoneNumber: '',
      firstName,
      lastName,
      shouldSharePhoneNumber
    });
  }
  if (result) {
    actions.loadChatSettings({
      chatId: userId
    });
    actions.loadPeerStories({
      peerId: userId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, user.id, {
      firstName,
      lastName
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('deleteContact', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('deleteContact', {
    id,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('loadProfilePhotos', async (global, actions, payload) => {
  const {
    profileId
  } = payload;
  const isPrivate = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId)(profileId);
  let user = isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUser)(global, profileId) : undefined;
  const chat = !isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, profileId) : undefined;
  if (!user && !chat) {
    return;
  }
  let userFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectUserFullInfo)(global, profileId);
  let chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatFullInfo)(global, profileId);
  if (user && !userFullInfo?.profilePhoto) {
    const {
      id,
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFullUser', {
      id,
      accessHash
    });
    if (!result?.user) {
      return;
    }
    user = result.user;
    userFullInfo = result.fullInfo;
  }
  if (chat && !chatFullInfo?.profilePhoto) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFullChat', chat);
    if (!result?.fullInfo) {
      return;
    }
    chatFullInfo = result.fullInfo;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchProfilePhotos', user, chat);
  if (!result || !result.photos) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const userOrChat = user || chat;
  const {
    photos,
    users
  } = result;
  const fallbackPhoto = userFullInfo?.fallbackPhoto;
  const personalPhoto = userFullInfo?.personalPhoto;
  const chatCurrentPhoto = chatFullInfo?.profilePhoto;
  if (fallbackPhoto) photos.push(fallbackPhoto);
  if (personalPhoto) photos.unshift(personalPhoto);
  if (chatCurrentPhoto && photos[0]?.id !== chatCurrentPhoto.id) photos.unshift(chatCurrentPhoto);
  photos.sort(a => a.id === userOrChat?.avatarHash ? -1 : 1);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  if (isPrivate) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, profileId, {
      photos
    });
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateChat)(global, profileId, {
      photos
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (!query) return;
  void runThrottledForSearch(async () => {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchChats', {
      query
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).userSearch.query;
    if (!result || !currentSearchQuery || query !== currentSearchQuery) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUserSearchFetchingStatus)(global, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
      return;
    }
    const {
      users,
      chats,
      accountResultIds,
      globalResultIds
    } = result;
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(chats, 'id'));
    const localUserIds = accountResultIds.filter(_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId);
    const globalUserIds = globalResultIds.filter(_helpers__WEBPACK_IMPORTED_MODULE_7__.isUserId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUserSearchFetchingStatus)(global, false, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUserSearch)(global, {
      localUserIds,
      globalUserIds
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('importContact', async (global, actions, payload) => {
  const {
    phoneNumber: phone,
    firstName,
    lastName,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('importContact', {
    phone,
    firstName,
    lastName
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('Contacts.PhoneNumber.NotRegistred'),
      tabId
    });
    return;
  }
  actions.openChat({
    id: result,
    tabId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('reportSpam', (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, chatId);
  if (!peer) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('reportSpam', peer);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setEmojiStatus', (global, actions, payload) => {
  const {
    emojiStatus,
    expires
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('updateEmojiStatus', emojiStatus, expires);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('saveCloseFriends', async (global, actions, payload) => {
  const {
    userIds
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('saveCloseFriends', userIds);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  global.contactList?.userIds.forEach(userId => {
    const {
      isCloseFriend
    } = global.users.byId[userId] || {};
    if (isCloseFriend && !userIds.includes(userId)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, userId, {
        isCloseFriend: undefined
      });
    }
  });
  userIds.forEach(userId => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateUser)(global, userId, {
      isCloseFriend: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/calls.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/calls.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_calls__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/calls */ "./src/global/reducers/calls.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_calls__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors/calls */ "./src/global/selectors/calls.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/calls */ "./src/global/actions/ui/calls.ts");












(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateGroupCall':
      {
        if (update.call.connectionState === 'discarded') {
          if (global.groupCalls.activeGroupCallId) {
            if ('leaveGroupCall' in actions) actions.leaveGroupCall({
              shouldRemove: true,
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
            });
            return undefined;
          } else {
            return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.removeGroupCall)(global, update.call.id);
          }
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, update.call.id);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, update.call.id, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_1__.omit)(update.call, ['connectionState']), undefined, update.call.participantsCount);
      }
    case 'updateGroupCallChatId':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectChat)(global, update.chatId);
        if (chat) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChatFullInfo)(global, update.chatId, {
            groupCallId: update.call.id
          });
        }
        return global;
      }
    case 'updateGroupCallParticipants':
      {
        const {
          groupCallId,
          participants,
          nextOffset
        } = update;
        const {
          currentUserId
        } = global;

        // `secret-sauce` should disconnect if the participant is us but from another device
        global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
        participants.forEach(participant => {
          if (participant.id) {
            global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCallParticipant)(global, groupCallId, participant.id, participant, Boolean(nextOffset) || currentUserId === participant.id);
          }
        });
        if (nextOffset) {
          global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, groupCallId, {
            nextOffset
          });
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, groupCallId);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return global;
      }
    case 'updatePhoneCall':
      {
        if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.ARE_CALLS_SUPPORTED) return undefined;
        const {
          phoneCall,
          currentUserId
        } = global;
        const {
          call
        } = update;
        if (phoneCall) {
          if (call.state === 'discarded') {
            actions.playGroupCallSound({
              sound: 'end'
            });
            if ('hangUp' in actions) actions.hangUp({
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
            });
            return {
              ...global,
              ...(call.needRating && {
                ratingPhoneCall: call
              })
            };
          }
          return undefined;
        }
        const isOutgoing = call?.adminId === currentUserId;
        if (!isOutgoing && call.state === 'requested') {
          (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.onTickEnd)(() => {
            global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
            (0,_util_notifications__WEBPACK_IMPORTED_MODULE_2__.notifyAboutCall)({
              call,
              user: (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectPhoneCallUser)(global)
            });
          });
          (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.initializeSounds)();
          void (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.checkNavigatorUserMediaPermissions)(global, actions, call.isVideo, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)());
          global = {
            ...global,
            phoneCall: call
          };
          return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
            isCallPanelVisible: false
          }, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)());
        }
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/chats.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/chats.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.ts");
/* harmony import */ var _api_gramjs_apiBuilders_messages__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs/apiBuilders/messages */ "./src/api/gramjs/apiBuilders/messages.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");












const TYPING_STATUS_CLEAR_DELAY = 6000; // 6 seconds

(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateChat':
      {
        const {
          isForum: prevIsForum,
          lastReadOutboxMessageId
        } = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, update.id) || {};
        if (update.chat.lastReadOutboxMessageId && lastReadOutboxMessageId && update.chat.lastReadOutboxMessageId < lastReadOutboxMessageId) {
          update = {
            ...update,
            chat: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(update.chat, ['lastReadInboxMessageId'])
          };
        }
        const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, update.id, update.chat, update.newProfilePhoto);
        if (localChat?.areStoriesHidden !== update.chat.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStoriesHidden)(global, update.id, update.chat.areStoriesHidden || false);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        if (!update.noTopChatsRequest && !(0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectIsChatListed)(global, update.id)) {
          // Chat can appear in dialogs list.
          actions.loadTopChats();
        }
        if (update.chat.id) {
          (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.closeMessageNotifications)({
            chatId: update.chat.id,
            lastReadInboxMessageId: update.chat.lastReadInboxMessageId
          });
        }
        Object.values(global.byTabId).forEach(_ref => {
          let {
            id: tabId
          } = _ref;
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectCurrentMessageList)(global, tabId) || {};
          const chatUpdate = update;
          // The property `isForum` was changed in another client
          if (currentChatId === chatUpdate.id && 'isForum' in chatUpdate.chat && prevIsForum !== chatUpdate.chat.isForum) {
            if (prevIsForum) {
              actions.closeForumPanel({
                tabId
              });
            }
            actions.openChat({
              id: currentChatId,
              tabId
            });
          }
        });
        return undefined;
      }
    case 'updateChatJoin':
      {
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatListType)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, update.id);
        if (chat && (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat)) {
          actions.loadChannelRecommendations({
            chatId: chat.id
          });
          const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatLastMessageId)(global, chat.id);
          const localMessage = (0,_api_gramjs_apiBuilders_messages__WEBPACK_IMPORTED_MODULE_5__.buildLocalMessage)(chat, lastMessageId);
          localMessage.content.action = {
            mediaType: 'action',
            text: 'you joined this channel',
            translationValues: ['ChannelJoined'],
            type: 'joinedChannel',
            targetChatId: chat.id
          };
          actions.apiUpdate({
            '@type': 'newMessage',
            id: localMessage.id,
            chatId: chat.id,
            message: localMessage
          });
        }
        if (!listType) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChatListIds)(global, listType, [update.id]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, update.id, {
          isNotJoined: false
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        if (chat) {
          actions.requestChatUpdate({
            chatId: chat.id
          });
        }
        return undefined;
      }
    case 'updateChatLeave':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.leaveChat)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, update.id);
        if (chat && (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat)) {
          const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatMessages)(global, update.id);
          const localMessageIds = Object.keys(chatMessages).map(Number).filter(_util_messageKey__WEBPACK_IMPORTED_MODULE_3__.isLocalMessageId);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.deleteChatMessages)(global, chat.id, localMessageIds);
        }
        return global;
      }
    case 'updateChatInbox':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, update.id, update.chat);
      }
    case 'updateChatTypingStatus':
      {
        const {
          id,
          threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
          typingStatus
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceThreadParam)(global, id, threadId, 'typingStatus', typingStatus);
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        setTimeout(() => {
          global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
          const currentTypingStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectThreadParam)(global, id, threadId, 'typingStatus');
          if (typingStatus && currentTypingStatus && typingStatus.timestamp === currentTypingStatus.timestamp) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceThreadParam)(global, id, threadId, 'typingStatus', undefined);
            (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
          }
        }, TYPING_STATUS_CLEAR_DELAY);
        return undefined;
      }
    case 'newMessage':
      {
        const {
          message
        } = update;
        if (message.senderId === global.currentUserId && !message.isFromScheduled) {
          return undefined;
        }
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, update.chatId);
        if (!chat) {
          return undefined;
        }
        const hasMention = Boolean(update.message.id && update.message.hasUnreadMention);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, update.chatId, {
          unreadCount: chat.unreadCount ? chat.unreadCount + 1 : 1
        });
        if (hasMention) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addUnreadMentions)(global, update.chatId, chat, [update.message.id], true);
        }
        const topic = chat.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTopicFromMessage)(global, message) : undefined;
        if (topic) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateTopic)(global, update.chatId, topic.id, {
            unreadCount: topic.unreadCount ? topic.unreadCount + 1 : 1
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.notifyAboutMessage)({
          chat,
          message
        });
        return undefined;
      }
    case 'updateCommonBoxMessages':
    case 'updateChannelMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = 'channelId' in update ? update.channelId : (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectCommonBoxChatId)(global, id);
          const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, chatId);
          if (messageUpdate.reactions && chat?.unreadReactionsCount && !(0,_helpers__WEBPACK_IMPORTED_MODULE_6__.checkIfHasUnreadReactions)(global, messageUpdate.reactions)) {
            global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_9__.updateUnreadReactions)(global, chatId, {
              unreadReactionsCount: Math.max(chat.unreadReactionsCount - 1, 0) || undefined,
              unreadReactions: chat.unreadReactions?.filter(i => i !== id)
            });
          }
          if (!messageUpdate.hasUnreadMention && chat?.unreadMentionsCount) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.removeUnreadMentions)(global, chatId, chat, [id], true);
          }
        });
        return global;
      }
    case 'updateChatFullInfo':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChatFullInfo)(global, update.id, update.fullInfo);
      }
    case 'updatePinnedChatIds':
      {
        const {
          ids,
          folderId
        } = update;
        const listType = folderId === _config__WEBPACK_IMPORTED_MODULE_1__.ARCHIVED_FOLDER_ID ? 'archived' : 'active';
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updatePinnedSavedDialogIds':
      {
        const {
          ids
        } = update;
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updateChatPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatListType)(global, id);
        if (!listType) {
          return undefined;
        }
        const {
          [listType]: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          // When moving pinned chats to archive, active ordered pinned ids don't get updated
          // (to preserve chat pinned state when it returns from archive)
          // If user already has max pinned chats, we should check for orderedIds
          // that don't point to listed chats
          if (listType === 'active' && newOrderedPinnedIds.length >= _config__WEBPACK_IMPORTED_MODULE_1__.MAX_ACTIVE_PINNED_CHATS) {
            const listIds = global.chats.listIds.active;
            newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => listIds && listIds.includes(pinnedId));
          }
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateSavedDialogPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const {
          saved: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateChatListType':
      {
        const {
          id,
          folderId
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChatListType)(global, id, folderId);
      }
    case 'updateChatFolder':
      {
        const {
          id,
          folder
        } = update;
        const {
          byId: chatFoldersById,
          orderedIds
        } = global.chatFolders;
        const isDeleted = folder === undefined;
        Object.values(global.byTabId).forEach(_ref2 => {
          let {
            id: tabId
          } = _ref2;
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId);
          const isFolderActive = Object.values(chatFoldersById)[tabState.activeChatFolder - 1]?.id === id;
          if (isFolderActive) {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
              activeChatFolder: 0
            }, tabId);
          }
        });
        const newChatFoldersById = !isDeleted ? {
          ...chatFoldersById,
          [id]: folder
        } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(chatFoldersById, [id]);
        const newOrderedIds = !isDeleted ? orderedIds?.includes(id) ? orderedIds : [...(orderedIds || []), id] : orderedIds?.filter(orderedId => orderedId !== id);
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            byId: newChatFoldersById,
            orderedIds: newOrderedIds,
            invites: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(global.chatFolders.invites, [id])
          }
        };
      }
    case 'updateChatFoldersOrder':
      {
        const {
          orderedIds
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            orderedIds
          }
        };
      }
    case 'updateRecommendedChatFolders':
      {
        const {
          folders
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            recommended: folders
          }
        };
      }
    case 'updateChatMembers':
      {
        const targetChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatFullInfo)(global, update.id);
        const {
          replacedMembers,
          addedMember,
          deletedMemberId
        } = update;
        if (!targetChatFullInfo) {
          return undefined;
        }
        let shouldUpdate = false;
        let members = targetChatFullInfo?.members ? [...targetChatFullInfo.members] : [];
        if (replacedMembers) {
          members = replacedMembers;
          shouldUpdate = true;
        } else if (addedMember) {
          if (!members.length || !members.some(m => m.userId === addedMember.userId)) {
            members.push(addedMember);
            shouldUpdate = true;
          }
        } else if (members.length && deletedMemberId) {
          const deleteIndex = members.findIndex(m => m.userId === deletedMemberId);
          if (deleteIndex > -1) {
            members.slice(deleteIndex, 1);
            shouldUpdate = true;
          }
        }
        if (shouldUpdate) {
          const adminMembers = members.filter(_ref3 => {
            let {
              isOwner,
              isAdmin
            } = _ref3;
            return isOwner || isAdmin;
          });
          // TODO Kicked members?

          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, update.id, {
            membersCount: members.length
          });
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChatFullInfo)(global, update.id, {
            members,
            adminMembersById: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(adminMembers, 'userId')
          });
          return global;
        }
        return undefined;
      }
    case 'draftMessage':
      {
        const {
          chatId,
          threadId,
          draft
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceThreadParam)(global, chatId, threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'draft', draft);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, chatId, {
          draftDate: draft?.date
        });
        return global;
      }
    case 'showInvite':
      {
        const {
          data
        } = update;
        Object.values(global.byTabId).forEach(_ref4 => {
          let {
            id: tabId
          } = _ref4;
          actions.showDialog({
            data,
            tabId
          });
        });
        return undefined;
      }
    case 'updatePendingJoinRequests':
      {
        const {
          chatId,
          requestsPending,
          recentRequesterIds
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChatFullInfo)(global, chatId, {
          requestsPending,
          recentRequesterIds
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        actions.loadChatJoinRequests({
          chatId
        });
        return undefined;
      }
    case 'updatePinnedTopic':
      {
        const {
          chatId,
          topicId,
          isPinned
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateTopic)(global, chatId, topicId, {
          isPinned
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        return undefined;
      }
    case 'updatePinnedTopicsOrder':
      {
        const {
          chatId,
          order
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, chatId, {
          orderedPinnedTopicIds: order
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        return undefined;
      }
    case 'updateTopic':
      {
        const {
          chatId,
          topicId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopicById({
          chatId,
          topicId
        });
        return undefined;
      }
    case 'updateTopics':
      {
        const {
          chatId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopics({
          chatId,
          force: true
        });
        return undefined;
      }
    case 'updateViewForumAsMessages':
      {
        const {
          chatId,
          isEnabled
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChat)(global, chatId, {
          isForumAsMessages: isEnabled
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/messages.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/messages.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   deleteMessages: () => (/* binding */ deleteMessages),
/* harmony export */   deleteThread: () => (/* binding */ deleteThread)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_messageKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/messageKey */ "./src/util/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_replies__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const ANIMATION_DELAY = 350;
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'newMessage':
      {
        const {
          chatId,
          id,
          message,
          shouldForceReply,
          wasDrafted
        } = update;
        global = updateWithLocalMedia(global, chatId, id, message);
        global = updateListedAndViewportIds(global, actions, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
        const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_9__.getMessageReplyInfo)(newMessage);
        const storyReplyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_9__.getStoryReplyInfo)(newMessage);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
        if (chat?.isForum && replyInfo?.isForumTopic && !(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTopicFromMessage)(global, newMessage) && replyInfo.replyToMsgId) {
          actions.loadTopicById({
            chatId,
            topicId: replyInfo.replyToMsgId
          });
        }
        const isLocal = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isMessageLocal)(message);
        Object.values(global.byTabId).forEach(_ref => {
          let {
            id: tabId
          } = _ref;
          // Force update for last message on drafted messages to prevent flickering
          if (isLocal && wasDrafted) {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, newMessage);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMediaLoadingState)(global, newMessage, chatId, threadId, tabId);
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsMessageInCurrentMessageList)(global, chatId, message, tabId)) {
            if (isLocal && message.isOutgoing && !message.content?.action && !storyReplyInfo?.storyId && !message.content?.storyData) {
              const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectCurrentMessageList)(global, tabId);
              if (currentMessageList) {
                // We do not use `actions.focusLastMessage` as it may be set with a delay (see below)
                actions.focusMessage({
                  chatId,
                  threadId: currentMessageList.threadId,
                  messageId: message.id,
                  noHighlight: true,
                  isResizingContainer: true,
                  tabId
                });
              }
            }

            // @perf Wait until scroll animation finishes or simply rely on delivery status update
            // (which is itself delayed)
            if (!isLocal) {
              setTimeout(() => {
                global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
                if (shouldForceReply) {
                  actions.updateDraftReplyInfo({
                    replyToMsgId: id,
                    tabId
                  });
                }
                global = updateChatLastMessage(global, chatId, newMessage);
                (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
              }, ANIMATION_DELAY);
            }
          } else {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);

        // Reload dialogs if chat is not present in the list
        if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatListed)(global, chatId)) {
          actions.loadTopChats();
        }
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatWithSelf)(global, chatId) && !isLocal) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }
        break;
      }
    case 'updateChatLastMessage':
      {
        const {
          id,
          lastMessage
        } = update;
        global = updateChatLastMessage(global, id, lastMessage, true);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.addMessages)(global, [lastMessage]);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateStartEmojiInteraction':
      {
        Object.values(global.byTabId).forEach(_ref2 => {
          let {
            id: tabId
          } = _ref2;
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== update.id) return;
          const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, currentChatId, update.messageId);
          if (!message) return;

          // Workaround for a weird behavior when interaction is received after watching reaction
          if ((0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getMessageText)(message) !== update.emoji) return;
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
          global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
            activeEmojiInteractions: [...(tabState.activeEmojiInteractions || []), {
              id: Math.random(),
              animatedEffect: update.emoji,
              messageId: update.messageId
            }]
          }, tabId);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'newScheduledMessage':
      {
        const {
          chatId,
          id,
          message
        } = update;
        global = updateWithLocalMedia(global, chatId, id, message, true);
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)([...scheduledIds, id]));
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)([...threadScheduledIds, id]));
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessage':
      {
        const {
          chatId,
          id,
          message
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
        global = updateWithLocalMedia(global, chatId, id, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
        if (message.reactions && chat) {
          global = updateReactions(global, actions, chatId, id, message.reactions, chat, newMessage.isOutgoing, currentMessage);
        }
        if (message.content?.text?.text !== currentMessage?.content?.text?.text) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.clearMessageTranslation)(global, chatId, id);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessage':
      {
        const {
          chatId,
          id,
          message
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledMessage)(global, chatId, id);
        if (!currentMessage) {
          return;
        }
        global = updateWithLocalMedia(global, chatId, id, message, true);
        const ids = Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatScheduledMessages)(global, chatId) || {}).map(Number).sort((a, b) => b - a);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, currentMessage);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', threadScheduledIds.sort((a, b) => b - a));
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplyMessage':
      {
        const {
          id,
          message
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateQuickReplyMessage)(global, id, message);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReplyMessages':
      {
        const {
          messageIds
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteQuickReplyMessages)(global, messageIds);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplies':
      {
        const {
          quickReplies
        } = update;
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(quickReplies, 'id');
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateQuickReplies)(global, byId);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReply':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteQuickReply)(global, update.quickReplyId);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message
        } = update;
        global = updateListedAndViewportIds(global, actions, message);
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatMessages)(global, chatId, [localId]);

        // Edge case for "Send When Online"
        if (message.isScheduled) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatScheduledMessages)(global, chatId, [localId]);
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId
        });
        global = {
          ...global,
          fileUploads: {
            byMessageKey: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.omit)(global.fileUploads.byMessageKey, [(0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageKey)(message)])
          }
        };
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, message.id);
        global = updateChatLastMessage(global, chatId, newMessage);
        const thread = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadByMessage)(global, message);
        // For some reason Telegram requires to manually mark outgoing thread messages read
        Object.values(global.byTabId).forEach(_ref3 => {
          let {
            id: tabId
          } = _ref3;
          const {
            chatId: currentChatId,
            threadId: currentThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== chatId || (thread?.threadInfo?.threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) !== currentThreadId) {
            return;
          }
          actions.markMessageListRead({
            maxId: message.id,
            tabId
          });
        });
        if (thread?.threadInfo?.threadId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, thread.threadInfo.threadId, 'threadInfo', {
            ...thread.threadInfo,
            lastMessageId: message.id,
            lastReadInboxMessageId: message.id
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChat)(global, chatId, {
          lastReadInboxMessageId: message.id
        });
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatWithSelf)(global, chatId)) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message
        } = update;
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', [...scheduledIds, message.id]);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', [...threadScheduledIds, message.id]);
        }
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatScheduledMessages)(global, chatId, [localId]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateScheduledMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updatePinnedIds':
      {
        const {
          chatId,
          isPinned,
          messageIds
        } = update;
        const messages = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pickTruthy)((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessages)(global, chatId), messageIds);
        const updatePerThread = {
          [_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID]: messageIds
        };
        Object.values(messages).forEach(message => {
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, message.id, {
            isPinned
          });
          if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) return;
          const currentUpdatedInThread = updatePerThread[threadId] || [];
          currentUpdatedInThread.push(message.id);
          updatePerThread[threadId] = currentUpdatedInThread;
        });
        Object.entries(updatePerThread).forEach(_ref4 => {
          let [threadId, ids] = _ref4;
          const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPinnedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
          const newPinnedIds = isPinned ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(pinnedIds.concat(ids)).sort((a, b) => b - a) : pinnedIds.filter(id => !ids.includes(id));
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, Number(threadId), 'pinnedIds', newPinnedIds);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateThreadInfos':
      {
        const {
          threadInfoUpdates
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateThreadInfos)(global, threadInfoUpdates);
        threadInfoUpdates.forEach(threadInfo => {
          const {
            chatId,
            threadId
          } = threadInfo;
          if (!chatId || !threadId) return;
          const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
          const currentThreadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadInfo)(global, chatId, threadId);
          if (chat?.isForum && threadInfo.lastReadInboxMessageId !== currentThreadInfo?.lastReadInboxMessageId) {
            actions.loadTopicById({
              chatId,
              topicId: Number(threadId)
            });
          }

          // Update reply thread last read message id if already read in main thread
          if (!chat?.isForum) {
            const lastReadInboxMessageId = chat?.lastReadInboxMessageId;
            const lastReadInboxMessageIdInThread = threadInfo.lastReadInboxMessageId || lastReadInboxMessageId;
            if (lastReadInboxMessageId && lastReadInboxMessageIdInThread) {
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateThreadInfo)(global, chatId, threadId, {
                lastReadInboxMessageId: Math.max(lastReadInboxMessageIdInThread, lastReadInboxMessageId)
              });
            }
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'resetMessages':
      {
        const {
          id: chatId
        } = update;
        const messagesById = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessages)(global, chatId);
        if (messagesById && !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isUserId)(chatId)) {
          const tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)();
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatMessages)(global, chatId, Object.keys(messagesById).map(Number));
          (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
          actions.loadFullChat({
            chatId,
            force: true,
            tabId
          });
          actions.loadViewportMessages({
            chatId,
            threadId: _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
            tabId
          });
        }
        break;
      }
    case 'deleteMessages':
      {
        const {
          ids,
          chatId
        } = update;
        deleteMessages(global, chatId, ids, actions);
        break;
      }
    case 'deleteScheduledMessages':
      {
        const {
          ids,
          chatId
        } = update;
        deleteScheduledMessages(chatId, ids, actions, global);
        break;
      }
    case 'deleteHistory':
      {
        const {
          chatId
        } = update;
        const chatMessages = global.messages.byChatId[chatId];
        if (chatId === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) {
          global = {
            ...global,
            serviceNotifications: global.serviceNotifications.map(notification => ({
              ...notification,
              isDeleted: true
            }))
          };
          (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        }
        if (chatMessages) {
          const ids = Object.keys(chatMessages.byId).map(Number);
          global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
          deleteMessages(global, chatId, ids, actions);
        } else {
          actions.requestChatUpdate({
            chatId
          });
        }
        global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.removeChatFromChatLists)(global, chatId);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'deleteSavedHistory':
      {
        const {
          chatId
        } = update;
        const currentUserId = global.currentUserId;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.removeChatFromChatLists)(global, chatId, 'saved');
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
        deleteThread(global, currentUserId, chatId, actions);
        break;
      }
    case 'updateCommonBoxMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectCommonBoxChatId)(global, id);
          if (chatId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, messageUpdate);
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateChannelMessages':
      {
        const {
          channelId,
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, channelId, id, messageUpdate);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessagePoll':
      {
        const {
          pollId,
          pollUpdate
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessageByPollId)(global, pollId);
        if (message?.content.poll) {
          const oldResults = message.content.poll.results;
          let newResults = oldResults;
          if (pollUpdate.results?.results) {
            if (!oldResults.results || !pollUpdate.results.isMin) {
              newResults = pollUpdate.results;
            } else if (oldResults.results) {
              newResults = {
                ...pollUpdate.results,
                results: pollUpdate.results.results.map(result => ({
                  ...result,
                  isChosen: oldResults.results.find(r => r.option === result.option)?.isChosen
                })),
                isMin: undefined
              };
            }
          }
          const updatedPoll = {
            ...message.content.poll,
            ...pollUpdate,
            results: newResults
          };
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, message.chatId, message.id, {
            content: {
              ...message.content,
              poll: updatedPoll
            }
          });
          (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        }
        break;
      }
    case 'updateMessagePollVote':
      {
        const {
          pollId,
          peerId,
          options
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessageByPollId)(global, pollId);
        if (!message || !message.content.poll || !message.content.poll.results) {
          break;
        }
        const {
          poll
        } = message.content;
        const currentSendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSendAs)(global, message.chatId);
        const {
          recentVoterIds,
          totalVoters,
          results
        } = poll.results;
        const newRecentVoterIds = recentVoterIds ? [...recentVoterIds] : [];
        const newTotalVoters = totalVoters ? totalVoters + 1 : 1;
        const newResults = results ? [...results] : [];
        newRecentVoterIds.push(peerId);
        options.forEach(option => {
          const targetOptionIndex = newResults.findIndex(result => result.option === option);
          const targetOption = newResults[targetOptionIndex];
          const updatedOption = targetOption ? {
            ...targetOption
          } : {
            option,
            votersCount: 0
          };
          updatedOption.votersCount += 1;
          if (currentSendAs?.id === peerId || peerId === global.currentUserId) {
            updatedOption.isChosen = true;
          }
          if (targetOptionIndex) {
            newResults[targetOptionIndex] = updatedOption;
          } else {
            newResults.push(updatedOption);
          }
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, message.chatId, message.id, {
          content: {
            ...message.content,
            poll: {
              ...poll,
              results: {
                ...poll.results,
                recentVoterIds: newRecentVoterIds,
                totalVoters: newTotalVoters,
                results: newResults
              }
            }
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateServiceNotification':
      {
        const {
          message
        } = update;
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsServiceChatReady)(global)) {
          actions.createServiceNotification({
            message
          });
        }
        break;
      }
    case 'updateMessageReactions':
      {
        const {
          chatId,
          id,
          reactions
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        global = updateReactions(global, actions, chatId, id, reactions, chat, message.isOutgoing, message);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessageExtendedMedia':
      {
        const {
          chatId,
          id,
          extendedMedia,
          isBought
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        if (message.content.invoice) {
          const media = extendedMedia[0];
          if ('mediaType' in media && media.mediaType === 'extendedMediaPreview') {
            if (!message.content.invoice) return;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, {
              content: {
                ...message.content,
                invoice: {
                  ...message.content.invoice,
                  extendedMedia: media
                }
              }
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
          } else {
            const content = media;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, {
              content
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
          }
        }
        if (message.content.paidMedia) {
          const paidMediaUpdate = isBought ? {
            isBought,
            extendedMedia
          } : {
            extendedMedia: extendedMedia,
            isBought: undefined
          };
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, {
            content: {
              ...message.content,
              paidMedia: {
                ...message.content.paidMedia,
                ...paidMediaUpdate
              }
            }
          });
          (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        }
        break;
      }
    case 'updateTranscribedAudio':
      {
        const {
          transcriptionId,
          text,
          isPending
        } = update;
        global = {
          ...global,
          transcriptions: {
            ...global.transcriptions,
            [transcriptionId]: {
              ...(global.transcriptions[transcriptionId] || {}),
              transcriptionId,
              text,
              isPending
            }
          }
        };
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessageSendFailed':
      {
        const {
          chatId,
          localId,
          error
        } = update;
        if (error.match(/CHAT_SEND_.+?FORBIDDEN/)) {
          Object.values(global.byTabId).forEach(_ref5 => {
            let {
              id: tabId
            } = _ref5;
            actions.showAllowedMessageTypesNotification({
              chatId,
              tabId
            });
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, localId, {
          sendingState: 'messageSendingStateFailed'
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
    case 'updateMessageTranslations':
      {
        const {
          chatId,
          messageIds,
          toLanguageCode,
          translations
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateMessageTranslations)(global, chatId, messageIds, toLanguageCode, translations);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
        break;
      }
  }
});
function updateReactions(global, actions, chatId, id, reactions, chat, isOutgoing, message) {
  const currentReactions = message?.reactions;

  // `updateMessageReactions` happens with an interval, so we try to avoid redundant global state updates
  if (currentReactions && (0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__.areDeepEqual)(reactions, currentReactions)) {
    return global;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, {
    reactions
  });
  if (!isOutgoing) {
    return global;
  }
  const {
    reaction,
    isOwn,
    isUnread
  } = reactions.recentReactions?.[0] ?? {};
  const reactionEffectsEnabled = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPerformanceSettingsValue)(global, 'reactionEffects');
  if (reactionEffectsEnabled && message && reaction && isUnread && !isOwn) {
    const messageKey = (0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageKey)(message);
    // Start reaction only in master tab
    actions.startActiveReaction({
      containerId: messageKey,
      reaction,
      tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
    });
  }
  const hasUnreadReactionsForMessageInChat = chat.unreadReactions?.includes(id);
  const hasUnreadReactionsInNewReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.checkIfHasUnreadReactions)(global, reactions);

  // Only notify about added reactions, not removed ones
  if (hasUnreadReactionsInNewReactions && !hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_12__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 0) + 1,
      unreadReactions: [...(chat?.unreadReactions || []), id].sort((a, b) => b - a)
    });
    const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
    if (!chat || !newMessage) return global;
    (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_7__.onTickEnd)(() => {
      (0,_util_notifications__WEBPACK_IMPORTED_MODULE_6__.notifyAboutMessage)({
        chat,
        message: newMessage,
        isReaction: true
      });
    });
  }
  if (!hasUnreadReactionsInNewReactions && hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_12__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 1) - 1,
      unreadReactions: chat?.unreadReactions?.filter(i => i !== id)
    });
  }
  return global;
}
function updateWithLocalMedia(global, chatId, id, messageUpdate) {
  let isScheduled = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
  const currentMessage = isScheduled ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectScheduledMessage)(global, chatId, id) : (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);

  // Preserve locally uploaded media.
  if (currentMessage && messageUpdate.content && !(0,_util_messageKey__WEBPACK_IMPORTED_MODULE_5__.isLocalMessageId)(id)) {
    const {
      photo,
      video,
      sticker,
      document
    } = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getMessageContent)(currentMessage);
    if (photo && messageUpdate.content.photo) {
      var _messageUpdate$conten, _messageUpdate$conten2;
      (_messageUpdate$conten = messageUpdate.content.photo).blobUrl ?? (_messageUpdate$conten.blobUrl = photo.blobUrl);
      (_messageUpdate$conten2 = messageUpdate.content.photo).thumbnail ?? (_messageUpdate$conten2.thumbnail = photo.thumbnail);
    } else if (video && messageUpdate.content.video) {
      var _messageUpdate$conten3;
      (_messageUpdate$conten3 = messageUpdate.content.video).blobUrl ?? (_messageUpdate$conten3.blobUrl = video.blobUrl);
    } else if (sticker && messageUpdate.content.sticker) {
      var _messageUpdate$conten4;
      (_messageUpdate$conten4 = messageUpdate.content.sticker).isPreloadedGlobally ?? (_messageUpdate$conten4.isPreloadedGlobally = sticker.isPreloadedGlobally);
    } else if (document && messageUpdate.content.document) {
      var _messageUpdate$conten5;
      (_messageUpdate$conten5 = messageUpdate.content.document).previewBlobUrl ?? (_messageUpdate$conten5.previewBlobUrl = document.previewBlobUrl);
    }
  }
  const newMessage = currentMessage ? {
    ...currentMessage,
    ...messageUpdate
  } : messageUpdate;
  return isScheduled ? (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateScheduledMessage)(global, chatId, id, newMessage) : (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, newMessage);
}
function updateThreadUnread(global, actions, message, isDeleting) {
  const {
    chatId
  } = message;
  const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_9__.getMessageReplyInfo)(message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadByMessage)(global, message) || {};
  if (!threadInfo && replyInfo?.replyToMsgId) {
    const originMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, replyInfo.replyToMsgId);
    if (originMessage) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateThreadUnreadFromForwardedMessage)(global, originMessage, chatId, message.id, isDeleting);
    } else {
      actions.loadMessage({
        chatId,
        messageId: replyInfo.replyToMsgId,
        threadUpdate: {
          isDeleting,
          lastMessageId: message.id
        }
      });
    }
  }
  return global;
}
function updateListedAndViewportIds(global, actions, message) {
  const {
    id,
    chatId
  } = message;
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSavedDialogIdFromMessage)(global, message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadByMessage)(global, message) || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  const isUnreadChatNotLoaded = chat?.unreadCount && !(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  global = updateThreadUnread(global, actions, message);
  const {
    threadId
  } = threadInfo ?? {
    threadId: savedDialogId
  };
  if (threadId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateListedIds)(global, chatId, threadId, [id]);
    Object.values(global.byTabId).forEach(_ref6 => {
      let {
        id: tabId
      } = _ref6;
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsViewportNewest)(global, chatId, threadId, tabId)) {
        // Always keep the first unread message in the viewport list
        const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectFirstUnreadId)(global, chatId, threadId);
        const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.addViewportId)(global, chatId, threadId, id, tabId);
        const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectViewportIds)(candidateGlobal, chatId, threadId, tabId);
        if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
          global = candidateGlobal;
        }
      }
    });
    if (threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, threadId, 'threadInfo', {
        ...threadInfo,
        lastMessageId: message.id
      });
      if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isMessageLocal)(message) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isActionMessage)(message)) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateThreadInfo)(global, chatId, threadId, {
          messagesCount: (threadInfo.messagesCount || 0) + 1
        });
      }
    }
  }
  if (isUnreadChatNotLoaded) {
    return global;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, [id]);
  Object.values(global.byTabId).forEach(_ref7 => {
    let {
      id: tabId
    } = _ref7;
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsViewportNewest)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId)) {
      // Always keep the first unread message in the viewport list
      const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectFirstUnreadId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
      const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.addViewportId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, id, tabId);
      const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectViewportIds)(candidateGlobal, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId);
      if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
        global = candidateGlobal;
      }
    }
  });
  return global;
}
function updateChatLastMessage(global, chatId, message) {
  let force = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
  const {
    chats
  } = global;
  const chat = chats.byId[chatId];
  const currentLastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatLastMessageId)(global, chatId);
  const topic = chat?.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTopicFromMessage)(global, message) : undefined;
  if (topic) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateTopic)(global, chatId, topic.id, {
      lastMessageId: message.id
    });
  }
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSavedDialogIdFromMessage)(global, message);
  if (savedDialogId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatLastMessageId)(global, savedDialogId, message.id, 'saved');
  }
  if (currentLastMessageId && !force) {
    const isSameOrNewer = currentLastMessageId === message.id || currentLastMessageId === message.previousLocalId || message.id > currentLastMessageId;
    if (!isSameOrNewer) {
      return global;
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatLastMessageId)(global, chatId, message.id);
  return global;
}
function findLastMessage(global, chatId) {
  let threadId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessages)(global, chatId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectListedIds)(global, chatId, threadId);
  if (!byId || !listedIds) {
    return undefined;
  }
  let i = listedIds.length;
  while (i--) {
    const message = byId[listedIds[i]];
    if (message && !message.isDeleting) {
      return message;
    }
  }
  return undefined;
}
function deleteThread(global, chatId, threadId, actions) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessages)(global, chatId);
  if (!byId) {
    return;
  }
  const messageIds = Object.values(byId).filter(message => {
    const messageThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
    return messageThreadId === threadId;
  }).map(message => message.id);
  if (!messageIds.length) {
    return;
  }
  deleteMessages(global, chatId, messageIds, actions);
}
function deleteMessages(global, chatId, ids, actions) {
  // Channel update

  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
    if (!chat) return;
    const threadIdsToUpdate = new Set();
    threadIdsToUpdate.add(_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
    ids.forEach(id => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, chatId, id, {
        isDeleting: true
      });
      if (chat.topics?.[id]) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteTopic)(global, chatId, id);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, chatId, id);
      if (!message) {
        return;
      }
      global = updateThreadUnread(global, actions, message, true);
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
      if (threadId) {
        threadIdsToUpdate.add(threadId);
      }
    });
    actions.requestChatUpdate({
      chatId
    });
    const idsSet = new Set(ids);
    threadIdsToUpdate.forEach(threadId => {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadInfo)(global, chatId, threadId);
      if (!threadInfo?.lastMessageId || !idsSet.has(threadInfo.lastMessageId)) return;
      const newLastMessage = findLastMessage(global, chatId, threadId);
      if (!newLastMessage) return;
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
        global = updateChatLastMessage(global, chatId, newLastMessage, true);
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateThreadInfo)(global, chatId, threadId, {
        lastMessageId: newLastMessage.id
      });
      if (chat.isForum) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateTopic)(global, chatId, Number(threadId), {
          lastMessageId: newLastMessage.id
        });
      }
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
    setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatMessages)(global, chatId, ids);
      (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
    }, ANIMATION_DELAY);
    return;
  }

  // Common box update

  const chatsIdsToUpdate = [];
  ids.forEach(id => {
    const commonBoxChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectCommonBoxChatId)(global, id);
    if (commonBoxChatId) {
      chatsIdsToUpdate.push(commonBoxChatId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatMessage)(global, commonBoxChatId, id, {
        isDeleting: true
      });
      const newLastMessage = findLastMessage(global, commonBoxChatId);
      if (newLastMessage) {
        global = updateChatLastMessage(global, commonBoxChatId, newLastMessage, true);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatMessage)(global, commonBoxChatId, id);
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatWithSelf)(global, commonBoxChatId) && message) {
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectThreadIdFromMessage)(global, message);
        if ((0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getIsSavedDialog)(commonBoxChatId, threadId, global.currentUserId)) {
          const newLastSavedDialogMessage = findLastMessage(global, commonBoxChatId, threadId);
          actions.requestSavedDialogUpdate({
            chatId: String(threadId)
          });
          if (newLastSavedDialogMessage) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChatLastMessageId)(global, commonBoxChatId, newLastSavedDialogMessage.id, 'saved');
          }
        }
      }
      setTimeout(() => {
        global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatMessages)(global, commonBoxChatId, [id]);
        (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
      }, ANIMATION_DELAY);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(chatsIdsToUpdate).forEach(id => {
    actions.requestChatUpdate({
      chatId: id
    });
  });
}
function deleteScheduledMessages(chatId, ids, actions, global) {
  if (!chatId) {
    return;
  }
  ids.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateScheduledMessage)(global, chatId, id, {
      isDeleting: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.deleteChatScheduledMessages)(global, chatId, ids);
    const scheduledMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatScheduledMessages)(global, chatId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', Object.keys(scheduledMessages || {}).map(Number));
    (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  }, ANIMATION_DELAY);
}

/***/ }),

/***/ "./src/global/actions/apiUpdaters/misc.ts":
/*!************************************************!*\
  !*** ./src/global/actions/apiUpdaters/misc.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updatePeerBlocked':
      if (update.isBlocked) {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.addBlockedUser)(global, update.id);
      } else if (update.isBlockedFromStories) {
        return global; // Unsupported
      } else {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.removeBlockedUser)(global, update.id);
      }
    case 'updateResetContactList':
      global = {
        ...global,
        contactList: {
          userIds: []
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updateConfig':
      actions.loadConfig();
      break;
    case 'updateNewAuthorization':
      {
        // Load more info about this session
        actions.loadAuthorizations();
        break;
      }
    case 'updateFavoriteStickers':
      actions.loadFavoriteStickers();
      break;
    case 'updateRecentStickers':
      actions.loadRecentStickers();
      break;
    case 'updateRecentReactions':
      actions.loadRecentReactions();
      break;
    case 'updateRecentEmojiStatuses':
      actions.loadRecentEmojiStatuses();
      break;
    case 'updateSavedReactionTags':
      actions.loadSavedReactionTags();
      break;
    case 'updateMoveStickerSetToTop':
      {
        const oldOrder = update.isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds;
        if (!oldOrder) return global;
        const newOrder = [update.id, ...oldOrder.filter(id => id !== update.id)];
        actions.reorderStickerSets({
          order: newOrder,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateStickerSets':
      actions.loadStickerSets();
      break;
    case 'updateStickerSetsOrder':
      {
        // Filter out invalid set IDs, which may be sent by the server
        const order = update.order.filter(setId => Boolean(global.stickers.setsById[setId]));
        actions.reorderStickerSets({
          order,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateSavedGifs':
      actions.loadSavedGifs();
      break;
    case 'updatePrivacy':
      global = {
        ...global,
        settings: {
          ...global.settings,
          privacy: {
            ...global.settings.privacy,
            [update.key]: update.rules
          }
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updatePaymentVerificationNeeded':
      Object.values(global.byTabId).forEach(_ref => {
        let {
          id: tabId
        } = _ref;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.setConfirmPaymentUrl)(global, update.url, tabId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.ConfirmPayment, tabId);
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updateWebViewResultSent':
      Object.values(global.byTabId).forEach(tabState => {
        if (tabState.webApp?.queryId === update.queryId) {
          actions.resetDraftReplyInfo({
            tabId: tabState.id
          });
          actions.closeWebApp({
            tabId: tabState.id
          });
        }
      });
      break;
    case 'updateStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.addStoriesForPeer)(global, update.peerId, {
        [update.story.id]: update.story
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePeersWithStories)(global, {
        [update.peerId]: (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeerStories)(global, update.peerId)
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'deleteStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.removePeerStory)(global, update.peerId, update.storyId);
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updateReadStories':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateLastReadStoryForPeer)(global, update.peerId, update.lastReadId);
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updateSentStoryReaction':
      {
        const {
          peerId,
          storyId,
          reaction
        } = update;
        const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeerStory)(global, peerId, storyId);
        if (!story) return global;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePeerStory)(global, peerId, storyId, {
          sentReaction: reaction
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
        break;
      }
    case 'updateStealthMode':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateStealthMode)(global, update.stealthMode);
      (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
      break;
    case 'updateAttachMenuBots':
      actions.loadAttachBots();
      break;
    case 'updatePremiumFloodWait':
      {
        actions.processPremiumFloodWait({
          isUpload: update.isUpload
        });
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/payments.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/payments.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updatePaymentStateCompleted':
      {
        Object.values(global.byTabId).forEach(_ref => {
          let {
            id: tabId
          } = _ref;
          const {
            inputInvoice,
            invoice
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).payment;
          if (!(0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_0__.areDeepEqual)(inputInvoice, update.inputInvoice)) return;
          if (invoice) {
            const {
              amount,
              currency,
              title
            } = invoice;
            actions.showNotification({
              tabId,
              message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate('PaymentInfoHint', [(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_1__.formatCurrencyAsString)(amount, currency, _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.getTranslationFn().code), title])
            });
          }
          if (inputInvoice?.type === 'giftcode') {
            if (!inputInvoice.userIds) {
              return;
            }
            const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftPremiumModal;
            if (giftModalState && giftModalState.isOpen && (0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_0__.areDeepEqual)(inputInvoice.userIds, giftModalState.forUserIds)) {
              global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
                giftPremiumModal: {
                  ...giftModalState,
                  isCompleted: true
                }
              }, tabId);
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.closeInvoice)(global, tabId);
            }
          }
          (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        });
        break;
      }
    case 'updateStarsBalance':
      {
        const stars = global.stars;
        if (!stars) {
          return;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateStarsBalance)(global, update.balance);
        (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        actions.loadStarStatus();
        break;
      }
  }
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/settings.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/settings.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateNotifySettings':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateNotifySettings)(global, update.peerType, update.isSilent, update.shouldShowPreviews);
      }
    case 'updateNotifyExceptions':
      {
        const {
          chatId,
          isMuted,
          isSilent,
          shouldShowPreviews
        } = update;
        const chat = global.chats.byId[chatId];
        if (chat) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateChat)(global, chatId, {
            isMuted
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.addNotifyException)(global, chatId, {
          isMuted,
          isSilent,
          shouldShowPreviews
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
    case 'updateTopicNotifyExceptions':
      {
        const {
          chatId,
          topicId,
          isMuted
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateTopic)(global, chatId, topicId, {
          isMuted
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/symbols.ts":
/*!***************************************************!*\
  !*** ./src/global/actions/apiUpdaters/symbols.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateStickerSet':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateStickerSet)(global, update.id, update.stickerSet);
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/twoFaSettings.ts":
/*!*********************************************************!*\
  !*** ./src/global/actions/apiUpdaters/twoFaSettings.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");

(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateTwoFaStateWaitCode':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            isLoading: false,
            waitingEmailCodeLength: update.length
          }
        };
      }
    case 'updateTwoFaError':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            error: update.message
          }
        };
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/users.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/users.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




const STATUS_UPDATE_THROTTLE = 3000;
const flushStatusUpdatesThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_0__.throttle)(flushStatusUpdates, STATUS_UPDATE_THROTTLE, true);
let pendingStatusUpdates = {};
function scheduleStatusUpdate(userId, statusUpdate) {
  pendingStatusUpdates[userId] = statusUpdate;
  flushStatusUpdatesThrottled();
}
function flushStatusUpdates() {
  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global
  let global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...pendingStatusUpdates
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  pendingStatusUpdates = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'deleteContact':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.deleteContact)(global, update.id);
      }
    case 'updateUser':
      {
        Object.values(global.byTabId).forEach(_ref => {
          let {
            id: tabId
          } = _ref;
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatWithSelf)(global, update.id) && update.user.isPremium !== (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global)) {
            if (update.user.isPremium && global.byTabId[tabId].premiumModal) {
              actions.openPremiumModal({
                isSuccess: true,
                tabId
              });
            }

            // Reset translation cache cause premium provides additional formatting
            global = {
              ...global,
              translations: {
                byChatId: {}
              }
            };
          }
        });
        const localUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.id, update.user);
        if (update.fullInfo) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, update.id, update.fullInfo);
        }
        if (localUser?.areStoriesHidden !== update.user.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePeerStoriesHidden)(global, update.id, update.user.areStoriesHidden || false);
        }
        return global;
      }
    case 'updateRequestUserUpdate':
      {
        actions.loadFullUser({
          userId: update.id
        });
        break;
      }
    case 'updateUserEmojiStatus':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.userId, {
          emojiStatus: update.emojiStatus
        });
      }
    case 'updateUserStatus':
      {
        // Status updates come very often so we throttle them
        scheduleStatusUpdate(update.userId, update.status);
        return undefined;
      }
    case 'updateUserFullInfo':
      {
        const {
          id,
          fullInfo
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, id, fullInfo);
      }
    case 'updateBotMenuButton':
      {
        const {
          botId,
          button
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, botId);
        if (!targetUserFullInfo?.botInfo) {
          return undefined;
        }
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, botId, {
          botInfo: {
            ...targetUserFullInfo.botInfo,
            menuButton: button
          }
        });
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/ui/chats.ts":
/*!****************************************!*\
  !*** ./src/global/actions/ui/chats.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _localSearch__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./localSearch */ "./src/global/actions/ui/localSearch.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    type = 'thread',
    shouldReplaceHistory = false,
    shouldReplaceLast = false,
    noForumTopicPanel,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  window.parent.postMessage({
    type: 'chatChange',
    url: chatId
  }, '*');
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  if (tabState.premiumModal?.promo && tabState.premiumModal?.isOpen) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
      premiumModal: {
        ...tabState.premiumModal,
        isOpen: false
      }
    }, tabId);
  }
  actions.hideEffectInComposer({
    tabId
  });
  if (!currentMessageList || currentMessageList.chatId !== chatId || currentMessageList.threadId !== threadId || currentMessageList.type !== type) {
    if (chatId) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [], tabId);
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
        activeReactions: {},
        shouldPreventComposerAnimation: true
      }, tabId);
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.exitMessageSelectMode)(global, tabId);
    global = (0,_localSearch__WEBPACK_IMPORTED_MODULE_8__.closeLocalTextSearch)(global, tabId);
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
      isStatisticsShown: false,
      boostStatistics: undefined,
      contentToBeScheduled: undefined,
      ...(chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).forwardMessages.toChatId && {
        forwardMessages: {}
      })
    }, tabId);
  }
  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
    if (chat?.isForum && !noForumTopicPanel) {
      actions.openForumPanel({
        chatId,
        tabId
      });
    } else if (chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).forumPanelChatId) {
      actions.closeForumPanel({
        tabId
      });
    }
  }
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateCurrentMessageList)(global, chatId, threadId, type, shouldReplaceHistory, shouldReplaceLast, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatInNewTab', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const hashUrl = (0,_util_routing__WEBPACK_IMPORTED_MODULE_2__.createMessageHashUrl)(chatId, 'thread', threadId);
  if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_ELECTRON) {
    window.electron.openNewWindow(hashUrl);
  } else {
    window.open(hashUrl, '_blank');
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openPreviousChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateCurrentMessageList)(global, undefined, undefined, undefined, true, undefined, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatWithInfo', (global, actions, payload) => {
  const {
    profileTab,
    forceScrollProfileTab = false,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isChatInfoShown: true,
    nextProfileTab: profileTab,
    forceScrollProfileTab
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.openChat({
    ...payload,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openThreadWithInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isChatInfoShown: true
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.openThread({
    ...payload,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatWithDraft', (global, actions, payload) => {
  const {
    chatId,
    text,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    files,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    requestedDraft: {
      chatId,
      text,
      files,
      filter
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('resetChatCreation', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatCreation: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('setNewChatMembersDialogState', (global, actions, payload) => {
  const {
    newChatMembersProgress,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    newChatMembersProgress
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openNextChat', (global, actions, payload) => {
  const {
    targetIndexDelta,
    orderedIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    actions.openChat({
      id: orderedIds[0],
      tabId
    });
    return;
  }
  const position = orderedIds.indexOf(chatId);
  if (position === -1) {
    return;
  }
  const nextId = orderedIds[position + targetIndexDelta];
  actions.openChat({
    id: nextId,
    shouldReplaceHistory: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeDeleteChatFolderModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    deleteFolderDialogModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeChatlistModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatlistModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('requestChatTranslation', (global, actions, payload) => {
  const {
    chatId,
    toLanguageCode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateRequestedChatTranslation)(global, chatId, toLanguageCode, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/globalSearch.ts":
/*!***********************************************!*\
  !*** ./src/global/actions/ui/globalSearch.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




const MAX_RECENTLY_FOUND_IDS = 10;
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global, tabId).globalSearch;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateGlobalSearch)(global, {
    globalResults: {},
    localResults: {},
    resultsByType: undefined,
    ...(query ? {
      fetchingStatus: {
        chats: !chatId,
        messages: true
      }
    } : {
      fetchingStatus: undefined
    }),
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGlobalSearchClosing', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)(),
    isClosing
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateGlobalSearch)(global, {
    isClosing
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('addRecentlyFoundChatId', (global, actions, payload) => {
  const {
    id
  } = payload;
  const {
    recentlyFoundChatIds
  } = global;
  if (!recentlyFoundChatIds) {
    return {
      ...global,
      recentlyFoundChatIds: [id]
    };
  }
  const newRecentIds = recentlyFoundChatIds.filter(chatId => chatId !== id);
  newRecentIds.unshift(id);
  if (newRecentIds.length > MAX_RECENTLY_FOUND_IDS) {
    newRecentIds.pop();
  }
  return {
    ...global,
    recentlyFoundChatIds: newRecentIds
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('clearRecentlyFoundChats', global => {
  return {
    ...global,
    recentlyFoundChatIds: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGlobalSearchContent', (global, actions, payload) => {
  const {
    content,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateGlobalSearchContent)(global, content, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGlobalSearchChatId', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateGlobalSearch)(global, {
    chatId: id,
    query: undefined,
    resultsByType: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/localSearch.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/ui/localSearch.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   closeLocalTextSearch: () => (/* binding */ closeLocalTextSearch)
/* harmony export */ });
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openLocalTextSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateLocalTextSearch)(global, chatId, threadId, '', tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeLocalTextSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return closeLocalTextSearch(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setLocalTextSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  const chatThreadKey = (0,_helpers__WEBPACK_IMPORTED_MODULE_2__.buildChatThreadKey)(chatId, threadId);
  const {
    query: currentQuery
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).localTextSearch.byChatThreadKey[chatThreadKey] || {};
  if (query !== currentQuery) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.replaceLocalTextSearchResults)(global, chatId, threadId, _util_memo__WEBPACK_IMPORTED_MODULE_1__.MEMO_EMPTY_ARRAY, undefined, undefined, tabId);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateLocalTextSearch)(global, chatId, threadId, query, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setLocalTextSearchTag', (global, actions, payload) => {
  const {
    tag,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  const chatThreadKey = (0,_helpers__WEBPACK_IMPORTED_MODULE_2__.buildChatThreadKey)(chatId, threadId);
  const {
    savedTag
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).localTextSearch.byChatThreadKey[chatThreadKey] || {};
  if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.isSameReaction)(tag, savedTag)) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.replaceLocalTextSearchResults)(global, chatId, threadId, _util_memo__WEBPACK_IMPORTED_MODULE_1__.MEMO_EMPTY_ARRAY, undefined, undefined, tabId);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateLocalTextSearchTag)(global, chatId, threadId, tag, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setSharedMediaSearchType', (global, actions, payload) => {
  const {
    mediaType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateSharedMediaSearchType)(global, chatId, threadId, mediaType, tabId);
});
function closeLocalTextSearch(global) {
  for (var _len = arguments.length, _ref = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    _ref[_key - 1] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()] = _ref;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return global;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateLocalTextSearchTag)(global, chatId, threadId, undefined, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateLocalTextSearch)(global, chatId, threadId, undefined, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.replaceLocalTextSearchResults)(global, chatId, threadId, undefined, undefined, undefined, tabId);
  return global;
}

/***/ }),

/***/ "./src/global/actions/ui/mediaViewer.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/ui/mediaViewer.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMediaViewer', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageId,
    mediaIndex,
    isAvatarView,
    origin,
    withDynamicLoading,
    standaloneMedia,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      ...tabState.mediaViewer,
      chatId,
      threadId,
      messageId,
      mediaIndex: mediaIndex || 0,
      isAvatarView,
      origin,
      standaloneMedia,
      isHidden: false,
      withDynamicLoading
    },
    forwardMessages: {}
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeMediaViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    volume,
    isMuted,
    playbackRate,
    isHidden
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).mediaViewer;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      volume,
      isMuted,
      isHidden,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setMediaViewerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).mediaViewer,
      volume,
      isMuted: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setMediaViewerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    mediaViewer: {
      ...global.mediaViewer,
      lastPlaybackRate: playbackRate
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).mediaViewer,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setMediaViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).mediaViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setMediaViewerHidden', (global, actions, payload) => {
  const {
    isHidden,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).mediaViewer,
      isHidden
    }
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/messages.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/messages.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _versionNotification_txt__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../versionNotification.txt */ "./src/versionNotification.txt");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_messageSummary__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../helpers/messageSummary */ "./src/global/helpers/messageSummary.ts");
/* harmony import */ var _helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers/renderMessageSummaryHtml */ "./src/global/helpers/renderMessageSummaryHtml.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");




















const FOCUS_DURATION = 1500;
const FOCUS_NO_HIGHLIGHT_DURATION = _config__WEBPACK_IMPORTED_MODULE_2__.FAST_SMOOTH_MAX_DURATION + _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_END_DELAY;
const POLL_RESULT_OPEN_DELAY_MS = 450;
const VERSION_NOTIFICATION_DURATION = 1000 * 60 * 60 * 24 * 3; // 3 days
const SERVICE_NOTIFICATIONS_MAX_AMOUNT = 1e3;
let blurTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setScrollOffset', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    scrollOffset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, 'lastScrollOffset', scrollOffset);
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceTabThreadParam)(global, chatId, threadId, 'scrollOffset', scrollOffset, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setEditingId', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId,
    type
  } = currentMessageList;
  const paramName = type === 'scheduled' ? 'editingScheduledId' : 'editingId';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, paramName, messageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setEditingDraft', (global, actions, payload) => {
  const {
    text,
    chatId,
    threadId,
    type
  } = payload;
  const paramName = type === 'scheduled' ? 'editingScheduledDraft' : 'editingDraft';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, paramName, text);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('editLastMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return undefined;
  }
  const lastOwnEditableMessageId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.findLast)(viewportIds, id => {
    return Boolean(chatMessages[id] && (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectAllowedMessageActions)(global, chatMessages[id], threadId).canEdit);
  });
  if (!lastOwnEditableMessageId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceThreadParam)(global, chatId, threadId, 'editingId', lastOwnEditableMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('replyToNextMessage', (global, actions, payload) => {
  const {
    targetIndexDelta,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return;
  }
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const isLatest = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsViewportNewest)(global, chatId, threadId, tabId);
  let messageId;
  if (!isLatest || !replyInfo?.replyToMsgId) {
    if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
      messageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, chatId);
    } else {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadInfo)(global, chatId, threadId);
      messageId = threadInfo?.lastMessageId;
    }
  } else {
    const chatMessageKeys = Object.keys(chatMessages);
    const indexOfCurrent = chatMessageKeys.indexOf(replyInfo.replyToMsgId.toString());
    const newIndex = indexOfCurrent + targetIndexDelta;
    messageId = newIndex <= chatMessageKeys.length + 1 && newIndex >= 0 ? Number(chatMessageKeys[newIndex]) : undefined;
  }
  actions.updateDraftReplyInfo({
    replyToMsgId: messageId,
    replyToPeerId: undefined,
    quoteText: undefined,
    tabId
  });
  actions.focusMessage({
    chatId,
    threadId,
    messageId: messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openAudioPlayer', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    messageId,
    origin,
    volume,
    playbackRate,
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      chatId,
      threadId,
      messageId,
      origin: origin ?? tabState.audioPlayer.origin,
      volume: volume ?? tabState.audioPlayer.volume,
      playbackRate: playbackRate || tabState.audioPlayer.playbackRate || global.audioPlayer.lastPlaybackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive === undefined ? global.audioPlayer.isLastPlaybackRateActive : tabState.audioPlayer.isPlaybackRateActive,
      isMuted: isMuted || tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setAudioPlayerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).audioPlayer,
      volume,
      isMuted: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setAudioPlayerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    isPlaybackRateActive,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    audioPlayer: {
      ...global.audioPlayer,
      lastPlaybackRate: playbackRate,
      isLastPlaybackRateActive: isPlaybackRateActive
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).audioPlayer,
      playbackRate,
      isPlaybackRateActive
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setAudioPlayerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).audioPlayer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setAudioPlayerOrigin', (global, actions, payload) => {
  const {
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).audioPlayer,
      origin
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeAudioPlayer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    audioPlayer: {
      volume: tabState.audioPlayer.volume,
      playbackRate: tabState.audioPlayer.playbackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive,
      isMuted: tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openPollResults', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const shouldOpenInstantly = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsRightColumnShown)(global, (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__.getIsMobile)(), tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  if (!shouldOpenInstantly) {
    window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
        pollResults: {
          chatId,
          messageId,
          voters: {}
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }, POLL_RESULT_OPEN_DELAY_MS);
  } else if (chatId !== tabState.pollResults.chatId || messageId !== tabState.pollResults.messageId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
      pollResults: {
        chatId,
        messageId,
        voters: {}
      }
    }, tabId);
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closePollResults', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    pollResults: {}
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('focusLastMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId,
    type
  } = currentMessageList;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  let lastMessageId;
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    if (type === 'pinned') {
      const pinnedMessageIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPinnedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
      if (!pinnedMessageIds?.length) {
        return;
      }
      lastMessageId = pinnedMessageIds[pinnedMessageIds.length - 1];
    } else {
      lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, chatId);
      const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
      // Workaround for scroll to local message 'you joined this channel'
      const lastChatMessage = Object.values(chatMessages).reverse()[0];
      if (lastMessageId && (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.isJoinedChannelMessage)(lastChatMessage) && lastChatMessage.id > lastMessageId) {
        lastMessageId = lastChatMessage.id;
      }
    }
  } else if (isSavedDialog) {
    lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, String(threadId), 'saved');
  } else {
    const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadInfo)(global, chatId, threadId);
    lastMessageId = threadInfo?.lastMessageId;
  }
  if (!lastMessageId) {
    return;
  }
  actions.focusMessage({
    chatId,
    threadId,
    messageListType: type,
    messageId: lastMessageId,
    noHighlight: true,
    noForumTopicPanel: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('focusNextReply', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectReplyStack)(global, chatId, threadId, tabId);
  if (!replyStack || replyStack.length === 0) {
    actions.focusLastMessage({
      tabId
    });
  } else {
    const messageId = replyStack.pop();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack], tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    actions.focusMessage({
      chatId,
      threadId,
      messageId: messageId,
      tabId,
      noForumTopicPanel: true
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('focusMessage', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageListType = 'thread',
    noHighlight,
    groupedId,
    groupedChatId,
    replyMessageId,
    isResizingContainer,
    shouldReplaceHistory,
    noForumTopicPanel,
    quote,
    scrollTargetPosition,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_6__.oldTranslate)('Conversation.ErrorInaccessibleMessage'),
      tabId
    });
    return undefined;
  }
  if (groupedId !== undefined) {
    const ids = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectForwardedMessageIdsByGroupId)(global, groupedChatId, groupedId);
    if (ids?.length) {
      [messageId] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.compact)(ids);
    }
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  const shouldSwitchChat = !currentMessageList || chatId !== currentMessageList.chatId || threadId !== currentMessageList.threadId || messageListType !== currentMessageList.type;
  if (blurTimeout) {
    clearTimeout(blurTimeout);
    blurTimeout = undefined;
  }
  blurTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusedMessage)({
      global
    }, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusDirection)(global, undefined, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  }, noHighlight ? FOCUS_NO_HIGHLIGHT_DURATION : FOCUS_DURATION);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusedMessage)({
    global,
    chatId,
    messageId,
    threadId,
    noHighlight,
    isResizingContainer,
    quote,
    scrollTargetPosition
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusDirection)(global, undefined, tabId);
  if (replyMessageId) {
    const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectReplyStack)(global, chatId, threadId, tabId) || [];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack, replyMessageId], tabId);
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusDirection)(global, _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Static, tabId);
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(global, chatId, threadId, tabId);
  if (viewportIds && viewportIds.includes(messageId)) {
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global, {
      forceOnHeavyAnimation: true
    });
    actions.openThread({
      chatId,
      threadId,
      type: messageListType,
      shouldReplaceHistory,
      noForumTopicPanel,
      tabId
    });
    return undefined;
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.replaceTabThreadParam)(global, chatId, threadId, 'viewportIds', undefined, tabId);
  }
  if (viewportIds && !shouldSwitchChat) {
    const direction = messageId > viewportIds[0] ? _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Down : _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Up;
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.updateFocusDirection)(global, direction, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global, {
    forceOnHeavyAnimation: true
  });
  actions.openThread({
    chatId,
    threadId,
    type: messageListType,
    shouldReplaceHistory,
    noForumTopicPanel,
    tabId
  });
  actions.loadViewportMessages({
    chatId,
    threadId,
    tabId,
    shouldForceRender: true
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setShouldPreventComposerAnimation', (global, actions, payload) => {
  const {
    shouldPreventComposerAnimation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    shouldPreventComposerAnimation
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openForwardMenu', (global, actions, payload) => {
  const {
    fromChatId,
    messageIds,
    storyId,
    groupedId,
    withMyScore,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  let groupedMessageIds;
  if (groupedId) {
    groupedMessageIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectMessageIdsByGroupId)(global, fromChatId, groupedId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      fromChatId,
      messageIds: groupedMessageIds || messageIds,
      storyId,
      isModalShown: true,
      withMyScore
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('changeRecipient', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages,
      toChatId: undefined,
      isModalShown: true,
      noAuthors: false,
      noCaptions: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setForwardNoAuthors', (global, actions, payload) => {
  const {
    noAuthors,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...tabState.forwardMessages,
      noAuthors,
      // `noCaptions` cannot be true when `noAuthors` is false
      noCaptions: noAuthors && tabState.forwardMessages.noCaptions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setForwardNoCaptions', (global, actions, payload) => {
  const {
    noCaptions,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).forwardMessages,
      noCaptions,
      noAuthors: noCaptions // On other clients `noAuthors` updates together with `noCaptions`
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('exitForwardMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    forwardMessages: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openForwardMenuForSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId: fromChatId,
    messageIds
  } = tabState.selectedMessages;
  actions.openForwardMenu({
    fromChatId,
    messageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('cancelMediaDownload', (global, actions, payload) => {
  const {
    media,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.cancelMessageMediaDownload)(global, [hash], tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('cancelMediaHashDownloads', (global, actions, payload) => {
  const {
    mediaHashes,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.cancelMessageMediaDownload)(global, mediaHashes, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('downloadMedia', (global, actions, payload) => {
  const {
    media,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  const size = 'size' in media ? media.size : 0;
  const metadata = {
    size,
    format: (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMediaFormat)(media, 'download'),
    filename: (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMediaFilename)(media)
  };
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.addActiveMediaDownload)(global, hash, metadata, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('downloadSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  const {
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  if (!chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectAllowedMessageActions)(global, message, threadId).canDownload);
  messages.forEach(message => {
    const media = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMessageDownloadableMedia)(message);
    if (!media) return;
    actions.downloadMedia({
      media,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('enterMessageSelectMode', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const openChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!openChat) {
    return global;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.enterMessageSelectMode)(global, openChat.id, messageId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleMessageSelection', (global, actions, payload) => {
  const {
    messageId,
    groupedId,
    childMessageIds,
    withShift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.toggleMessageSelection)(global, chatId, threadId, messageListType, messageId, groupedId, childMessageIds, withShift, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  if (global.shouldShowContextMenuHint) {
    actions.disableContextMenuHint();
    actions.showNotification({
      // eslint-disable-next-line max-len
      message: `To **edit** or **reply**, close this menu. Then ${_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_TOUCH_ENV ? 'long tap' : 'right click'} on a message.`,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('disableContextMenuHint', global => {
  if (!global.shouldShowContextMenuHint) {
    return undefined;
  }
  return {
    ...global,
    shouldShowContextMenuHint: false
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('exitMessageSelectMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_15__.exitMessageSelectMode)(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openPollModal', (global, actions, payload) => {
  const {
    isQuiz,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    pollModal: {
      isOpen: true,
      isQuiz
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closePollModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    pollModal: {
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('checkVersionNotification', (global, actions) => {
  if (_config__WEBPACK_IMPORTED_MODULE_2__.RELEASE_DATETIME && Date.now() > Number(_config__WEBPACK_IMPORTED_MODULE_2__.RELEASE_DATETIME) + VERSION_NOTIFICATION_DURATION) {
    return;
  }
  const currentVersion = "10.9.8".split('.').slice(0, 2).join('.');
  const {
    serviceNotifications
  } = global;
  if (serviceNotifications.find(_ref => {
    let {
      version
    } = _ref;
    return version === currentVersion;
  })) {
    return;
  }
  const message = {
    chatId: _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID,
    date: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_8__.getServerTime)(),
    content: {
      text: (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__["default"])(_versionNotification_txt__WEBPACK_IMPORTED_MODULE_10__, true)
    },
    isOutgoing: false
  };
  actions.createServiceNotification({
    message: message,
    version: currentVersion
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('createServiceNotification', (global, actions, payload) => {
  const {
    message,
    version
  } = payload;
  const {
    serviceNotifications
  } = global;
  const maxId = Math.max((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) || 0, ...serviceNotifications.map(_ref2 => {
    let {
      id
    } = _ref2;
    return id;
  }));
  const fractionalPart = (serviceNotifications.length + 1) / SERVICE_NOTIFICATIONS_MAX_AMOUNT;
  // The fractional ID is made of the largest integer ID and an incremented fractional part
  const id = Math.floor(maxId) + fractionalPart;
  message.previousLocalId = message.id;
  message.id = id;
  const serviceNotification = {
    id,
    message,
    version,
    isUnread: true
  };
  global = {
    ...global,
    serviceNotifications: [...serviceNotifications.slice(-SERVICE_NOTIFICATIONS_MAX_AMOUNT), serviceNotification]
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'newMessage',
    id: message.id,
    chatId: message.chatId,
    message
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openReactorListModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    reactorModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeReactorListModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    reactorModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openSeenByModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    seenByModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeSeenByModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    seenByModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openPrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    chatId,
    isReadDate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    privacySettingsNoticeModal: {
      chatId,
      isReadDate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closePrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    privacySettingsNoticeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openChatLanguageModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const activeLanguage = messageId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectRequestedMessageTranslationLanguage)(global, chatId, messageId, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectRequestedChatTranslationLanguage)(global, chatId, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    chatLanguageModal: {
      chatId,
      messageId,
      activeLanguage
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeChatLanguageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    chatLanguageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('copySelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  copyTextForMessages(global, chatId, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('copyMessagesByIds', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!messageIds || messageIds.length === 0 || !chat) {
    return;
  }
  copyTextForMessages(global, chat.id, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openOneTimeMediaModal', (global, actions, payload) => {
  const {
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    oneTimeMediaModal: {
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeOneTimeMediaModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    oneTimeMediaModal: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    reportAdModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openPreviousReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const reportAdModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).reportAdModal;
  if (!reportAdModal) {
    return undefined;
  }
  if (reportAdModal.sections.length === 1) {
    actions.closeReportAdModal({
      tabId
    });
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    reportAdModal: {
      ...reportAdModal,
      sections: reportAdModal.sections.slice(0, -1)
    }
  }, tabId);
});
function copyTextForMessages(global, chatId, messageIds) {
  const {
    type: messageListType,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global) || {};
  const lang = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_6__.oldTranslate;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const chatMessages = messageListType === 'scheduled' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatScheduledMessages)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  if (!chat || !chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectAllowedMessageActions)(global, message, threadId).canCopy).sort((message1, message2) => message1.id - message2.id);
  const resultHtml = [];
  const resultText = [];
  messages.forEach(message => {
    const sender = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.isChatChannel)(chat) ? chat : (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSender)(global, message);
    const senderTitle = `> ${sender ? (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getSenderTitle)(lang, sender) : message.forwardInfo?.hiddenUserName || ''}:`;
    resultHtml.push(senderTitle);
    resultHtml.push(`${(0,_helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_13__.renderMessageSummaryHtml)(lang, message)}\n`);
    resultText.push(senderTitle);
    resultText.push(`${(0,_helpers_messageSummary__WEBPACK_IMPORTED_MODULE_12__.getMessageSummaryText)(lang, message, false, 0, true)}\n`);
  });
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyHtmlToClipboard)(resultHtml.join('\n'), resultText.join('\n'));
}

/***/ }),

/***/ "./src/global/actions/ui/misc.ts":
/*!***************************************!*\
  !*** ./src/global/actions/ui/misc.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   APP_VERSION_URL: () => (/* binding */ APP_VERSION_URL)
/* harmony export */ });
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/getIsAppUpdateNeeded */ "./src/util/getIsAppUpdateNeeded.ts");
/* harmony import */ var _util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/getReadableErrorText */ "./src/util/getReadableErrorText.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/updatePageTitle */ "./src/util/updatePageTitle.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");


















const APP_VERSION_URL = 'version.txt';
const FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION = 6000;
const MAX_STORED_EMOJIS = 8 * 4; // Represents four rows of recent emojis

(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleChatInfo', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const isChatInfoShown = force !== undefined ? force : !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isChatInfoShown;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isChatInfoShown
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: isChatInfoShown
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setLeftColumnWidth', (global, actions, payload) => {
  const {
    leftColumnWidth
  } = payload;
  return {
    ...global,
    leftColumnWidth
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('resetLeftColumnWidth', global => {
  return {
    ...global,
    leftColumnWidth: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleManagement', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: force !== undefined ? force : !(tabState.management.byChatId[chatId] || {}).isActive
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestNextManagementScreen', (global, actions, payload) => {
  const {
    screen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: true,
          nextScreen: screen
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeManagement', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: false
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if (!(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_17__.getIsMobile)() && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_17__.getIsTablet)()) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isLeftColumnShown: (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).messageLists.length === 0
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('resetNextProfileTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    nextProfileTab: undefined,
    forceScrollProfileTab: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isStatisticsShown: !tabState.isStatisticsShown,
    statistics: {
      ...tabState.statistics,
      currentMessageId: undefined,
      currentStoryId: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleMessageStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    messageId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).statistics,
      currentMessageId: messageId,
      currentStoryId: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleStoryStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    storyId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).statistics,
      currentStoryId: storyId,
      currentMessageId: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleLeftColumn', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isLeftColumnShown: !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isLeftColumnShown
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    recentEmojis
  } = global;
  if (!recentEmojis) {
    return {
      ...global,
      recentEmojis: [emoji]
    };
  }
  const newEmojis = recentEmojis.filter(e => e !== emoji);
  newEmojis.unshift(emoji);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const {
    recent
  } = global.stickers;
  if (!recent) {
    return {
      ...global,
      stickers: {
        ...global.stickers,
        recent: {
          hash: '0',
          stickers: [sticker]
        }
      }
    };
  }
  const newStickers = recent.stickers.filter(s => s.id !== sticker.id);
  newStickers.unshift(sticker);
  return {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        ...recent,
        stickers: newStickers
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentCustomEmoji', (global, actions, payload) => {
  const {
    documentId
  } = payload;
  const {
    recentCustomEmojis
  } = global;
  if (!recentCustomEmojis) {
    return {
      ...global,
      recentCustomEmojis: [documentId]
    };
  }
  const newEmojis = recentCustomEmojis.filter(id => id !== documentId);
  newEmojis.unshift(documentId);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentCustomEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('clearRecentCustomEmoji', global => {
  return {
    ...global,
    recentCustomEmojis: []
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('reorderStickerSets', (global, actions, payload) => {
  const {
    order,
    isCustomEmoji
  } = payload;
  return {
    ...global,
    stickers: {
      ...global.stickers,
      added: {
        setIds: !isCustomEmoji ? order : global.stickers.added.setIds
      }
    },
    customEmojis: {
      ...global.customEmojis,
      added: {
        setIds: isCustomEmoji ? order : global.customEmojis.added.setIds
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showNotification', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    ...notification
  } = payload;
  notification.localId = (0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const newNotifications = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).notifications];
  const existingNotificationIndex = newNotifications.findIndex(n => n.message === notification.message);
  if (existingNotificationIndex !== -1) {
    newNotifications.splice(existingNotificationIndex, 1);
  }
  newNotifications.push(notification);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    notifications: newNotifications
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showAllowedMessageTypesNotification', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  if (!chat) return;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatFullInfo)(global, chatId);
  const {
    canSendPlainText,
    canSendPhotos,
    canSendVideos,
    canSendDocuments,
    canSendAudios,
    canSendStickers,
    canSendRoundVideos,
    canSendVoices
  } = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getAllowedAttachmentOptions)(chat, chatFullInfo);
  const allowedContent = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.compact)([canSendPlainText ? 'Chat.SendAllowedContentTypeText' : undefined, canSendPhotos ? 'Chat.SendAllowedContentTypePhoto' : undefined, canSendVideos ? 'Chat.SendAllowedContentTypeVideo' : undefined, canSendVoices ? 'Chat.SendAllowedContentTypeVoiceMessage' : undefined, canSendRoundVideos ? 'Chat.SendAllowedContentTypeVideoMessage' : undefined, canSendDocuments ? 'Chat.SendAllowedContentTypeFile' : undefined, canSendAudios ? 'Chat.SendAllowedContentTypeMusic' : undefined, canSendStickers ? 'Chat.SendAllowedContentTypeSticker' : undefined]).map(l => _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate(l));
  if (!allowedContent.length) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  const lastDelimiter = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate('AutoDownloadSettings.LastDelimeter');
  const allowedContentString = allowedContent.join(', ').replace(/,([^,]*)$/, `${lastDelimiter}$1`);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate('Chat.SendAllowedContentText', allowedContentString),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('dismissNotification', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const newNotifications = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).notifications.filter(_ref => {
    let {
      localId
    } = _ref;
    return localId !== payload.localId;
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    notifications: newNotifications
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showDialog', (global, actions, payload) => {
  const {
    data,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;

  // Filter out errors that we don't want to show to the user
  if ('message' in data && data.hasErrorKey && !(0,_util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_6__["default"])(data)) {
    return global;
  }
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).dialogs];
  if ('message' in data) {
    const existingErrorIndex = newDialogs.findIndex(err => err.message === data.message);
    if (existingErrorIndex !== -1) {
      newDialogs.splice(existingErrorIndex, 1);
    }
  }
  newDialogs.push(data);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('dismissDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).dialogs];
  newDialogs.pop();
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleSafeLinkModal', (global, actions, payload) => {
  const {
    url: safeLinkModalUrl,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    safeLinkModalUrl
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openHistoryCalendar', (global, actions, payload) => {
  const {
    selectedAt,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    historyCalendarSelectedAt: selectedAt
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeHistoryCalendar', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    historyCalendarSelectedAt: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openGame', (global, actions, payload) => {
  const {
    url,
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const botId = message.viaBotId || message.senderId;
  if (!botId) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'game',
        onConfirm: {
          action: 'openGame',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedGame: {
      url,
      chatId,
      messageId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeGame', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedGame: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestConfetti', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    ...rest
  } = payload;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateInterface)(global)) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    confetti: {
      lastConfettiTime: Date.now(),
      ...rest
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateAttachmentSettings', (global, actions, payload) => {
  const {
    shouldCompress,
    shouldSendGrouped,
    isInvertedMedia
  } = payload;
  return {
    ...global,
    attachmentSettings: {
      shouldCompress: shouldCompress ?? global.attachmentSettings.shouldCompress,
      shouldSendGrouped: shouldSendGrouped ?? global.attachmentSettings.shouldSendGrouped,
      isInvertedMedia
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldPlayEffectInComposer: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('hideEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldPlayEffectInComposer: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setReactionEffect', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const emoticon = reaction && 'emoticon' in reaction && reaction.emoticon;
  if (!emoticon) return;
  const effect = Object.values(global.availableEffectById).find(currentEffect => currentEffect.effectAnimationId && currentEffect.emoticon === emoticon);
  const effectId = effect?.id;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsCurrentUserPremium)(global);
  if (effect?.isPremium && !isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'effects',
      tabId
    });
    return;
  }
  if (!effectId) return;
  actions.requestEffectInComposer({
    tabId
  });
  actions.saveEffectInDraft({
    chatId,
    threadId,
    effectId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openLimitReachedModal', (global, actions, payload) => {
  const {
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    limitReachedModal: {
      limit
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeLimitReachedModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    limitReachedModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeStickerSetModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedStickerSetShortName: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openCustomEmojiSets', (global, actions, payload) => {
  const {
    setIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedCustomEmojiSetIds: setIds
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCustomEmojiSets', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedCustomEmojiSetIds: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateLastRenderedCustomEmojis', (global, actions, payload) => {
  const {
    ids
  } = payload;
  const {
    lastRendered
  } = global.customEmojis;
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      lastRendered: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)([...lastRendered, ...ids]).slice(0, _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT)
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openCreateTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    createTopicPanel: {
      chatId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCreateTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    createTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openEditTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    editTopicPanel: {
      chatId,
      topicId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeEditTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    editTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateArchiveSettings', (global, actions, payload) => {
  const {
    archiveSettings
  } = global;
  const {
    isHidden = archiveSettings.isHidden,
    isMinimized = archiveSettings.isMinimized
  } = payload;
  return {
    ...global,
    archiveSettings: {
      isHidden,
      isMinimized
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openMapModal', (global, actions, payload) => {
  const {
    geoPoint,
    zoom,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    mapModal: {
      point: geoPoint,
      zoom
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeMapModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    mapModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('checkAppVersion', global => {
  fetch(`${APP_VERSION_URL}?${Date.now()}`).then(response => response.text()).then(version => {
    version = version.trim();
    if ((0,_util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_5__["default"])(version, "10.9.8")) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      global = {
        ...global,
        isAppUpdateAvailable: true
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }
  }).catch(err => {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.error('[checkAppVersion failed] ', err);
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setIsElectronUpdateAvailable', (global, action, payload) => {
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = {
    ...global,
    isElectronUpdateAvailable: Boolean(payload)
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('afterHangUp', global => {
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()).multitabNextAction) return;
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.reestablishMasterToSelf)();
});
let notificationInterval;
const NOTIFICATION_INTERVAL = 500;
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('onTabFocusChange', (global, actions, payload) => {
  const {
    isBlurred,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if (isBlurred) {
    if (notificationInterval) clearInterval(notificationInterval);
    notificationInterval = window.setInterval(() => {
      actions.updatePageTitle({
        tabId
      });
    }, NOTIFICATION_INTERVAL);
  } else {
    clearInterval(notificationInterval);
    notificationInterval = undefined;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isBlurred
  }, tabId);
  return {
    ...global,
    initialUnreadNotifications: isBlurred ? (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_3__.getAllNotificationsCount)() : undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updatePageTitle', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    canDisplayChatInTitle
  } = global.settings.byKey;
  const currentUserId = global.currentUserId;
  if (document.title.includes(_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER)) {
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_10__["default"])(false);
    (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__.setPageTitleInstant)(`${_config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE} ${_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER}`);
    return;
  }
  if (global.initialUnreadNotifications && Math.round(Date.now() / 1000) % 2 === 0) {
    const notificationCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_3__.getAllNotificationsCount)();
    const newUnread = notificationCount - global.initialUnreadNotifications;
    if (newUnread > 0) {
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__.setPageTitleInstant)(`${newUnread} notification${newUnread > 1 ? 's' : ''}`);
      (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_10__["default"])(true);
      return;
    }
  }
  (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_10__["default"])(false);
  const messageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
  if (messageList && canDisplayChatInTitle && !global.passcode.isScreenLocked) {
    const {
      chatId,
      threadId
    } = messageList;
    const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
    if (currentChat) {
      const title = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getChatTitle)(_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate, currentChat, chatId === currentUserId);
      if (currentChat.isForum && currentChat.topics?.[threadId]) {
        (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__.setPageTitle)(`${title} › ${currentChat.topics[threadId].title}`);
        return;
      }
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__.setPageTitle)(title);
      return;
    }
  }
  (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_11__.setPageTitleInstant)(_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_12__.IS_ELECTRON ? '' : _config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeInviteViaLinkModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    inviteViaLinkModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCollectibleInfoModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    collectibleInfoModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setShouldCloseRightColumn', (global, actions, payload) => {
  const {
    value,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldCloseRightColumn: value
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('refreshLangPackFromCache', (global, actions, payload) => {
  (0,_util_localization__WEBPACK_IMPORTED_MODULE_8__.refreshFromCache)(payload.langCode);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('processPremiumFloodWait', (global, actions, payload) => {
  const {
    isUpload
  } = payload;
  const {
    bandwidthPremiumDownloadSpeedup,
    bandwidthPremiumUploadSpeedup,
    bandwidthPremiumNotifyPeriod
  } = global.appConfig || {};
  const {
    lastPremiumBandwithNotificationDate: lastNotifiedAt
  } = global.settings;
  if (!bandwidthPremiumDownloadSpeedup || !bandwidthPremiumUploadSpeedup || !bandwidthPremiumNotifyPeriod) {
    return undefined;
  }
  if (lastNotifiedAt && Date.now() < lastNotifiedAt + bandwidthPremiumNotifyPeriod * 1000) return undefined;
  const unblurredTabIds = Object.values(global.byTabId).filter(l => !l.isBlurred).map(l => l.id);
  unblurredTabIds.forEach(tabId => {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate(isUpload ? 'UploadSpeedLimited' : 'DownloadSpeedLimited'),
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate(isUpload ? 'UploadSpeedLimitedMessage' : 'DownloadSpeedLimitedMessage', isUpload ? bandwidthPremiumUploadSpeedup : bandwidthPremiumDownloadSpeedup),
      duration: FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION,
      tabId
    });
  });
  return {
    ...global,
    settings: {
      ...global.settings,
      lastPremiumBandwithNotificationDate: Date.now()
    }
  };
});
let prevIsScreenLocked;
let prevBlurredTabsCount = 0;
let onlineTimeout;
const ONLINE_TIMEOUT = 100;
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  // eslint-disable-next-line eslint-multitab-tt/no-getactions-in-actions
  const {
    updatePageTitle,
    updateIsOnline
  } = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getActions)();
  const isLockedUpdated = global.passcode.isScreenLocked !== prevIsScreenLocked;
  const blurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
  const isMasterTab = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()).isMasterTab;
  if (isLockedUpdated) {
    updatePageTitle();
  }
  if (blurredTabsCount !== prevBlurredTabsCount && isMasterTab) {
    if (onlineTimeout) clearTimeout(onlineTimeout);
    onlineTimeout = window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      const newBlurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
      updateIsOnline(newBlurredTabsCount !== (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getAllMultitabTokens)().length);
    }, ONLINE_TIMEOUT);
  }
  prevIsScreenLocked = global.passcode.isScreenLocked;
  prevBlurredTabsCount = blurredTabsCount;
});

/***/ }),

/***/ "./src/global/actions/ui/passcode.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/passcode.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_sessions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/sessions */ "./src/util/sessions.ts");
/* harmony import */ var _cache__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../cache */ "./src/global/cache.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _initialState__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../initialState */ "./src/global/initialState.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");










let noLockOnUnload = false;
(0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.onBeforeUnload)(() => {
  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global
  if ((0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)().passcode.hasPasscode && !noLockOnUnload && Object.keys((0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)().byTabId).length === 1) {
    (0,_util_sessions__WEBPACK_IMPORTED_MODULE_5__.clearStoredSession)();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setPasscode', async (global, actions, payload) => {
  const {
    passcode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    isLoading: true
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_3__.setupPasscode)(passcode);
  const sessionJson = JSON.stringify({
    ...(0,_util_sessions__WEBPACK_IMPORTED_MODULE_5__.loadStoredSession)(),
    userId: global.currentUserId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const globalJson = (0,_cache__WEBPACK_IMPORTED_MODULE_6__.serializeGlobal)((0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    hasPasscode: true,
    error: undefined,
    isLoading: false
  }));
  try {
    await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_3__.encryptSession)(sessionJson, globalJson);
    (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.signalPasscodeHash)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
      hasPasscode: true,
      error: undefined,
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    (0,_cache__WEBPACK_IMPORTED_MODULE_6__.forceUpdateCache)(true);
  } catch (err) {
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_3__.forgetPasscode)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    actions.showNotification({
      message: 'Failed to set passcode',
      tabId
    });
    actions.requestNextSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_0__.SettingsScreens.PasscodeDisabled,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearPasscode', global => {
  void (0,_util_passcode__WEBPACK_IMPORTED_MODULE_3__.clearEncryptedSession)();
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.clearPasscodeSettings)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('unlockScreen', (global, actions, payload) => {
  const beforeTabStates = Object.values(global.byTabId);
  const {
    sessionJson,
    globalJson
  } = payload;
  const session = JSON.parse(sessionJson);
  (0,_util_sessions__WEBPACK_IMPORTED_MODULE_5__.storeSession)(session, session.userId);
  const previousGlobal = global;
  global = JSON.parse(globalJson);
  global.byTabId = previousGlobal.byTabId;
  (0,_cache__WEBPACK_IMPORTED_MODULE_6__.migrateCache)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.cloneDeep)(_initialState__WEBPACK_IMPORTED_MODULE_8__.INITIAL_GLOBAL_STATE));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    isScreenLocked: false,
    error: undefined,
    invalidAttemptsCount: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.signalPasscodeHash)();
  beforeTabStates.forEach(_ref => {
    let {
      id: tabId,
      isMasterTab
    } = _ref;
    return actions.init({
      tabId,
      isMasterTab
    });
  });
  actions.initApi();
});
const MAX_INVALID_ATTEMPTS = 5;
const TIMEOUT_RESET_INVALID_ATTEMPTS_MS = 1000 * 15; // 180000; // 3 minutes

(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('logInvalidUnlockAttempt', global => {
  const invalidAttemptsCount = (global.passcode?.invalidAttemptsCount ?? 0) + 1;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    invalidAttemptsCount,
    timeoutUntil: invalidAttemptsCount >= MAX_INVALID_ATTEMPTS ? Date.now() + TIMEOUT_RESET_INVALID_ATTEMPTS_MS : undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('resetInvalidUnlockAttempts', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    invalidAttemptsCount: 0,
    timeoutUntil: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setPasscodeError', (global, actions, payload) => {
  const {
    error
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    error
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearPasscodeError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updatePasscodeSettings)(global, {
    error: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('skipLockOnUnload', () => {
  noLockOnUnload = true;
});

/***/ }),

/***/ "./src/global/actions/ui/payments.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/payments.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closePaymentModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const payment = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).payment;
  const status = payment.status || 'cancelled';
  const originPayment = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).starsBalanceModal?.originPayment;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.clearPayment)(global, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.closeInvoice)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).payment,
      status
    },
    ...(originPayment && {
      starsBalanceModal: undefined
    })
  }, tabId);

  // Re-open previous payment modal
  if (originPayment) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePayment)(global, originPayment, tabId);
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
      isStarPaymentModalOpen: true
    }, tabId);
  }
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('addPaymentError', (global, actions, payload) => {
  const {
    error,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).payment,
      status: 'failed',
      error
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeGiftCodeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    giftCodeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openStarsBalanceModal', (global, actions, payload) => {
  const {
    originPayment,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.clearPayment)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    starsBalanceModal: {
      originPayment
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeStarsBalanceModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    starsBalanceModal: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/reactions.ts":
/*!********************************************!*\
  !*** ./src/global/actions/ui/reactions.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
      reactionPicker: {
        chatId,
        messageId: undefined,
        position: undefined
      }
    }, tabId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    reactionPicker: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openMessageReactionPicker', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    position,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    reactionPicker: {
      chatId,
      messageId,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openStoryReactionPicker', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    position,
    sendAsMessage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    reactionPicker: {
      storyPeerId: peerId,
      storyId,
      sendAsMessage,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openEffectPicker', (global, actions, payload) => {
  const {
    position,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    reactionPicker: {
      position,
      chatId,
      isForEffects: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeReactionPicker', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    reactionPicker: {
      ...tabState.reactionPicker,
      messageId: undefined,
      position: undefined,
      storyId: undefined,
      storyPeerId: undefined,
      isForEffects: undefined
    }
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/stickerSearch.ts":
/*!************************************************!*\
  !*** ./src/global/actions/ui/stickerSearch.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");



(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    stickerSearch: {
      query,
      resultIds: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    gifSearch: {
      query,
      offset: undefined,
      // offsetId: undefined,
      results: undefined
    }
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/stories.ts":
/*!******************************************!*\
  !*** ./src/global/actions/ui/stories.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../api/chats */ "./src/global/actions/api/chats.ts");










(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewer', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    isPrivate,
    isArchive,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (storyId && (!peerStories || !peerStories.byId[storyId])) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
      peer,
      ids: [storyId]
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.addUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.users, 'id'));
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.addChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.chats, 'id'));
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.addStoriesForPeer)(global, peerId, result.stories);
  }
  const storyList = tabState.storyViewer.storyList || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectStoryListForViewer)(global, peerId, storyId, isSingleStory, isSinglePeer, isPrivate, isArchive);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId,
      storyId: storyId || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerFirstUnreadStoryId)(global, peerId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerFirstStoryId)(global, peerId),
      isSinglePeer,
      isPrivate,
      isArchive,
      isSingleStory,
      viewModal: undefined,
      origin,
      storyList
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewerByUsername', async (global, actions, payload) => {
  const {
    username,
    storyId,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = await (0,_api_chats__WEBPACK_IMPORTED_MODULE_9__.fetchChatByUsername)(global, username);
  if (!chat) {
    return;
  }
  actions.openStoryViewer({
    peerId: chat.id,
    storyId,
    isSinglePeer: true,
    isSingleStory: true,
    origin,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    isMuted,
    isRibbonShown,
    isArchivedRibbonShown,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer;
  if (!storyId) return global;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      isMuted,
      isRibbonShown,
      isArchivedRibbonShown,
      lastViewedByPeerIds: undefined,
      storyList: undefined
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setStoryViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('toggleStoryRibbon', (global, actions, payload) => {
  const {
    isShown,
    isArchived,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const orderedIds = global.stories.orderedPeerIds[isArchived ? 'archived' : 'active'];
  if (!orderedIds?.length) {
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer,
      [isArchived ? 'isArchivedRibbonShown' : 'isRibbonShown']: isShown
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openPreviousStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let previousStoryIndex;
  let previousPeerId;
  if (currentStoryIndex > 0) {
    previousStoryIndex = currentStoryIndex - 1;
    previousPeerId = peerId;
  } else {
    const previousPeerIdIndex = orderedPeerIds.indexOf(peerId) - 1;
    if (isSinglePeer || previousPeerIdIndex < 0) {
      return undefined;
    }
    previousPeerId = orderedPeerIds[previousPeerIdIndex];
    previousStoryIndex = (storyIdsByPeerId?.[previousPeerId]?.length || 1) - 1;
  }
  const previousStoryId = storyIdsByPeerId?.[previousPeerId]?.[previousStoryIndex];
  if (!previousStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: previousPeerId,
      storyId: previousStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openNextStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let nextStoryIndex;
  let nextPeerId;
  if (currentStoryIndex < peerStoryIds.length - 1) {
    nextStoryIndex = currentStoryIndex + 1;
    nextPeerId = peerId;
  } else {
    const nextPeerIdIndex = orderedPeerIds.indexOf(peerId) + 1;
    if (isSinglePeer || nextPeerIdIndex > orderedPeerIds.length - 1) {
      actions.closeStoryViewer({
        tabId
      });
      return undefined;
    }
    nextPeerId = orderedPeerIds[nextPeerIdIndex];
    nextStoryIndex = 0;
  }
  const nextStoryId = storyIdsByPeerId?.[nextPeerId]?.[nextStoryIndex];
  if (!nextStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: nextPeerId,
      storyId: nextStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewModal', (global, actions, payload) => {
  const {
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        storyId,
        nextOffset: '',
        isLoading: true
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryViewModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(tabState.storyViewer, ['viewModal'])
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('copyStoryLink', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const link = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoryLink', {
    peer,
    storyId
  });
  if (!link) {
    return;
  }
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_0__.copyTextToClipboard)(link);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LinkCopied'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('sendMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!isStoryReply) {
    return;
  }
  const {
    gif,
    sticker,
    isReaction
  } = payload;
  let message;
  if (gif) {
    message = 'Story.Tooltip.GifSent';
  } else if (sticker) {
    message = 'Story.Tooltip.StickerSent';
  } else if (isReaction) {
    message = 'Story.Tooltip.ReactionSent';
  } else {
    message = 'Story.Tooltip.MessageSent';
  }
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate(message),
    actionText: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('Story.ToastViewInChat'),
    action: [{
      action: 'closeStoryViewer',
      payload: undefined
    }, {
      action: 'openChat',
      payload: {
        id: storyPeerId
      }
    }],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('toggleStealthModal', (global, actions, payload) => {
  const {
    isOpen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isStealthModalOpen: isOpen
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('clearStoryViews', (global, actions, payload) => {
  const {
    isLoading,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  if (!tabState.storyViewer.viewModal) return global;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...tabState.storyViewer.viewModal,
        views: undefined,
        isLoading,
        nextOffset: ''
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateStoryView', (global, actions, payload) => {
  const {
    userId,
    isUserBlocked,
    areStoriesBlocked,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    viewModal
  } = tabState.storyViewer;
  if (!viewModal?.storyId) return undefined;
  const updatedViews = viewModal?.views?.map(view => {
    if (view.peerId === userId) {
      return {
        ...view,
        isUserBlocked: isUserBlocked || undefined,
        areStoriesBlocked: areStoriesBlocked || undefined
      };
    }
    return view;
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...viewModal,
        views: updatedViews
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeBoostModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    boostModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeBoostStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    boostStatistics: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/users.ts":
/*!****************************************!*\
  !*** ./src/global/actions/ui/users.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");




(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserSearch)(global, {
    globalUserIds: undefined,
    localUserIds: undefined,
    fetchingStatus: Boolean(query),
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openAddContactDialog', (global, actions, payload) => {
  const {
    userId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    newContact: {
      userId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    newContact: {
      isByPhoneNumber: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.closeNewContactDialog)(global, tabId);
});

/***/ }),

/***/ "./src/global/helpers/renderMessageSummaryHtml.ts":
/*!********************************************************!*\
  !*** ./src/global/helpers/renderMessageSummaryHtml.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   renderMessageSummaryHtml: () => (/* binding */ renderMessageSummaryHtml)
/* harmony export */ });
/* harmony import */ var _components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../components/common/helpers/renderMessageText */ "./src/components/common/helpers/renderMessageText.ts");
/* harmony import */ var _messageSummary__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./messageSummary */ "./src/global/helpers/messageSummary.ts");


function renderMessageSummaryHtml(lang, message) {
  const emoji = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_1__.getMessageSummaryEmoji)(message);
  const emojiWithSpace = emoji ? `${emoji} ` : '';
  const text = (0,_components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__.renderMessageText)({
    message,
    shouldRenderAsHtml: true
  })?.join('');
  const description = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_1__.getMessageSummaryDescription)(lang, message, text, true);
  return `${emojiWithSpace}${description}`;
}

/***/ }),

/***/ "./src/global/reducers/bots.ts":
/*!*************************************!*\
  !*** ./src/global/reducers/bots.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   replaceInlineBotSettings: () => (/* binding */ replaceInlineBotSettings),
/* harmony export */   replaceInlineBotsIsLoading: () => (/* binding */ replaceInlineBotsIsLoading)
/* harmony export */ });
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tabs */ "./src/global/reducers/tabs.ts");



function replaceInlineBotSettings(global, username, inlineBotSettings) {
  for (var _len = arguments.length, _ref = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {
    _ref[_key - 3] = arguments[_key];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()] = _ref;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    inlineBots: {
      ...tabState.inlineBots,
      byUsername: {
        ...tabState.inlineBots.byUsername,
        [username]: inlineBotSettings
      }
    }
  }, tabId);
}
function replaceInlineBotsIsLoading(global, isLoading) {
  for (var _len2 = arguments.length, _ref2 = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
    _ref2[_key2 - 2] = arguments[_key2];
  }
  let [tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()] = _ref2;
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    inlineBots: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId).inlineBots,
      isLoading
    }
  }, tabId);
}

/***/ }),

/***/ "./src/global/reducers/reactions.ts":
/*!******************************************!*\
  !*** ./src/global/reducers/reactions.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addMessageReaction: () => (/* binding */ addMessageReaction),
/* harmony export */   subtractXForEmojiInteraction: () => (/* binding */ subtractXForEmojiInteraction),
/* harmony export */   updateUnreadReactions: () => (/* binding */ updateUnreadReactions)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../components/middle/helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./chats */ "./src/global/reducers/chats.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./messages */ "./src/global/reducers/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");








function getLeftColumnWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.25, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.33);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.33, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.4);
  }
  return _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.SIDE_COLUMN_MAX_WIDTH;
}
function subtractXForEmojiInteraction(global, x) {
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  return x - (tabState.isLeftColumnShown && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__.getIsMobile)() ? global.leftColumnWidth || getLeftColumnWidth(_util_windowSize__WEBPACK_IMPORTED_MODULE_1__["default"].get().width) : 0);
}
function addMessageReaction(global, message, userReactions) {
  const isInSavedMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsChatWithSelf)(global, message.chatId);
  const currentReactions = message.reactions || {
    results: [],
    areTags: isInSavedMessages
  };
  const currentSendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSendAs)(global, message.chatId);

  // Update UI without waiting for server response
  const results = (0,_helpers__WEBPACK_IMPORTED_MODULE_3__.updateReactionCount)(currentReactions.results, userReactions);
  let {
    recentReactions = []
  } = currentReactions;
  if (recentReactions.length) {
    recentReactions = recentReactions.filter(_ref => {
      let {
        isOwn,
        peerId
      } = _ref;
      return !isOwn && peerId !== global.currentUserId;
    });
  }
  userReactions.forEach(reaction => {
    const {
      currentUserId
    } = global;
    recentReactions.unshift({
      peerId: currentSendAs?.id || currentUserId,
      reaction,
      addedDate: Math.floor(Date.now() / 1000),
      isOwn: true
    });
  });
  return (0,_messages__WEBPACK_IMPORTED_MODULE_6__.updateChatMessage)(global, message.chatId, message.id, {
    reactions: {
      ...currentReactions,
      results,
      recentReactions
    }
  });
}
function updateUnreadReactions(global, chatId, update) {
  return (0,_chats__WEBPACK_IMPORTED_MODULE_5__.updateChat)(global, chatId, update, undefined, true);
}

/***/ }),

/***/ "./src/hooks/useCacheBuster.ts":
/*!*************************************!*\
  !*** ./src/hooks/useCacheBuster.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");

const useCacheBuster = () => {
  const [cacheBuster, setCacheBuster] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const updateCacheBuster = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setCacheBuster(current => current + 1);
  }, []);
  return [cacheBuster, updateCacheBuster];
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useCacheBuster);

/***/ }),

/***/ "./src/hooks/useConnectionStatus.ts":
/*!******************************************!*\
  !*** ./src/hooks/useConnectionStatus.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ConnectionStatus: () => (/* binding */ ConnectionStatus),
/* harmony export */   "default": () => (/* binding */ useConnectionStatus)
/* harmony export */ });
/* harmony import */ var _window_useBrowserOnline__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./window/useBrowserOnline */ "./src/hooks/window/useBrowserOnline.ts");

let ConnectionStatus = /*#__PURE__*/function (ConnectionStatus) {
  ConnectionStatus[ConnectionStatus["waitingForNetwork"] = 0] = "waitingForNetwork";
  ConnectionStatus[ConnectionStatus["syncing"] = 1] = "syncing";
  ConnectionStatus[ConnectionStatus["online"] = 2] = "online";
  return ConnectionStatus;
}({});
function useConnectionStatus(lang, connectionState, isSyncing, hasMiddleHeader, isMinimized, isDisabled) {
  let status;
  const isBrowserOnline = (0,_window_useBrowserOnline__WEBPACK_IMPORTED_MODULE_0__["default"])();
  if (!isBrowserOnline || connectionState === 'connectionStateConnecting') {
    status = ConnectionStatus.waitingForNetwork;
  } else if (isSyncing) {
    status = ConnectionStatus.syncing;
  } else {
    status = ConnectionStatus.online;
  }
  let position;
  if (status === ConnectionStatus.online || isDisabled) {
    position = 'none';
  } else if (hasMiddleHeader) {
    position = 'middleHeader';
  } else if (isMinimized) {
    position = 'minimized';
  } else {
    position = 'overlay';
  }
  let text;
  if (status === ConnectionStatus.waitingForNetwork) {
    text = lang('WaitingForNetwork');
  } else if (status === ConnectionStatus.syncing) {
    text = lang('Updating');
  }
  if (position === 'middleHeader') {
    text = text.toLowerCase().replace(/\.+$/, '');
  }
  return {
    connectionStatus: status,
    connectionStatusPosition: position,
    connectionStatusText: text
  };
}

/***/ }),

/***/ "./src/hooks/useCustomBackground.ts":
/*!******************************************!*\
  !*** ./src/hooks/useCustomBackground.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _util_cacheApi__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/cacheApi */ "./src/util/cacheApi.ts");
/* harmony import */ var _util_files__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/files */ "./src/util/files.ts");





const useCustomBackground = (theme, settingValue) => {
  const {
    setThemeSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [value, setValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(settingValue);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!settingValue) {
      return;
    }
    if (settingValue.startsWith('#')) {
      setValue(settingValue);
    } else {
      _util_cacheApi__WEBPACK_IMPORTED_MODULE_3__.fetch(_config__WEBPACK_IMPORTED_MODULE_2__.CUSTOM_BG_CACHE_NAME, theme, _util_cacheApi__WEBPACK_IMPORTED_MODULE_3__.Type.Blob).then(blob => {
        const url = URL.createObjectURL(blob);
        (0,_util_files__WEBPACK_IMPORTED_MODULE_4__.preloadImage)(url).then(() => {
          setValue(`url(${url})`);
        });
      }).catch(() => {
        setThemeSettings({
          theme,
          background: undefined,
          backgroundColor: undefined,
          isBlurred: true,
          patternColor: theme === 'dark' ? _config__WEBPACK_IMPORTED_MODULE_2__.DARK_THEME_PATTERN_COLOR : _config__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_PATTERN_COLOR
        });
      });
    }
  }, [settingValue, theme]);
  return settingValue ? value : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useCustomBackground);

/***/ }),

/***/ "./src/hooks/useMessageMediaMetadata.ts":
/*!**********************************************!*\
  !*** ./src/hooks/useMessageMediaMetadata.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_imageResize__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/imageResize */ "./src/util/imageResize.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../components/common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _useAsync__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./useAsync */ "./src/hooks/useAsync.ts");
/* harmony import */ var _useMedia__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../assets/telegram-logo-filled.svg */ "./src/assets/telegram-logo-filled.svg");









const LOGO_DIMENSIONS = {
  width: 200,
  height: 200
};
const MINIMAL_SIZE = 115; // spec says 100, but on Chrome 93 it's not showing

// TODO Add support for video in future
const useMessageMediaMetadata = (message, sender, chat) => {
  const lang = (0,_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    audio,
    voice
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message);
  const title = audio ? audio.title || audio.fileName : voice ? 'Voice message' : '';
  const artist = audio?.performer || sender && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getSenderTitle)(lang, sender);
  const album = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatTitle)(lang, chat) || 'Telegram';
  const audioCoverHash = audio && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getAudioHasCover)(audio) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaHash)(audio, 'pictogram');
  const avatarHash = sender && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatAvatarHash)(sender, 'big');
  const hash = audio && audioCoverHash || voice && avatarHash;
  const media = (0,_useMedia__WEBPACK_IMPORTED_MODULE_6__["default"])(hash);
  const size = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return getCoverSize(audio, voice, media);
  }, [audio, media, voice]);
  const {
    result: url
  } = (0,_useAsync__WEBPACK_IMPORTED_MODULE_5__["default"])(() => makeGoodArtwork(media, size), [media, size], _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_8__);
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_3__.buildMediaMetadata)({
      title,
      artist,
      album,
      artwork: [{
        src: url
      }]
    });
  }, [album, artist, title, url]);
};
function makeGoodArtwork(url, size) {
  if (!url) return Promise.resolve(_assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_8__);
  if (!size) return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_2__.resizeImage)(url, MINIMAL_SIZE, MINIMAL_SIZE);
  const min = Math.min(size.width, size.height);
  if (min < MINIMAL_SIZE) {
    const ratio = MINIMAL_SIZE / min;
    return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_2__.scaleImage)(url, ratio);
  }
  return Promise.resolve(url);
}
function getCoverSize(audio, voice, url) {
  if (!url) return LOGO_DIMENSIONS;
  if (audio) {
    if (!audio.thumbnailSizes?.length) return undefined;
    const preferred = audio.thumbnailSizes.find(size => size.type === 'm');
    return preferred || audio.thumbnailSizes[0]; // Sometimes `m` is not present
  }
  if (voice) {
    return _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.AVATAR_FULL_DIMENSIONS;
  }
  return undefined;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useMessageMediaMetadata);

/***/ }),

/***/ "./src/hooks/useNativeCopySelectedMessages.ts":
/*!****************************************************!*\
  !*** ./src/hooks/useNativeCopySelectedMessages.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_getMessageIdsForSelectedText__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../util/getMessageIdsForSelectedText */ "./src/util/getMessageIdsForSelectedText.ts");
/* harmony import */ var _useHotkeys__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useHotkeys */ "./src/hooks/useHotkeys.ts");


const useNativeCopySelectedMessages = copyMessagesByIds => {
  function handleCopy(e) {
    const messageIds = (0,_util_getMessageIdsForSelectedText__WEBPACK_IMPORTED_MODULE_0__["default"])();
    if (messageIds && messageIds.length > 1) {
      e.preventDefault();
      copyMessagesByIds({
        messageIds
      });
    }
  }
  (0,_useHotkeys__WEBPACK_IMPORTED_MODULE_1__.useHotkeys)({
    'Mod+C': handleCopy
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useNativeCopySelectedMessages);

/***/ }),

/***/ "./src/hooks/usePreventPinchZoomGesture.ts":
/*!*************************************************!*\
  !*** ./src/hooks/usePreventPinchZoomGesture.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePreventPinchZoomGesture)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/windowEnvironment */ "./src/util/windowEnvironment.ts");


const metaViewport = document.querySelector('meta[name="viewport"]');
const defaultViewportContent = metaViewport?.getAttribute('content') || '';
const allowedZoomViewportContent = 'width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover';
function usePreventPinchZoomGesture() {
  let isDisabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV) {
      return undefined;
    }
    if (isDisabled) {
      // Clean viewport content from values values that disable the ability to zoom a webpage
      // https://web.dev/meta-viewport/
      metaViewport?.setAttribute('content', allowedZoomViewportContent);
      return undefined;
    }
    metaViewport?.setAttribute('content', defaultViewportContent);

    // Since iOS 10 `user-scaleable=no` is disabled in Safari for iOS,
    // this is only applicable for the browser and does not apply to the PWA mode.
    // https://newbedev.com/how-do-you-disable-viewport-zooming-on-mobile-safari
    if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
      document.addEventListener('gesturestart', preventEvent);
    }
    return () => {
      metaViewport?.setAttribute('content', 'width=device-width, initial-scale=1, shrink-to-fit=no');
      if (_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
        document.removeEventListener('gesturestart', preventEvent);
      }
    };
  }, [isDisabled]);
}
function preventEvent(e) {
  e.preventDefault();
}

/***/ }),

/***/ "./src/hooks/usePrevious2.ts":
/*!***********************************!*\
  !*** ./src/hooks/usePrevious2.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePrevious2)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");


// This is not render-dependent and will never allow previous to match current
function usePrevious2(current) {
  const prevRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lastRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  if (lastRef.current !== current) {
    prevRef.current = lastRef.current;
  }
  lastRef.current = current;
  return prevRef.current;
}

/***/ }),

/***/ "./src/hooks/useResize.ts":
/*!********************************!*\
  !*** ./src/hooks/useResize.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useResize: () => (/* binding */ useResize)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _useFlag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");




function useResize(elementRef, onResize, onReset, initialWidth, cssPropertyName) {
  const [isActive, markIsActive, unmarkIsActive] = (0,_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const [initialMouseX, setInitialMouseX] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [initialElementWidth, setInitialElementWidth] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const setElementStyle = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(width => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (!elementRef.current) {
        return;
      }
      const widthPx = width ? `${width}px` : '';
      elementRef.current.style.width = widthPx;
      if (cssPropertyName) {
        elementRef.current.style.setProperty(cssPropertyName, widthPx);
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!elementRef.current || !initialWidth) {
      return;
    }
    setElementStyle(initialWidth);
  }, [cssPropertyName, elementRef, initialWidth, setElementStyle]);
  function handleMouseUp() {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.remove('cursor-ew-resize');
    });
  }
  function initResize(e) {
    e.preventDefault();
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.add('cursor-ew-resize');
    });
    setInitialMouseX(e.clientX);
    setInitialElementWidth(elementRef.current.offsetWidth);
    markIsActive();
  }
  function resetResize(e) {
    e.preventDefault();
    setElementStyle(undefined);
    onReset();
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive) return undefined;
    const handleMouseMove = e => {
      const newWidth = Math.ceil(initialElementWidth + e.clientX - initialMouseX);
      setElementStyle(newWidth);
    };
    function stopDrag() {
      cleanup();
      onResize(elementRef.current.offsetWidth);
    }
    function cleanup() {
      handleMouseUp();
      document.removeEventListener('mousemove', handleMouseMove, false);
      document.removeEventListener('mouseup', stopDrag, false);
      document.removeEventListener('blur', stopDrag, false);
      unmarkIsActive();
    }
    document.addEventListener('mousemove', handleMouseMove, false);
    document.addEventListener('mouseup', stopDrag, false);
    document.addEventListener('blur', stopDrag, false);
    return cleanup;
  }, [initialElementWidth, initialMouseX, elementRef, onResize, isActive, unmarkIsActive, setElementStyle]);
  return {
    initResize,
    resetResize,
    handleMouseUp
  };
}

/***/ }),

/***/ "./src/hooks/useTextLanguage.ts":
/*!**************************************!*\
  !*** ./src/hooks/useTextLanguage.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTextLanguage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_languageDetection__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/languageDetection */ "./src/util/languageDetection.ts");


function useTextLanguage(text, isDisabled, getIsReady) {
  const [language, setLanguage] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || getIsReady && !getIsReady()) return;
    if (text) {
      (0,_util_languageDetection__WEBPACK_IMPORTED_MODULE_1__.detectLanguage)(text).then(setLanguage);
    } else {
      setLanguage(undefined);
    }
  }, [isDisabled, text, getIsReady]);
  return language;
}

/***/ }),

/***/ "./src/hooks/window/useBrowserOnline.ts":
/*!**********************************************!*\
  !*** ./src/hooks/window/useBrowserOnline.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useBrowserOnline)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");

function useBrowserOnline() {
  const [isOnline, setIsOnline] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(window.navigator.onLine);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function handleChange() {
      setIsOnline(window.navigator.onLine);
    }
    window.addEventListener('online', handleChange);
    window.addEventListener('offline', handleChange);
    return () => {
      window.removeEventListener('offline', handleChange);
      window.removeEventListener('online', handleChange);
    };
  }, []);
  return isOnline;
}

/***/ }),

/***/ "./src/nreach/helpers.ts":
/*!*******************************!*\
  !*** ./src/nreach/helpers.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   newMessageUpdateCrm: () => (/* binding */ newMessageUpdateCrm),
/* harmony export */   updateCrmWithTimeout: () => (/* binding */ updateCrmWithTimeout),
/* harmony export */   updateUnreadMessages: () => (/* binding */ updateUnreadMessages)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _global_actions_api_chats__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global/actions/api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../global/selectors */ "./src/global/selectors/index.ts");



const handleChannelType = channelName => {
  if (/^\+/.test(channelName)) {
    return 'phone';
  } else if (/^-?\d+(\.\d+)?$/.test(channelName)) {
    return 'userId';
  }
  return 'username';
};
async function updateUnreadMessages(global, telegramToEids) {
  let newMessage = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  const eidsToUpdate = {};
  const localStorageMapper = {};
  for (const [telegramId, eid] of Object.entries(telegramToEids)) {
    const telegramType = handleChannelType(telegramId);
    let chat;
    switch (telegramType) {
      case 'phone':
        chat = await (0,_global_actions_api_chats__WEBPACK_IMPORTED_MODULE_1__.fetchChatByPhoneNumber)(global, telegramId);
        break;
      case 'userId':
        chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, telegramId);
        break;
      case 'username':
        chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatByUsername)(global, telegramId);
        break;
    }
    if (chat) {
      let count = 0;
      if (newMessage) {
        count = chat?.unreadCount || 0;
      } else {
        count = chat.unreadCount || 0;
      }
      eidsToUpdate[eid] = count;
      localStorageMapper[chat.id] = {
        eid,
        crmTelegramId: telegramId
      };
    }
  }
  localStorage.setItem('crmMapper', JSON.stringify(localStorageMapper));
  window.parent.postMessage({
    type: 'UpdateUnreadMessages',
    dataToUpdate: JSON.stringify(eidsToUpdate)
  }, '*');
  // setTimeout(() => { updateCrmWithTimeout(); }, 20000);
  // updateCrmWithTimeout();
}
async function newMessageUpdateCrm(global, chatId) {
  const localstorageMapperString = localStorage.getItem('crmMapper');
  if (!localstorageMapperString) return;
  const localStorageMapper = JSON.parse(localstorageMapperString);
  const chat = localStorageMapper[chatId];
  if (!chat) return;
  const chatToUpdate = {
    [chat.crmTelegramId]: chat.eid
  };
  const global2 = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  await updateUnreadMessages(global2, chatToUpdate, true);
}
function updateCrmWithTimeout(global, telegramToEids) {
  // eslint-disable-next-line no-console
  console.log('starting to updateCrmWithTimeout function');
  if (!telegramToEids) {
    const localstorageMapperString = localStorage.getItem('crmMapper');
    if (!localstorageMapperString) return;
    const localStorageMapper = JSON.parse(localstorageMapperString);
    telegramToEids = {};
    for (const [chatId, data] of Object.entries(localStorageMapper)) {
      // @ts-ignore
      telegramToEids[chatId] = data.eid;
    }
    global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  }
  updateUnreadMessages(global, telegramToEids).then(() => {
    setTimeout(updateCrmWithTimeout, 20000);
  }).catch(() => {
    setTimeout(updateCrmWithTimeout, 20000);
  });
}

// export function processChatData(chatData: Record<string, ApiChat>): Record<string, any> {
//   const result: Record<string, any> = {};
//
//   Object.values(chatData).forEach(item => {
//     let key: string = item.id; // Default key
//     if (item.usernames && item.usernames.length > 0) {
//       const activeUser = item.usernames.find(u => u.isActive);
//       if (activeUser) {
//         key = activeUser.username; // Use username if active
//       }
//     }
//     result[key] = item.unreadCount || 0;
//   });
//
//   return result;
// }

/***/ }),

/***/ "./src/util/PopupManager.ts":
/*!**********************************!*\
  !*** ./src/util/PopupManager.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PopupManager)
/* harmony export */ });
/* harmony import */ var _windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./windowEnvironment */ "./src/util/windowEnvironment.ts");
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }

const SHOULD_PRE_OPEN = _windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_IOS || _windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_ANDROID;
class PopupManager {
  constructor(features, onFail) {
    this.features = features;
    this.onFail = onFail;
    _defineProperty(this, "preOpened", void 0);
  }
  preOpenIfNeeded() {
    if (!SHOULD_PRE_OPEN) return;
    this.preOpened = window.open('about:blank', undefined, this.features);
    if (this.preOpened) {
      this.preOpened.blur();
    } else {
      this.onFail?.();
    }
  }
  open(url) {
    if (this.preOpened) {
      this.preOpened.location.href = url;
      this.preOpened.focus();
      this.preOpened = undefined;
      return;
    }
    if (!SHOULD_PRE_OPEN) {
      const popup = window.open(url, undefined, this.features);
      if (popup) {
        popup.focus();
      } else {
        this.onFail?.();
      }
    }
  }
  cancelPreOpen() {
    this.preOpened?.close();
    this.preOpened = undefined;
  }
}

/***/ }),

/***/ "./src/util/getIsAppUpdateNeeded.ts":
/*!******************************************!*\
  !*** ./src/util/getIsAppUpdateNeeded.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getIsAppUpdateNeeded)
/* harmony export */ });
const APP_VERSION_REGEX = /^\d+\.\d+(\.\d+)?$/;
function getIsAppUpdateNeeded(remoteVersion, appVersion, isStrict) {
  const sanitizedRemoteVersion = remoteVersion.trim();
  if (!APP_VERSION_REGEX.test(sanitizedRemoteVersion)) {
    return false;
  }
  if (isStrict) {
    return sanitizedRemoteVersion.localeCompare(appVersion, undefined, {
      numeric: true,
      sensitivity: 'base'
    }) === 1;
  }
  return sanitizedRemoteVersion !== appVersion;
}

/***/ }),

/***/ "./src/util/languageDetection.ts":
/*!***************************************!*\
  !*** ./src/util/languageDetection.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   detectLanguage: () => (/* binding */ detectLanguage),
/* harmony export */   detectLanguageProbability: () => (/* binding */ detectLanguageProbability)
/* harmony export */ });
/* harmony import */ var _windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./windowEnvironment */ "./src/util/windowEnvironment.ts");
/* harmony import */ var _Deferred__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Deferred */ "./src/util/Deferred.ts");
/* harmony import */ var _PostMessageConnector__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PostMessageConnector */ "./src/util/PostMessageConnector.ts");



const WORKER_INIT_DELAY = 4000;
const DEFAULT_THRESHOLD = 0.2;
const DEFAULT_LABELS_COUNT = 5;
let worker;
const initializationDeferred = new _Deferred__WEBPACK_IMPORTED_MODULE_1__["default"]();
if (_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_TRANSLATION_SUPPORTED) {
  setTimeout(initWorker, WORKER_INIT_DELAY);
}
function initWorker() {
  if (!worker) {
    worker = (0,_PostMessageConnector__WEBPACK_IMPORTED_MODULE_2__.createConnector)(new Worker(new URL(/* worker import */ __webpack_require__.p + __webpack_require__.u("src_lib_fasttextweb_fasttext_worker_ts"), __webpack_require__.b)));
    initializationDeferred.resolve();
  }
}
async function detectLanguage(text) {
  let threshold = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_THRESHOLD;
  if (!worker) await initializationDeferred.promise;
  const result = await worker.request({
    name: 'detectLanguage',
    args: [text, threshold]
  });
  return result;
}
async function detectLanguageProbability(text) {
  let labelsCount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_LABELS_COUNT;
  let threshold = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DEFAULT_THRESHOLD;
  if (!worker) await initializationDeferred.promise;
  const result = await worker.request({
    name: 'detectLanguageProbability',
    args: [text, labelsCount, threshold]
  });
  return result;
}

/***/ }),

/***/ "./src/util/payments/stripe.ts":
/*!*************************************!*\
  !*** ./src/util/payments/stripe.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getStripeError: () => (/* binding */ getStripeError)
/* harmony export */ });
const STRIPE_ERRORS = {
  missing_payment_information: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  invalid_number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  exp_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  exp_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  invalid_expiry_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  invalid_expiry_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  },
  invalid_cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  }
};
function getStripeError(error) {
  const {
    message: description,
    code,
    param
  } = error;
  const {
    field,
    message
  } = param ? STRIPE_ERRORS[param] : STRIPE_ERRORS[code];
  return {
    field,
    message,
    description
  };
}

/***/ }),

/***/ "./src/util/requestQuery.ts":
/*!**********************************!*\
  !*** ./src/util/requestQuery.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildQueryString: () => (/* binding */ buildQueryString)
/* harmony export */ });
function buildQueryString(data) {
  const query = Object.keys(data).map(k => `${k}=${data[k]}`).join('&');
  return query.length > 0 ? `?${query}` : '';
}

/***/ }),

/***/ "./src/util/updateIcon.ts":
/*!********************************!*\
  !*** ./src/util/updateIcon.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ updateIcon)
/* harmony export */ });
function updateIcon(asUnread) {
  document.querySelectorAll('link[rel="icon"], link[rel="alternate icon"]').forEach(link => {
    if (asUnread) {
      if (!link.href.includes('favicon-unread')) {
        link.href = link.href.replace('favicon', 'favicon-unread');
      }
    } else {
      link.href = link.href.replace('favicon-unread', 'favicon');
    }
  });
}

/***/ }),

/***/ "./src/util/updatePageTitle.ts":
/*!*************************************!*\
  !*** ./src/util/updatePageTitle.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   setPageTitle: () => (/* binding */ setPageTitle),
/* harmony export */   setPageTitleInstant: () => (/* binding */ setPageTitleInstant)
/* harmony export */ });
/* harmony import */ var _schedulers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./windowEnvironment */ "./src/util/windowEnvironment.ts");


const UPDATE_DEBOUNCE_MS = 200;

// For some reason setting `document.title` to the same value
// causes increment of Chrome Dev Tools > Performance Monitor > DOM Nodes counter
function setPageTitleInstant(nextTitle) {
  if (_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_ELECTRON) {
    window.electron.setWindowTitle(nextTitle);
    return;
  }
  if (document.title !== nextTitle) {
    document.title = nextTitle;
  }
}

// Synchronous page title update has conflicts with History API in Chrome
const setPageTitle = (0,_schedulers__WEBPACK_IMPORTED_MODULE_0__.debounce)(setPageTitleInstant, UPDATE_DEBOUNCE_MS, false);

/***/ }),

/***/ "./src/components/common/PeerColorWrapper.module.scss":
/*!************************************************************!*\
  !*** ./src/components/common/PeerColorWrapper.module.scss ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"nRjVJOQv"});

/***/ }),

/***/ "./src/components/common/TopicChip.module.scss":
/*!*****************************************************!*\
  !*** ./src/components/common/TopicChip.module.scss ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"JldIqqof"});

/***/ }),

/***/ "./src/components/left/ConnectionStatusOverlay.scss":
/*!**********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/LeftColumn.scss":
/*!*********************************************!*\
  !*** ./src/components/left/LeftColumn.scss ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/NewChatButton.scss":
/*!************************************************!*\
  !*** ./src/components/left/NewChatButton.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/main/LeftMain.scss":
/*!************************************************!*\
  !*** ./src/components/left/main/LeftMain.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/main/LeftMainHeader.scss":
/*!******************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.scss ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/main/ConfettiContainer.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/main/ConfettiContainer.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"e0JMk_Kh"});

/***/ }),

/***/ "./src/components/main/GameModal.scss":
/*!********************************************!*\
  !*** ./src/components/main/GameModal.scss ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/main/LockScreen.module.scss":
/*!****************************************************!*\
  !*** ./src/components/main/LockScreen.module.scss ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"bdKGCai4","wrapper":"BIi4Pl4Z","icon":"JwlsF2tF","help":"VlXFyC_a"});

/***/ }),

/***/ "./src/components/main/Main.scss":
/*!***************************************!*\
  !*** ./src/components/main/Main.scss ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/AudioPlayer.scss":
/*!************************************************!*\
  !*** ./src/components/middle/AudioPlayer.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/ChatReportPanel.scss":
/*!****************************************************!*\
  !*** ./src/components/middle/ChatReportPanel.scss ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/ContactGreeting.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/middle/ContactGreeting.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"osdROIcA","wrapper":"c3NtU3JZ","explainer":"WIbO6rja","title":"n2KO1cAv","description":"MVSedxKc","sticker":"qsfxNv7L"});

/***/ }),

/***/ "./src/components/middle/FloatingActionButtons.module.scss":
/*!*****************************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.module.scss ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"VWoOZCD5","hidden":"UMXbiYB3","reactions":"eO_Fz8SD","transform-down":"gn3iLVq1","transformDown":"gn3iLVq1","unread":"u62x81QI","revealed":"iozW83la","no-composer":"yzzjqibi","noComposer":"yzzjqibi","no-extra-shift":"wDwOdyQH","noExtraShift":"wDwOdyQH","hide-scroll-down":"UBa5kAK5","hideScrollDown":"UBa5kAK5","is-symbol-menu-open":"qoyRzwL6","isSymbolMenuOpen":"qoyRzwL6"});

/***/ }),

/***/ "./src/components/middle/HeaderPinnedMessage.module.scss":
/*!***************************************************************!*\
  !*** ./src/components/middle/HeaderPinnedMessage.module.scss ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Guj4V7W_","pinnedMessage":"GgG7nh8p","messageText":"LPdDfCw0","loading":"clu9vjEC","pinListIcon":"OibpUlOd","pinListIconHidden":"_f3hwC8p","no-hover":"Nki3ifmz","noHover":"Nki3ifmz","messageTextTransition":"lo853Tki","withMedia":"hRtSF_Ex","title":"bY9umAoY","summary":"Ko14czNN","inlineButton":"lfWlkB7k","pictogramTransition":"ud4LJMTI","pinnedThumb":"_M8tJtJD","pinnedThumbImage":"KKUhI313","fade-in":"cq06IGIL","fadeIn":"cq06IGIL"});

/***/ }),

/***/ "./src/components/middle/MessageList.scss":
/*!************************************************!*\
  !*** ./src/components/middle/MessageList.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/MessageListBotInfo.module.scss":
/*!**************************************************************!*\
  !*** ./src/components/middle/MessageListBotInfo.module.scss ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"sqThK406","bot-info":"XhDB6LWO","botInfo":"XhDB6LWO","bot-info-description":"lbMO1XqP","botInfoDescription":"lbMO1XqP","bot-info-title":"ELYpyMpR","botInfoTitle":"ELYpyMpR","media":"zLLIV9Iw"});

/***/ }),

/***/ "./src/components/middle/MiddleColumn.module.scss":
/*!********************************************************!*\
  !*** ./src/components/middle/MiddleColumn.module.scss ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"background":"C6IaXYew","customBgImage":"K1xhz7U5","customBgColor":"CwoXMwaR","withTransition":"nXhZtCma","draggable":"jMpPshUt","blurred":"JBrOVLsX","withRightColumn":"Lyw3O8XE"});

/***/ }),

/***/ "./src/components/middle/MiddleColumn.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleColumn.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/MiddleHeader.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleHeader.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/NoMessages.scss":
/*!***********************************************!*\
  !*** ./src/components/middle/NoMessages.scss ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/PinnedMessageNavigation.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"pinned-message-border":"L5TQCriM","pinnedMessageBorder":"L5TQCriM","pinned-message-border-wrapper-1":"v5sJGzfS","pinnedMessageBorderWrapper1":"v5sJGzfS","pinned-message-border-wrapper":"p6PQhvds","pinnedMessageBorderWrapper":"p6PQhvds","pinned-message-border-mark":"M2PQZgBd","pinnedMessageBorderMark":"M2PQZgBd"});

/***/ }),

/***/ "./src/components/middle/PremiumRequiredMessage.module.scss":
/*!******************************************************************!*\
  !*** ./src/components/middle/PremiumRequiredMessage.module.scss ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"tFp81o13","button":"KJVF1etk","disabled":"Mii8vuoC","inner":"xzZFmIqC","icons-container":"vyeCoKP3","iconsContainer":"vyeCoKP3","animated-unlock":"YVmR5pRi","animatedUnlock":"YVmR5pRi","comments-icon":"ouB5dgHN","commentsIcon":"ouB5dgHN","description":"oEQISdJD"});

/***/ }),

/***/ "./src/components/middle/ScrollDownButton.module.scss":
/*!************************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.module.scss ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Y2NKrpKj","button":"cxwA6gDO","icon":"F4zNUFhH","unread-count":"GovSzpfQ","unreadCount":"GovSzpfQ"});

/***/ }),

/***/ "./src/components/middle/message/Album.scss":
/*!**************************************************!*\
  !*** ./src/components/middle/message/Album.scss ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/AnimatedEmoji.scss":
/*!**********************************************************!*\
  !*** ./src/components/middle/message/AnimatedEmoji.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/CommentButton.scss":
/*!**********************************************************!*\
  !*** ./src/components/middle/message/CommentButton.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/Contact.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/middle/message/Contact.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"AAHWWWvU","info-container":"tpDpg82n","infoContainer":"tpDpg82n","info":"fpYynE5s","name":"_PNTJc_V","phone":"JP_3wes8","divider":"_OSJcuqH","buttons":"Blui4M4G","button":"ReDHhQHm","disabled":"XAeKpuIZ","emoji-icon-background":"SjZYi3sJ","emojiIconBackground":"SjZYi3sJ"});

/***/ }),

/***/ "./src/components/middle/message/FactCheck.module.scss":
/*!*************************************************************!*\
  !*** ./src/components/middle/message/FactCheck.module.scss ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"HMB5LgeX","title":"vZnCPl3t","content":"k_dGolcu","separator":"qRaSs5iA","footnote":"EDmr0wJG","collapsed":"hYzpXwTM","cutoutWrapper":"nfCzKu78","collapseIcon":"mxPizZpR","clickable":"Cj2cLczd"});

/***/ }),

/***/ "./src/components/middle/message/Game.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/message/Game.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/Giveaway.module.scss":
/*!************************************************************!*\
  !*** ./src/components/middle/message/Giveaway.module.scss ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"CbpKtOey","title":"ogvcv3mr","sticker":"hjjKhvVv","resultSticker":"JEiR48jJ","count":"n_QCMv_A","section":"MSFa9BPf","description":"HfZ6SuLI","peers":"rPyyNYxK","peer":"FV70u896","button":"jMBw7STU","result":"ZQ4aVVkI","separator":"ao0x1YnS"});

/***/ }),

/***/ "./src/components/middle/message/InlineButtons.scss":
/*!**********************************************************!*\
  !*** ./src/components/middle/message/InlineButtons.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/Invoice.scss":
/*!****************************************************!*\
  !*** ./src/components/middle/message/Invoice.scss ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/InvoiceMediaPreview.module.scss":
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/InvoiceMediaPreview.module.scss ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"dCK8GQ_8","duration":"CWT8ZMwV","buy":"C38zhCDM","spoiler":"CG55VZP1"});

/***/ }),

/***/ "./src/components/middle/message/Location.scss":
/*!*****************************************************!*\
  !*** ./src/components/middle/message/Location.scss ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/Message.scss":
/*!****************************************************!*\
  !*** ./src/components/middle/message/Message.scss ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/MessageMeta.scss":
/*!********************************************************!*\
  !*** ./src/components/middle/message/MessageMeta.scss ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/MessagePhoneCall.module.scss":
/*!********************************************************************!*\
  !*** ./src/components/middle/message/MessagePhoneCall.module.scss ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"wqsZyy8u","button":"NGmo4ADz","info":"iFn6m6hd","reason":"l8QfocIQ","arrow":"ONmpzmUS","incoming":"BfgDXljM","missed":"Alra_BWu","canceled":"J7xsuCAm","meta":"rF5tkx92","duration":"kKPKwFzu"});

/***/ }),

/***/ "./src/components/middle/message/PaidMediaOverlay.module.scss":
/*!********************************************************************!*\
  !*** ./src/components/middle/message/PaidMediaOverlay.module.scss ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"mVaSjZRJ","buyButton":"GnKGu6D9","boughtStatus":"IGXW5hWr","star":"ywiOugiH","buttonText":"gLaaVQXr"});

/***/ }),

/***/ "./src/components/middle/message/Poll.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/message/Poll.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/PollOption.scss":
/*!*******************************************************!*\
  !*** ./src/components/middle/message/PollOption.scss ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/SponsoredMessage.scss":
/*!*************************************************************!*\
  !*** ./src/components/middle/message/SponsoredMessage.scss ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/message/Sticker.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/middle/message/Sticker.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"FPceNkgD","inactive":"hruUWBuj","mirrored":"GydRBA08","effect":"WMMaWlOL"});

/***/ }),

/***/ "./src/components/middle/message/reactions/Reactions.scss":
/*!****************************************************************!*\
  !*** ./src/components/middle/message/reactions/Reactions.scss ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/AddChatMembers.scss":
/*!**************************************************!*\
  !*** ./src/components/right/AddChatMembers.scss ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/Profile.scss":
/*!*******************************************!*\
  !*** ./src/components/right/Profile.scss ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/RightColumn.scss":
/*!***********************************************!*\
  !*** ./src/components/right/RightColumn.scss ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/RightHeader.scss":
/*!***********************************************!*\
  !*** ./src/components/right/RightHeader.scss ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/statistics/BoostStatistics.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"gk6pIryJ","noResults":"WP4wRUbm","section-header":"LWcgK3OX","sectionHeader":"LWcgK3OX","section":"C8KF95yU","user":"oMy5KOFr","stats":"GOzrl0zF","down":"QuLtxDUV","loadMoreSpinner":"ln5zB7KK","status":"r3zLiaXx","info":"Eo1qQlxx","month":"McSPvm0N","quantity":"s1yf_GJa","floatingBadge":"oSCjRZtx","floatingBadgeButtonColor":"duVpAT_e","floatingBadgeWarning":"DsJMXNNk","floatingBadgeButton":"urrWJVYB","floatingBadgeIcon":"hcA9VPeV","floatingBadgeValue":"hHkCO4Ge","content":"SG00REIA","boostSection":"ETgjBS4d","giveawayButton":"wOCtp5Kk","giveawayIcon":"B9GF4NDB"});

/***/ }),

/***/ "./src/components/story/MediaStory.module.scss":
/*!*****************************************************!*\
  !*** ./src/components/story/MediaStory.module.scss ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"kxMIqtqr","wrapper":"D6Yajvjx","media":"cV_QL3N5","expiredIcon":"cq7jTRkg","overlayIcon":"NOCaj4mx","pinnedIcon":"GTWFQyJx","viewsCount":"g09Rb4Ps","duration":"lM_2MMyQ","contextMenu":"UAfI9izT"});

/***/ }),

/***/ "./src/assets/map-pin.svg":
/*!********************************!*\
  !*** ./src/assets/map-pin.svg ***!
  \********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "map-pin.899635f6fe777c28998a.svg";

/***/ }),

/***/ "./src/assets/telegram-logo-filled.svg":
/*!*********************************************!*\
  !*** ./src/assets/telegram-logo-filled.svg ***!
  \*********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "telegram-logo-filled.67469f6dc5e301e8e0bd.svg";

/***/ }),

/***/ "./src/versionNotification.txt":
/*!*************************************!*\
  !*** ./src/versionNotification.txt ***!
  \*************************************/
/***/ ((module) => {

module.exports = "**Telegram Web A Digest**\n\nMany new features and useful optimizations have been added in recent months. Here is a brief overview of what's been happening in Web A since August.\n\n**September – November** \n\n✏️ __General__\n• [Reply Revolution](https://telegram.org/blog/reply-revolution#reply-revolution) – the app learned to quote specific parts of any message, making your responses 100% precise.\n• Also, [Quote Formatting](https://telegram.org/blog/reply-revolution#quote-formatting) have arrived.\n\n📣 __Channels__\n• Channels added [boosts](https://telegram.org/blog/channel-stories#stories-for-channels) and [giveaways.](https://telegram.org/blog/giveaways#free-telegram-premium) \n• Users also got an option to reassign their boosts between channels.\n\n🌄 __Stories__\n• Numerous improvements have been made to the animations flow, ensuring the stories bar expands more smoothly. Additionally, a package of optimizations has been added to enhance the performance of stories on mobile devices.\n• Stories have been introduced for [channels,](https://telegram.org/blog/channel-stories#stories-for-channels) and the story viewer has been updated with new gestures to expand and reply.\n\n⚙️ __Settings__\n• The app has added an option, 'Who can find me by phone number,' along with a setting under 'Privacy and Security' to manage the visibility of your bio.\n\n✨ __Extra__\n• Some further improvements have been made to the Mini Apps area.\n• New security notifications have been added to the chat list to alert you when your account is logged into from a new device.\n• New design for code blocks formatting.\n\n**December – February**\n\n✏️ __General__\n• [Saved Messages 2.0](https://telegram.org/blog/new-saved-messages-and-9-more#saved-messages-2-0) – including tags, My Notes, Replies and forwards from hidden authors.\n• [One-Time Voice Messages](https://telegram.org/blog/new-saved-messages-and-9-more#one-time-voice-and-video-messages) including both listening and recording. Added support for viewing One-Time Video Messages.\n• [Read-Time in Private Chats](https://telegram.org/blog/new-saved-messages-and-9-more#read-time-in-private-chats)\n• You can now replace media when editing messages.\n• The app learned to [preserve the selected mode](https://telegram.org/blog/similar-channels#improvements-for-topics) for topics in groups.\n• Whenever you create a small group, Web A suggests a name for it based on users' name you have added.\n\n📣 __Channels__ \n• Added [custom channel reactions.](https://telegram.org/blog/similar-channels#custom-reactions-for-channels)\n• Implemented [channel stories stats.](https://telegram.org/blog/similar-channels#story-stats-for-channels)\n• Channel emoji statuses.\n• [Similar Channels.](https://telegram.org/blog/similar-channels#similar-channels)\n\n👥 __Groups__\n• [9 new features for groups.](https://telegram.org/blog/february2024)\n\n🤖 __Bots__\n• Edit your bots info right from their profile.\n\n🌄 __Stories__\n• Added support for [forwarded stories](https://telegram.org/blog/posts-in-stories-and-more#view-reposts-and-more) and [channel posts in stories.](https://telegram.org/blog/posts-in-stories-and-more#share-posts-in-stories)\n\n✨ __Extra__\n• Giveaway Improvements: displaying winners list and additional prizes.\n\n**March**\n\n📣 __Channels__ \n• Admins will soon be able to launch giveaways in their channels.\n\n✨ __Extra__\n• Added support for Emoji v15.1.\n• Some design enhancements for shared contacts, links preview and more.\n";

/***/ })

}]);
//# sourceMappingURL=BundleMain.a369d8f24f6a1e646a55.js.map