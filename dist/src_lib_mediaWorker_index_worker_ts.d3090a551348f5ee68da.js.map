{"version":3,"file":"src_lib_mediaWorker_index_worker_ts.d3090a551348f5ee68da.js","mappings":"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ACA;UACA;UACA;UACA;UACA;UACA;;;;;WClCA;WACA;WACA;WACA;WACA,+BAA+B,wCAAwC;WACvE;WACA;WACA;WACA;WACA,iBAAiB,qBAAqB;WACtC;WACA;WACA,kBAAkB,qBAAqB;WACvC;WACA;WACA,KAAK;WACL;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WC3BA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA,8BAA8B,uLAAuL;WACrN;;;;;WCJA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WClBA;;WAEA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,aAAa;WACb;WACA;WACA;WACA;;WAEA;WACA;WACA;;WAEA;;WAEA;;;;;WCpCA;WACA;WACA;WACA;;;;;UEHA;UACA","sources":["webpack://telegram-t/./src/lib/mediaWorker/index.worker.ts","webpack://telegram-t/./src/lib/rlottie/rlottie.worker.ts","webpack://telegram-t/./src/lib/video-preview/MP4Demuxer.ts","webpack://telegram-t/./src/lib/video-preview/requestPart.ts","webpack://telegram-t/./src/lib/video-preview/video-preview.worker.ts","webpack://telegram-t/./src/util/callbacks.ts","webpack://telegram-t/./src/util/createPostMessageInterface.ts","webpack://telegram-t/./src/util/generateUniqueId.ts","webpack://telegram-t/./src/util/schedulers.ts","webpack://telegram-t/webpack/bootstrap","webpack://telegram-t/webpack/runtime/chunk loaded","webpack://telegram-t/webpack/runtime/compat get default export","webpack://telegram-t/webpack/runtime/define property getters","webpack://telegram-t/webpack/runtime/ensure chunk","webpack://telegram-t/webpack/runtime/get javascript chunk filename","webpack://telegram-t/webpack/runtime/get mini-css chunk filename","webpack://telegram-t/webpack/runtime/global","webpack://telegram-t/webpack/runtime/hasOwnProperty shorthand","webpack://telegram-t/webpack/runtime/make namespace object","webpack://telegram-t/webpack/runtime/publicPath","webpack://telegram-t/webpack/runtime/importScripts chunk loading","webpack://telegram-t/webpack/runtime/startup chunk dependencies","webpack://telegram-t/webpack/before-startup","webpack://telegram-t/webpack/startup","webpack://telegram-t/webpack/after-startup"],"sourcesContent":["import '../rlottie/rlottie.worker';\nimport '../video-preview/video-preview.worker';\n\nimport type { RLottieApi } from '../rlottie/rlottie.worker';\nimport type { VideoPreviewApi } from '../video-preview/video-preview.worker';\n\nexport type MediaWorkerApi =\n  RLottieApi\n  & VideoPreviewApi;\n","import { inflate } from 'pako/dist/pako_inflate';\n\nimport type { CancellableCallback } from '../../util/PostMessageConnector';\n\nimport { createWorkerInterface } from '../../util/createPostMessageInterface';\n\nimportScripts(new URL('./rlottie-wasm.js', import.meta.url));\n\ndeclare const Module: any;\n\ndeclare function allocate(...args: any[]): string;\n\ndeclare function intArrayFromString(str: String): string;\n\nlet rLottieApi: Record<string, Function>;\nconst rLottieApiPromise = new Promise<void>((resolve) => {\n  Module.onRuntimeInitialized = () => {\n    rLottieApi = {\n      init: Module.cwrap('lottie_init', '', []),\n      destroy: Module.cwrap('lottie_destroy', '', ['number']),\n      resize: Module.cwrap('lottie_resize', '', ['number', 'number', 'number']),\n      buffer: Module.cwrap('lottie_buffer', 'number', ['number']),\n      render: Module.cwrap('lottie_render', '', ['number', 'number']),\n      loadFromData: Module.cwrap('lottie_load_from_data', 'number', ['number', 'number']),\n    };\n\n    resolve();\n  };\n});\n\nconst HIGH_PRIORITY_MAX_FPS = 60;\nconst LOW_PRIORITY_MAX_FPS = 30;\nconst DESTROY_REPEAT_DELAY = 1000;\n\nconst renderers = new Map<string, {\n  imgSize: number;\n  reduceFactor: number;\n  handle: any;\n  imageData: ImageData;\n  customColor?: [number, number, number];\n}>();\n\nasync function init(\n  key: string,\n  tgsUrl: string,\n  imgSize: number,\n  isLowPriority: boolean,\n  customColor: [number, number, number] | undefined,\n  onInit: CancellableCallback,\n) {\n  if (!rLottieApi) {\n    await rLottieApiPromise;\n  }\n\n  const json = await extractJson(tgsUrl);\n  const stringOnWasmHeap = allocate(intArrayFromString(json), 'i8', 0);\n  const handle = rLottieApi.init();\n  const framesCount = rLottieApi.loadFromData(handle, stringOnWasmHeap);\n  rLottieApi.resize(handle, imgSize, imgSize);\n\n  const imageData = new ImageData(imgSize, imgSize);\n\n  const { reduceFactor, msPerFrame, reducedFramesCount } = calcParams(json, isLowPriority, framesCount);\n\n  renderers.set(key, {\n    imgSize, reduceFactor, handle, imageData, customColor,\n  });\n\n  onInit(reduceFactor, msPerFrame, reducedFramesCount);\n}\n\nasync function changeData(\n  key: string,\n  tgsUrl: string,\n  isLowPriority: boolean,\n  onInit: CancellableCallback,\n) {\n  if (!rLottieApi) {\n    await rLottieApiPromise;\n  }\n\n  const json = await extractJson(tgsUrl);\n  const stringOnWasmHeap = allocate(intArrayFromString(json), 'i8', 0);\n  const { handle } = renderers.get(key)!;\n  const framesCount = rLottieApi.loadFromData(handle, stringOnWasmHeap);\n\n  const { reduceFactor, msPerFrame, reducedFramesCount } = calcParams(json, isLowPriority, framesCount);\n\n  onInit(reduceFactor, msPerFrame, reducedFramesCount);\n}\n\nasync function extractJson(tgsUrl: string) {\n  const response = await fetch(tgsUrl);\n  const contentType = response.headers.get('Content-Type');\n\n  // Support deprecated JSON format cached locally\n  if (contentType?.startsWith('text/')) {\n    return response.text();\n  }\n\n  const arrayBuffer = await response.arrayBuffer();\n  return inflate(arrayBuffer, { to: 'string' });\n}\n\nfunction calcParams(json: string, isLowPriority: boolean, framesCount: number) {\n  const animationData = JSON.parse(json);\n  const maxFps = isLowPriority ? LOW_PRIORITY_MAX_FPS : HIGH_PRIORITY_MAX_FPS;\n  const sourceFps = animationData.fr || maxFps;\n  const reduceFactor = sourceFps % maxFps === 0 ? sourceFps / maxFps : 1;\n\n  return {\n    reduceFactor,\n    msPerFrame: 1000 / (sourceFps / reduceFactor),\n    reducedFramesCount: Math.ceil(framesCount / reduceFactor),\n  };\n}\n\nasync function renderFrames(\n  key: string, frameIndex: number, onProgress: CancellableCallback,\n) {\n  if (!rLottieApi) {\n    await rLottieApiPromise;\n  }\n\n  const {\n    imgSize, reduceFactor, handle, imageData, customColor,\n  } = renderers.get(key)!;\n\n  const realIndex = frameIndex * reduceFactor;\n\n  rLottieApi.render(handle, realIndex);\n  const bufferPointer = rLottieApi.buffer(handle);\n  const data = Module.HEAPU8.subarray(bufferPointer, bufferPointer + (imgSize * imgSize * 4));\n\n  if (customColor) {\n    const arr = new Uint8ClampedArray(data);\n    applyColor(arr, customColor);\n    imageData.data.set(arr);\n  } else {\n    imageData.data.set(data);\n  }\n\n  const imageBitmap = await createImageBitmap(imageData);\n\n  onProgress(frameIndex, imageBitmap);\n}\n\nfunction applyColor(arr: Uint8ClampedArray, color: [number, number, number]) {\n  for (let i = 0; i < arr.length; i += 4) {\n    arr[i] = color[0];\n    arr[i + 1] = color[1];\n    arr[i + 2] = color[2];\n  }\n}\n\nfunction destroy(key: string, isRepeated = false) {\n  try {\n    const renderer = renderers.get(key)!;\n    rLottieApi.destroy(renderer.handle);\n    renderers.delete(key);\n  } catch (err) {\n    // `destroy` sometimes can be called before the initialization is finished\n    if (!isRepeated) {\n      setTimeout(() => destroy(key, true), DESTROY_REPEAT_DELAY);\n    }\n  }\n}\n\nconst api = {\n  'rlottie:init': init,\n  'rlottie:changeData': changeData,\n  'rlottie:renderFrames': renderFrames,\n  'rlottie:destroy': destroy,\n};\n\ncreateWorkerInterface(api);\n\nexport type RLottieApi = typeof api;\n","import type { MP4ArrayBuffer, MP4Info, MP4VideoTrack } from 'mp4box';\nimport MP4Box, { DataStream } from 'mp4box';\n\nimport { requestPart } from './requestPart';\n\nconst META_PART_SIZE = 128 * 1024;\nconst MIN_PART_SIZE = 1024;\nenum Status {\n  loading = 'loading',\n  ready = 'ready',\n  closed = 'closed',\n}\n\nexport type MP4DecoderConfig = {\n  codec: string;\n  codedHeight: number;\n  codedWidth: number;\n  description: Uint8Array;\n};\n\ntype MP4DemuxerConfig = {\n  stepOffset: number;\n  stepMultiplier: number;\n  isPolyfill: boolean;\n  maxFrames: number;\n  onConfig: (config: any) => void;\n  onChunk: (chunk: any) => void;\n};\n\nexport class MP4Demuxer {\n  private readonly url: string;\n\n  private file: MP4Box.MP4File;\n\n  private status = Status.loading;\n\n  private readonly stepOffset: number;\n\n  private readonly stepMultiplier: number;\n\n  private readonly maxFrames: number;\n\n  private readonly isPolyfill: boolean;\n\n  private decodedSamples = new Set<string>();\n\n  private lastSample = 0;\n\n  private readonly onConfig: (config: MP4DecoderConfig) => void;\n\n  private readonly onChunk: (chunk: any) => void;\n\n  constructor(url: string, {\n    onConfig,\n    onChunk,\n    stepOffset,\n    stepMultiplier,\n    isPolyfill,\n    maxFrames,\n  }: MP4DemuxerConfig) {\n    this.url = url;\n    this.stepOffset = stepOffset;\n    this.stepMultiplier = stepMultiplier;\n    this.maxFrames = maxFrames;\n    this.isPolyfill = isPolyfill;\n    this.onConfig = onConfig;\n    this.onChunk = onChunk;\n\n    this.file = MP4Box.createFile();\n    this.file.onError = (e) => {\n      // eslint-disable-next-line no-console\n      console.error(e);\n    };\n    this.file.onReady = this.onReady.bind(this);\n    this.file.onSamples = this.onSamples.bind(this);\n\n    void this.loadMetadata();\n  }\n\n  private async loadMetadata() {\n    let offset: number | undefined = 0;\n    while (offset !== undefined) {\n      try {\n        offset = await this.requestPart(offset, META_PART_SIZE);\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.error(e);\n      }\n      if (this.status === Status.ready) break;\n    }\n  }\n\n  private async loadNextFrames(step: number, duration: number, partSize: number) {\n    let tick = step * this.stepOffset;\n    let lastSample = 0;\n    let rap = this.file.seek(tick, true);\n    while (this.status !== Status.closed) {\n      try {\n        await this.requestPart(rap.offset, partSize);\n        if (tick > duration) break;\n        if (this.lastSample > 1 && lastSample < this.lastSample) {\n          tick += step * this.stepMultiplier;\n          lastSample = this.lastSample;\n        }\n        rap = this.file.seek(tick, true);\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.error(e);\n      }\n    }\n    this.file.flush();\n  }\n\n  private async requestPart(offset: number, partSize: number, useRap = true) {\n    const reminder = (offset % MIN_PART_SIZE);\n    const start = offset - reminder;\n    const end = start + partSize - 1;\n    let arrayBuffer = await requestPart({ url: this.url, start, end }) as MP4ArrayBuffer;\n    if (!arrayBuffer) {\n      return undefined;\n    }\n    if (reminder) {\n      arrayBuffer = arrayBuffer.slice(reminder) as MP4ArrayBuffer;\n    }\n    arrayBuffer.fileStart = offset;\n    const nextOffset = this.file.appendBuffer(arrayBuffer);\n    if (!useRap) return offset + arrayBuffer.byteLength;\n    return nextOffset;\n  }\n\n  private description(track: MP4VideoTrack) {\n    const t = this.file.getTrackById(track.id);\n    for (const entry of t.mdia.minf.stbl.stsd.entries) {\n      if (entry.avcC || entry.hvcC || entry.av1C) {\n        const stream = new DataStream(undefined, 0, DataStream.BIG_ENDIAN);\n        if (entry.avcC) {\n          entry.avcC.write(stream);\n        } else if (entry.hvcC) {\n          entry.hvcC.write(stream);\n        } else if (entry.av1C) {\n          entry.av1C.write(stream);\n        }\n        return new Uint8Array(stream.buffer, 8); // Remove the box header.\n      }\n    }\n    throw new Error('avcC, hvcC ro av1C not found');\n  }\n\n  private onReady(info: MP4Info) {\n    const track = info.videoTracks[0];\n\n    let codec = track.codec;\n    if (codec.startsWith('avc1')) {\n      // Somehow this is the only avc1 codec that works.\n      codec = 'avc1.4d001f';\n    }\n\n    // Generate and emit an appropriate VideoDecoderConfig.\n    this.onConfig({\n      codec,\n      codedHeight: track.video.height,\n      codedWidth: track.video.width,\n      description: this.description(track),\n    });\n\n    const duration = info.duration / info.timescale;\n\n    // If we set a part size too small, the onSamples callback is not called.\n    // If we use polyfill, we need to set a smaller part size to avoid decoding multiple frames.\n    const partSizeDivider = this.isPolyfill ? 24 : 12;\n    const partSize = roundPartSize(track.bitrate / partSizeDivider);\n    const step = calculateStep(duration, this.maxFrames);\n\n    // Start demuxing.\n    this.file.setExtractionOptions(track.id, undefined, { nbSamples: 1 });\n    this.file.start();\n\n    this.status = Status.ready;\n\n    // // Load frames\n    void this.loadNextFrames(step, duration, partSize);\n  }\n\n  private onSamples(trackId: number, ref: any, samples: any) {\n    if (this.status !== Status.ready) return;\n    // Generate and emit an EncodedVideoChunk for each demuxed sample.\n    for (const sample of samples) {\n      const time = sample.cts / sample.timescale;\n      const type = sample.is_sync ? 'key' : 'delta';\n      const id = `${type}${sample.number}`;\n\n      // Skip already decoded samples.\n      if (this.decodedSamples.has(id)) continue;\n\n      // @ts-ignore\n      this.onChunk(new EncodedVideoChunk({\n        type,\n        timestamp: (1e6 * time),\n        duration: (1e6 * sample.duration) / sample.timescale,\n        data: sample.data,\n      }));\n\n      this.decodedSamples.add(id);\n      this.lastSample = parseInt(sample.number, 10);\n\n      if (sample.is_sync) {\n        this.file.releaseUsedSamples(trackId, sample.number);\n      }\n    }\n  }\n\n  close() {\n    this.file.flush();\n    this.file.stop();\n    this.status = Status.closed;\n  }\n}\n\nfunction roundPartSize(size: number) {\n  return size + MIN_PART_SIZE - (size % MIN_PART_SIZE);\n}\n\nfunction calculateStep(duration: number, max: number): number {\n  return Math.round((duration + max) / max);\n}\n","import generateUniqueId from '../../util/generateUniqueId';\nimport { pause } from '../../util/schedulers';\n\ndeclare const self: WorkerGlobalScope;\n\ntype RequestStates = {\n  resolve: (response: ArrayBuffer) => void;\n  reject: () => void;\n};\n\ntype RequestPartParams = { url: string; start: number; end: number };\n\nconst PART_TIMEOUT = 30000;\n\nconst requestStates = new Map<string, RequestStates>();\n\nexport function requestPart(params: RequestPartParams): Promise<ArrayBuffer | undefined> {\n  const messageId = generateUniqueId();\n  const requestState = {} as RequestStates;\n\n  let isResolved = false;\n  const promise = Promise.race([\n    pause(PART_TIMEOUT).then(() => (isResolved ? undefined : Promise.reject(new Error('ERROR_PART_TIMEOUT')))),\n    new Promise<ArrayBuffer>((resolve, reject) => {\n      Object.assign(requestState, { resolve, reject });\n    }),\n  ]);\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n      isResolved = true;\n    });\n\n  const message = {\n    type: 'requestPart',\n    messageId,\n    params,\n  };\n\n  postMessage(message);\n\n  return promise;\n}\n\nself.addEventListener('message', (e) => {\n  const { type, messageId, result } = (e as any).data as {\n    type: string;\n    messageId: string;\n    result: ArrayBuffer;\n  };\n\n  if (type === 'partResponse') {\n    const requestState = requestStates.get(messageId);\n    if (requestState) {\n      requestState.resolve(result);\n    }\n  }\n});\n","import type { CancellableCallback } from '../../util/PostMessageConnector';\n\nimport { createWorkerInterface } from '../../util/createPostMessageInterface';\n\nimport { MP4Demuxer } from './MP4Demuxer';\n\nlet decoder: any;\nlet demuxer: any;\nlet onDestroy: VoidFunction | undefined;\n\nfunction init(\n  url: string,\n  maxFrames: number,\n  workerIndex: number,\n  workersTotal: number,\n  onFrame: CancellableCallback,\n) {\n  const hasWebCodecs = 'VideoDecoder' in globalThis;\n  if (!hasWebCodecs) {\n    // eslint-disable-next-line no-console\n    console.log('[Video Preview] WebCodecs not supported');\n    return new Promise<void>((resolve) => {\n      onDestroy = resolve;\n    });\n  }\n\n  const decodedFrames = new Set<number>();\n\n  // @ts-ignore\n  decoder = new VideoDecoder({\n    async output(frame: any) {\n      const time = frame.timestamp / 1e6;\n      const seconds = Math.floor(time);\n      // Only render whole second frames\n      if (!decodedFrames.has(seconds)) {\n        const bitmap = await createImageBitmap(frame);\n        decodedFrames.add(seconds);\n        onFrame(seconds, bitmap);\n      }\n      frame.close();\n    },\n    error(e: any) {\n      // eslint-disable-next-line no-console\n      console.error('[Video Preview] error', e);\n    },\n  });\n\n  demuxer = new MP4Demuxer(url, {\n    stepOffset: workerIndex,\n    stepMultiplier: workersTotal,\n    isPolyfill: !hasWebCodecs,\n    maxFrames,\n    onConfig(config) {\n      decoder?.configure(config);\n    },\n    onChunk(chunk) {\n      if (decoder?.state !== 'configured') return;\n      decoder?.decode(chunk);\n    },\n  });\n\n  return new Promise<void>((resolve) => {\n    onDestroy = resolve;\n  });\n}\n\nfunction destroy() {\n  try {\n    decoder?.close();\n    demuxer?.close();\n  } catch {\n    // Ignore\n  }\n  decoder = undefined;\n  demuxer = undefined;\n  onDestroy?.();\n}\n\nconst api = {\n  'video-preview:init': init,\n  'video-preview:destroy': destroy,\n};\n\ncreateWorkerInterface(api);\n\nexport type VideoPreviewApi = typeof api;\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n","import type {\n  ApiUpdate,\n  CancellableCallback, OriginMessageData, OriginMessageEvent, WorkerMessageData,\n} from './PostMessageConnector';\n\nimport { DEBUG } from '../config';\nimport { createCallbackManager } from './callbacks';\n\ndeclare const self: WorkerGlobalScope;\n\nconst callbackState = new Map<string, CancellableCallback>();\n\ntype ApiConfig =\n  ((name: string, ...args: any[]) => any | [any, ArrayBuffer[]])\n  | Record<string, Function>;\ntype SendToOrigin = (data: WorkerMessageData, transferables?: Transferable[]) => void;\n\nconst messageHandlers = createCallbackManager();\nonmessage = messageHandlers.runCallbacks;\n\nexport function createWorkerInterface(api: ApiConfig, channel?: string) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      postMessage(data, transferables);\n    } else {\n      postMessage(data);\n    }\n  }\n\n  handleErrors(sendToOrigin);\n\n  messageHandlers.addCallback((message: OriginMessageEvent) => {\n    if (message.data?.channel === channel) {\n      onMessage(api, message.data, sendToOrigin);\n    }\n  });\n}\n\nasync function onMessage(\n  api: ApiConfig,\n  data: OriginMessageData,\n  sendToOrigin: SendToOrigin,\n  onUpdate?: (update: ApiUpdate) => void,\n) {\n  if (!onUpdate) {\n    onUpdate = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n  }\n\n  switch (data.type) {\n    case 'init': {\n      const { args } = data;\n      const promise = typeof api === 'function'\n        ? api('init', onUpdate, ...args)\n        : api.init?.(onUpdate, ...args);\n      await promise;\n\n      break;\n    }\n    case 'callMethod': {\n      const {\n        messageId, name, args, withCallback,\n      } = data;\n\n      try {\n        if (typeof api !== 'function' && !api[name]) return;\n\n        if (messageId && withCallback) {\n          const callback = (...callbackArgs: any[]) => {\n            const lastArg = callbackArgs[callbackArgs.length - 1];\n\n            sendToOrigin({\n              type: 'methodCallback',\n              messageId,\n              callbackArgs,\n            }, isTransferable(lastArg) ? [lastArg] : undefined);\n          };\n\n          callbackState.set(messageId, callback);\n\n          args.push(callback as never);\n        }\n\n        const response = typeof api === 'function'\n          ? await api(name, ...args)\n          : await api[name](...args);\n        const { arrayBuffer } = (typeof response === 'object' && 'arrayBuffer' in response && response) || {};\n        if (messageId) {\n          sendToOrigin(\n            {\n              type: 'methodResponse',\n              messageId,\n              response,\n            },\n            arrayBuffer ? [arrayBuffer] : undefined,\n          );\n        }\n      } catch (error: any) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.error(error);\n        }\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            error: { message: error.message },\n          });\n        }\n      }\n\n      if (messageId) {\n        callbackState.delete(messageId);\n      }\n\n      break;\n    }\n    case 'cancelProgress': {\n      const callback = callbackState.get(data.messageId);\n      if (callback) {\n        callback.isCanceled = true;\n      }\n\n      break;\n    }\n  }\n}\n\nfunction isTransferable(obj: any) {\n  return obj instanceof ArrayBuffer || obj instanceof ImageBitmap;\n}\n\nfunction handleErrors(sendToOrigin: SendToOrigin) {\n  self.onerror = (e) => {\n    // eslint-disable-next-line no-console\n    console.error(e);\n    sendToOrigin({ type: 'unhandledError', error: { message: e.error.message || 'Uncaught exception in worker' } });\n  };\n\n  self.addEventListener('unhandledrejection', (e) => {\n    // eslint-disable-next-line no-console\n    console.error(e);\n    sendToOrigin({ type: 'unhandledError', error: { message: e.reason.message || 'Uncaught rejection in worker' } });\n  });\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      // eslint-disable-next-line no-restricted-globals\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          // eslint-disable-next-line no-restricted-globals\n          self.clearInterval(interval!);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport function onIdle(cb: NoneToVoidFunction, timeout?: number) {\n  // eslint-disable-next-line no-restricted-globals\n  if (self.requestIdleCallback) {\n    // eslint-disable-next-line no-restricted-globals\n    self.requestIdleCallback(cb, { timeout });\n  } else {\n    onTickEnd(cb);\n  }\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [\"vendors-node_modules_pako_dist_pako_inflate_js\",\"vendors-node_modules_mp4box_dist_mp4box_all_js\",\"src_config_ts\"], () => (__webpack_require__(\"./src/lib/mediaWorker/index.worker.ts\")))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"vendors-node_modules_pako_dist_pako_inflate_js\":\"5f75bdcaf063c6c088d2\",\"vendors-node_modules_mp4box_dist_mp4box_all_js\":\"ae4c1ac754ab954b0df3\",\"src_config_ts\":\"d91d981f0690dbfe91a9\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = self.location + \"\";\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t\"src_lib_mediaWorker_index_worker_ts\": 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunktelegram_t\"] = self[\"webpackChunktelegram_t\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([\"vendors-node_modules_pako_dist_pako_inflate_js\",\"vendors-node_modules_mp4box_dist_mp4box_all_js\",\"src_config_ts\"].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n",""],"names":["inflate","createWorkerInterface","importScripts","URL","import","meta","url","rLottieApi","rLottieApiPromise","Promise","resolve","Module","onRuntimeInitialized","init","cwrap","destroy","resize","buffer","render","loadFromData","HIGH_PRIORITY_MAX_FPS","LOW_PRIORITY_MAX_FPS","DESTROY_REPEAT_DELAY","renderers","Map","key","tgsUrl","imgSize","isLowPriority","customColor","onInit","json","extractJson","stringOnWasmHeap","allocate","intArrayFromString","handle","framesCount","imageData","ImageData","reduceFactor","msPerFrame","reducedFramesCount","calcParams","set","changeData","get","response","fetch","contentType","headers","startsWith","text","arrayBuffer","to","animationData","JSON","parse","maxFps","sourceFps","fr","Math","ceil","renderFrames","frameIndex","onProgress","realIndex","bufferPointer","data","HEAPU8","subarray","arr","Uint8ClampedArray","applyColor","imageBitmap","createImageBitmap","color","i","length","isRepeated","arguments","undefined","renderer","delete","err","setTimeout","api","MP4Box","DataStream","requestPart","META_PART_SIZE","MIN_PART_SIZE","Status","MP4Demuxer","constructor","_ref","onConfig","onChunk","stepOffset","stepMultiplier","isPolyfill","maxFrames","_defineProperty","loading","Set","file","createFile","onError","e","console","error","onReady","bind","onSamples","loadMetadata","offset","status","ready","loadNextFrames","step","duration","partSize","tick","lastSample","rap","seek","closed","flush","useRap","reminder","start","end","slice","fileStart","nextOffset","appendBuffer","byteLength","description","track","t","getTrackById","id","entry","mdia","minf","stbl","stsd","entries","avcC","hvcC","av1C","stream","BIG_ENDIAN","write","Uint8Array","Error","info","videoTracks","codec","codedHeight","video","height","codedWidth","width","timescale","partSizeDivider","roundPartSize","bitrate","calculateStep","setExtractionOptions","nbSamples","trackId","ref","samples","sample","time","cts","type","is_sync","number","decodedSamples","has","EncodedVideoChunk","timestamp","add","parseInt","releaseUsedSamples","close","stop","size","max","round","generateUniqueId","pause","PART_TIMEOUT","requestStates","params","messageId","requestState","isResolved","promise","race","then","reject","Object","assign","catch","finally","message","postMessage","self","addEventListener","result","decoder","demuxer","onDestroy","workerIndex","workersTotal","onFrame","hasWebCodecs","globalThis","log","decodedFrames","VideoDecoder","output","frame","seconds","floor","bitmap","config","configure","chunk","state","decode","createCallbackManager","callbacks","addCallback","cb","removeCallback","runCallbacks","_len","args","Array","_key","forEach","callback","hasCallbacks","Boolean","DEBUG","callbackState","messageHandlers","onmessage","channel","sendToOrigin","transferables","handleErrors","onMessage","onUpdate","update","name","withCallback","callbackArgs","lastArg","isTransferable","push","isCanceled","obj","ArrayBuffer","ImageBitmap","onerror","reason","Date","now","toString","random","debounce","fn","ms","shouldRunFirst","shouldRunLast","waitingTimeout","clearTimeout","throttle","interval","isPending","_len2","_args","_key2","setInterval","clearInterval","throttleWithTickEnd","throttleWith","onTickEnd","schedulerFn","waiting","_len3","_key3","onIdle","timeout","requestIdleCallback","rafPromise","fastRaf","FAST_RAF_TIMEOUT_FALLBACK_MS","fastRafCallbacks","fastRafFallbackCallbacks","fastRafFallbackTimeout","withTimeoutFallback","requestAnimationFrame","currentCallbacks","window","currentTimeoutCallbacks","onTickEndCallbacks","beforeUnloadCallbacks","onBeforeUnload","isLast","unshift","filter"],"sourceRoot":""}